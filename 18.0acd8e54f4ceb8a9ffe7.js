(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{458:function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"e",(function(){return a})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return h})),r.d(e,"d",(function(){return d}));var s=r(38);class n{constructor(t,e){this.x=t,this.y=e}get u(){return this.x}get v(){return this.y}}function a(t,e){return new n(t.x-e.x,t.y-e.y)}class i{constructor(t,e,r){this.x=t,this.y=e,this.z=r}}class o{constructor(t){this.data=t,Object(s.d)(9===t.length,"data should be of length 9.")}static of(t,e,r,s,n,a,i,h,d){return new o(new Float32Array([t,s,i,e,n,h,r,a,d]))}static identity(){return o.of(1,0,0,0,1,0,0,0,1)}get(t,e){return this.data[t+3*e]}set(t,e,r){this.data[t+3*e]=r}clone(){return new o(new Float32Array(this.data))}transpose(){let t;const e=this.data;t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t}inverse(){const t=this.clone();return t.invert(),t}invert(){const t=this.data[0],e=this.data[1],r=this.data[2],s=this.data[3],n=this.data[4],a=this.data[5],i=this.data[6],o=this.data[7],h=this.data[8],d=h*n-a*o,c=a*i-h*s,u=o*s-n*i,f=t*d+e*c+r*u;if(0===f)return this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=1,this.data[5]=0,this.data[6]=0,this.data[7]=0,void(this.data[8]=1);const l=1/f;this.data[0]=d*l,this.data[1]=(r*o-h*e)*l,this.data[2]=(a*e-r*n)*l,this.data[3]=c*l,this.data[4]=(h*t-r*i)*l,this.data[5]=(r*s-a*t)*l,this.data[6]=u*l,this.data[7]=(e*i-o*t)*l,this.data[8]=(n*t-e*s)*l}}class h{constructor(t){this.data=t,Object(s.d)(16===t.length,"data should be of length 16.")}static of(t,e,r,s,n,a,i,o,d,c,u,f,l,x,_,w){return new h(new Float32Array([t,n,d,l,e,a,c,x,r,i,u,_,s,o,f,w]))}static identity(){return h.of(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static translation(t,e,r){return h.of(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1)}static scale(t,e,r){return h.of(t,0,0,1,0,e,0,1,0,0,r,1,0,0,0,1)}static compose(t,e,r){const s=e.w,n=e.x,a=e.y,i=e.z,o=n+n,d=a+a,c=i+i,u=n*o,f=n*d,l=n*c,x=a*d,_=a*c,w=i*c,g=s*o,m=s*d,p=s*c,v=r.x,T=r.y,b=r.z;return h.of((1-(x+w))*v,(f-p)*T,(l+m)*b,t.x,(f+p)*v,(1-(u+w))*T,(_-g)*b,t.y,(l-m)*v,(_+g)*T,(1-(u+x))*b,t.z,0,0,0,1)}get(t,e){return this.data[t+4*e]}set(t,e,r){this.data[t+4*e]=r}clone(){return new h(new Float32Array(this.data))}normal_mat3(){const t=o.of(this.data[0],this.data[4],this.data[8],this.data[1],this.data[5],this.data[9],this.data[2],this.data[6],this.data[10]);return t.invert(),t.transpose(),t}}function d(t,e){const r=new h(new Float32Array(16));return c(r.data,t,e),r}function c(t,e,r){for(let s=0;s<4;s++)for(let n=0;n<4;n++)for(let a=0;a<4;a++)t[s+4*n]+=e.data[s+4*a]*r.data[a+4*n]}},477:function(t,e,r){"use strict";var s;r.d(e,"d",(function(){return s})),r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return a})),r.d(e,"c",(function(){return i})),r.d(e,"f",(function(){return o})),r.d(e,"e",(function(){return h})),r.d(e,"g",(function(){return d})),function(t){t[t.PosNorm=0]="PosNorm",t[t.PosTex=1]="PosTex",t[t.PosNormTex=2]="PosNormTex"}(s||(s={}));const n=0,a=1,i=2;function o(t){switch(t){case s.PosNorm:return 24;case s.PosTex:return 16;case s.PosNormTex:return 28}}function h(t){switch(t){case s.PosTex:return-1;case s.PosNorm:case s.PosNormTex:return 12}}function d(t){switch(t){case s.PosNorm:return-1;case s.PosTex:return 12;case s.PosNormTex:return 24}}},495:function(t,e,r){"use strict";var s;r.d(e,"b",(function(){return s})),r.d(e,"a",(function(){return n})),function(t){t[t.RGBA_S3TC_DXT1=0]="RGBA_S3TC_DXT1",t[t.RGBA_S3TC_DXT3=1]="RGBA_S3TC_DXT3"}(s||(s={}));class n{constructor(t,e,r,s,n){this.gfx=t,this.format=e,this.width=r,this.height=s,this.data=n}upload(){null==this.gfx_texture&&(this.gfx_texture=this.gfx.create_texture(this.format,this.width,this.height,this.data))}destroy(){this.gfx.destroy_texture(this.gfx_texture)}}},517:function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return a}));var s=r(458);class n{constructor(){this.root_node=new a(void 0,s.a.identity())}traverse(t,e){this.traverse_node(this.root_node,t,e)}traverse_node(t,e,r){const s=e(t,r);for(const r of t.children)this.traverse_node(r,e,s)}}class a{constructor(t,e,...r){this.mesh=t,this.transform=e,this._children=r}get children(){return this._children}add_child(t){this._children.push(t)}clear_children(){this._children.splice(0)}}},540:function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return i})),r.d(e,"c",(function(){return o}));var s=r(133),n=r(495);function a(t,e){let r,s;switch(e.format[1]){case 6:r=n.b.RGBA_S3TC_DXT1,s=e.width*e.height/2;break;case 7:r=n.b.RGBA_S3TC_DXT3,s=e.width*e.height;break;default:throw new Error(`Format ${e.format.join(", ")} not supported.`)}return new n.a(t,r,e.width,e.height,e.data.slice(0,s))}function i(t){return t.textures.map(o)}function o(t){let e,r;switch(t.format[1]){case 6:e=s.RGBA_S3TC_DXT1_Format,r=t.width*t.height/2;break;case 7:e=s.RGBA_S3TC_DXT3_Format,r=t.width*t.height;break;default:throw new Error(`Format ${t.format.join(", ")} not supported.`)}const n=new s.CompressedTexture([{data:new Uint8Array(t.data,0,r),width:t.width,height:t.height}],t.width,t.height,e);return n.minFilter=s.LinearFilter,n.wrapS=s.MirroredRepeatWrapping,n.wrapT=s.MirroredRepeatWrapping,n.needsUpdate=!0,n}},651:function(t,e,r){"use strict";var s=r(477);class n{constructor(t){this.format=t,this.vertex_data=[],this.index_data=[]}get vertex_count(){return this.vertex_data.length}triangle(t,e,r){return this.index_data.push(t,e,r),this}build(){const t=Object(s.f)(this.format),e=Object(s.e)(this.format),r=Object(s.g)(this.format),n=new ArrayBuffer(this.vertex_data.length*t),a=new DataView(n);let i=0;for(const{pos:s,normal:n,tex:o}of this.vertex_data)a.setFloat32(i,s.x,!0),a.setFloat32(i+4,s.y,!0),a.setFloat32(i+8,s.z,!0),-1!==e&&(a.setFloat32(i+e,n.x,!0),a.setFloat32(i+e+4,n.y,!0),a.setFloat32(i+e+8,n.z,!0)),-1!==r&&(a.setUint16(i+r,65535*o.x,!0),a.setUint16(i+r+2,65535*o.y,!0)),i+=t;const o=new Uint16Array(2*Math.ceil(this.index_data.length/2));return o.set(this.index_data),new h(this.format,n,o,this.index_data.length,this._texture)}}class a extends n{constructor(){super(s.d.PosNorm)}vertex(t,e){return this.vertex_data.push({pos:t,normal:e}),this}}class i extends n{constructor(){super(s.d.PosTex)}vertex(t,e){return this.vertex_data.push({pos:t,tex:e}),this}texture(t){return this._texture=t,this}}class o extends n{constructor(){super(s.d.PosNormTex)}vertex(t,e,r){return this.vertex_data.push({pos:t,normal:e,tex:r}),this}texture(t){return this._texture=t,this}}r.d(e,"a",(function(){return h}));class h{constructor(t,e,r,s,n){this.format=t,this.vertex_data=e,this.index_data=r,this.index_count=s,this.texture=n}static builder(t){switch(t){case s.d.PosNorm:return new a;case s.d.PosTex:return new i;case s.d.PosNormTex:return new o}}upload(t){var e;null===(e=this.texture)||void 0===e||e.upload(),null==this.gfx_mesh&&(this.gfx_mesh=t.create_gfx_mesh(this.format,this.vertex_data,this.index_data,this.texture))}destroy(t){t.destroy_gfx_mesh(this.gfx_mesh)}}},833:function(t,e,r){"use strict";r.r(e),r.d(e,"TextureRenderer",(function(){return u}));var s=r(15),n=r(23),a=r(477),i=r(651),o=r(540),h=r(458),d=r(517);const c=n.a.get("viewer/rendering/TextureRenderer");class u{constructor(t,e){this.renderer=e,this.disposer=new s.a,this.canvas_element=e.canvas_element,this.disposer.add_all(t.textures.observe(({value:t})=>{e.destroy_scene(),e.camera.reset(),this.create_quads(t),e.schedule_render()}))}dispose(){this.renderer.dispose(),this.disposer.dispose()}start_rendering(){this.renderer.start_rendering()}stop_rendering(){this.renderer.stop_rendering()}set_size(t,e){this.renderer.set_size(t,e)}create_quads(t){let e=10*(t.length-1),r=0;for(const s of t)e+=s.width,r=Math.max(r,s.height);let s=-Math.floor(e/2);const n=-Math.floor(r/2);for(const e of t){try{const t=this.create_quad(e);t.upload(this.renderer.gfx),this.renderer.scene.root_node.add_child(new d.b(t,h.a.translation(s,n+(r-e.height)/2,0)))}catch(t){c.error("Couldn't create quad for texture.",t)}s+=10+e.width}}create_quad(t){return i.a.builder(a.d.PosTex).vertex(new h.c(0,0,0),new h.b(0,1)).vertex(new h.c(t.width,0,0),new h.b(1,1)).vertex(new h.c(t.width,t.height,0),new h.b(1,0)).vertex(new h.c(0,t.height,0),new h.b(0,0)).triangle(0,1,2).triangle(2,3,0).texture(Object(o.b)(this.renderer.gfx,t)).build()}}}}]);