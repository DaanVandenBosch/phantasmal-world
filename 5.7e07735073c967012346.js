(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"/UnV":function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var i=s("rwco"),n=s("BAAx"),a=s("5cb6");const r=i.a.get("core/data_formats/parsing/afs"),o=5457473;function c(e){const t=Object(n.b)(r);if(e.bytes_left<8)return t.add_problem(a.b.Error,"AFS archive is corrupted.","Too small to be an AFS archive.").failure();if(e.u32()!==o)return t.add_problem(a.b.Error,"AFS archive is corrupted.","Magic bytes not present.").failure();const s=e.u16();e.seek(2);const i=[];for(let n=1;n<=s;n++){if(e.bytes_left<8){t.add_problem(a.b.Warning,`AFS file entry ${n} is invalid.`,`Couldn't read file entry ${n}, only ${e.bytes_left} bytes left.`);break}const s=e.u32(),r=e.u32();if(s>e.size)t.add_problem(a.b.Warning,`AFS file entry ${n} is invalid.`,`Invalid file offset ${s} for entry ${n}.`);else if(s+r>e.size)t.add_problem(a.b.Warning,`AFS file entry ${n} is invalid.`,`File size ${r} (offset: ${s}) of entry ${n} too large.`);else{const t=e.position;e.seek_start(s),i.push(e.array_buffer(r)),e.seek_start(t)}}return t.success(i)}},"68q7":function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var i=s("iUMt"),n=s("KVVN"),a=s("jJhE"),r=s("FXpb"),o=s("ouMO");class c extends i.a{constructor(e){const t=new n.a({text:"Dismiss"});super(Object.assign({footer:[t.element]},e));const s=Object(a.a)(e.result)?e.result:Object(o.e)(e.result);this.problems_message=Object(a.a)(e.problems_message)?e.problems_message:Object(o.e)(e.problems_message),this.error_message=Object(a.a)(e.error_message)?e.error_message:Object(o.e)(e.error_message),this.disposables(t,t.onclick.observe(e=>this._ondismiss.emit(e)),s.observe(({value:e})=>this.result_changed(e),{call_now:!0})),this.finalize_construction()}result_changed(e){e?(this.content.val=function(e){const t=Object(r.h)();t.style.overflow="auto",t.style.userSelect="text",t.style.height="100%",t.style.maxHeight="400px";const s=Object(r.B)(...e.problems.map(e=>Object(r.o)(e.ui_message)));return s.style.cursor="text",t.append(s),t}(e),e.success?e.problems.length&&(this.title.val="Problems",this.description.val=this.problems_message.val):(this.title.val="Error",this.description.val=this.error_message.val)):this.content.val=""}}},"9fJw":function(e,t,s){"use strict";s.d(t,"g",(function(){return n})),s.d(t,"h",(function(){return a})),s.d(t,"f",(function(){return r})),s.d(t,"e",(function(){return o})),s.d(t,"k",(function(){return c})),s.d(t,"l",(function(){return _})),s.d(t,"j",(function(){return l})),s.d(t,"i",(function(){return h})),s.d(t,"a",(function(){return u})),s.d(t,"b",(function(){return d})),s.d(t,"d",(function(){return m})),s.d(t,"c",(function(){return b}));class i{constructor(e){var t,s,i,n,a;this.name=e.name,this.body_style_count=null!=(t=e.body_style_count)?t:1,this.head_style_count=e.head_style_count,this.hair_style_count=e.hair_style_count,this.hair_styles_with_accessory=e.hair_styles_with_accessory,this.body_tex_ids=null!=(s=e.body_tex_ids)?s:[],this.head_tex_ids=null!=(i=e.head_tex_ids)?i:[],this.hair_tex_ids=null!=(n=e.hair_tex_ids)?n:[],this.accessory_tex_ids=null!=(a=e.accessory_tex_ids)?a:[]}}const n=new i({name:"HUmar",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([6])}),a=new i({name:"HUnewearl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set}),r=new i({name:"HUcast",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),o=new i({name:"HUcaseal",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),c=new i({name:"RAmar",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),_=new i({name:"RAmarl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),l=new i({name:"RAcast",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),h=new i({name:"RAcaseal",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),u=new i({name:"FOmar",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),d=new i({name:"FOmarl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),m=new i({name:"FOnewm",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),b=new i({name:"FOnewearl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])})},HjM1:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("39ZU"),n=s("nN8q"),a=(s("4AvX"),s("FXpb"));const r=28;class o extends n.a{constructor(e,t){super(t),this.gui_store=e,this.tabs=[],this.bar_element=Object(a.h)({className:"core_TabContainer_Bar"}),this.panes_element=Object(a.h)({className:"core_TabContainer_Panes"}),this.element=Object(a.h)({className:"core_TabContainer"}),this.bar_mousedown=e=>{if(e.target instanceof HTMLElement){const t=e.target.dataset.key;t&&this.activate_key(t)}},this.bar_element.onmousedown=this.bar_mousedown;for(const e of t.tabs){const t=Object(a.s)({className:"core_TabContainer_Tab",data:{key:e.key}},e.title);this.bar_element.append(t);const s=this.disposable(new i.a(e.create_view)),n=Object.assign(Object.assign({},e),{tab_element:t,lazy_view:s});this.tabs.push(n),this.panes_element.append(s.element)}this.element.append(this.bar_element,this.panes_element),this.finalize_construction()}get children(){return this.tabs.flatMap(e=>e.lazy_view.children)}resize(e,t){super.resize(e,t),this.bar_element.style.width=`${e}px`,this.bar_element.style.height=`${r}px`;const s=t-r;this.panes_element.style.width=`${e}px`,this.panes_element.style.height=`${s}px`;for(const t of this.tabs)t.lazy_view.resize(e,s);return this}activate(){if(this.active_tab)this.activate_tab(this.active_tab);else{let e;for(const t of this.tabs)null!=t.path&&this.gui_store.path.val.startsWith(t.path)&&(e=t);e?this.activate_tab(e):this.tabs.length&&this.activate_tab(this.tabs[0])}}activate_key(e){for(const t of this.tabs)if(t.key===e){this.activate_tab(t);break}}activate_tab(e){this.active_tab!==e&&(this.active_tab&&(this.active_tab.tab_element.classList.remove("active"),this.active_tab.lazy_view.visible.val=!1,this.active_tab.lazy_view.deactivate()),this.active_tab=e,e.tab_element.classList.add("active"),e.lazy_view.visible.val=!0),null!=e.path&&(this.gui_store.set_path_prefix(e.path),e.lazy_view.activate())}}},U6CM:function(e,t,s){"use strict";s.r(t);var i=s("HjM1"),n=s("zsIO");class a extends n.a{constructor(e,t,s){super(),this.tab_container=this.add(new i.a(e,{class:"viewer_ViewerView",tabs:[{title:"Models",key:"model",path:"/models",create_view:t},{title:"Textures",key:"texture",path:"/textures",create_view:s}]})),this.finalize_construction()}get element(){return this.tab_container.element}resize(e,t){this.tab_container.resize(e,t)}}var r=s("Tpfs"),o=s("Womt"),c=s("Ftn7"),_=s("iR5r"),l=s("rwco");const h=l.a.get("viewer/rendering/TextureRenderer");class u extends c.a{constructor(e,t){super(t),this.disposer=new r.a,this.quad_meshes=[],this.camera=new o.OrthographicCamera(-400,400,300,-300,1,10),this.disposer.add_all(e.textures.observe(({value:e})=>{this.scene.remove(...this.quad_meshes),this.render_textures(e),this.reset_camera(new o.Vector3(0,0,5),new o.Vector3),this.schedule_render()})),this.init_camera_controls(),this.controls.azimuthRotateSpeed=0,this.controls.polarRotateSpeed=0}set_size(e,t){this.camera.left=-Math.floor(e/2),this.camera.right=Math.ceil(e/2),this.camera.top=Math.floor(t/2),this.camera.bottom=-Math.ceil(t/2),this.camera.updateProjectionMatrix(),super.set_size(e,t)}dispose(){super.dispose(),this.disposer.dispose()}render_textures(e){let t=10*(e.length-1),s=0;for(const i of e)t+=i.width,s=Math.max(s,i.height);let i=-Math.floor(t/2);const n=-Math.floor(s/2);for(const t of e){let e=void 0;try{e=Object(_.b)(t)}catch(e){h.error("Couldn't convert XVR texture.",e)}const a=new o.Mesh(this.create_quad(i,n+Math.floor((s-t.height)/2),t.width,t.height),e?new o.MeshBasicMaterial({map:e,transparent:!0}):new o.MeshBasicMaterial({color:16711935}));this.quad_meshes.push(a),this.scene.add(a),i+=10+t.width}}create_quad(e,t,s,i){const n=new o.PlaneGeometry(s,i,1,1);return n.faceVertexUvs=[[[new o.Vector2(0,0),new o.Vector2(0,1),new o.Vector2(1,0)],[new o.Vector2(0,1),new o.Vector2(1,1),new o.Vector2(1,0)]]],n.translate(e+s/2,t+i/2,-5),n}}var d=s("Eqai"),m=s("488w"),b=s("VwSi");const v=30;function p(e,t){const s=t.interpolation===b.a.Spline?o.InterpolateSmooth:o.InterpolateLinear,i=[];return t.motion_data.forEach((t,n)=>{const a=e.get_bone(n);a&&t.tracks.forEach(({type:e,keyframes:t})=>{const r=[],c=[];for(const s of t)if(r.push(s.frame/v),e===b.b.Rotation){const e=a.evaluation_flags.zxy_rotation_order?"ZXY":"ZYX",t=(new o.Quaternion).setFromEuler(new o.Euler(s.value.x,s.value.y,s.value.z,e));c.push(t.x,t.y,t.z,t.w)}else c.push(s.value.x,s.value.y,s.value.z);if(e===b.b.Rotation)i.push(new o.QuaternionKeyframeTrack(`.bones[${n}].quaternion`,r,c,s));else{const t=e===b.b.Position?`.bones[${n}].position`:`.bones[${n}].scale`;i.push(new o.VectorKeyframeTrack(t,r,c,s))}})}),new o.AnimationClip("Animation",(t.frame_count-1)/v,i).optimize()}const f=l.a.get("viewer/rendering/ModelRenderer"),y=new o.MeshLambertMaterial({color:16777215,side:o.DoubleSide}),w=new o.MeshLambertMaterial({skinning:!0,color:16777215,side:o.DoubleSide}),g=Object.freeze(new o.Vector3(0,10,20)),j=Object.freeze(new o.Vector3(0,0,0));class x extends c.a{constructor(e,t){super(t),this.store=e,this.disposer=new r.a,this.clock=new o.Clock,this.update_animation_time=!0,this.camera=new o.PerspectiveCamera(75,1,1,200),this.current_character_class_changed=e=>{const t=null!=e.value;this.character_class_active!==t&&this.reset_camera(g,j),this.character_class_active=t},this.nj_object_or_xvm_changed=()=>{var e;this.mesh&&(this.scene.remove(this.mesh),this.mesh=void 0,this.scene.remove(this.skeleton_helper),this.skeleton_helper=void 0);const t=this.store.current_nj_object.val;if(t){let s;if(this.animation){const t=this.animation.mixer;s=null===(e=t.existingAction(this.animation.clip))||void 0===e?void 0:e.time,t.stopAllAction(),t.uncacheAction(this.animation.clip),this.animation=void 0}const i=this.store.current_textures.val.map(e=>{if(e)try{return Object(_.b)(e)}catch(e){f.error("Couldn't convert XVR texture.",e)}}),n=Object(m.a)(t),a=null!=n.getAttribute("skinIndex"),r=i.map(e=>e?new o.MeshBasicMaterial({skinning:a,map:e,side:o.DoubleSide,alphaTest:.1,transparent:!0}):new o.MeshLambertMaterial({skinning:a,side:o.DoubleSide}));this.mesh=a?Object(d.b)(n,r,w):Object(d.a)(n,r,y);const c=n.boundingBox,l=c.max.y-c.min.y;this.mesh.translateY(-l/2-c.min.y),this.scene.add(this.mesh),this.skeleton_helper=new o.SkeletonHelper(this.mesh),this.skeleton_helper.visible=this.store.show_skeleton.val,this.skeleton_helper.material.linewidth=3,this.scene.add(this.skeleton_helper);const h=this.store.current_nj_motion.val;if(h){const e=new o.AnimationMixer(this.mesh);e.timeScale=this.store.animation_frame_rate.val/v;const i=p(t,h);this.animation={mixer:e,clip:i};const n=e.clipAction(i,this.mesh);n.time=null!=s?s:0,n.play()}}this.schedule_render()},this.nj_motion_changed=({value:e})=>{let t;this.animation&&(this.animation.mixer.stopAllAction(),this.animation.mixer.uncacheAction(this.animation.clip),t=this.animation.mixer);const s=this.store.current_nj_object.val;if(!(this.mesh&&this.mesh instanceof o.SkinnedMesh&&e&&s))return;t||(t=new o.AnimationMixer(this.mesh));const i=p(s,e);this.animation={mixer:t,clip:i},this.clock.start(),t.clipAction(i).play(),this.schedule_render()},this.show_skeleton_changed=({value:e})=>{this.skeleton_helper&&(this.skeleton_helper.visible=e,this.schedule_render())},this.animation_playing_changed=({value:e})=>{this.animation&&(this.animation.mixer.clipAction(this.animation.clip).paused=!e,e?(this.clock.start(),this.schedule_render()):this.clock.stop())},this.animation_frame_rate_changed=({value:e})=>{this.animation&&(this.animation.mixer.timeScale=e/v)},this.animation_frame_changed=({value:e})=>{const t=this.store.current_nj_motion.val;if(this.animation&&t){const s=t.frame_count;e>s&&(e=1),e<1&&(e=s),this.update_animation_time&&(this.animation.mixer.clipAction(this.animation.clip).time=(e-1)/v),this.schedule_render()}},this.character_class_active=null!=e.current_character_class.val,this.disposer.add_all(e.current_character_class.observe(this.current_character_class_changed),e.current_nj_object.observe(this.nj_object_or_xvm_changed),e.current_textures.observe(this.nj_object_or_xvm_changed),e.current_nj_motion.observe(this.nj_motion_changed),e.show_skeleton.observe(this.show_skeleton_changed),e.animation_playing.observe(this.animation_playing_changed),e.animation_frame_rate.observe(this.animation_frame_rate_changed),e.animation_frame.observe(this.animation_frame_changed)),this.init_camera_controls(),this.reset_camera(g,j)}set_size(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),super.set_size(e,t)}dispose(){super.dispose(),this.disposer.dispose()}render(){this.animation&&this.animation.mixer.update(this.clock.getDelta()),this.light_holder.quaternion.copy(this.camera.quaternion),super.render(),this.animation&&!this.animation.mixer.clipAction(this.animation.clip).paused&&(this.update_animation_frame(),this.schedule_render())}update_animation_frame(){if(this.animation){const e=this.animation.mixer.clipAction(this.animation.clip);e.paused||(this.update_animation_time=!1,this.store.set_animation_frame(e.time*v+1),this.update_animation_time=!0)}}}var k=s("w6HN"),O=s("6cU9"),M=s("oyid"),S=s("PE7g"),A=s("7ZX1"),z=s("FXpb"),V=s("6Fug"),C=s("68q7");class $ extends V.a{constructor(e){super();const t=new O.a({icon_left:z.a.File,text:"Open file...",accept:".afs, .nj, .njm, .xj, .xvm"}),s=new M.a(!1,{label:"Show skeleton"}),i=new M.a(!0,{label:"Play animation"}),n=new S.a(v,{label:"Frame rate:",min:1,max:240,step:1}),a=new S.a(1,{label:"Frame:",min:1,max:e.animation_frame_count,step:1}),r=new A.a(e.animation_frame_count_label);this.toolbar=this.add(new k.a(t,s,i,n,a,r));const o=this.disposable(new C.a({visible:e.result_dialog_visible,result:e.result,problems_message:e.result_problems_message,error_message:e.result_error_message}));this.disposables(t.files.observe(({value:t})=>{t.length&&e.load_file(t[0])}),s.checked.observe(({value:t})=>e.set_show_skeleton(t)),o.ondismiss.observe(e.dismiss_result_dialog));const c=e.animation_controls_enabled;this.disposables(i.enabled.bind_to(c),i.checked.bind_to(e.animation_playing),i.checked.observe(({value:t})=>e.set_animation_playing(t)),n.enabled.bind_to(c),n.value.observe(({value:t})=>e.set_animation_frame_rate(t)),a.enabled.bind_to(c),a.value.bind_to(e.animation_frame),a.value.observe(({value:t})=>e.set_animation_frame(t)),r.enabled.bind_to(c)),this.finalize_construction()}get element(){return this.toolbar.element}get height(){return this.toolbar.height}}var F=s("kcKQ"),R=s("9fJw"),P=s("ouMO");class T{constructor(e,t){this.id=e,this.name=t}}var U=s("nsCy"),E=s("4SjJ"),L=s("uiJh"),q=function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function r(e){try{c(i.next(e))}catch(e){a(e)}}function o(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}c((i=i.apply(e,t||[])).next())}))};const H=l.a.get("viewer/stores/ModelStore");class N extends F.a{constructor(e,t,s){super(),this.asset_loader=t,this.random=s,this._current_character_class=Object(P.e)(void 0),this._current_section_id=Object(P.e)(void 0),this._current_body=Object(P.e)(void 0),this._current_animation=Object(P.e)(void 0),this._current_nj_object=Object(P.e)(void 0),this._current_textures=Object(P.c)(),this._current_nj_motion=Object(P.e)(void 0),this._show_skeleton=Object(P.e)(!1),this._animation_playing=Object(P.e)(!0),this._animation_frame_rate=Object(P.e)(v),this._animation_frame=Object(P.e)(0),this.character_classes=[R.g,R.h,R.f,R.e,R.k,R.l,R.j,R.i,R.a,R.b,R.d,R.c],this.current_character_class=this._current_character_class,this.current_section_id=this._current_section_id,this.current_body=this._current_body,this.animations=new Array(572).fill(void 0).map((e,t)=>new T(t,`Animation ${t+1}`)),this.current_animation=this._current_animation,this.current_nj_object=this._current_nj_object,this.current_textures=this._current_textures,this.current_nj_motion=this._current_nj_motion,this.animation_frame_count=this.current_nj_motion.map(e=>e?e.frame_count:0),this.show_skeleton=this._show_skeleton,this.animation_playing=this._animation_playing,this.animation_frame_rate=this._animation_frame_rate,this.animation_frame=this._animation_frame,this.set_current_character_class=e=>{var t;if(this._current_character_class.val!==e){if(null==e)this.set_current_body(void 0);else{const s=this.current_body.val;(void 0===s||s>=(null===(t=e)||void 0===t?void 0:t.body_style_count))&&this.set_current_body(e.body_style_count-1)}this._current_character_class.val=e,null==this.current_animation.val&&this.set_current_nj_motion(void 0)}},this.set_current_section_id=e=>{this._current_section_id.val=e},this.set_current_body=e=>{this._current_body.val=e},this.set_current_animation=e=>{this._current_animation.val!==e&&(this._current_animation.val=e)},this.set_current_nj_object=e=>{this.set_current_character_class(void 0),this.set_current_animation(void 0),this.set_current_textures([]),this.set_current_nj_motion(void 0),this._current_nj_object.val=e},this.set_current_textures=e=>{this._current_textures.val=e},this.set_current_nj_motion=e=>{this.set_current_animation(void 0),this._current_nj_motion.val=e},this.set_show_skeleton=e=>{this._show_skeleton.val=e},this.set_animation_playing=e=>{this._animation_playing.val=e},this.set_animation_frame_rate=e=>{this._animation_frame_rate.val=e},this.set_animation_frame=e=>{this._animation_frame.val=e},this.load_character_class_model=()=>q(this,void 0,void 0,(function*(){const e=this.current_character_class.val;if(null==e)return;const t=this.current_section_id.val;if(null==t)return;const s=this.current_body.val;if(null!=s)try{const i=yield this.asset_loader.load_geometry(e);this._current_textures.val=yield this.asset_loader.load_textures(e,t,s),this._current_nj_object.val=i}catch(t){H.error(`Couldn't load model for ${e.name}.`),this._current_nj_object.val=void 0}})),this.load_animation=()=>q(this,void 0,void 0,(function*(){const e=this._current_nj_object.val,t=this.current_animation.val;if(e&&t)try{this._current_nj_motion.val=yield this.asset_loader.load_animation(t.id,64),this.set_animation_playing(!0)}catch(e){H.error(`Couldn't load animation "${t.name}".`,e),this._current_nj_motion.val=void 0}else this._current_nj_motion.val=void 0})),this.disposables(this.current_character_class.observe(this.load_character_class_model),this.current_section_id.observe(this.load_character_class_model),this.current_body.observe(this.load_character_class_model),this.current_animation.observe(this.load_animation)),this.disposables(e.bind_parameter(E.b.Viewer,"/models","model",this.current_character_class.map(e=>void 0===e?void 0:e.name)),e.bind_parameter(E.b.Viewer,"/models","section_id",this.current_section_id.map(e=>void 0===e?void 0:U.e[e])),e.bind_parameter(E.b.Viewer,"/models","body",this.current_body.map(e=>void 0===e?void 0:String(e+1))));const i=e.get_parameter(E.b.Viewer,"/models","model");let n=this.character_classes.find(e=>e.name===i);null==n&&(n=s.sample_array(this.character_classes));const a=e.get_parameter(E.b.Viewer,"/models","body");let r=null==a?void 0:parseInt(a,10);null!=r&&Number.isInteger(r)?r--:r=s.integer(0,n.body_style_count);const o=e.get_parameter(E.b.Viewer,"/models","section_id"),c=void 0===o?void 0:Object(L.b)(U.e,o);this._current_section_id.val=null!=c?c:s.sample_array(U.f),this._current_body.val=r,this._current_character_class.val=n}}var B=s("mKaR"),I=s("iPoI"),W=s("NRxM"),X=s("bcBH"),D=s("kwt4"),J=s("yub1"),Z=s("/UnV"),K=s("IMNf"),Q=s("BAAx"),Y=s("5cb6"),G=function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function r(e){try{c(i.next(e))}catch(e){a(e)}}function o(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}c((i=i.apply(e,t||[])).next())}))};const ee=l.a.get("viewer/controllers/model/ModelToolBarController");class te extends B.a{constructor(e){super(),this.store=e,this._result_dialog_visible=Object(P.e)(!1),this._result=Object(P.e)(void 0),this._result_problems_message=Object(P.e)(""),this._result_error_message=Object(P.e)(""),this.result_dialog_visible=this._result_dialog_visible,this.result=this._result,this.result_problems_message=this._result_problems_message,this.result_error_message=this._result_error_message,this.set_show_skeleton=e=>{this.store.set_show_skeleton(e)},this.set_animation_playing=e=>{this.store.set_animation_playing(e)},this.set_animation_frame_rate=e=>{this.store.set_animation_frame_rate(e)},this.set_animation_frame=e=>{this.store.set_animation_frame(e)},this.load_file=e=>G(this,void 0,void 0,(function*(){this._result_problems_message.val=`Encountered some problems while opening "${e.name}".`,this._result_error_message.val=`Couldn't open "${e.name}".`;try{const t=yield Object(I.b)(e),s=new W.a(t,X.a.Little);if(e.name.endsWith(".nj")){const e=Object(D.c)(s);this.set_result(e),e.success&&this.store.set_current_nj_object(e.value[0])}else if(e.name.endsWith(".xj")){const e=Object(D.d)(s);this.set_result(e),e.success&&this.store.set_current_nj_object(e.value[0])}else if(e.name.endsWith(".njm")){this.store.set_current_animation(void 0),this.store.set_current_nj_motion(void 0);const e=this.store.current_nj_object.val;e?(this.set_animation_playing(!0),this.store.set_current_nj_motion(Object(b.c)(s,e.bone_count())),this.set_result(Object(Q.c)(void 0))):this.set_result(Object(Q.a)([{severity:Y.b.Error,ui_message:"No model to animate"}]))}else if(e.name.endsWith(".xvm")){const e=Object(J.b)(s);this.set_result(e),e.success?this.store.set_current_textures(e.value.textures):this.store.set_current_textures([])}else if(e.name.endsWith(".afs")){const e=Object(Q.b)(ee),t=Object(Z.a)(s);if(e.add_result(t),t.success){const s=t.value.flatMap(t=>{var s,i,n,a;const r=new W.a(t,X.a.Little);if(Object(J.a)(r)){const t=Object(J.b)(r);return e.add_result(t),null!=(i=null===(s=t.value)||void 0===s?void 0:s.textures)?i:[]}{const t=Object(J.b)(Object(K.a)(r.seek_start(0)));return e.add_result(t),null!=(a=null===(n=t.value)||void 0===n?void 0:n.textures)?a:[]}});s.length?this.set_result(e.success(s)):this.set_result(e.failure()),this.store.set_current_textures(s)}else this.set_result(e.failure())}else ee.debug(`Unsupported file extension in filename "${e.name}".`),this.set_result(Object(Q.a)([{severity:Y.b.Error,ui_message:"Unsupported file type."}]))}catch(e){ee.error("Couldn't read file.",e),this.set_result(Object(Q.a)())}})),this.dismiss_result_dialog=()=>{this._result_dialog_visible.val=!1},this.show_skeleton=e.show_skeleton,this.animation_frame_count=e.animation_frame_count,this.animation_frame_count_label=e.animation_frame_count.map(e=>`/ ${e}`),this.animation_controls_enabled=e.current_nj_motion.map(e=>null!=e),this.animation_playing=e.animation_playing,this.animation_frame_rate=e.animation_frame_rate,this.animation_frame=e.animation_frame.map(e=>Math.round(e))}set_result(e){this._result.val=e,e.problems.length&&(this._result_dialog_visible.val=!0)}}var se=s("sv1z");s("ePAx");class ie extends n.a{constructor(e){var t,s;super();const i=this.add(new se.a({class:"viewer_model_CharacterClassOptionsView_section_id",label:"Section ID:",items:U.f,selected:e.current_section_id,to_label:e=>null==e?"":U.e[e],enabled:e.enabled})),n=this.add(new se.a({class:"viewer_model_CharacterClassOptionsView_body",label:"Body:",items:e.current_body_options,selected:e.current_body,enabled:e.enabled}));this.element=Object(z.h)({className:"viewer_model_CharacterClassOptionsView"},Object(z.t)(Object(z.A)(Object(z.v)(null===(t=i.label)||void 0===t?void 0:t.element),Object(z.v)(i.element)),Object(z.A)(Object(z.v)(null===(s=n.label)||void 0===s?void 0:s.element),Object(z.v)(n.element)))),this.disposables(i.selected.observe(({value:t})=>e.set_current_section_id(t)),n.selected.observe(({value:t})=>e.set_current_body(t))),this.finalize_construction()}}var ne=s("LvDl");class ae extends B.a{constructor(e){super(),this.store=e,this.set_current_section_id=e=>{null!=e&&this.store.set_current_section_id(e)},this.set_current_body=e=>{this.store.set_current_body(null==e?void 0:e-1)},this.enabled=e.current_character_class.map(e=>null!=e),this.current_section_id=e.current_section_id,this.current_body_options=e.current_character_class.map(e=>e?Object(ne.range)(1,e.body_style_count+1):[]),this.current_body=e.current_body.map(e=>null==e?void 0:e+1)}}s.d(t,"initialize_viewer",(function(){return oe}));var re=function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function r(e){try{c(i.next(e))}catch(e){a(e)}}function o(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}c((i=i.apply(e,t||[])).next())}))};function oe(e,t,i,n){const o=new r.a;return{view:new a(i,()=>re(this,void 0,void 0,(function*(){const{ModelController:a}=yield s.e(14).then(s.bind(null,"UwGQ")),{ModelView:r}=yield Promise.all([s.e(1),s.e(11)]).then(s.bind(null,"puLw")),{CharacterClassAssetLoader:c}=yield s.e(15).then(s.bind(null,"ZV42")),_=o.add(new c(e)),l=o.add(new N(i,_,t)),h=new a(l),u=new te(l),d=new ae(l);return new r(h,new $(u),new ie(d),new x(l,n()))})),()=>re(this,void 0,void 0,(function*(){const{TextureController:e}=yield s.e(13).then(s.bind(null,"QRTb")),{TextureView:t}=yield s.e(10).then(s.bind(null,"Za3H")),i=o.add(new e);return new t(i,new u(i,n()))}))),dispose(){o.dispose()}}}},VwSi:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return r})),s.d(t,"c",(function(){return o}));var i=s("kwt4");const n=1296321870;var a,r;function o(e,t){return e.u32()===n?function(e,t){const s=e.u32();return c(e.take(s),t)}(e,t):(e.seek_start(0),function(e,t){e.seek_end(16);const s=e.u32();e.seek_start(s);const i=e.u32();return e.seek_start(i),function(e,t){e.seek(4);const s=e.u32();return e.seek_start(s),c(e,t)}(e,t)}(e,t))}function c(e,t){let s=e.u32();const i=e.u32(),n=e.u16(),a=e.u16(),o=(192&a)>>6,c=15&a,h=[];for(let a=0;a<t;a++){e.seek_start(s),s=s+=8*c;const t={tracks:[]};h.push(t);const a=[],o=[];for(let t=0;t<c;t++)a.push(e.u32());for(let t=0;t<c;t++){const t=e.u32();o.push(t)}if(1&n){e.seek_start(a.shift());const s=o.shift();s&&t.tracks.push({type:r.Position,keyframes:_(e,s)})}if(2&n){e.seek_start(a.shift());const s=o.shift();s&&t.tracks.push({type:r.Rotation,keyframes:l(e,s,i)})}if(4&n){e.seek_start(a.shift());const s=o.shift();s&&t.tracks.push({type:r.Scale,keyframes:_(e,s)})}}return{motion_data:h,frame_count:i,type:n,interpolation:o,element_count:c}}function _(e,t){const s=[];for(let i=0;i<t;++i)s.push({frame:e.u32(),value:e.vec3_f32()});return s}function l(e,t,s){const n=[],a=e.position;for(let s=0;s<t;++s)n.push({frame:e.u16(),value:{x:e.u16()*i.a,y:e.u16()*i.a,z:e.u16()*i.a}});let r=-1;for(const{frame:i}of n){if(i<r||i>=s)return e.seek_start(a),h(e,t);r=i}return n}function h(e,t){const s=[];for(let n=0;n<t;++n)s.push({frame:e.u32(),value:{x:e.i32()*i.a,y:e.i32()*i.a,z:e.i32()*i.a}});return s}!function(e){e[e.Linear=0]="Linear",e[e.Spline=1]="Spline",e[e.UserFunction=2]="UserFunction"}(a||(a={})),function(e){e[e.Position=0]="Position",e[e.Rotation=1]="Rotation",e[e.Scale=2]="Scale"}(r||(r={}))}}]);