(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{455:function(e,t,i){"use strict";function o(e,t){return{success:!0,value:e,problems:null!=t?t:[]}}function s(e){return{success:!1,problems:null!=e?e:[]}}function n(e){if(e.success)return e.value;throw new Error(e.problems.join("\n"))}function r(e){return new a(e)}i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return s})),i.d(t,"d",(function(){return n})),i.d(t,"b",(function(){return r}));class a{constructor(e){this.logger=e,this.problems=[]}add_problem(e,t,i,o){return this.logger.log(e,i,o),this.problems.push({severity:e,ui_message:t}),this}add_result(e){return this.problems.push(...e.problems),this}success(e){return o(e,this.problems)}failure(){return s(this.problems)}}},459:function(e,t,i){"use strict";var o;i.d(t,"a",(function(){return o})),function(e){e[e.Little=0]="Little",e[e.Big=1]="Big"}(o||(o={}))},463:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"g",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"j",(function(){return a})),i.d(t,"h",(function(){return d})),i.d(t,"i",(function(){return c})),i.d(t,"d",(function(){return _})),i.d(t,"a",(function(){return u})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return p}));var o=i(40);class s{constructor(e,t){this.x=e,this.y=t}get u(){return this.x}get v(){return this.y}}function n(e,t){return new s(e.x-t.x,e.y-t.y)}class r{constructor(e,t,i){this.x=e,this.y=t,this.z=i}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){const e=1/this.magnitude();this.x*=e,this.y*=e,this.z*=e}}function a(e,t){return new r(e.x-t.x,e.y-t.y,e.z-t.z)}function d(e,t){return new r(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)}function c(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}class l{constructor(e){this.data=e,Object(o.d)(9===e.length,"data should be of length 9.")}static of(e,t,i,o,s,n,r,a,d){return new l(new Float32Array([e,o,r,t,s,a,i,n,d]))}static identity(){return l.of(1,0,0,0,1,0,0,0,1)}get(e,t){return this.data[e+3*t]}set(e,t,i){this.data[e+3*t]=i}clone(){return new l(new Float32Array(this.data))}transpose(){let e;const t=this.data;e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e}inverse(){const e=this.clone();return e.invert(),e}invert(){const e=this.data[0],t=this.data[1],i=this.data[2],o=this.data[3],s=this.data[4],n=this.data[5],r=this.data[6],a=this.data[7],d=this.data[8],c=d*s-n*a,l=n*r-d*o,_=a*o-s*r,u=e*c+t*l+i*_;if(0===u)return this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=1,this.data[5]=0,this.data[6]=0,this.data[7]=0,void(this.data[8]=1);const h=1/u;this.data[0]=c*h,this.data[1]=(i*a-d*t)*h,this.data[2]=(n*t-i*s)*h,this.data[3]=l*h,this.data[4]=(d*e-i*r)*h,this.data[5]=(i*o-n*e)*h,this.data[6]=_*h,this.data[7]=(t*r-a*e)*h,this.data[8]=(s*e-t*o)*h}}function _(e,t,i){const o=e.get(0,0)*t.x+e.get(0,1)*t.y+e.get(0,2)*t.z,s=e.get(1,0)*t.x+e.get(1,1)*t.y+e.get(1,2)*t.z,n=e.get(2,0)*t.x+e.get(2,1)*t.y+e.get(2,2)*t.z;i.x=o,i.y=s,i.z=n}class u{constructor(e){this.data=e,Object(o.d)(16===e.length,"data should be of length 16.")}static of(e,t,i,o,s,n,r,a,d,c,l,_,h,v,p,g){return new u(new Float32Array([e,s,d,h,t,n,c,v,i,r,l,p,o,a,_,g]))}static identity(){return u.of(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static translation(e,t,i){return u.of(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1)}static scale(e,t,i){return u.of(e,0,0,1,0,t,0,1,0,0,i,1,0,0,0,1)}static compose(e,t,i){const o=t.w,s=t.x,n=t.y,r=t.z,a=s+s,d=n+n,c=r+r,l=s*a,_=s*d,h=s*c,v=n*d,p=n*c,g=r*c,b=o*a,f=o*d,m=o*c,w=i.x,k=i.y,y=i.z;return u.of((1-(v+g))*w,(_-m)*k,(h+f)*y,e.x,(_+m)*w,(1-(l+g))*k,(p-b)*y,e.y,(h-f)*w,(p+b)*k,(1-(l+v))*y,e.z,0,0,0,1)}get(e,t){return this.data[e+4*t]}set(e,t,i){this.data[e+4*t]=i}set_all(e,t,i,o,s,n,r,a,d,c,l,_,u,h,v,p){this.data[0]=e,this.data[1]=s,this.data[2]=d,this.data[3]=u,this.data[4]=t,this.data[5]=n,this.data[6]=c,this.data[7]=h,this.data[8]=i,this.data[9]=r,this.data[10]=l,this.data[11]=v,this.data[12]=o,this.data[13]=a,this.data[14]=_,this.data[15]=p}transpose(){let e;const t=this.data;e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e}clone(){return new u(new Float32Array(this.data))}normal_mat3(){const e=l.of(this.data[0],this.data[4],this.data[8],this.data[1],this.data[5],this.data[9],this.data[2],this.data[6],this.data[10]);return e.invert(),e.transpose(),e}}function h(e,t){const i=new u(new Float32Array(16));return v(i.data,e,t),i}function v(e,t,i){for(let o=0;o<4;o++)for(let s=0;s<4;s++)for(let n=0;n<4;n++)e[o+4*s]+=t.data[o+4*n]*i.data[n+4*s]}function p(e,t,i){const o=e.get(0,0)*t.x+e.get(0,1)*t.y+e.get(0,2)*t.z+e.get(0,3),s=e.get(1,0)*t.x+e.get(1,1)*t.y+e.get(1,2)*t.z+e.get(1,3),n=e.get(2,0)*t.x+e.get(2,1)*t.y+e.get(2,2)*t.z+e.get(2,3);i.x=o,i.y=s,i.z=n}},468:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var o=i(488);class s extends o.a{constructor(e,t,i=0,o=e.byteLength-i){super(t,i),this._size=o,this.backing_buffer=e,this.dv=new DataView(e,0,e.byteLength)}get size(){return this._size}set size(e){if(e>this.backing_buffer.byteLength-this.offset)throw new Error(`Size ${e} is out of bounds.`);this._size=e}take(e){const t=this.offset+this.position,i=new s(this.backing_buffer,this.endianness,t,e);return this._position+=e,i}}},482:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return d}));var o=i(455),s=i(23),n=i(27);const r=s.a.get("core/data_formats/parsing/iff");function a(e,t=!1){return c(e,t,[],(e,t,i)=>({type:t,data:e.take(i)}))}function d(e,t=!1){return c(e,t,[],(e,t,i)=>({type:t,size:i}))}function c(e,t,i,s){const a=Object(o.b)(r);let d=!1;for(;e.bytes_left>=8;){const o=e.u32(),r=e.position,c=e.u32();if(c>e.bytes_left){d=!0,t||a.add_problem(0===i.length?n.b.Error:n.b.Warning,"Invalid IFF format.",`Size ${c} was too large (only ${e.bytes_left} bytes left) at position ${r}.`);break}i.push(s(e,o,c))}return d&&0===i.length?a.failure():a.success(i)}},483:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n}));var o=i(2);function s(e){return new Promise(t=>{var i,s;const n=Object(o.m)({type:"file"});n.accept=null!==(i=null==e?void 0:e.accept)&&void 0!==i?i:"",n.multiple=null!==(s=null==e?void 0:e.multiple)&&void 0!==s&&s,n.onchange=()=>{n.files&&n.files.length?t([...n.files]):t([])},n.click()})}function n(e){return new Promise((t,i)=>{const o=new FileReader;o.addEventListener("loadend",()=>{o.result instanceof ArrayBuffer?t(o.result):i(new Error("Couldn't read file."))}),o.readAsArrayBuffer(e)})}},484:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var o=i(488);class s extends o.a{constructor(e,t,i=0,o=e.size-i){if(i<0||i>e.size)throw new Error(`Offset ${i} is out of bounds.`);if(o<0||i+o>e.size)throw new Error(`Size ${o} is out of bounds.`);super(t,i),this.buffer=e,this._size=o}get size(){return this._size}set size(e){e>this._size?this.ensure_size(e-this.position):this._size=e}get backing_buffer(){return this.buffer.backing_buffer}get dv(){return this.buffer.view}take(e){this.check_size("size",e,e);const t=this.offset+this.position,i=new s(this.buffer,this.endianness,t,e);return this._position+=e,i}ensure_size(e,t=this.position){const i=t+e-this._size;i>0&&(this._size+=i,this.buffer.size<this.offset+this._size&&(this.buffer.size=this.offset+this._size))}}},487:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return w})),i.d(t,"d",(function(){return k})),i.d(t,"e",(function(){return y}));var o=i(482),s=i(23);const n=s.a.get("core/data_formats/parsing/ninja/njcm");var r;function a(e,t){const i=e.u32(),o=e.u32(),s=e.vec3_f32(),n=e.f32(),a=[],c=[];if(i){e.seek_start(i);for(const i of d(e,t,!0))if(i.type===r.Vertex)for(const e of i.vertices)a[e.index]={position:e.position,normal:e.normal,bone_weight:e.bone_weight,bone_weight_status:e.bone_weight_status,calc_continue:e.calc_continue}}if(o){e.seek_start(o);let i=void 0,s=void 0,n=void 0;for(const o of d(e,t,!1))switch(o.type){case r.Bits:s=o.src_alpha,n=o.dst_alpha;break;case r.Tiny:i=o.texture_id;break;case r.Material:s=o.src_alpha,n=o.dst_alpha;break;case r.Strip:for(const e of o.triangle_strips)e.texture_id=i,e.src_alpha=s,e.dst_alpha=n;c.push(...o.triangle_strips)}}return{type:"njcm",vertices:a,meshes:c,collision_sphere_center:s,collision_sphere_radius:n}}function d(e,t,i){const o=[];let s=!0;for(;s;){const a=e.u8(),_=e.u8(),u=e.position;let h=0;if(0===a)o.push({type:r.Null,type_id:a});else if(1<=a&&a<=3)o.push({type:r.Bits,type_id:a,src_alpha:_>>>3&7,dst_alpha:7&_});else if(4===a){const i=_,n=e.position;o.push({type:r.CachePolygonList,type_id:a,cache_index:i,offset:n}),t[i]=n,s=!1}else if(5===a){const s=_,n=t[s];null!=n&&(e.seek_start(n),o.push(...d(e,t,i))),o.push({type:r.DrawPolygonList,type_id:a,cache_index:s})}else if(8<=a&&a<=9){h=2;const t=e.u16();o.push({type:r.Tiny,type_id:a,flip_u:0!=(128&a),flip_v:0!=(64&a),clamp_u:0!=(32&a),clamp_v:0!=(16&a),mipmap_d_adjust:15&a,filter_mode:t>>>14,super_sample:0!=(64&t),texture_id:8191&t})}else if(17<=a&&a<=31){let t,i,s;h=2+2*e.u16(),0!=(1&_)&&(t={b:e.u8()/255,g:e.u8()/255,r:e.u8()/255,a:e.u8()/255}),0!=(2&_)&&(i={b:e.u8()/255,g:e.u8()/255,r:e.u8()/255,a:e.u8()/255}),0!=(4&_)&&(s={b:e.u8(),g:e.u8(),r:e.u8(),e:e.u8()}),o.push({type:r.Material,type_id:a,src_alpha:_>>>3&7,dst_alpha:7&_,diffuse:t,ambient:i,specular:s})}else 32<=a&&a<=50?(h=2+4*e.u16(),o.push({type:r.Vertex,type_id:a,vertices:c(e,a,_)})):56<=a&&a<=58?(h=2+2*e.u16(),o.push({type:r.Volume,type_id:a})):64<=a&&a<=75?(h=2+2*e.u16(),o.push({type:r.Strip,type_id:a,triangle_strips:l(e,a,_)})):255===a?(h=i?2:0,o.push({type:r.End,type_id:a}),s=!1):(h=2+2*e.u16(),o.push({type:r.Unknown,type_id:a}),n.warn(`Unknown chunk type ${a} at offset ${u}.`));e.seek_start(u+h)}return o}function c(e,t,i){if(t<32||t>50)return n.warn(`Unknown vertex chunk type ${t}.`),[];const o=3&i,s=0!=(128&i),r=e.u16(),a=e.u16(),d=[];for(let i=0;i<a;++i){const n={index:r+i,position:e.vec3_f32(),bone_weight:1,bone_weight_status:o,calc_continue:s};if(32===t)e.seek(4);else if(33===t)e.seek(4),n.normal=e.vec3_f32(),e.seek(4);else if(35<=t&&t<=40)37===t?(n.index=r+e.u16(),n.bone_weight=e.u16()/255):e.seek(4);else if(41<=t&&t<=47)n.normal=e.vec3_f32(),t>=42&&(44===t?(n.index=r+e.u16(),n.bone_weight=e.u16()/255):e.seek(4));else if(48<=t&&t<=50){const i=e.u32();n.normal={x:(i>>20&1023)/1023,y:(i>>10&1023)/1023,z:(1023&i)/1023},t>=49&&e.seek(4)}d.push(n)}return d}function l(e,t,i){const o={ignore_light:0!=(1&i),ignore_specular:0!=(2&i),ignore_ambient:0!=(4&i),use_alpha:0!=(8&i),double_side:0!=(16&i),flat_shading:0!=(32&i),environment_mapping:0!=(64&i)},s=e.u16(),n=s>>>14,r=16383&s;let a=!1,d=!1,c=!1,l=!1;switch(t){case 64:break;case 65:case 66:a=!0;break;case 67:c=!0;break;case 68:case 69:a=!0,c=!0;break;case 70:d=!0;break;case 71:case 72:a=!0,d=!0;break;case 73:break;case 74:case 75:l=!0;break;default:throw new Error(`Unexpected chunk type ID: ${t}.`)}const _=[];for(let t=0;t<r;++t){const t=e.i16(),i=t<1,s=Math.abs(t),r=[];for(let t=0;t<s;++t){const i={index:e.u16()};r.push(i),a&&(i.tex_coords={x:e.u16()/255,y:e.u16()/255}),d&&e.seek(4),c&&(i.normal={x:e.u16()/255,y:e.u16()/255,z:e.u16()/255}),l&&e.seek(8),t>=2&&e.seek(2*n)}_.push(Object.assign(Object.assign({},o),{clockwise_winding:i,has_tex_coords:a,has_normal:c,vertices:r}))}return _}!function(e){e[e.Unknown=0]="Unknown",e[e.Null=1]="Null",e[e.Bits=2]="Bits",e[e.CachePolygonList=3]="CachePolygonList",e[e.DrawPolygonList=4]="DrawPolygonList",e[e.Tiny=5]="Tiny",e[e.Material=6]="Material",e[e.Vertex=7]="Vertex",e[e.Volume=8]="Volume",e[e.Strip=9]="Strip",e[e.End=10]="End"}(r||(r={}));const _=s.a.get("core/data_formats/parsing/ninja/xj");function u(e){e.seek(4);const t=e.u32(),i=e.u32(),o=e.u32(),s=e.u32(),n=e.u32(),r=e.u32(),a={type:"xj",vertices:[],meshes:[],collision_sphere_position:e.vec3_f32(),collision_sphere_radius:e.f32()};return i>=1&&(i>1&&_.warn(`Vertex info count of ${i} was larger than expected.`),a.vertices.push(...function(e,t){e.seek_start(t);const i=e.u16();e.seek(2);const o=e.u32(),s=e.u32(),n=e.u32(),r=[];for(let t=0;t<n;++t){e.seek_start(o+t*s);const n=e.vec3_f32();let a,d;switch(i){case 3:a=e.vec3_f32(),d=e.vec2_f32();break;case 4:break;case 5:e.seek(4),d=e.vec2_f32();break;case 6:a=e.vec3_f32();break;case 7:a=e.vec3_f32(),d=e.vec2_f32();break;default:_.warn(`Unknown vertex type ${i} with size ${s}.`)}r.push({position:n,normal:a,uv:d})}return r}(e,t))),a.meshes.push(...h(e,o,s)),a.meshes.push(...h(e,n,r)),a}function h(e,t,i){const o=[];for(let s=0;s<i;++s){e.seek_start(t+20*s);const i=e.u32(),n=e.u32(),r=e.u32(),a=e.u32(),d=v(e,i,n);e.seek_start(r);const c=e.u16_array(a);o.push({material_properties:d,indices:c})}return o}function v(e,t,i){const o={};for(let s=0;s<i;++s){switch(e.seek_start(t+16*s),e.u32()){case 2:o.src_alpha=e.u32(),o.dst_alpha=e.u32();break;case 3:o.texture_id=e.u32();break;case 5:o.diffuse_r=e.u8(),o.diffuse_g=e.u8(),o.diffuse_b=e.u8(),o.diffuse_a=e.u8()}}return o}var p=i(455);const g=2*Math.PI/65535,b=1296255566;function f(e){return"njcm"===e.type}class m{constructor(e,t,i,o,s,n){this.evaluation_flags=e,this.model=t,this.position=i,this.rotation=o,this.scale=s,this._children=n,this.children=this._children}bone_count(){const e=[0];return this.get_bone_internal(this,Number.MAX_SAFE_INTEGER,e),e[0]}get_bone(e){return this.get_bone_internal(this,e,[0])}add_child(e){this._children.push(e)}clear_children(){this._children.splice(0)}get_bone_internal(e,t,i){if(!e.evaluation_flags.skip){if(i[0]++===t)return e}if(!e.evaluation_flags.break_child_trace)for(const o of e.children){const e=this.get_bone_internal(o,t,i);if(e)return e}}}function w(e){return R(e,a,[])}function k(e){return R(e,u,void 0)}function y(e){return I(e,u,void 0)}function R(e,t,i){const s=Object(o.a)(e);if(!s.success)return s;const n=s.value.filter(e=>e.type===b),r=[];for(const e of n)r.push(...I(e.data,t,i));return Object(p.c)(r,s.problems)}function I(e,t,i){const o=e.u32(),s=0!=(1&o),n=0!=(2&o),r=0!=(4&o),a=0!=(8&o),d=0!=(16&o),c=0!=(32&o),l=0!=(64&o),_=0!=(128&o),u=e.u32(),h=e.vec3_f32(),v={x:e.i32()*g,y:e.i32()*g,z:e.i32()*g},p=e.vec3_f32(),b=e.u32(),f=e.u32();let w,k,y;return u&&(e.seek_start(u),w=t(e,i)),b?(e.seek_start(b),k=I(e,t,i)):k=[],f?(e.seek_start(f),y=I(e,t,i)):y=[],[new m({no_translate:s,no_rotate:n,no_scale:r,hidden:a,break_child_trace:d,zxy_rotation_order:c,skip:l,shape_skip:_},w,h,v,p,k),...y]}},488:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i(459);class s{constructor(e,t){this._position=0,this.endianness=e,this.offset=t}get position(){return this._position}get endianness(){return this.little_endian?o.a.Little:o.a.Big}set endianness(e){this.little_endian=e===o.a.Little}get bytes_left(){return this.size-this.position}seek(e){return this.seek_start(this.position+e)}seek_start(e){if(e<0||e>this.size)throw new Error(`Offset ${e} is out of bounds.`);return this._position=e,this}seek_end(e){if(e<0||e>this.size)throw new Error(`Offset ${e} is out of bounds.`);return this._position=this.size-e,this}u8(){return this.u8_at(this._position++)}u8_at(e){return this.check_offset(e,1),this.dv.getUint8(this.offset+e)}u16(){const e=this.u16_at(this.position);return this._position+=2,e}u16_at(e){return this.check_offset(e,2),this.dv.getUint16(this.offset+e,this.little_endian)}u32(){const e=this.u32_at(this.position);return this._position+=4,e}u32_at(e){return this.check_offset(e,4),this.dv.getUint32(this.offset+e,this.little_endian)}i8(){return this.i8_at(this._position++)}i8_at(e){return this.check_offset(e,1),this.dv.getInt8(this.offset+e)}i16(){const e=this.i16_at(this.position);return this._position+=2,e}i16_at(e){return this.check_offset(e,2),this.dv.getInt16(this.offset+e,this.little_endian)}i32(){const e=this.i32_at(this.position);return this._position+=4,e}i32_at(e){return this.check_offset(e,4),this.dv.getInt32(this.offset+e,this.little_endian)}f32(){const e=this.f32_at(this.position);return this._position+=4,e}f32_at(e){return this.check_offset(e,4),this.dv.getFloat32(this.offset+e,this.little_endian)}u8_array(e){this.check_size("n",e,e);const t=[];for(let i=0;i<e;++i)t.push(this.dv.getUint8(this.offset+this._position++));return t}u16_array(e){this.check_size("n",e,2*e);const t=[];for(let i=0;i<e;++i)t.push(this.dv.getUint16(this.offset+this.position,this.little_endian)),this._position+=2;return t}u32_array(e){this.check_size("n",e,4*e);const t=[];for(let i=0;i<e;++i)t.push(this.dv.getUint32(this.offset+this.position,this.little_endian)),this._position+=4;return t}i32_array(e){this.check_size("n",e,4*e);const t=[];for(let i=0;i<e;++i)t.push(this.dv.getInt32(this.offset+this.position,this.little_endian)),this._position+=4;return t}vec2_f32(){return{x:this.f32(),y:this.f32()}}vec3_f32(){return{x:this.f32(),y:this.f32(),z:this.f32()}}string_ascii(e,t,i){const o=[];for(let s=0;s<e;s++){const n=this.u8();if(t&&0===n){i&&this.seek(e-s-1);break}o.push(n)}return String.fromCodePoint(...o)}string_utf16(e,t,i){const o=[],s=Math.floor(e/2);for(let e=0;e<s;e++){const n=this.u16();if(t&&0===n){i&&this.seek(2*(s-e-1));break}o.push(n)}return String.fromCodePoint(...o)}string_ascii_at(e,t,i){const o=[];for(let s=0;s<t;s++){const t=this.u8_at(e+s);if(i&&0===t)break;o.push(t)}return String.fromCodePoint(...o)}string_utf16_at(e,t,i){const o=[],s=Math.floor(t/2);for(let t=0;t<s;t++){const s=this.u16_at(e+2*t);if(i&&0===s)break;o.push(s)}return String.fromCodePoint(...o)}array_buffer(e=this.size-this.position){this.check_size("size",e,e);const t=this.backing_buffer.slice(this.offset+this.position,this.offset+this.position+e);return this._position+=e,t}copy_to_uint8_array(e,t=this.size-this.position){return this.check_size("size",t,t),e.set(new Uint8Array(this.backing_buffer,this.offset+this.position,t)),this._position+=t,this}check_size(e,t,i){if(i<0||i>this.size-this.position)throw new Error(`${e} ${t} is out of bounds.`)}check_offset(e,t){if(e<0||e+t>this.size)throw new Error(`Offset ${e} is out of bounds.`)}}class n extends s{write_u8(e){return this.write_u8_at(this.position,e),this._position+=1,this}write_u16(e){return this.write_u16_at(this.position,e),this._position+=2,this}write_u32(e){return this.write_u32_at(this.position,e),this._position+=4,this}write_i8(e){return this.write_i8_at(this.position,e),this._position+=1,this}write_i16(e){return this.write_i16_at(this.position,e),this._position+=2,this}write_i32(e){return this.write_i32_at(this.position,e),this._position+=4,this}write_f32(e){return this.write_f32_at(this.position,e),this._position+=4,this}write_u8_array(e){return this.write_u8_array_at(this.position,e),this._position+=e.length,this}write_u16_array(e){return this.write_u16_array_at(this.position,e),this._position+=2*e.length,this}write_u32_array(e){return this.write_u32_array_at(this.position,e),this._position+=4*e.length,this}write_i32_array(e){return this.write_i32_array_at(this.position,e),this._position+=4*e.length,this}write_vec2_f32(e){return this.write_vec2_f32_at(this.position,e),this._position+=8,this}write_vec3_f32(e){return this.write_vec3_f32_at(this.position,e),this._position+=12,this}write_cursor(e){const t=e.size-e.position;return this.ensure_size(t),e.copy_to_uint8_array(new Uint8Array(this.backing_buffer,this.offset+this.position,t),t),this._position+=t,this}write_string_ascii(e,t){return this.write_string_ascii_at(this.position,e,t),this._position+=t,this}write_string_utf16(e,t){return this.write_string_utf16_at(this.position,e,t),this._position+=t,this}write_u8_at(e,t){return this.ensure_size(1,e),this.dv.setUint8(e,t),this}write_u16_at(e,t){return this.ensure_size(2,e),this.dv.setUint16(e,t,this.little_endian),this}write_u32_at(e,t){return this.ensure_size(4,e),this.dv.setUint32(e,t,this.little_endian),this}write_i8_at(e,t){return this.ensure_size(1,e),this.dv.setInt8(e,t),this}write_i16_at(e,t){return this.ensure_size(2,e),this.dv.setInt16(e,t,this.little_endian),this}write_i32_at(e,t){return this.ensure_size(4,e),this.dv.setInt32(e,t,this.little_endian),this}write_f32_at(e,t){return this.ensure_size(4,e),this.dv.setFloat32(e,t,this.little_endian),this}write_u8_array_at(e,t){return this.ensure_size(t.length,e),new Uint8Array(this.backing_buffer,this.offset+e).set(new Uint8Array(t)),this}write_u16_array_at(e,t){this.ensure_size(2*t.length,e);const i=t.length;for(let o=0;o<i;o++)this.write_u16_at(e+2*o,t[o]);return this}write_u32_array_at(e,t){this.ensure_size(4*t.length,e);const i=t.length;for(let o=0;o<i;o++)this.write_u32_at(e+4*o,t[o]);return this}write_i32_array_at(e,t){this.ensure_size(4*t.length,e);const i=t.length;for(let o=0;o<i;o++)this.write_i32_at(e+4*o,t[o]);return this}write_vec2_f32_at(e,t){return this.ensure_size(8,e),this.dv.setFloat32(e,t.x,this.little_endian),this.dv.setFloat32(e+4,t.y,this.little_endian),this}write_vec3_f32_at(e,t){return this.ensure_size(12,e),this.dv.setFloat32(e,t.x,this.little_endian),this.dv.setFloat32(e+4,t.y,this.little_endian),this.dv.setFloat32(e+8,t.z,this.little_endian),this}write_string_ascii_at(e,t,i){this.ensure_size(i,e);const o=Math.min(i,t.length);for(let i=0;i<o;i++)this.write_u8_at(e+i,t.codePointAt(i));const s=i-o;for(let t=0;t<s;t++)this.write_u8_at(e+o+t,0);return this}write_string_utf16_at(e,t,i){this.ensure_size(i,e);const o=Math.floor(i/2),s=Math.min(o,t.length);for(let i=0;i<s;i++)this.write_u16_at(e+2*i,t.codePointAt(i));const n=o-s;for(let t=0;t<n;t++)this.write_u16_at(e+2*s+2*t,0);return this}ensure_size(e,t=this.position){const i=this.size-t;if(e>i)throw new Error(`${e} Bytes required but only ${i} available.`)}}},495:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var o=i(42),s=(i(544),i(138)),n=i(2);class r extends o.a{constructor(e,...t){super(e instanceof o.a?void 0:e),this.element=Object(n.h)({className:"core_ToolBar"}),this.height=33,this.element.style.height=`${this.height}px`,this.children=e instanceof o.a?[e,...t]:t;for(const e of this.children)if(this.disposable(e),e instanceof s.a&&e.label){const t=Object(n.h)({className:"core_ToolBar_group"});"left"===e.preferred_label_position||"top"===e.preferred_label_position?t.append(e.label.element,e.element):t.append(e.element,e.label.element),this.element.append(t)}else this.element.append(e.element);this.finalize_construction()}set_enabled(e){super.set_enabled(e);for(const t of this.children)t.enabled.val=e}}},496:function(e,t,i){"use strict";var o;i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return s})),function(e){e[e.RGBA_S3TC_DXT1=0]="RGBA_S3TC_DXT1",e[e.RGBA_S3TC_DXT3=1]="RGBA_S3TC_DXT3"}(o||(o={}));class s{constructor(e,t,i,o,s){this.gfx=e,this.format=t,this.width=i,this.height=o,this.data=s}upload(){null==this.gfx_texture&&(this.gfx_texture=this.gfx.create_texture(this.format,this.width,this.height,this.data))}destroy(){this.gfx.destroy_texture(this.gfx_texture)}}},497:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));class o{constructor(e=8192){this._size=0,this._buffer=new ArrayBuffer(e),this._data_view=new DataView(this._buffer)}get size(){return this._size}set size(e){if(e<0)throw new Error("Size should be non-negative.");this.ensure_capacity(e),this._size=e}get capacity(){return this._buffer.byteLength}get backing_buffer(){return this._buffer}get view(){return this._data_view}sub_view(e,t){return new DataView(this._buffer,e,t)}ensure_capacity(e){if(e>this.capacity){let t=this.capacity||e;do{t*=2}while(t<e);const i=new ArrayBuffer(t);new Uint8Array(i).set(new Uint8Array(this._buffer,0,this.size)),this._buffer=i,this._data_view=new DataView(this._buffer)}}}},499:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=i(138),s=i(17),n=(i(500),i(32)),r=i(2);class a extends o.a{constructor(e,t,i,o,s){super(s),this.element=Object(r.s)({className:`${t} core_Input`}),this._value=new n.a(this,e,this.set_value),this.value=this._value,this.input_element=Object(r.m)({className:`${o} core_Input_inner`}),this.input_element.type=i,this.input_element.addEventListener("change",()=>{this._value.set_val(this.get_value(),{silent:!1})}),this.input_element.addEventListener("keydown",e=>{"Enter"===e.key&&this._value.set_val(this.get_value(),{silent:!1})}),s&&s.readonly&&this.set_attr("readOnly",!0),this.element.append(this.input_element)}set_enabled(e){super.set_enabled(e),this.input_element.disabled=!e}set_attr(e,t,i){if(null==t)return;const o=this.input_element,n=i||(e=>e);Object(s.a)(t)?(o[e]=n(t.val),this.disposable(t.observe(({value:t})=>o[e]=n(t)))):o[e]=n(t)}}},500:function(e,t,i){},508:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var o=i(499);i(533);class s extends o.a{constructor(e=0,t){if(super(e,"core_NumberInput","number","core_NumberInput_inner",t),this.preferred_label_position="left",t){const{min:e,max:i,step:o,width:s}=t;this.set_attr("min",e,String),this.set_attr("max",i,String),this.input_element.step="any",this.set_attr("step",o,String),null!=s&&(this.element.style.width=`${s}px`)}t&&null!=t.round_to&&t.round_to>=0?this.rounding_factor=Math.pow(10,t.round_to):this.rounding_factor=1,this.set_value(e),this.finalize_construction()}get_value(){return parseFloat(this.input_element.value)}set_value(e){this.input_element.valueAsNumber=Math.round(this.rounding_factor*e)/this.rounding_factor}}},517:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r}));var o=i(136),s=i(463);function n(e){return new o.Vector3(e.x,e.y,e.z)}function r(e){return new s.c(e.x,e.y,e.z)}},518:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return _}));var o=i(482),s=i(23),n=i(455),r=i(27);const a=s.a.get("core/data_formats/parsing/ninja/texture"),d=1213027928,c=1414682200;function l(e){const t=Object(o.b)(e,!0);return e.seek_start(0),t.success&&null!=t.value.find(e=>e.type===d||e.type===c)}function _(e){const t=Object(o.a)(e);if(!t.success)return t;const i=Object(n.b)(a);i.add_result(t);const s=t.value,l=s.find(e=>e.type===d),_=l&&function(e){return{texture_count:e.u16()}}(l.data),u=s.filter(e=>e.type===c).map(e=>(function(e){const t=e.u32(),i=e.u32(),o=e.u32(),s=e.u16(),n=e.u16(),r=e.u32();return e.seek(36),{id:o,format:[t,i],width:s,height:n,size:r,data:e.array_buffer(r)}})(e.data));return _||0!==u.length?(_&&_.texture_count!==u.length&&i.add_problem(r.b.Warning,"Corrupted XVM file.",`Found ${u.length} textures instead of ${_.texture_count} as defined in the header.`),i.success({textures:u})):(i.add_problem(r.b.Error,"Corrupted XVM file.","No header and no XVRT chunks found."),i.failure())}},530:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var o=i(142),s=i(2),n=(i(547),i(17)),r=i(32),a=i(14);const d=500,c=500;class l extends o.a{constructor(e){var t;super(e),this.x=0,this.y=0,this.prev_mouse_x=0,this.prev_mouse_y=0,this._title=new r.a(this,"",this.set_title),this._description=new r.a(this,"",this.set_description),this._content=new r.a(this,"",this.set_content),this._ondismiss=Object(a.a)(),this.children=[],this.title=this._title,this.description=this._description,this.content=this._content,this.ondismiss=this._ondismiss,this.mousedown=e=>{this.prev_mouse_x=e.clientX,this.prev_mouse_y=e.clientY,window.addEventListener("mousemove",this.window_mousemove),window.addEventListener("mouseup",this.window_mouseup)},this.window_mousemove=e=>{e.preventDefault(),this.set_position(this.x+e.clientX-this.prev_mouse_x,this.y+e.clientY-this.prev_mouse_y),this.prev_mouse_x=e.clientX,this.prev_mouse_y=e.clientY},this.window_mouseup=e=>{e.preventDefault(),window.removeEventListener("mousemove",this.window_mousemove),window.removeEventListener("mouseup",this.window_mouseup)},this.element=Object(s.q)({className:"core_Dialog",tabIndex:0},this.header_element=Object(s.i)(),this.description_element=Object(s.h)({className:"core_Dialog_description"}),this.content_element=Object(s.h)({className:"core_Dialog_body"}),Object(s.h)({className:"core_Dialog_footer"},...null!==(t=null==e?void 0:e.footer)&&void 0!==t?t:[])),this.element.style.width=`${d}px`,this.element.style.maxHeight=`${c}px`,this.element.addEventListener("keydown",e=>this.keydown(e)),e&&("string"==typeof e.title?this.title.val=e.title:e.title&&this.title.bind_to(e.title),"string"==typeof e.description?this.description.val=e.description:e.description&&this.description.bind_to(e.description),Object(n.a)(e.content)?this.content.bind_to(e.content):null!=e.content&&(this.content.val=e.content)),this.set_position((window.innerWidth-d)/2,(window.innerHeight-c)/2),this.header_element.addEventListener("mousedown",this.mousedown),this.overlay_element=Object(s.h)({className:"core_Dialog_modal_overlay",tabIndex:-1}),this.overlay_element.addEventListener("focus",()=>this.focus()),this.finalize_construction()}dispose(){super.dispose(),this.overlay_element.remove()}focus(){(this.first_focusable_child(this.element)||this.element).focus()}first_focusable_child(e){for(const t of e.children)if(t instanceof HTMLElement){if(t.tabIndex>=0)return t;{const e=this.first_focusable_child(t);if(e)return e}}}set_position(e,t){this.x=e,this.y=t,this.element.style.transform=`translate(${Math.floor(e)}px, ${Math.floor(t)}px)`}set_visible(e){e?(document.body.append(this.overlay_element),document.body.append(this.element),this.focus()):(this.overlay_element.remove(),this.element.remove())}set_title(e){this.header_element.textContent=e}set_description(e){""===e?(this.description_element.hidden=!0,this.description_element.textContent=""):(this.description_element.hidden=!1,this.description_element.textContent=e)}set_content(e){this.content_element.textContent="",this.content_element.append(e)}keydown(e){"Escape"===e.key&&this._ondismiss.emit({value:e})}}},532:function(e,t,i){"use strict";i.d(t,"d",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return d}));const o=180/Math.PI,s=Math.PI/180;function n(e){return e*o}function r(e){return e*s}function a(e,t){return(e%t+t)%t}function d(e,t,i){return Math.max(t,Math.min(e,i))}},533:function(e,t,i){},534:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i(142),s=i(2);class n extends o.a{constructor(e){super(),this.renderer=e,this.element=Object(s.h)({className:"core_RendererWidget"}),this.children=[],this.element.append(e.canvas_element),this.disposable(e),this.finalize_construction()}start_rendering(){this.renderer.start_rendering()}stop_rendering(){this.renderer.stop_rendering()}resize(e,t){return super.resize(e,t),this.renderer.set_size(e,t),this}}},544:function(e,t,i){},545:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return a}));var o=i(136),s=i(496);function n(e,t){let i,o;switch(t.format[1]){case 6:i=s.b.RGBA_S3TC_DXT1,o=t.width*t.height/2;break;case 7:i=s.b.RGBA_S3TC_DXT3,o=t.width*t.height;break;default:throw new Error(`Format ${t.format.join(", ")} not supported.`)}return new s.a(e,i,t.width,t.height,t.data.slice(0,o))}function r(e){return e.textures.map(a)}function a(e){let t,i;switch(e.format[1]){case 6:t=o.RGBA_S3TC_DXT1_Format,i=e.width*e.height/2;break;case 7:t=o.RGBA_S3TC_DXT3_Format,i=e.width*e.height;break;default:throw new Error(`Format ${e.format.join(", ")} not supported.`)}const s=new o.CompressedTexture([{data:new Uint8Array(e.data,0,i),width:e.width,height:e.height}],e.width,e.height,t);return s.minFilter=o.LinearFilter,s.wrapS=o.MirroredRepeatWrapping,s.wrapT=o.MirroredRepeatWrapping,s.needsUpdate=!0,s}},546:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=i(14),s=i(139),n=i(483),r=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};class a extends s.a{constructor(e){super(e),this._files=Object(o.e)([]),this.files=this._files,this.element.classList.add("core_FileButton"),this.disposables(this.onclick.observe(()=>r(this,void 0,void 0,(function*(){this._files.val=yield Object(n.a)(e)})))),this.finalize_construction()}}},547:function(e,t,i){},548:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var o=i(530),s=i(139),n=i(17),r=i(2),a=i(14);class d extends o.a{constructor(e){const t=new s.a({text:"Dismiss"});super(Object.assign({footer:[t.element]},e));const i=Object(n.a)(e.result)?e.result:Object(a.e)(e.result);this.problems_message=Object(n.a)(e.problems_message)?e.problems_message:Object(a.e)(e.problems_message),this.error_message=Object(n.a)(e.error_message)?e.error_message:Object(a.e)(e.error_message),this.disposables(t,t.onclick.observe(e=>this._ondismiss.emit(e)),i.observe(({value:e})=>this.result_changed(e),{call_now:!0})),this.finalize_construction()}result_changed(e){e?(this.content.val=function(e){const t=Object(r.h)();t.style.overflow="auto",t.style.userSelect="text",t.style.height="100%",t.style.maxHeight="400px";const i=Object(r.B)(...e.problems.map(e=>Object(r.o)(e.ui_message)));return i.style.cursor="text",t.append(i),t}(e),e.success?e.problems.length&&(this.title.val="Problems",this.description.val=this.problems_message.val):(this.title.val="Error",this.description.val=this.error_message.val)):this.content.val=""}}},549:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var o=i(484),s=i(497);const n=i(23).a.get("core/data_formats/compression/prs/decompress");function r(e){const t=new a(e);for(;;)if(1===t.read_flag_bit())t.copy_u8();else{let e,i;if(0===t.read_flag_bit())e=t.read_flag_bit()<<1,e|=t.read_flag_bit(),e+=2,i=t.read_u8()-256;else{if(i=t.read_u16(),0===i)break;e=7&i,i>>>=3,0===e?(e=t.read_u8(),e+=1):e+=2,i-=8192}t.offset_copy(i,e)}return t.dst.seek_start(0)}class a{constructor(e){this.src=e,this.dst=new o.a(new s.a(Math.floor(1.5*e.size)),e.endianness),this.flags=0,this.flag_bits_left=0}read_flag_bit(){0===this.flag_bits_left&&(this.flags=this.read_u8(),this.flag_bits_left=8);const e=1&this.flags;return this.flags>>>=1,this.flag_bits_left-=1,e}copy_u8(){this.dst.write_u8(this.read_u8())}read_u8(){return this.src.u8()}read_u16(){return this.src.u16()}offset_copy(e,t){(e<-8192||e>0)&&n.error(`offset was ${e}, should be between -8192 and 0.`),(t<1||t>256)&&n.error(`length was ${t}, should be between 1 and 256.`);const i=Math.min(-e,t);this.dst.seek(e);const o=this.dst.take(i);this.dst.seek(-e-i);for(let e=0;e<Math.floor(t/i);++e)this.dst.write_cursor(o),o.seek_start(0);this.dst.write_cursor(o.take(t%i))}}},583:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var o=i(138),s=i(32),n=i(2);class r extends o.a{constructor(e=!1,t){super(t),this.element=Object(n.m)({className:"core_CheckBox"}),this.preferred_label_position="right",this._checked=new s.a(this,e,this.set_checked),this.checked=this._checked,this.set_checked(e),this.element.type="checkbox",this.element.onchange=()=>this._checked.set_val(this.element.checked,{silent:!1}),this.finalize_construction()}set_enabled(e){super.set_enabled(e),this.element.disabled=!e}set_checked(e){this.element.checked=e}}},584:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var o=i(136),s=i(40);class n{constructor(){this.materials=[{alpha:!1,additive_blending:!1}],this.map=new Map}add_material(e,t=!1,i=!1){if(null==e)return 0;{const o=e<<2|(t?2:0)|(i?1:0);return Object(s.h)(this.map,o,()=>(this.materials.push({texture_id:e,alpha:t,additive_blending:i}),this.materials.length-1))}}get_materials(){return this.materials}}class r{constructor(){this.positions=[],this.normals=[],this.uvs=[],this.indices=[],this.bones=[],this.bone_indices=[],this.bone_weights=[],this.groups=[],this.material_map=new n}get vertex_count(){return this.positions.length/3}get index_count(){return this.indices.length}get_position(e){return new o.Vector3(this.positions[3*e],this.positions[3*e+1],this.positions[3*e+2])}get_normal(e){return new o.Vector3(this.normals[3*e],this.normals[3*e+1],this.normals[3*e+2])}add_vertex(e,t,i){this.positions.push(e.x,e.y,e.z),this.normals.push(t.x,t.y,t.z),this.uvs.push(i.x,i.y)}add_index(e){this.indices.push(e)}add_bone(e){this.bones.push(e)}add_bone_weight(e,t){this.bone_indices.push(e),this.bone_weights.push(t)}add_group(e,t,i,o=!1,s=!1){const n=this.groups[this.groups.length-1],r=this.material_map.add_material(i,o,s);n&&n.material_index===r?n.size+=t:this.groups.push({offset:e,size:t,material_index:r})}build(){const e=new o.BufferGeometry;let t;e.setAttribute("position",new o.Float32BufferAttribute(this.positions,3)),e.setAttribute("normal",new o.Float32BufferAttribute(this.normals,3)),e.setAttribute("uv",new o.Float32BufferAttribute(this.uvs,2)),e.setIndex(new o.Uint16BufferAttribute(this.indices,1)),this.bone_indices.length&&this.bones.length?(e.setAttribute("skinIndex",new o.Uint16BufferAttribute(this.bone_indices,4)),e.setAttribute("skinWeight",new o.Float32BufferAttribute(this.bone_weights,4)),t=this.bones):t=[];for(const t of this.groups)e.addGroup(t.offset,t.size,t.material_index);const i={created_by_geometry_builder:!0,materials:this.material_map.get_materials(),bones:t};return e.userData=i,e.computeBoundingSphere(),e.computeBoundingBox(),e}}},585:function(e,t,i){"use strict";i.d(t,"b",(function(){return u})),i.d(t,"a",(function(){return h}));var o=i(136),s=i(517),n=i(487),r=i(584);const a=new o.Vector3(0,1,0),d=new o.Vector2(0,0),c=new o.Vector3(0,0,0),l=new o.Quaternion(0,0,0,1),_=new o.Vector3(1,1,1);function u(e,t){new p(t).to_geometry_builder(e)}function h(e){return new p(new r.a).create_buffer_geometry(e)}class v{constructor(){this.vertices_stack=[]}put(e){this.vertices_stack.push(e)}get(e){const t=[];for(let i=this.vertices_stack.length-1;i>=0;i--){const o=this.vertices_stack[i][e];o&&t.push(o)}return t}}class p{constructor(e){this.vertices=new v,this.bone_id=0,this.builder=e}to_geometry_builder(e){this.object_to_geometry(e,void 0,new o.Matrix4)}create_buffer_geometry(e){return this.to_geometry_builder(e),this.builder.build()}object_to_geometry(e,t,i){const{no_translate:n,no_rotate:r,no_scale:a,hidden:d,break_child_trace:u,zxy_rotation_order:h,skip:v}=e.evaluation_flags,{position:p,rotation:g,scale:b}=e,f=new o.Euler(g.x,g.y,g.z,h?"ZXY":"ZYX"),m=(new o.Matrix4).compose(n?c:Object(s.b)(p),r?l:(new o.Quaternion).setFromEuler(f),a?_:Object(s.b)(b)).premultiply(i);let w;if(v?w=t:(w=new o.Bone,w.name=this.bone_id.toString(),w.position.set(p.x,p.y,p.z),w.setRotationFromEuler(f),w.scale.set(b.x,b.y,b.z),this.builder.add_bone(w),t&&t.add(w)),e.model&&!d&&this.model_to_geometry(e.model,m),this.bone_id++,!u)for(const t of e.children)this.object_to_geometry(t,w,m)}model_to_geometry(e,t){Object(n.b)(e)?this.njcm_model_to_geometry(e,t):this.xj_model_to_geometry(e,t)}njcm_model_to_geometry(e,t){var i,n;const r=(new o.Matrix3).getNormalMatrix(t),c=e.vertices.map(e=>{const i=Object(s.b)(e.position),n=e.normal?Object(s.b)(e.normal):new o.Vector3(0,1,0);return i.applyMatrix4(t),n.applyMatrix3(r),{bone_id:this.bone_id,position:i,normal:n,bone_weight:e.bone_weight,bone_weight_status:e.bone_weight_status,calc_continue:e.calc_continue}});this.vertices.put(c);for(const t of e.meshes){const e=this.builder.index_count;for(let e=0;e<t.vertices.length;++e){const o=t.vertices[e],s=this.vertices.get(o.index);if(s.length){const r=s[0],c=null!==(n=null!==(i=r.normal)&&void 0!==i?i:o.normal)&&void 0!==n?n:a,l=this.builder.vertex_count;this.builder.add_vertex(r.position,c,t.has_tex_coords?o.tex_coords:d),e>=2&&(e%2==(t.clockwise_winding?1:0)?(this.builder.add_index(l-2),this.builder.add_index(l-1),this.builder.add_index(l)):(this.builder.add_index(l-2),this.builder.add_index(l),this.builder.add_index(l-1)));const _=[[0,0],[0,0],[0,0],[0,0]];for(let e=s.length-1;e>=0;e--){const t=s[e];_[t.bone_weight_status]=[t.bone_id,t.bone_weight]}const u=_.reduce((e,[,t])=>e+t,0);for(const[e,t]of _)this.builder.add_bone_weight(e,u>0?t/u:t)}}this.builder.add_group(e,this.builder.index_count-e,t.texture_id,t.use_alpha,4!==t.src_alpha||5!==t.dst_alpha)}}xj_model_to_geometry(e,t){const i=this.builder.vertex_count,n=(new o.Matrix3).getNormalMatrix(t);for(const{position:i,normal:r,uv:a}of e.vertices){const e=Object(s.b)(i).applyMatrix4(t),c=(r?Object(s.b)(r):new o.Vector3(0,1,0)).applyMatrix3(n),l=a||d;this.builder.add_vertex(e,c,l)}let r,a,c;for(const t of e.meshes){const e=this.builder.index_count;let o=!1;for(let e=2;e<t.indices.length;++e){const s=i+t.indices[e-2],n=i+t.indices[e-1],r=i+t.indices[e],a=this.builder.get_position(s),d=this.builder.get_position(n),c=this.builder.get_position(r),l=this.builder.get_normal(s),_=this.builder.get_normal(n),u=this.builder.get_normal(r),h=d.clone().sub(a).cross(c.clone().sub(a));o&&h.negate(),(h.dot(l)<0?1:0)+(h.dot(_)<0?1:0)+(h.dot(u)<0?1:0)>=2&&(o=!o),o?(this.builder.add_index(n),this.builder.add_index(s),this.builder.add_index(r)):(this.builder.add_index(s),this.builder.add_index(n),this.builder.add_index(r)),o=!o}null!=t.material_properties.texture_id&&(r=t.material_properties.texture_id),null!=t.material_properties.src_alpha&&(a=t.material_properties.src_alpha),null!=t.material_properties.dst_alpha&&(c=t.material_properties.dst_alpha),this.builder.add_group(e,this.builder.index_count-e,r,!0,4!==a||5!==c)}}}},586:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=i(31),s=i(23),n=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const r=s.a.get("core/persistence/Persister");class a{persist_for_server(e,t,i){this.persist(this.server_key(e,t),i)}persist(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){r.error(`Couldn't persist ${e}.`,t)}}load_for_server(e,t){return n(this,void 0,void 0,(function*(){return this.load(this.server_key(e,t))}))}load(e){return n(this,void 0,void 0,(function*(){try{const t=localStorage.getItem(e);return t&&JSON.parse(t)}catch(t){return void r.error(`Couldn't load ${e}.`,t)}}))}server_key(e,t){let i=t+".";switch(e){case o.g.Ephinea:i+="Ephinea";break;default:throw new Error(`Server ${o.g[e]} not supported.`)}return i}}},595:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i(666),s=i(136);o.a.install({THREE:Object.assign(Object.assign({},s),{MOUSE:Object.assign(Object.assign({},s.MOUSE),{LEFT:s.MOUSE.RIGHT,RIGHT:s.MOUSE.LEFT})})});class n{constructor(e){this._debug=!1,this.scene=new s.Scene,this.light_holder=new s.Group,this.render_scheduled=!1,this.animation_frame_handle=void 0,this.light=new s.HemisphereLight(16777215,5263440,1),this.controls_clock=new s.Clock,this.size=new s.Vector2(0,0),this.schedule_render=()=>{this.render_scheduled=!0},this.on_mouse_down=e=>{e.currentTarget&&e.currentTarget.focus()},this.call_render=()=>{const e=this.controls.update(this.controls_clock.getDelta()),t=this.render_scheduled||e;this.render_scheduled=!1,t&&this.render(),this.animation_frame_handle=requestAnimationFrame(this.call_render)},this.renderer=e,this.renderer.domElement.tabIndex=0,this.renderer.domElement.addEventListener("mousedown",this.on_mouse_down),this.renderer.domElement.style.outline="none",this.scene.background=new s.Color(1579032),this.light_holder.add(this.light),this.scene.add(this.light_holder)}get debug(){return this._debug}set debug(e){this._debug=e}get canvas_element(){return this.renderer.domElement}set_size(e,t){this.size.set(e,t),this.renderer.setSize(e,t),this.schedule_render()}pointer_pos_to_device_coords(e){e.set(e.x/this.size.width*2-1,e.y/this.size.height*-2+1)}start_rendering(){null==this.animation_frame_handle&&(this.schedule_render(),this.animation_frame_handle=requestAnimationFrame(this.call_render))}stop_rendering(){null!=this.animation_frame_handle&&(cancelAnimationFrame(this.animation_frame_handle),this.animation_frame_handle=void 0)}reset_camera(e,t){this.controls.setLookAt(e.x,e.y,e.z,t.x,t.y,t.z)}dispose(){this.renderer.dispose(),this.controls.dispose()}init_camera_controls(){this.controls=new o.a(this.camera,this.renderer.domElement),this.controls.dampingFactor=1,this.controls.draggingDampingFactor=1}render(){this.renderer.render(this.scene,this.camera)}}},596:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i(136);const s=new o.MeshLambertMaterial({color:65280,side:o.DoubleSide});function n(e,t,i,n){const{created_by_geometry_builder:r,materials:a,bones:d}=e.userData;let c;if(t.length&&r){c=[s];for(let e=1;e<a.length;e++){const{texture_id:i,alpha:s,additive_blending:r}=a[e],d=null==i?void 0:t[i];if(d){const e={skinning:n,map:d,side:o.DoubleSide};s&&(e.transparent=!0,e.alphaTest=.01),r&&(e.transparent=!0,e.alphaTest=.01,e.blending=o.AdditiveBlending),c.push(new o.MeshBasicMaterial(e))}else c.push(new o.MeshLambertMaterial({skinning:n,side:o.DoubleSide}))}}else c=i;if(r&&d.length&&n){const t=new o.SkinnedMesh(e,c);return t.add(d[0]),t.bind(new o.Skeleton(d)),t}return new o.Mesh(e,c)}},705:function(e,t,i){},706:function(e,t,i){},707:function(e,t,i){},709:function(e,t,i){},710:function(e,t,i){},785:function(e,t,i){},786:function(e,t,i){},787:function(e,t,i){},788:function(e,t,i){},789:function(e,t,i){},790:function(e,t,i){},791:function(e,t,i){},792:function(e,t,i){},793:function(e,t,i){},794:function(e,t,i){},795:function(e,t,i){e.exports=function(){return new Worker(i.p+"cf20a8042b365c4aeece.worker.js")}},796:function(e,t,i){},901:function(e,t,i){"use strict";i.r(t),i.d(t,"initialize_quest_editor",(function(){return Ea}));var o=i(703),s=i.n(o),n=i(137),r=i(508),a=i(15),d=i(499);class c extends d.a{constructor(e="",t){if(super(e,"core_TextInput","text","core_TextInput_inner",t),this.preferred_label_position="left",t){const{max_length:e}=t;this.set_attr("maxLength",e)}this.set_value(e),this.finalize_construction()}get_value(){return this.input_element.value}set_value(e){this.input_element.value=e}}var l=i(138),_=(i(705),i(32)),u=i(2);class h extends l.a{constructor(e="",t){super(t),this.element=Object(u.h)({className:"core_TextArea"}),this.preferred_label_position="left",this.text_element=Object(u.w)({className:"core_TextArea_inner"}),this._value=new _.a(this,"",this.set_value),t&&(null!=t.max_length&&(this.text_element.maxLength=t.max_length),null!=t.font_family&&(this.text_element.style.fontFamily=t.font_family),null!=t.rows&&(this.text_element.rows=t.rows),null!=t.cols&&(this.text_element.cols=t.cols)),this.value=this._value,this.set_value(e),this.text_element.onchange=()=>this._value.set_val(this.text_element.value,{silent:!1}),this.element.append(this.text_element),this.finalize_construction()}set_value(e){this.text_element.value=e}}i(706);var v=i(144),p=(i(707),i(83));class g extends p.a{constructor(e){super(),this.element=Object(u.h)({className:"quest_editor_UnavailableView"}),this.label=this.disposable(new v.a(e,{enabled:!1})),this.element.append(this.label.element),this.finalize_construction()}}var b=i(82);class f extends b.a{constructor(e){super(),this.element=Object(u.h)({className:"quest_editor_QuestInfoView",tabIndex:-1}),this.table_element=Object(u.t)(),this.id_input=this.add(new r.a(0,{min:0,step:1})),this.name_input=this.add(new c("",{max_length:32})),this.short_description_input=this.add(new h("",{max_length:128,font_family:'"Courier New", monospace',cols:25,rows:5})),this.long_description_input=this.add(new h("",{max_length:288,font_family:'"Courier New", monospace',cols:25,rows:10})),this.unavailable_view=this.add(new g("No quest loaded.")),this.quest_disposer=this.disposable(new a.a);const t=e.current_quest;this.table_element.append(Object(u.A)(Object(u.y)("Episode:"),this.episode_element=Object(u.v)()),Object(u.A)(Object(u.y)("ID:"),Object(u.v)(this.id_input.element)),Object(u.A)(Object(u.y)("Name:"),Object(u.v)(this.name_input.element)),Object(u.A)(Object(u.y)({colSpan:2},"Short description:")),Object(u.A)(Object(u.v)({colSpan:2},this.short_description_input.element)),Object(u.A)(Object(u.y)({colSpan:2},"Long description:")),Object(u.A)(Object(u.v)({colSpan:2},this.long_description_input.element))),this.element.append(this.table_element,this.unavailable_view.element),this.element.addEventListener("focus",e.focused,!0),this.disposables(this.unavailable_view.visible.bind_to(e.unavailable),Object(u.c)(this.table_element,"hidden",e.unavailable),t.observe(({value:t})=>{this.quest_disposer.dispose_all(),this.episode_element.textContent=t?n.b[t.episode]:"",t&&this.quest_disposer.add_all(this.id_input.value.bind_to(t.id),this.id_input.value.observe(({value:t})=>e.set_id(t)),this.name_input.value.bind_to(t.name),this.name_input.value.observe(({value:t})=>e.set_name(t)),this.short_description_input.value.bind_to(t.short_description),this.short_description_input.value.observe(({value:t})=>e.set_short_description(t)),this.long_description_input.value.bind_to(t.long_description),this.long_description_input.value.observe(({value:t})=>e.set_long_description(t)),this.enabled.bind_to(e.enabled))})),this.finalize_construction()}set_enabled(e){super.set_enabled(e),this.id_input.enabled.val=e,this.name_input.enabled.val=e,this.short_description_input.enabled.val=e,this.long_description_input.enabled.val=e}}i(708),i(709),i(710);class m extends b.a{constructor(e){super(),this.element=Object(u.h)({className:"quest_editor_NpcCountsView"}),this.table_element=Object(u.t)(),this.unavailable_view=this.add(new g("No quest loaded.")),this.element.append(this.table_element,this.unavailable_view.element),this.disposables(Object(u.c)(this.table_element,"hidden",e.unavailable),this.unavailable_view.visible.bind_to(e.unavailable),e.npc_counts.observe(({value:e})=>this.update_view(e),{call_now:!0})),this.finalize_construction()}update_view(e){const t=document.createDocumentFragment();for(const{name:i,count:o}of e)t.append(Object(u.A)(Object(u.y)(i+":"),Object(u.v)(String(o))));this.table_element.innerHTML="",this.table_element.append(t)}}var w,k=i(595),y=i(136),R=i(596),I=i(140);!function(e){e[e.Unknown=1e3]="Unknown",e[e.PlayerSet=1001]="PlayerSet",e[e.Particle=1002]="Particle",e[e.Teleporter=1003]="Teleporter",e[e.Warp=1004]="Warp",e[e.LightCollision=1005]="LightCollision",e[e.Item=1006]="Item",e[e.EnvSound=1007]="EnvSound",e[e.FogCollision=1008]="FogCollision",e[e.EventCollision=1009]="EventCollision",e[e.CharaCollision=1010]="CharaCollision",e[e.ElementalTrap=1011]="ElementalTrap",e[e.StatusTrap=1012]="StatusTrap",e[e.HealTrap=1013]="HealTrap",e[e.LargeElementalTrap=1014]="LargeElementalTrap",e[e.ObjRoomID=1015]="ObjRoomID",e[e.Sensor=1016]="Sensor",e[e.UnknownItem16=1017]="UnknownItem16",e[e.LensFlare=1018]="LensFlare",e[e.ScriptCollision=1019]="ScriptCollision",e[e.HealRing=1020]="HealRing",e[e.MapCollision=1021]="MapCollision",e[e.ScriptCollisionA=1022]="ScriptCollisionA",e[e.ItemLight=1023]="ItemLight",e[e.RadarCollision=1024]="RadarCollision",e[e.FogCollisionSW=1025]="FogCollisionSW",e[e.BossTeleporter=1026]="BossTeleporter",e[e.ImageBoard=1027]="ImageBoard",e[e.QuestWarp=1028]="QuestWarp",e[e.Epilogue=1029]="Epilogue",e[e.UnknownItem29=1030]="UnknownItem29",e[e.UnknownItem30=1031]="UnknownItem30",e[e.UnknownItem31=1032]="UnknownItem31",e[e.BoxDetectObject=1033]="BoxDetectObject",e[e.SymbolChatObject=1034]="SymbolChatObject",e[e.TouchPlateObject=1035]="TouchPlateObject",e[e.TargetableObject=1036]="TargetableObject",e[e.EffectObject=1037]="EffectObject",e[e.CountDownObject=1038]="CountDownObject",e[e.UnknownItem38=1039]="UnknownItem38",e[e.UnknownItem39=1040]="UnknownItem39",e[e.UnknownItem40=1041]="UnknownItem40",e[e.UnknownItem41=1042]="UnknownItem41",e[e.MenuActivation=1043]="MenuActivation",e[e.TelepipeLocation=1044]="TelepipeLocation",e[e.BGMCollision=1045]="BGMCollision",e[e.MainRagolTeleporter=1046]="MainRagolTeleporter",e[e.LobbyTeleporter=1047]="LobbyTeleporter",e[e.PrincipalWarp=1048]="PrincipalWarp",e[e.ShopDoor=1049]="ShopDoor",e[e.HuntersGuildDoor=1050]="HuntersGuildDoor",e[e.TeleporterDoor=1051]="TeleporterDoor",e[e.MedicalCenterDoor=1052]="MedicalCenterDoor",e[e.Elevator=1053]="Elevator",e[e.EasterEgg=1054]="EasterEgg",e[e.ValentinesHeart=1055]="ValentinesHeart",e[e.ChristmasTree=1056]="ChristmasTree",e[e.ChristmasWreath=1057]="ChristmasWreath",e[e.HalloweenPumpkin=1058]="HalloweenPumpkin",e[e.TwentyFirstCentury=1059]="TwentyFirstCentury",e[e.Sonic=1060]="Sonic",e[e.WelcomeBoard=1061]="WelcomeBoard",e[e.Firework=1062]="Firework",e[e.LobbyScreenDoor=1063]="LobbyScreenDoor",e[e.MainRagolTeleporterBattleInNextArea=1064]="MainRagolTeleporterBattleInNextArea",e[e.LabTeleporterDoor=1065]="LabTeleporterDoor",e[e.Pioneer2InvisibleTouchplate=1066]="Pioneer2InvisibleTouchplate",e[e.ForestDoor=1067]="ForestDoor",e[e.ForestSwitch=1068]="ForestSwitch",e[e.LaserFence=1069]="LaserFence",e[e.LaserSquareFence=1070]="LaserSquareFence",e[e.ForestLaserFenceSwitch=1071]="ForestLaserFenceSwitch",e[e.LightRays=1072]="LightRays",e[e.BlueButterfly=1073]="BlueButterfly",e[e.Probe=1074]="Probe",e[e.RandomTypeBox1=1075]="RandomTypeBox1",e[e.ForestWeatherStation=1076]="ForestWeatherStation",e[e.Battery=1077]="Battery",e[e.ForestConsole=1078]="ForestConsole",e[e.BlackSlidingDoor=1079]="BlackSlidingDoor",e[e.RicoMessagePod=1080]="RicoMessagePod",e[e.EnergyBarrier=1081]="EnergyBarrier",e[e.ForestRisingBridge=1082]="ForestRisingBridge",e[e.SwitchNoneDoor=1083]="SwitchNoneDoor",e[e.EnemyBoxGrey=1084]="EnemyBoxGrey",e[e.FixedTypeBox=1085]="FixedTypeBox",e[e.EnemyBoxBrown=1086]="EnemyBoxBrown",e[e.EmptyTypeBox=1087]="EmptyTypeBox",e[e.LaserFenceEx=1088]="LaserFenceEx",e[e.LaserSquareFenceEx=1089]="LaserSquareFenceEx",e[e.FloorPanel1=1090]="FloorPanel1",e[e.Caves4ButtonDoor=1091]="Caves4ButtonDoor",e[e.CavesNormalDoor=1092]="CavesNormalDoor",e[e.CavesSmashingPillar=1093]="CavesSmashingPillar",e[e.CavesSign1=1094]="CavesSign1",e[e.CavesSign2=1095]="CavesSign2",e[e.CavesSign3=1096]="CavesSign3",e[e.HexagonalTank=1097]="HexagonalTank",e[e.BrownPlatform=1098]="BrownPlatform",e[e.WarningLightObject=1099]="WarningLightObject",e[e.Rainbow=1100]="Rainbow",e[e.FloatingJellyfish=1101]="FloatingJellyfish",e[e.FloatingDragonfly=1102]="FloatingDragonfly",e[e.CavesSwitchDoor=1103]="CavesSwitchDoor",e[e.RobotRechargeStation=1104]="RobotRechargeStation",e[e.CavesCakeShop=1105]="CavesCakeShop",e[e.Caves1SmallRedRock=1106]="Caves1SmallRedRock",e[e.Caves1MediumRedRock=1107]="Caves1MediumRedRock",e[e.Caves1LargeRedRock=1108]="Caves1LargeRedRock",e[e.Caves2SmallRock1=1109]="Caves2SmallRock1",e[e.Caves2MediumRock1=1110]="Caves2MediumRock1",e[e.Caves2LargeRock1=1111]="Caves2LargeRock1",e[e.Caves2SmallRock2=1112]="Caves2SmallRock2",e[e.Caves2MediumRock2=1113]="Caves2MediumRock2",e[e.Caves2LargeRock2=1114]="Caves2LargeRock2",e[e.Caves3SmallRock=1115]="Caves3SmallRock",e[e.Caves3MediumRock=1116]="Caves3MediumRock",e[e.Caves3LargeRock=1117]="Caves3LargeRock",e[e.FloorPanel2=1118]="FloorPanel2",e[e.DestructableRockCaves1=1119]="DestructableRockCaves1",e[e.DestructableRockCaves2=1120]="DestructableRockCaves2",e[e.DestructableRockCaves3=1121]="DestructableRockCaves3",e[e.MinesDoor=1122]="MinesDoor",e[e.FloorPanel3=1123]="FloorPanel3",e[e.MinesSwitchDoor=1124]="MinesSwitchDoor",e[e.LargeCryoTube=1125]="LargeCryoTube",e[e.ComputerLikeCalus=1126]="ComputerLikeCalus",e[e.GreenScreenOpeningAndClosing=1127]="GreenScreenOpeningAndClosing",e[e.FloatingRobot=1128]="FloatingRobot",e[e.FloatingBlueLight=1129]="FloatingBlueLight",e[e.SelfDestructingObject1=1130]="SelfDestructingObject1",e[e.SelfDestructingObject2=1131]="SelfDestructingObject2",e[e.SelfDestructingObject3=1132]="SelfDestructingObject3",e[e.SparkMachine=1133]="SparkMachine",e[e.MinesLargeFlashingCrate=1134]="MinesLargeFlashingCrate",e[e.RuinsSeal=1135]="RuinsSeal",e[e.RuinsTeleporter=1136]="RuinsTeleporter",e[e.RuinsWarpSiteToSite=1137]="RuinsWarpSiteToSite",e[e.RuinsSwitch=1138]="RuinsSwitch",e[e.FloorPanel4=1139]="FloorPanel4",e[e.Ruins1Door=1140]="Ruins1Door",e[e.Ruins3Door=1141]="Ruins3Door",e[e.Ruins2Door=1142]="Ruins2Door",e[e.Ruins11ButtonDoor=1143]="Ruins11ButtonDoor",e[e.Ruins21ButtonDoor=1144]="Ruins21ButtonDoor",e[e.Ruins31ButtonDoor=1145]="Ruins31ButtonDoor",e[e.Ruins4ButtonDoor=1146]="Ruins4ButtonDoor",e[e.Ruins2ButtonDoor=1147]="Ruins2ButtonDoor",e[e.RuinsSensor=1148]="RuinsSensor",e[e.RuinsFenceSwitch=1149]="RuinsFenceSwitch",e[e.RuinsLaserFence4x2=1150]="RuinsLaserFence4x2",e[e.RuinsLaserFence6x2=1151]="RuinsLaserFence6x2",e[e.RuinsLaserFence4x4=1152]="RuinsLaserFence4x4",e[e.RuinsLaserFence6x4=1153]="RuinsLaserFence6x4",e[e.RuinsPoisonBlob=1154]="RuinsPoisonBlob",e[e.RuinsPillarTrap=1155]="RuinsPillarTrap",e[e.PopupTrapNoTech=1156]="PopupTrapNoTech",e[e.RuinsCrystal=1157]="RuinsCrystal",e[e.Monument=1158]="Monument",e[e.RuinsRock1=1159]="RuinsRock1",e[e.RuinsRock2=1160]="RuinsRock2",e[e.RuinsRock3=1161]="RuinsRock3",e[e.RuinsRock4=1162]="RuinsRock4",e[e.RuinsRock5=1163]="RuinsRock5",e[e.RuinsRock6=1164]="RuinsRock6",e[e.RuinsRock7=1165]="RuinsRock7",e[e.Poison=1166]="Poison",e[e.FixedBoxTypeRuins=1167]="FixedBoxTypeRuins",e[e.RandomBoxTypeRuins=1168]="RandomBoxTypeRuins",e[e.EnemyTypeBoxYellow=1169]="EnemyTypeBoxYellow",e[e.EnemyTypeBoxBlue=1170]="EnemyTypeBoxBlue",e[e.EmptyTypeBoxBlue=1171]="EmptyTypeBoxBlue",e[e.DestructableRock=1172]="DestructableRock",e[e.PopupTrapsTechs=1173]="PopupTrapsTechs",e[e.FlyingWhiteBird=1174]="FlyingWhiteBird",e[e.Tower=1175]="Tower",e[e.FloatingRocks=1176]="FloatingRocks",e[e.FloatingSoul=1177]="FloatingSoul",e[e.Butterfly=1178]="Butterfly",e[e.LobbyGameMenu=1179]="LobbyGameMenu",e[e.LobbyWarpObject=1180]="LobbyWarpObject",e[e.Lobby1EventObjectDefaultTree=1181]="Lobby1EventObjectDefaultTree",e[e.UnknownItem387=1182]="UnknownItem387",e[e.UnknownItem388=1183]="UnknownItem388",e[e.UnknownItem389=1184]="UnknownItem389",e[e.LobbyEventObjectStaticPumpkin=1185]="LobbyEventObjectStaticPumpkin",e[e.LobbyEventObject3ChristmasWindows=1186]="LobbyEventObject3ChristmasWindows",e[e.LobbyEventObjectRedAndWhiteCurtain=1187]="LobbyEventObjectRedAndWhiteCurtain",e[e.UnknownItem393=1188]="UnknownItem393",e[e.UnknownItem394=1189]="UnknownItem394",e[e.LobbyFishTank=1190]="LobbyFishTank",e[e.LobbyEventObjectButterflies=1191]="LobbyEventObjectButterflies",e[e.UnknownItem400=1192]="UnknownItem400",e[e.GreyWallLow=1193]="GreyWallLow",e[e.SpaceshipDoor=1194]="SpaceshipDoor",e[e.GreyWallHigh=1195]="GreyWallHigh",e[e.TempleNormalDoor=1196]="TempleNormalDoor",e[e.BreakableWallWallButUnbreakable=1197]="BreakableWallWallButUnbreakable",e[e.BrokenCylinderAndRubble=1198]="BrokenCylinderAndRubble",e[e.ThreeBrokenWallPiecesOnFloor=1199]="ThreeBrokenWallPiecesOnFloor",e[e.HighBrickCylinder=1200]="HighBrickCylinder",e[e.LyingCylinder=1201]="LyingCylinder",e[e.BrickConeWithFlatTop=1202]="BrickConeWithFlatTop",e[e.BreakableTempleWall=1203]="BreakableTempleWall",e[e.TempleMapDetect=1204]="TempleMapDetect",e[e.SmallBrownBrickRisingBridge=1205]="SmallBrownBrickRisingBridge",e[e.LongRisingBridgeWithPinkHighEdges=1206]="LongRisingBridgeWithPinkHighEdges",e[e.FourSwitchTempleDoor=1207]="FourSwitchTempleDoor",e[e.FourButtonSpaceshipDoor=1208]="FourButtonSpaceshipDoor",e[e.ItemBoxCca=1209]="ItemBoxCca",e[e.TeleporterEp2=1210]="TeleporterEp2",e[e.CCADoor=1211]="CCADoor",e[e.SpecialBoxCCA=1212]="SpecialBoxCCA",e[e.BigCCADoor=1213]="BigCCADoor",e[e.BigCCADoorSwitch=1214]="BigCCADoorSwitch",e[e.LittleRock=1215]="LittleRock",e[e.Little3StoneWall=1216]="Little3StoneWall",e[e.Medium3StoneWall=1217]="Medium3StoneWall",e[e.SpiderPlant=1218]="SpiderPlant",e[e.CCAAreaTeleporter=1219]="CCAAreaTeleporter",e[e.UnknownItem523=1220]="UnknownItem523",e[e.WhiteBird=1221]="WhiteBird",e[e.OrangeBird=1222]="OrangeBird",e[e.Saw=1223]="Saw",e[e.LaserDetect=1224]="LaserDetect",e[e.UnknownItem529=1225]="UnknownItem529",e[e.UnknownItem530=1226]="UnknownItem530",e[e.Seagull=1227]="Seagull",e[e.Fish=1228]="Fish",e[e.SeabedDoorWithBlueEdges=1229]="SeabedDoorWithBlueEdges",e[e.SeabedDoorAlwaysOpenNonTriggerable=1230]="SeabedDoorAlwaysOpenNonTriggerable",e[e.LittleCryotube=1231]="LittleCryotube",e[e.WideGlassWallBreakable=1232]="WideGlassWallBreakable",e[e.BlueFloatingRobot=1233]="BlueFloatingRobot",e[e.RedFloatingRobot=1234]="RedFloatingRobot",e[e.Dolphin=1235]="Dolphin",e[e.CaptureTrap=1236]="CaptureTrap",e[e.VRLink=1237]="VRLink",e[e.UnknownItem576=1238]="UnknownItem576",e[e.WarpInBarbaRayRoom=1239]="WarpInBarbaRayRoom",e[e.UnknownItem672=1240]="UnknownItem672",e[e.GeeNest=1241]="GeeNest",e[e.LabComputerConsole=1242]="LabComputerConsole",e[e.LabComputerConsoleGreenScreen=1243]="LabComputerConsoleGreenScreen",e[e.ChairYellowPillow=1244]="ChairYellowPillow",e[e.OrangeWallWithHoleInMiddle=1245]="OrangeWallWithHoleInMiddle",e[e.GreyWallWithHoleInMiddle=1246]="GreyWallWithHoleInMiddle",e[e.LongTable=1247]="LongTable",e[e.GBAStation=1248]="GBAStation",e[e.TalkLinkToSupport=1249]="TalkLinkToSupport",e[e.InstaWarp=1250]="InstaWarp",e[e.LabInvisibleObject=1251]="LabInvisibleObject",e[e.LabGlassWindowDoor=1252]="LabGlassWindowDoor",e[e.UnknownItem700=1253]="UnknownItem700",e[e.LabCeilingWarp=1254]="LabCeilingWarp",e[e.Ep4LightSource=1255]="Ep4LightSource",e[e.Cactus=1256]="Cactus",e[e.BigBrownRock=1257]="BigBrownRock",e[e.BreakableBrownRock=1258]="BreakableBrownRock",e[e.UnknownItem832=1259]="UnknownItem832",e[e.UnknownItem833=1260]="UnknownItem833",e[e.PoisonPlant=1261]="PoisonPlant",e[e.UnknownItem897=1262]="UnknownItem897",e[e.UnknownItem898=1263]="UnknownItem898",e[e.OozingDesertPlant=1264]="OozingDesertPlant",e[e.UnknownItem901=1265]="UnknownItem901",e[e.BigBlackRocks=1266]="BigBlackRocks",e[e.UnknownItem903=1267]="UnknownItem903",e[e.UnknownItem904=1268]="UnknownItem904",e[e.UnknownItem905=1269]="UnknownItem905",e[e.UnknownItem906=1270]="UnknownItem906",e[e.FallingRock=1271]="FallingRock",e[e.DesertPlantHasCollision=1272]="DesertPlantHasCollision",e[e.DesertFixedTypeBoxBreakableCrystals=1273]="DesertFixedTypeBoxBreakableCrystals",e[e.UnknownItem910=1274]="UnknownItem910",e[e.BeeHive=1275]="BeeHive",e[e.UnknownItem912=1276]="UnknownItem912",e[e.Heat=1277]="Heat",e[e.TopOfSaintMillionEgg=1278]="TopOfSaintMillionEgg",e[e.UnknownItem961=1279]="UnknownItem961"}(w||(w={}));const x=[];function j(e){return T[e]}const T=[];function C(e,t,i,o){x.push(e);const s=[];for(const[e,t]of o)s[e]=t;T[e]=Object.freeze({name:i,area_ids:s,pso_id:t})}function S(e){var t;return null!==(t=I.c[e])&&void 0!==t?t:w[e]}function O(e){return null!=I.c[e]}function L(e){var t;return null!==(t=Object(I.d)(e))&&void 0!==t?t:j(e)}var D;C(w.Unknown,void 0,"Unknown",[]),C(w.PlayerSet,0,"Player Set",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,9,0]]]),C(w.Particle,1,"Particle",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.Teleporter,2,"Teleporter",[[n.b.I,[0,1,2,3,4,5,6,7,11,12,13,14]],[n.b.II,[0,1,2,3,4,12,13,14,15]],[n.b.IV,[1,2,3,4,5,6,7,8,9,0]]]),C(w.Warp,3,"Warp",[[n.b.I,[0,1,2,3,4,5,6,7,11,12,13,14,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,9,0]]]),C(w.LightCollision,4,"Light Collision",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,15,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.Item,5,"Item",[]),C(w.EnvSound,6,"Env Sound",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,13]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.FogCollision,7,"Fog Collision",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.EventCollision,8,"Event Collision",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,9,0]]]),C(w.CharaCollision,9,"Chara Collision",[[n.b.I,[0,1,2,3,4,5,8,9,10]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.ElementalTrap,10,"Elemental Trap",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,9]]]),C(w.StatusTrap,11,"Status Trap",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,9]]]),C(w.HealTrap,12,"Heal Trap",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,9]]]),C(w.LargeElementalTrap,13,"Large Elemental Trap",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,9]]]),C(w.ObjRoomID,14,"Obj Room ID",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,11,12,13]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,9]]]),C(w.Sensor,15,"Sensor",[[n.b.I,[1,2,4,5,6,7]]]),C(w.UnknownItem16,16,"Unknown Item (16)",[]),C(w.LensFlare,17,"Lens Flare",[[n.b.I,[1,2,3,4,8,14]]]),C(w.ScriptCollision,18,"Script Collision",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.HealRing,19,"Heal Ring",[[n.b.I,[1,2,3,4,5,6,7,8,9,10]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.MapCollision,20,"Map Collision",[[n.b.I,[0,1,2,3,4,5,8,9,10,16,17]],[n.b.II,[0,5,6,7,8,9,10,11,16,17]],[n.b.IV,[0]]]),C(w.ScriptCollisionA,21,"Script Collision A",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.ItemLight,22,"Item Light",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.RadarCollision,23,"Radar Collision",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.FogCollisionSW,24,"Fog Collision SW",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,11,12,13,14]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.BossTeleporter,25,"Boss Teleporter",[[n.b.I,[0,2,5,7,10]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[5,6,7,8,0]]]),C(w.ImageBoard,26,"Image Board",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.QuestWarp,27,"Quest Warp",[[n.b.I,[1,2,3,4,5,6,7,11,12,13,14]],[n.b.IV,[9]]]),C(w.Epilogue,28,"Epilogue",[[n.b.I,[14]],[n.b.II,[13]],[n.b.IV,[9]]]),C(w.UnknownItem29,29,"Unknown Item (29)",[[n.b.I,[1]]]),C(w.UnknownItem30,30,"Unknown Item (30)",[[n.b.I,[1,2,17]],[n.b.II,[1,2,14]],[n.b.IV,[1,2,3,4,5]]]),C(w.UnknownItem31,31,"Unknown Item (31)",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.BoxDetectObject,32,"Box Detect Object",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.SymbolChatObject,33,"Symbol Chat Object",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.TouchPlateObject,34,"Touch plate Object",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.TargetableObject,35,"Targetable Object",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.EffectObject,36,"Effect object",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[0,1,2,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[0]]]),C(w.CountDownObject,37,"Count Down Object",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.UnknownItem38,38,"Unknown Item (38)",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.UnknownItem39,39,"Unknown Item (39)",[[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.UnknownItem40,40,"Unknown Item (40)",[[n.b.I,[0,1,2,4,5,6,7,8,9,10,13,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,13,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.UnknownItem41,41,"Unknown Item (41)",[[n.b.I,[0,1,2,4,5,6,7,8,9,10,13,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,13,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.MenuActivation,64,"Menu activation",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.TelepipeLocation,65,"Telepipe Location",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.BGMCollision,66,"BGM Collision",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.MainRagolTeleporter,67,"Main Ragol Teleporter",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.LobbyTeleporter,68,"Lobby Teleporter",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.PrincipalWarp,69,"Principal warp",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.ShopDoor,70,"Shop Door",[[n.b.I,[0]],[n.b.IV,[0]]]),C(w.HuntersGuildDoor,71,"Hunter's Guild Door",[[n.b.I,[0]],[n.b.IV,[0]]]),C(w.TeleporterDoor,72,"Teleporter Door",[[n.b.I,[0]],[n.b.IV,[0]]]),C(w.MedicalCenterDoor,73,"Medical Center Door",[[n.b.I,[0]],[n.b.IV,[0]]]),C(w.Elevator,74,"Elevator",[[n.b.I,[0]],[n.b.IV,[0]]]),C(w.EasterEgg,75,"Easter Egg",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.ValentinesHeart,76,"Valentines Heart",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.ChristmasTree,77,"Christmas Tree",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.ChristmasWreath,78,"Christmas Wreath",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.HalloweenPumpkin,79,"Halloween Pumpkin",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.TwentyFirstCentury,80,"21st Century",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.Sonic,81,"Sonic",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.WelcomeBoard,82,"Welcome Board",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.Firework,83,"Firework",[[n.b.I,[0]],[n.b.II,[0,16]],[n.b.IV,[0]]]),C(w.LobbyScreenDoor,84,"Lobby Screen Door",[[n.b.I,[0]],[n.b.IV,[0]]]),C(w.MainRagolTeleporterBattleInNextArea,85,"Main Ragol Teleporter (Battle in next area?)",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.LabTeleporterDoor,86,"Lab Teleporter Door",[[n.b.II,[0]]]),C(w.Pioneer2InvisibleTouchplate,87,"Pioneer 2 Invisible Touchplate",[[n.b.I,[0]],[n.b.II,[0]],[n.b.IV,[0]]]),C(w.ForestDoor,128,"Forest Door",[[n.b.I,[1,2]]]),C(w.ForestSwitch,129,"Forest Switch",[[n.b.I,[1,2,3,4,5]],[n.b.II,[1,2,3,4]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.LaserFence,130,"Laser Fence",[[n.b.I,[1,2,3,4,5,6,7,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.LaserSquareFence,131,"Laser Square Fence",[[n.b.I,[1,2,3,4,5,6,7,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.ForestLaserFenceSwitch,132,"Forest Laser Fence Switch",[[n.b.I,[1,2,3,4,5,6,7,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.LightRays,133,"Light rays",[[n.b.I,[1,2]],[n.b.II,[5,6,7,8,9]],[n.b.IV,[6,7,8]]]),C(w.BlueButterfly,134,"Blue Butterfly",[[n.b.I,[1,2]],[n.b.IV,[6,7,8]]]),C(w.Probe,135,"Probe",[[n.b.I,[1,2]]]),C(w.RandomTypeBox1,136,"Random Type Box 1",[[n.b.I,[1,2,3,4,5,6,7]],[n.b.II,[10,11,13]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.ForestWeatherStation,137,"Forest Weather Station",[[n.b.I,[1,2]]]),C(w.Battery,138,"Battery",[]),C(w.ForestConsole,139,"Forest Console",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.BlackSlidingDoor,140,"Black Sliding Door",[[n.b.I,[1,2,3]]]),C(w.RicoMessagePod,141,"Rico Message Pod",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,13]]]),C(w.EnergyBarrier,142,"Energy Barrier",[[n.b.I,[1,2,4,5,6,7]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.ForestRisingBridge,143,"Forest Rising Bridge",[[n.b.I,[1,2]]]),C(w.SwitchNoneDoor,144,"Switch (none door)",[[n.b.I,[1,2,6,7,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.EnemyBoxGrey,145,"Enemy Box (Grey)",[[n.b.I,[1,2,3,4,5,6,7]],[n.b.II,[10,11]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.FixedTypeBox,146,"Fixed Type Box",[[n.b.I,[1,2,3,4,5,6,7,11,12,13,14]],[n.b.II,[10,11,13]],[n.b.IV,[1,2,3,4,6,7,8,9]]]),C(w.EnemyBoxBrown,147,"Enemy Box (Brown)",[[n.b.I,[1,2,3,4,5,6,7]],[n.b.II,[10,11]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.EmptyTypeBox,149,"Empty Type Box",[[n.b.I,[1,2,3,4,5,6,7]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.LaserFenceEx,150,"Laser Fence Ex",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.LaserSquareFenceEx,151,"Laser Square Fence Ex",[]),C(w.FloorPanel1,192,"Floor Panel 1",[[n.b.I,[3,4,5,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.Caves4ButtonDoor,193,"Caves 4 Button door",[[n.b.I,[3,4,5]]]),C(w.CavesNormalDoor,194,"Caves Normal door",[[n.b.I,[3,4,5]]]),C(w.CavesSmashingPillar,195,"Caves Smashing Pillar",[[n.b.I,[3,4,5]],[n.b.II,[1,2,3,4,17]]]),C(w.CavesSign1,196,"Caves Sign 1",[[n.b.I,[4,5]]]),C(w.CavesSign2,197,"Caves Sign 2",[[n.b.I,[4,5]]]),C(w.CavesSign3,198,"Caves Sign 3",[[n.b.I,[4,5]]]),C(w.HexagonalTank,199,"Hexagonal Tank",[[n.b.I,[4,5]]]),C(w.BrownPlatform,200,"Brown Platform",[[n.b.I,[4,5]]]),C(w.WarningLightObject,201,"Warning Light Object",[[n.b.I,[4,5]],[n.b.IV,[5]]]),C(w.Rainbow,203,"Rainbow",[[n.b.I,[4]]]),C(w.FloatingJellyfish,204,"Floating Jellyfish",[[n.b.I,[4]],[n.b.II,[10,11]]]),C(w.FloatingDragonfly,205,"Floating Dragonfly",[[n.b.I,[4,16]],[n.b.II,[3,4]],[n.b.IV,[6,7,8]]]),C(w.CavesSwitchDoor,206,"Caves Switch Door",[[n.b.I,[3,4,5]]]),C(w.RobotRechargeStation,207,"Robot Recharge Station",[[n.b.I,[3,4,5,6,7]],[n.b.II,[17]]]),C(w.CavesCakeShop,208,"Caves Cake Shop",[[n.b.I,[5]]]),C(w.Caves1SmallRedRock,209,"Caves 1 Small Red Rock",[[n.b.I,[3]]]),C(w.Caves1MediumRedRock,210,"Caves 1 Medium Red Rock",[[n.b.I,[3]]]),C(w.Caves1LargeRedRock,211,"Caves 1 Large Red Rock",[[n.b.I,[3]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.Caves2SmallRock1,212,"Caves 2 Small Rock 1",[[n.b.I,[4]]]),C(w.Caves2MediumRock1,213,"Caves 2 Medium Rock 1",[[n.b.I,[4]]]),C(w.Caves2LargeRock1,214,"Caves 2 Large Rock 1",[[n.b.I,[4]]]),C(w.Caves2SmallRock2,215,"Caves 2 Small Rock 2",[[n.b.I,[4]]]),C(w.Caves2MediumRock2,216,"Caves 2 Medium Rock 2",[[n.b.I,[4]]]),C(w.Caves2LargeRock2,217,"Caves 2 Large Rock 2",[[n.b.I,[4]]]),C(w.Caves3SmallRock,218,"Caves 3 Small Rock",[[n.b.I,[5]]]),C(w.Caves3MediumRock,219,"Caves 3 Medium Rock",[[n.b.I,[5]]]),C(w.Caves3LargeRock,220,"Caves 3 Large Rock",[[n.b.I,[5]]]),C(w.FloorPanel2,222,"Floor Panel 2",[[n.b.I,[1,2,3,4,5,6,7,8,9,10,16,17]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.DestructableRockCaves1,223,"Destructable Rock (Caves 1)",[[n.b.I,[3]]]),C(w.DestructableRockCaves2,224,"Destructable Rock (Caves 2)",[[n.b.I,[4]]]),C(w.DestructableRockCaves3,225,"Destructable Rock (Caves 3)",[[n.b.I,[5]]]),C(w.MinesDoor,256,"Mines Door",[[n.b.I,[6,7]]]),C(w.FloorPanel3,257,"Floor Panel 3",[[n.b.I,[1,2,6,7,16,17]],[n.b.II,[1,2,3,4]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.MinesSwitchDoor,258,"Mines Switch Door",[[n.b.I,[6,7]],[n.b.IV,[6,7,8]]]),C(w.LargeCryoTube,259,"Large Cryo-Tube",[[n.b.I,[6,7]],[n.b.II,[17]]]),C(w.ComputerLikeCalus,260,"Computer (like calus)",[[n.b.I,[6,7]],[n.b.II,[17]]]),C(w.GreenScreenOpeningAndClosing,261,"Green Screen opening and closing",[[n.b.I,[6,7]],[n.b.II,[17]]]),C(w.FloatingRobot,262,"Floating Robot",[[n.b.I,[6,7]]]),C(w.FloatingBlueLight,263,"Floating Blue Light",[[n.b.I,[6,7]]]),C(w.SelfDestructingObject1,264,"Self Destructing Object 1",[[n.b.I,[6,7]]]),C(w.SelfDestructingObject2,265,"Self Destructing Object 2",[[n.b.I,[6,7]]]),C(w.SelfDestructingObject3,266,"Self Destructing Object 3",[[n.b.I,[6,7]]]),C(w.SparkMachine,267,"Spark Machine",[[n.b.I,[6,7]]]),C(w.MinesLargeFlashingCrate,268,"Mines Large Flashing Crate",[[n.b.I,[6,7]]]),C(w.RuinsSeal,304,"Ruins Seal",[[n.b.I,[13]]]),C(w.RuinsTeleporter,320,"Ruins Teleporter",[[n.b.I,[8,9,10]]]),C(w.RuinsWarpSiteToSite,321,"Ruins Warp (Site to site)",[[n.b.I,[8,9,10]]]),C(w.RuinsSwitch,322,"Ruins Switch",[[n.b.I,[8,9,10]]]),C(w.FloorPanel4,323,"Floor Panel 4",[[n.b.I,[8,9,10]]]),C(w.Ruins1Door,324,"Ruins 1 Door",[[n.b.I,[8]]]),C(w.Ruins3Door,325,"Ruins 3 Door",[[n.b.I,[10]]]),C(w.Ruins2Door,326,"Ruins 2 Door",[[n.b.I,[9]]]),C(w.Ruins11ButtonDoor,327,"Ruins 1-1 Button Door",[[n.b.I,[8]]]),C(w.Ruins21ButtonDoor,328,"Ruins 2-1 Button Door",[[n.b.I,[9]]]),C(w.Ruins31ButtonDoor,329,"Ruins 3-1 Button Door",[[n.b.I,[10]]]),C(w.Ruins4ButtonDoor,330,"Ruins 4-Button Door",[[n.b.I,[8,9,10]]]),C(w.Ruins2ButtonDoor,331,"Ruins 2-Button Door",[[n.b.I,[8,9,10]]]),C(w.RuinsSensor,332,"Ruins Sensor",[[n.b.I,[8,9,10]]]),C(w.RuinsFenceSwitch,333,"Ruins Fence Switch",[[n.b.I,[8,9,10]]]),C(w.RuinsLaserFence4x2,334,"Ruins Laser Fence 4x2",[[n.b.I,[8,9,10]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.RuinsLaserFence6x2,335,"Ruins Laser Fence 6x2",[[n.b.I,[8,9,10]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.RuinsLaserFence4x4,336,"Ruins Laser Fence 4x4",[[n.b.I,[8,9,10]]]),C(w.RuinsLaserFence6x4,337,"Ruins Laser Fence 6x4",[[n.b.I,[8,9,10]]]),C(w.RuinsPoisonBlob,338,"Ruins poison Blob",[[n.b.I,[8,9,10]],[n.b.II,[5,6,7,8,9]],[n.b.IV,[6,7,8]]]),C(w.RuinsPillarTrap,339,"Ruins Pillar Trap",[[n.b.I,[8,9,10]],[n.b.II,[1,2,3,4]]]),C(w.PopupTrapNoTech,340,"Popup Trap (No Tech)",[[n.b.I,[8,9,10]]]),C(w.RuinsCrystal,341,"Ruins Crystal",[[n.b.I,[8,9,10]]]),C(w.Monument,342,"Monument",[[n.b.I,[2,4,7]]]),C(w.RuinsRock1,345,"Ruins Rock 1",[[n.b.I,[8,9,10]]]),C(w.RuinsRock2,346,"Ruins Rock 2",[[n.b.I,[8,9,10]]]),C(w.RuinsRock3,347,"Ruins Rock 3",[[n.b.I,[8,9,10]]]),C(w.RuinsRock4,348,"Ruins Rock 4",[[n.b.I,[8,9,10]]]),C(w.RuinsRock5,349,"Ruins Rock 5",[[n.b.I,[8,9,10]]]),C(w.RuinsRock6,350,"Ruins Rock 6",[[n.b.I,[8,9,10]]]),C(w.RuinsRock7,351,"Ruins Rock 7",[[n.b.I,[8,9,10]]]),C(w.Poison,352,"Poison",[[n.b.I,[8,9,10,13]],[n.b.II,[3,4,10,11]],[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.FixedBoxTypeRuins,353,"Fixed Box Type (Ruins)",[[n.b.I,[8,9,10,16,17]],[n.b.II,[1,2,3,4,14,15]]]),C(w.RandomBoxTypeRuins,354,"Random Box Type (Ruins)",[[n.b.I,[8,9,10,16,17]],[n.b.II,[1,2,3,4,14,15]]]),C(w.EnemyTypeBoxYellow,355,"Enemy Type Box (Yellow)",[[n.b.I,[8,9,10,16,17]],[n.b.II,[1,2,3,4]]]),C(w.EnemyTypeBoxBlue,356,"Enemy Type Box (Blue)",[[n.b.I,[8,9,10,16,17]],[n.b.II,[1,2,3,4]]]),C(w.EmptyTypeBoxBlue,357,"Empty Type Box (Blue)",[[n.b.I,[8,9,10,16,17]],[n.b.II,[1,2,3,4]]]),C(w.DestructableRock,358,"Destructable Rock",[[n.b.I,[8,9,10]]]),C(w.PopupTrapsTechs,359,"Popup Traps (techs)",[[n.b.I,[6,7,8,9,10]],[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,16,17]]]),C(w.FlyingWhiteBird,368,"Flying White Bird",[[n.b.I,[14,16]],[n.b.II,[3,4]]]),C(w.Tower,369,"Tower",[[n.b.I,[14]]]),C(w.FloatingRocks,370,"Floating Rocks",[[n.b.I,[14]]]),C(w.FloatingSoul,371,"Floating Soul",[[n.b.I,[14]]]),C(w.Butterfly,372,"Butterfly",[[n.b.I,[14]]]),C(w.LobbyGameMenu,384,"Lobby Game menu",[[n.b.I,[15]]]),C(w.LobbyWarpObject,385,"Lobby Warp Object",[[n.b.I,[15]]]),C(w.Lobby1EventObjectDefaultTree,386,"Lobby 1 Event Object (Default Tree)",[[n.b.I,[15]]]),C(w.UnknownItem387,387,"Unknown Item (387)",[[n.b.I,[15]]]),C(w.UnknownItem388,388,"Unknown Item (388)",[[n.b.I,[15]]]),C(w.UnknownItem389,389,"Unknown Item (389)",[[n.b.I,[15]]]),C(w.LobbyEventObjectStaticPumpkin,390,"Lobby Event Object (Static Pumpkin)",[[n.b.I,[15]]]),C(w.LobbyEventObject3ChristmasWindows,391,"Lobby Event Object (3 Christmas Windows)",[[n.b.I,[15]]]),C(w.LobbyEventObjectRedAndWhiteCurtain,392,"Lobby Event Object (Red and White Curtain)",[[n.b.I,[15]]]),C(w.UnknownItem393,393,"Unknown Item (393)",[[n.b.I,[15]]]),C(w.UnknownItem394,394,"Unknown Item (394)",[[n.b.I,[15]]]),C(w.LobbyFishTank,395,"Lobby Fish Tank",[[n.b.I,[15]]]),C(w.LobbyEventObjectButterflies,396,"Lobby Event Object (Butterflies)",[[n.b.I,[15]]]),C(w.UnknownItem400,400,"Unknown Item (400)",[[n.b.I,[16]],[n.b.II,[3,4]]]),C(w.GreyWallLow,401,"grey wall low",[[n.b.I,[16]],[n.b.II,[3,4,17]]]),C(w.SpaceshipDoor,402,"Spaceship Door",[[n.b.I,[16]],[n.b.II,[3,4]]]),C(w.GreyWallHigh,403,"grey wall high",[[n.b.I,[16]],[n.b.II,[3,4,17]]]),C(w.TempleNormalDoor,416,"Temple Normal Door",[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.BreakableWallWallButUnbreakable,417,'"breakable wall wall, but unbreakable"',[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.BrokenCylinderAndRubble,418,"Broken cylinder and rubble",[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.ThreeBrokenWallPiecesOnFloor,419,"3 broken wall pieces on floor",[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.HighBrickCylinder,420,"high brick cylinder",[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.LyingCylinder,421,"lying cylinder",[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.BrickConeWithFlatTop,422,"brick cone with flat top",[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.BreakableTempleWall,423,"breakable temple wall",[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.TempleMapDetect,424,"Temple Map Detect",[[n.b.I,[17]],[n.b.II,[1,2,14]],[n.b.IV,[1,2,3,4,5]]]),C(w.SmallBrownBrickRisingBridge,425,"small brown brick rising bridge",[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.LongRisingBridgeWithPinkHighEdges,426,"long rising bridge (with pink high edges)",[[n.b.I,[17]],[n.b.II,[1,2]]]),C(w.FourSwitchTempleDoor,427,"4 switch temple door",[[n.b.II,[1,2]]]),C(w.FourButtonSpaceshipDoor,448,"4 button spaceship door",[[n.b.II,[3,4]]]),C(w.ItemBoxCca,512,"item box cca",[[n.b.II,[5,6,7,8,9,12,16,17]],[n.b.IV,[5]]]),C(w.TeleporterEp2,513,"Teleporter (Ep 2)",[[n.b.II,[5,6,7,8,9,10,11,12,13,16,17]]]),C(w.CCADoor,514,"CCA Door",[[n.b.II,[5,6,7,8,9,16,17]]]),C(w.SpecialBoxCCA,515,"Special Box CCA",[[n.b.II,[5,6,7,8,9,12,16,17]],[n.b.IV,[1,2,3,4,5]]]),C(w.BigCCADoor,516,"Big CCA Door",[[n.b.II,[5]]]),C(w.BigCCADoorSwitch,517,"Big CCA Door Switch",[[n.b.II,[5,6,7,8,9,16,17]]]),C(w.LittleRock,518,"Little Rock",[[n.b.II,[5,6,7,8,9,16]]]),C(w.Little3StoneWall,519,"Little 3 Stone Wall",[[n.b.II,[5,6,7,8,9,16]]]),C(w.Medium3StoneWall,520,"Medium 3 stone wall",[[n.b.II,[5,6,7,8,9,16]]]),C(w.SpiderPlant,521,"Spider Plant",[[n.b.II,[5,6,7,8,9,16]]]),C(w.CCAAreaTeleporter,522,"CCA Area Teleporter",[[n.b.II,[5,6,7,8,9,16,17]]]),C(w.UnknownItem523,523,"Unknown Item (523)",[[n.b.II,[5,12]]]),C(w.WhiteBird,524,"White Bird",[[n.b.II,[6,7,9,16,17]],[n.b.IV,[6,7,8]]]),C(w.OrangeBird,525,"Orange Bird",[[n.b.II,[6,7,9,17]]]),C(w.Saw,527,"Saw",[[n.b.II,[5,6,7,8,9,10,11,16,17]]]),C(w.LaserDetect,528,"Laser Detect",[[n.b.II,[5,6,7,8,9,10,11,16,17]]]),C(w.UnknownItem529,529,"Unknown Item (529)",[[n.b.II,[5,6,7]],[n.b.IV,[6,7,8]]]),C(w.UnknownItem530,530,"Unknown Item (530)",[[n.b.II,[5,6,7,8,9,17]]]),C(w.Seagull,531,"Seagull",[[n.b.II,[6,7,8,9,16]],[n.b.IV,[6,7,8]]]),C(w.Fish,544,"Fish",[[n.b.I,[15]],[n.b.II,[6,9,10,11,16]]]),C(w.SeabedDoorWithBlueEdges,545,"Seabed Door (with blue edges)",[[n.b.II,[10,11]]]),C(w.SeabedDoorAlwaysOpenNonTriggerable,546,"Seabed door (always open, non-triggerable)",[[n.b.II,[10,11]]]),C(w.LittleCryotube,547,"Little Cryotube",[[n.b.II,[10,11,17]]]),C(w.WideGlassWallBreakable,548,"Wide Glass Wall (breakable)",[[n.b.II,[10,11]]]),C(w.BlueFloatingRobot,549,"Blue floating robot",[[n.b.II,[10,11]]]),C(w.RedFloatingRobot,550,"Red floating robot",[[n.b.II,[10,11]]]),C(w.Dolphin,551,"Dolphin",[[n.b.II,[10,11]]]),C(w.CaptureTrap,552,"Capture Trap",[[n.b.II,[5,6,7,8,9,10,11,16,17]]]),C(w.VRLink,553,"VR link",[[n.b.II,[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]]]),C(w.UnknownItem576,576,"Unknown Item (576)",[[n.b.II,[12]]]),C(w.WarpInBarbaRayRoom,640,"Warp in Barba Ray Room",[[n.b.II,[14]]]),C(w.UnknownItem672,672,"Unknown Item (672)",[[n.b.II,[15]]]),C(w.GeeNest,688,"Gee Nest",[[n.b.I,[8,9,10]],[n.b.II,[5,6,7,8,9,16,17]],[n.b.IV,[6,7,8]]]),C(w.LabComputerConsole,689,"Lab Computer Console",[[n.b.II,[0]]]),C(w.LabComputerConsoleGreenScreen,690,"Lab Computer Console (Green Screen)",[[n.b.II,[0]]]),C(w.ChairYellowPillow,691,"Chair, Yellow Pillow",[[n.b.II,[0]]]),C(w.OrangeWallWithHoleInMiddle,692,"orange wall with hole in middle",[[n.b.II,[0]]]),C(w.GreyWallWithHoleInMiddle,693,"grey wall with hole in middle",[[n.b.II,[0]]]),C(w.LongTable,694,"long table",[[n.b.II,[0]]]),C(w.GBAStation,695,"GBA Station",[]),C(w.TalkLinkToSupport,696,"Talk (link to support)",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.InstaWarp,697,"insta-warp",[[n.b.I,[0,1,2,3,4,5,6,7,11,12,13,14,16,17]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,9,0]]]),C(w.LabInvisibleObject,698,"Lab Invisible Object",[[n.b.I,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]],[n.b.II,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],[n.b.IV,[1,2,3,4,5,6,7,8,0]]]),C(w.LabGlassWindowDoor,699,"Lab Glass window Door",[[n.b.II,[0]]]),C(w.UnknownItem700,700,"Unknown Item (700)",[[n.b.II,[13]]]),C(w.LabCeilingWarp,701,"Lab Ceiling Warp",[[n.b.II,[0]]]),C(w.Ep4LightSource,768,"Ep4 Light Source",[[n.b.IV,[1,2,3,4,5,6,7,8,9]]]),C(w.Cactus,769,"Cactus",[[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.BigBrownRock,770,"Big Brown Rock",[[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.BreakableBrownRock,771,"Breakable Brown Rock",[[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.UnknownItem832,832,"Unknown Item (832)",[]),C(w.UnknownItem833,833,"Unknown Item (833)",[]),C(w.PoisonPlant,896,"Poison Plant",[[n.b.IV,[6,7,8]]]),C(w.UnknownItem897,897,"Unknown Item (897)",[[n.b.IV,[6,7,8]]]),C(w.UnknownItem898,898,"Unknown Item (898)",[[n.b.IV,[6,7,8]]]),C(w.OozingDesertPlant,899,"Oozing Desert Plant",[[n.b.IV,[6,7,8]]]),C(w.UnknownItem901,901,"Unknown Item (901)",[[n.b.IV,[6,7,8]]]),C(w.BigBlackRocks,902,"big black rocks",[[n.b.IV,[1,2,3,4,5,6,7,8]]]),C(w.UnknownItem903,903,"Unknown Item (903)",[[n.b.IV,[6,7,8]]]),C(w.UnknownItem904,904,"Unknown Item (904)",[[n.b.IV,[6,7,8]]]),C(w.UnknownItem905,905,"Unknown Item (905)",[]),C(w.UnknownItem906,906,"Unknown Item (906)",[]),C(w.FallingRock,907,"Falling Rock",[[n.b.IV,[6,7,8]]]),C(w.DesertPlantHasCollision,908,"Desert Plant (has collision)",[[n.b.IV,[6,7,8]]]),C(w.DesertFixedTypeBoxBreakableCrystals,909,"Desert Fixed Type Box (Breakable Crystals)",[[n.b.IV,[6,7,8]]]),C(w.UnknownItem910,910,"Unknown Item (910)",[]),C(w.BeeHive,911,"Bee Hive",[[n.b.IV,[6,7,8]]]),C(w.UnknownItem912,912,"Unknown Item (912)",[[n.b.IV,[6,7,8]]]),C(w.Heat,913,"Heat",[[n.b.IV,[6,7,8]]]),C(w.TopOfSaintMillionEgg,960,"Top of saint million egg",[[n.b.IV,[9]]]),C(w.UnknownItem961,961,"Unknown Item (961)",[[n.b.IV,[9]]]),Object.freeze(x),Object.freeze(T),function(e){e[e.Normal=0]="Normal",e[e.Hovered=1]="Hovered",e[e.Selected=2]="Selected"}(D||(D={}));const B=[];B[D.Normal]=16776960,B[D.Hovered]=16768831,B[D.Selected]=16755200;const P=[];function E(e,t,i,o=new y.MeshLambertMaterial({color:O(e)?P[D.Normal]:B[D.Normal],side:y.DoubleSide})){const s=Object(R.a)(t,i,o,!1);return s.name=S(e),s}P[D.Normal]=16711680,P[D.Hovered]=16727903,P[D.Selected]=16711764;var M=i(14),W=i(532),q=i(40);function F(e,t,i){return new y.Euler(e,t,i,"ZXY")}function V(e){return(new y.Euler).setFromQuaternion(e,"ZXY")}const z=new y.Quaternion,U=new y.Quaternion;class ${constructor(e,t,i,o,s){this._section=Object(M.e)(void 0),Object(q.f)(e,"type"),Object(q.l)(t,"area_id"),Object(q.l)(i,"section_id"),Object(q.f)(o,"position"),Object(q.f)(s,"rotation"),this.type=e,this.area_id=t,this.section=this._section,this._section_id=Object(M.e)(i),this.section_id=this._section_id,this._position=Object(M.e)(o),this.position=this._position,this._world_position=Object(M.e)(o),this.world_position=this._world_position,this._rotation=Object(M.e)(s),this.rotation=this._rotation,this._world_rotation=Object(M.e)(s),this.world_rotation=this._world_rotation}set_section(e){if(e.area_variant.area.id!==this.area_id)throw new Error("Quest entities can't be moved across areas.");return this._section.val=e,this._section_id.val=e.id,this.set_position(this.position.val),this.set_rotation(this.rotation.val),this}set_position(e){this._position.val=e;const t=this.section.val;return this._world_position.val=t?e.clone().applyEuler(t.rotation).add(t.position):e,this}set_world_position(e){this._world_position.val=e;const t=this.section.val;return this._position.val=t?e.clone().sub(t.position).applyEuler(t.inverse_rotation):e,this}set_rotation(e){A(e),this._rotation.val=e;const t=this.section.val;return t?(z.setFromEuler(e),U.setFromEuler(t.rotation),this._world_rotation.val=A(V(z.multiply(U)))):this._world_rotation.val=e,this}set_world_rotation(e){A(e),this._world_rotation.val=e;const t=this.section.val;return t?(z.setFromEuler(e),U.setFromEuler(t.rotation),U.inverse(),this._rotation.val=A(V(z.multiply(U)))):this._rotation.val=e,this}}function A(e){return e.set(Object(W.c)(e.x,2*Math.PI),Object(W.c)(e.y,2*Math.PI),Object(W.c)(e.z,2*Math.PI))}class N extends ${constructor(e,t,i,o,s,n,r,a,d,c,l,_,u){var h,v,p;Object(q.l)(t,"pso_type_id"),Object(q.k)(i,"npc_id"),Object(q.m)(s,"pso_wave2"),Object(q.l)(n,"script_label"),Object(q.l)(r,"pso_roaming"),Object(q.f)(_,"scale"),Object(q.f)(u,"unknown"),Object(q.d)(2===u.length,()=>`unknown should be of length 2, was ${u.length}.`),Object(q.d)(10===u[0].length,()=>`unknown[0] should be of length 10, was ${u[0].length}`),Object(q.d)(4===u[1].length,()=>`unknown[1] should be of length 4, was ${u[1].length}`),super(e,a,d,c,l),this.pso_type_id=t,this.npc_id=i,this._wave=Object(M.e)(o),this.wave=this._wave;const g=null===(h=null==o?void 0:o.id)||void 0===h?void 0:h.val,b=null===(v=null==o?void 0:o.section_id)||void 0===v?void 0:v.val,f=null===(p=null==o?void 0:o.area_id)||void 0===p?void 0:p.val;this._pso_wave2=s,this.pso_wave2=this.wave.flat_map(e=>null==e?Object(M.e)(null==g?this._pso_wave2:0):g===e.id.val&&b===e.section_id.val&&f===e.area_id.val?e.id.map(e=>g===e?this._pso_wave2:e):e.id),this.script_label=n,this.pso_roaming=r,this.unknown=u,this.scale=_}set_wave(e){return this._wave.val=e,this}}class G extends k.a{constructor(e,t){super(e),this._collision_geometry=new y.Object3D,this._render_geometry=new y.Object3D,this._entity_models=new y.Object3D,this.disposer=new a.a,this.entity_to_mesh=new Map,this.camera=new y.PerspectiveCamera(60,1,10,1e4),this.disposer.add(t(this))}get debug(){return super.debug}set debug(e){this.debug!==e&&(super.debug=e,this._render_geometry.visible=e,this.schedule_render())}get collision_geometry(){return this._collision_geometry}set collision_geometry(e){this.scene.remove(this.collision_geometry),this._collision_geometry=e,this.scene.add(e)}set render_geometry(e){this.scene.remove(this._render_geometry),this._render_geometry=e,e.visible=this.debug,this.scene.add(e)}get entity_models(){return this._entity_models}init_camera_controls(){super.init_camera_controls()}dispose(){super.dispose(),this.disposer.dispose()}set_size(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),super.set_size(e,t)}reset_entity_models(){this.scene.remove(this._entity_models),this._entity_models=new y.Group,this.scene.add(this._entity_models),this.entity_to_mesh.clear(),this.schedule_render()}add_entity_model(e){const t=e.userData.entity;this._entity_models.add(e),this.entity_to_mesh.set(t,e),t===this.selected_entity&&this.mark_selected(e),this.schedule_render()}remove_entity_model(e){const t=this.entity_to_mesh.get(e);t&&(this.entity_to_mesh.delete(e),this._entity_models.remove(t),this.schedule_render())}get_entity_mesh(e){return this.entity_to_mesh.get(e)}mark_selected(e){e===this.hovered_mesh&&(this.hovered_mesh=void 0),e!==this.selected_mesh&&(this.selected_mesh&&H(this.selected_mesh,D.Normal),H(e,D.Selected),this.schedule_render()),this.selected_mesh=e}mark_hovered(e){this.selected_mesh&&e===this.selected_mesh||(e!==this.hovered_mesh&&(this.hovered_mesh&&H(this.hovered_mesh,D.Normal),e&&H(e,D.Hovered),this.schedule_render()),this.hovered_mesh=e)}unmark_selected(){this.selected_mesh&&(H(this.selected_mesh,D.Normal),this.schedule_render()),this.selected_mesh=void 0}}function H(e,t){const i=e.userData.entity instanceof N?P[t]:B[t];if(e)if(Array.isArray(e.material))for(const o of e.material)t===D.Normal&&o.map?o.color.set(16777215):o.color.set(i);else e.material.color.set(i)}var Q=i(13),Y=i(23),X=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const J=Y.a.get("quest_editor/rendering/QuestModelManager"),K=Object.freeze(new y.Vector3(0,800,700)),Z=Object.freeze(new y.Vector3(0,0,0)),ee=new y.Object3D;class te{constructor(e,t,i,o){this.renderer=t,this.area_asset_loader=i,this.entity_asset_loader=o,this.disposer=new a.a,this.quest_disposer=this.disposer.add(new a.a),this.area_variant_changed=()=>X(this,void 0,void 0,(function*(){const{episode:e,area_variant:t,npcs:i,objects:o}=this.get_area_variant_details();yield this.area_model_manager.load(e,t),this.quest_disposer.dispose_all(),this.npc_model_manager.remove_all(),this.object_model_manager.remove_all(),this.renderer.reset_entity_models(),this.quest_disposer.add_all(i.observe_list(this.npcs_changed,{call_now:!0}),o.observe_list(this.objects_changed,{call_now:!0}))})),this.npcs_changed=e=>{e.type===Q.a.ListChange&&(this.npc_model_manager.remove(e.removed),this.npc_model_manager.add(e.inserted))},this.objects_changed=e=>{e.type===Q.a.ListChange&&(this.object_model_manager.remove(e.removed),this.object_model_manager.add(e.inserted))},this.area_model_manager=new ie(this.renderer,i),this.npc_model_manager=new oe(e,this.renderer,o),this.object_model_manager=new oe(e,this.renderer,o)}dispose(){this.disposer.dispose(),this.npc_model_manager.remove_all(),this.object_model_manager.remove_all(),this.renderer.reset_entity_models()}}class ie{constructor(e,t){this.renderer=e,this.area_asset_loader=t,this.raycaster=new y.Raycaster,this.origin=new y.Vector3,this.down=Object.freeze(new y.Vector3(0,-1,0)),this.up=Object.freeze(new y.Vector3(0,1,0))}load(e,t){return X(this,void 0,void 0,(function*(){if(this.area_variant=t,null==e||null==t)return this.renderer.collision_geometry=ee,void(this.renderer.render_geometry=ee);try{const i=yield this.area_asset_loader.load_collision_geometry(e,t);if(this.should_cancel(t))return;const o=yield this.area_asset_loader.load_render_geometry(e,t);if(this.should_cancel(t))return;this.add_sections_to_collision_geometry(i,o),this.renderer.collision_geometry=i,this.renderer.render_geometry=o,this.renderer.reset_camera(K,Z)}catch(e){J.error(`Couldn't load models for area ${t.area.id}, variant ${t.id}.`,e),this.renderer.collision_geometry=ee,this.renderer.render_geometry=ee}}))}should_cancel(e){return this.area_variant!==e}add_sections_to_collision_geometry(e,t){for(const i of e.children){i.geometry.boundingBox.getCenter(this.origin),this.raycaster.set(this.origin,this.down);const e=this.raycaster.intersectObject(t,!0).find(e=>null!=e.object.userData.section);this.raycaster.set(this.origin,this.up);const o=this.raycaster.intersectObject(t,!0).find(e=>null!=e.object.userData.section);let s;if(s=e&&o?e.distance<=o.distance?e:o:e||o,s){const e=i.userData,t=s.object.userData;e.section=t.section}}}}class oe{constructor(e,t,i){this.current_wave=e,this.renderer=t,this.entity_asset_loader=i,this.queue=[],this.loaded_entities=[],this.loading=!1}add(e){return X(this,void 0,void 0,(function*(){if(this.queue.push(...e),!this.loading)try{for(this.loading=!0;this.queue.length;){const e=this.queue[0];try{yield this.load(e)}catch(t){J.error(`Couldn't load model for entity ${S(e.type)}.`,t)}finally{const t=this.queue.indexOf(e);-1!==t&&this.queue.splice(t,1)}}}finally{this.loading=!1}}))}remove(e){for(const t of e){const e=this.queue.indexOf(t);-1!==e&&this.queue.splice(e,1);const i=this.loaded_entities.findIndex(e=>e.entity===t);if(-1!==i){const e=this.loaded_entities.splice(i,1)[0];this.renderer.remove_entity_model(e.entity),e.disposer.dispose()}}}remove_all(){for(const{disposer:e}of this.loaded_entities)e.dispose();this.loaded_entities.splice(0,1/0),this.queue.splice(0,1/0)}load(e){return X(this,void 0,void 0,(function*(){const t=yield this.entity_asset_loader.load_geometry(e.type);if(!this.queue.includes(e))return;const i=yield this.entity_asset_loader.load_textures(e.type);if(!this.queue.includes(e))return;const o=function(e,t,i){const o=E(e.type,t,i);return o.userData.entity=e,o.position.copy(e.world_position.val),o.rotation.copy(e.world_rotation.val),o}(e,t,i);this.update_entity_geometry(e,o)}))}update_entity_geometry(e,t){this.renderer.add_entity_model(t);const i=new a.a(e.world_position.observe(({value:e})=>{t.position.copy(e),this.renderer.schedule_render()}),e.world_rotation.observe(({value:e})=>{t.rotation.copy(e),this.renderer.schedule_render()}));e instanceof N&&i.add(Object(M.d)((e,t)=>null==e||e===t,this.current_wave,e.wave).observe(({value:e})=>{t.visible=e,this.renderer.schedule_render()},{call_now:!0})),this.loaded_entities.push({entity:e,disposer:i})}}class se extends te{constructor(e,t,i,o,s,n){super(i,o,s,n),this.current_quest=e,this.current_area=t,this.disposer.add_all(e.observe(this.area_variant_changed),t.observe(this.area_variant_changed))}get_area_variant_details(){const e=this.current_quest.val,t=this.current_area.val;let i,o,s;return e&&t?(i=e.area_variants.val.find(e=>e.area.id===t.id)||t.area_variants[0],o=e.npcs.filtered(e=>e.area_id===t.id),s=e.objects.filtered(e=>e.area_id===t.id)):(o=Object(M.c)(),s=Object(M.c)()),{episode:null==e?void 0:e.episode,area_variant:i,npcs:o,objects:s}}}var ne=i(534);class re extends b.a{constructor(e,t,i){super(),this.element=Object(u.h)({className:t,tabIndex:-1}),this.renderer=i,this.renderer_view=this.add(new ne.a(this.renderer)),this.element.append(this.renderer_view.element),this.disposables(e.debug.observe(({value:e})=>this.renderer.debug=e)),this.finalize_construction()}activate(){this.renderer_view.start_rendering(),super.activate()}deactivate(){super.deactivate(),this.renderer_view.stop_rendering()}resize(e,t){return super.resize(e,t),this.renderer_view.resize(e,t),this}}let ae=void 0;const de=new Map,ce=new y.Vector2(0,0);let le=0;function _e(e,t,i){function o(e){ae&&i(Object.assign(Object.assign({},ae),{event:e}))}de.set(i,o),e.addEventListener(t,o)}function ue(e,t,i){const o=de.get(i);o&&(de.delete(i),e.removeEventListener(t,o))}function he(e){e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="none"),ae&&(ae.drag_element.style.transform=`translate(${e.clientX-ce.x}px, ${e.clientY-ce.y}px)`)}function ve(){ae&&(ae.drag_element.remove(),ae=void 0)}class pe extends ${constructor(e,t,i,o,s,n,r,a,d){super(e,o,s,n,r),this.id=t,this.group_id=i,this.properties=a,this.unknown=d}}class ge{constructor(e,t,i){this.quest_editor_store=e,this.quest=t,this.entity=i,this.description=`Create ${L(i.type).name}`}undo(){this.quest.remove_entity(this.entity)}redo(){this.quest.add_entity(this.entity),this.quest_editor_store.set_selected_entity(this.entity)}}class be{constructor(e,t,i,o,s){this.quest_editor_store=e,this.entity=t,this.old_rotation=i,this.new_rotation=o,this.world=s,this.description=`Rotate ${L(t.type).name}`}undo(){this.quest_editor_store.set_selected_entity(this.entity),this.world?this.entity.set_world_rotation(this.old_rotation):this.entity.set_rotation(this.old_rotation)}redo(){this.quest_editor_store.set_selected_entity(this.entity),this.world?this.entity.set_world_rotation(this.new_rotation):this.entity.set_rotation(this.new_rotation)}}class fe{constructor(e,t,i){this.quest_editor_store=e,this.quest=t,this.entity=i,this.description=`Delete ${L(i.type).name}`,this.redo()}undo(){this.quest.add_entity(this.entity),this.quest_editor_store.set_selected_entity(this.entity)}redo(){this.quest.remove_entity(this.entity)}}class me{constructor(e,t,i,o,s,n,r){this.quest_editor_store=e,this.entity=t,this.old_section=i,this.new_section=o,this.old_position=s,this.new_position=n,this.world=r,this.description=`Move ${L(t.type).name}`}undo(){this.quest_editor_store.set_selected_entity(this.entity),this.old_section&&this.entity.set_section(this.old_section),this.world?this.entity.set_world_position(this.old_position):this.entity.set_position(this.old_position)}redo(){this.quest_editor_store.set_selected_entity(this.entity),this.new_section&&this.entity.set_section(this.new_section),this.world?this.entity.set_world_position(this.new_position):this.entity.set_position(this.new_position)}}const we=Object.freeze(new y.Vector3(0,0,0)),ke=Object.freeze(new y.Vector3(0,1,0)),ye=Object.freeze(new y.Vector3(0,-1,0)),Re=2*Math.PI,Ie=new y.Raycaster;class xe{constructor(e,t){this.quest_editor_store=e,this.renderer=t,this.disposer=new a.a,this.pointer_position=new y.Vector2(0,0),this.pointer_device_position=new y.Vector2(0,0),this.last_pointer_position=new y.Vector2(0,0),this.moved_since_last_pointer_down=!1,this._enabled=!0,this.dispose=()=>{this.renderer.canvas_element.removeEventListener("keydown",this.keydown),this.renderer.canvas_element.removeEventListener("mousedown",this.mousedown),this.renderer.canvas_element.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup),this.renderer.canvas_element.removeEventListener("mouseleave",this.mouseleave),ue(this.renderer.canvas_element,"dragenter",this.dragenter),ue(this.renderer.canvas_element,"dragover",this.dragover),ue(this.renderer.canvas_element,"dragleave",this.dragleave),ue(this.renderer.canvas_element,"drop",this.drop),this.disposer.dispose()},this.selected_entity_changed=({value:e})=>{if(this.state.cancel(),e){const t=this.renderer.get_entity_mesh(e);t?this.renderer.mark_selected(t):this.renderer.unmark_selected()}else this.renderer.unmark_selected()},this.keydown=e=>{this.state=this.state.process_event({type:je.KeyDown,key:e.key})},this.mousedown=e=>{this.process_mouse_event(e),this.state=this.state.process_event({type:je.MouseDown,buttons:e.buttons,shift_key:e.shiftKey,pointer_device_position:this.pointer_device_position,moved_since_last_pointer_down:this.moved_since_last_pointer_down,mark_hovered:this.mark_hovered}),this.renderer.canvas_element.removeEventListener("mousemove",this.mousemove),document.addEventListener("mousemove",this.mousemove),document.addEventListener("mouseup",this.mouseup)},this.mousemove=e=>{this.process_mouse_event(e),this.state=this.state.process_event({type:je.MouseMove,buttons:e.buttons,shift_key:e.shiftKey,pointer_device_position:this.pointer_device_position,moved_since_last_pointer_down:this.moved_since_last_pointer_down,mark_hovered:this.mark_hovered})},this.mouseup=e=>{this.process_mouse_event(e),this.state=this.state.process_event({type:je.MouseUp,buttons:e.buttons,shift_key:e.shiftKey,pointer_device_position:this.pointer_device_position,moved_since_last_pointer_down:this.moved_since_last_pointer_down,mark_hovered:this.mark_hovered}),this.renderer.canvas_element.addEventListener("mousemove",this.mousemove),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup)},this.mouseleave=e=>{this.process_mouse_event(e),this.state=this.state.process_event({type:je.MouseLeave,buttons:e.buttons,shift_key:e.shiftKey,pointer_device_position:this.pointer_device_position,moved_since_last_pointer_down:this.moved_since_last_pointer_down,mark_hovered:this.mark_hovered})},this.dragenter=e=>{this.process_mouse_event(e.event),this.state=this.state.process_event({type:je.EntityDragEnter,shift_key:e.event.shiftKey,pointer_device_position:this.pointer_device_position,entity_type:e.entity_type,drag_element:e.drag_element,data_transfer:e.event.dataTransfer,prevent_default:()=>e.event.preventDefault(),stop_propagation:()=>e.event.stopPropagation()})},this.dragover=e=>{this.process_mouse_event(e.event),this.state=this.state.process_event({type:je.EntityDragOver,shift_key:e.event.shiftKey,pointer_device_position:this.pointer_device_position,entity_type:e.entity_type,drag_element:e.drag_element,data_transfer:e.event.dataTransfer,prevent_default:()=>e.event.preventDefault(),stop_propagation:()=>e.event.stopPropagation()})},this.dragleave=e=>{this.process_mouse_event(e.event),this.state=this.state.process_event({type:je.EntityDragLeave,shift_key:e.event.shiftKey,pointer_device_position:this.pointer_device_position,entity_type:e.entity_type,drag_element:e.drag_element,data_transfer:e.event.dataTransfer,prevent_default:()=>e.event.preventDefault(),stop_propagation:()=>e.event.stopPropagation()})},this.drop=e=>{this.process_mouse_event(e.event),this.renderer.canvas_element.focus(),this.state=this.state.process_event({type:je.EntityDrop})},this.mark_hovered=e=>{this.renderer.mark_hovered(e)},this.disposer.add(e.selected_entity.observe(this.selected_entity_changed)),t.canvas_element.addEventListener("keydown",this.keydown),t.canvas_element.addEventListener("mousedown",this.mousedown),t.canvas_element.addEventListener("mousemove",this.mousemove),t.canvas_element.addEventListener("mouseleave",this.mouseleave),_e(t.canvas_element,"dragenter",this.dragenter),_e(t.canvas_element,"dragover",this.dragover),_e(t.canvas_element,"dragleave",this.dragleave),_e(t.canvas_element,"drop",this.drop),this.state=new Te(this.quest_editor_store,t,this._enabled)}set enabled(e){this._enabled=e,this.state.cancel(),this.state=new Te(this.quest_editor_store,this.renderer,this._enabled)}process_mouse_event(e){const{left:t,top:i}=this.renderer.canvas_element.getBoundingClientRect();this.pointer_position.set(e.clientX-t,e.clientY-i),this.pointer_device_position.copy(this.pointer_position),this.renderer.pointer_pos_to_device_coords(this.pointer_device_position),"mousedown"===e.type?this.moved_since_last_pointer_down=!1:"mousemove"!==e.type&&"mouseup"!==e.type||this.pointer_position.equals(this.last_pointer_position)||(this.moved_since_last_pointer_down=!0),this.last_pointer_position.copy(this.pointer_position)}}var je;!function(e){e[e.KeyDown=0]="KeyDown",e[e.MouseDown=1]="MouseDown",e[e.MouseMove=2]="MouseMove",e[e.MouseUp=3]="MouseUp",e[e.MouseLeave=4]="MouseLeave",e[e.EntityDragEnter=5]="EntityDragEnter",e[e.EntityDragOver=6]="EntityDragOver",e[e.EntityDragLeave=7]="EntityDragLeave",e[e.EntityDrop=8]="EntityDrop"}(je||(je={}));class Te{constructor(e,t,i){this.quest_editor_store=e,this.renderer=t,this.enabled=i}process_event(e){switch(e.type){case je.KeyDown:if(this.enabled){const t=this.quest_editor_store.selected_entity.val;if(t&&"Delete"===e.key){const e=this.quest_editor_store.current_quest.val;e&&this.quest_editor_store.undo.push(new fe(this.quest_editor_store,e,t))}}return this;case je.MouseDown:{const t=this.pick_entity(e.pointer_device_position);if(t)if(1===e.buttons){if(this.quest_editor_store.set_selected_entity(t.entity),this.enabled)return new Ce(this.quest_editor_store,this.renderer,t.entity,t.drag_adjust,t.grab_offset)}else if(2===e.buttons&&(this.quest_editor_store.set_selected_entity(t.entity),this.enabled))return new Se(this.quest_editor_store,this.renderer,t.entity,t.mesh,t.grab_offset);return this}case je.MouseMove:{const t=this.pick_entity(e.pointer_device_position);return e.mark_hovered(t&&t.mesh),this}case je.MouseUp:return e.moved_since_last_pointer_down||this.pick_entity(e.pointer_device_position)||this.quest_editor_store.set_selected_entity(void 0),this;case je.MouseLeave:return e.mark_hovered(void 0),this;case je.EntityDragEnter:if(this.enabled){const t=this.quest_editor_store.current_area.val,i=this.quest_editor_store.current_quest.val;return t&&i?new Oe(this.quest_editor_store,this.renderer,e,i,t):this}return this;default:return this}}cancel(){}pick_entity(e){Ie.setFromCamera(e,this.renderer.camera);const[t]=Ie.intersectObjects(this.renderer.entity_models.children);if(!t)return;const i=t.object.userData.entity,o=t.object.position.clone().sub(t.point),s=o.clone();Ie.set(t.object.position,ye);const[n]=Ie.intersectObjects(this.renderer.collision_geometry.children,!0);return n&&(s.y-=n.distance),{mesh:t.object,entity:i,grab_offset:o,drag_adjust:s}}}class Ce{constructor(e,t,i,o,s){this.quest_editor_store=e,this.renderer=t,this.entity=i,this.drag_adjust=o,this.grab_offset=s,this.cancelled=!1,this.initial_section=i.section.val,this.initial_position=i.world_position.val,this.renderer.controls.enabled=!1}process_event(e){switch(e.type){case je.MouseMove:return this.cancelled?new Te(this.quest_editor_store,this.renderer,!0):(e.moved_since_last_pointer_down&&Le(this.renderer,this.entity,this.drag_adjust,this.grab_offset,e.pointer_device_position,e.shift_key),this);case je.MouseUp:return this.renderer.controls.enabled=!0,!this.cancelled&&e.moved_since_last_pointer_down&&this.quest_editor_store.undo.push(new me(this.quest_editor_store,this.entity,this.initial_section,this.entity.section.val,this.initial_position,this.entity.world_position.val,!0)).redo(),new Te(this.quest_editor_store,this.renderer,!0);default:return this.cancelled?new Te(this.quest_editor_store,this.renderer,!0):this}}cancel(){this.cancelled=!0,this.renderer.controls.enabled=!0,this.initial_section&&this.entity.set_section(this.initial_section),this.entity.set_world_position(this.initial_position)}}class Se{constructor(e,t,i,o,s){this.quest_editor_store=e,this.renderer=t,this.entity=i,this.mesh=o,this.cancelled=!1,this.initial_rotation=i.world_rotation.val,this.grab_point=i.world_position.val.clone().sub(s),this.renderer.controls.enabled=!1}process_event(e){switch(e.type){case je.MouseMove:return this.cancelled?new Te(this.quest_editor_store,this.renderer,!0):(e.moved_since_last_pointer_down&&Pe(this.renderer,this.entity,this.mesh.quaternion,this.initial_rotation,this.grab_point,e.pointer_device_position),this);case je.MouseUp:return this.renderer.controls.enabled=!0,!this.cancelled&&e.moved_since_last_pointer_down&&this.quest_editor_store.undo.push(new be(this.quest_editor_store,this.entity,this.initial_rotation,this.entity.world_rotation.val,!0)),new Te(this.quest_editor_store,this.renderer,!0);default:return this.cancelled?new Te(this.quest_editor_store,this.renderer,!0):this}}cancel(){this.cancelled=!0,this.renderer.controls.enabled=!0,this.entity.set_world_rotation(this.initial_rotation)}}class Oe{constructor(e,t,i,o,s){if(this.quest_editor_store=e,this.drag_adjust=new y.Vector3(0,0,0),this.cancelled=!1,this.renderer=t,i.drag_element.style.display="none",i.data_transfer&&(i.data_transfer.dropEffect="copy"),O(i.entity_type)){const t=Object(I.d)(i.entity_type);this.entity=new N(i.entity_type,t.pso_type_id,0,e.selected_wave.val,0,0,t.pso_roaming,s.id,0,new y.Vector3(0,0,0),F(0,0,0),new y.Vector3(1,1,1),[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0]])}else this.entity=new pe(i.entity_type,0,0,s.id,0,new y.Vector3(0,0,0),F(0,0,0),new Map,[[0,0,0,0,0,0],[0,0]]);De(this.renderer,this.entity,this.drag_adjust,we,i.pointer_device_position),o.add_entity(this.entity),this.quest_editor_store.set_selected_entity(this.entity)}process_event(e){switch(e.type){case je.EntityDragOver:return this.cancelled?(e.drag_element.style.display="flex",e.data_transfer&&(e.data_transfer.dropEffect="none"),new Te(this.quest_editor_store,this.renderer,!0)):(e.stop_propagation(),e.prevent_default(),e.data_transfer&&(e.data_transfer.dropEffect="copy"),Le(this.renderer,this.entity,this.drag_adjust,we,e.pointer_device_position,e.shift_key),this);case je.EntityDragLeave:{e.drag_element.style.display="flex";const t=this.quest_editor_store.current_quest.val;return t&&t.remove_entity(this.entity),new Te(this.quest_editor_store,this.renderer,!0)}case je.EntityDrop:if(!this.cancelled){const e=this.quest_editor_store.current_quest.val;e&&this.quest_editor_store.undo.push(new ge(this.quest_editor_store,e,this.entity))}return new Te(this.quest_editor_store,this.renderer,!0);default:return this}}cancel(){this.cancelled=!0;const e=this.quest_editor_store.current_quest.val;e&&e.remove_entity(this.entity)}}function Le(e,t,i,o,s,n){n?Be(e,t,i,o,s):De(e,t,i,o,s)}const De=(()=>{const e=new y.Plane,t=new y.Vector3;return(i,o,s,n,r)=>{const{intersection:a,section:d}=function(e,t,i){Ie.setFromCamera(t,e.camera),Ie.ray.origin.add(i);const o=Ie.intersectObjects(e.collision_geometry.children,!0);for(const e of o)if(e.face.normal.y>.75)return{intersection:e,section:e.object.userData.section};return{}}(i,r,s);if(a){if(d){const e=o.world_rotation.val;o.set_section(d),o.set_world_rotation(e)}o.set_world_position(new y.Vector3(a.point.x,a.point.y+n.y-s.y,a.point.z))}else Ie.setFromCamera(r,i.camera),e.set(ke,-o.world_position.val.y+n.y),Ie.ray.intersectPlane(e,t)&&o.set_world_position(new y.Vector3(t.x+n.x,o.world_position.val.y,t.z+n.z))}})(),Be=(()=>{const e=new y.Vector3,t=new y.Plane,i=new y.Vector3,o=new y.Vector3;return(s,n,r,a,d)=>{if(Ie.setFromCamera(d,s.camera),s.camera.getWorldDirection(e),e.negate(),e.y=0,e.normalize(),o.set(n.world_position.val.x,n.world_position.val.y,n.world_position.val.z),o.sub(a),t.setFromNormalAndCoplanarPoint(e,o),Ie.ray.intersectPlane(t,i)){const e=i.y+a.y,t=e-n.world_position.val.y;r.y-=t,n.set_world_position(new y.Vector3(n.world_position.val.x,e,n.world_position.val.z))}}})(),Pe=(()=>{const e=new y.Vector3,t=new y.Plane,i=new y.Vector3,o=new y.Vector3,s=new y.Vector3,n=new y.Vector3;return(r,a,d,c,l,_)=>{if(e.copy(ke),e.applyQuaternion(d),t.setFromNormalAndCoplanarPoint(e,l),Ie.setFromCamera(_,r.camera),Ie.ray.intersectPlane(t,i)){t.projectPoint(a.world_position.val,o),s.subVectors(o,l),n.subVectors(o,i);const r=s.dot(n),d=e.dot(s.cross(n)),_=Math.atan2(d,r);a.set_world_rotation(new y.Euler(c.x,(c.y+_)%Re,c.z,"ZXY"))}}})();class Ee extends re{constructor(e,t,i,o){super(e,"quest_editor_QuestEditorRendererView",new G(o,o=>new se(e.current_quest,e.current_area,e.selected_wave,o,t,i))),this.element.addEventListener("focus",()=>e.undo.make_current(),!0),this.entity_controls=this.disposable(new xe(e,this.renderer)),this.disposables(e.selected_entity.observe(({value:e})=>this.renderer.selected_entity=e),e.quest_runner.running.observe(({value:e})=>this.entity_controls.enabled=!e,{call_now:!0})),this.renderer.init_camera_controls(),this.finalize_construction()}}var Me=i(556),We=i(495),qe=i(583);class Fe extends We.a{constructor(e){const t=new qe.a(!0,{label:"Inline args mode",tooltip:e.has_issues.map(e=>{let t="Transform arg_push* opcodes to be inline with the opcode the arguments are given to.";return e&&(t+="\nThis mode cannot be toggled because there are issues in the script."),t})});super(t),this.disposables(t.checked.bind_to(e.inline_args_mode),t.checked.observe(({value:t})=>e.set_inline_args_mode(t)),t.enabled.bind_to(e.has_issues.map(e=>!e))),this.finalize_construction()}}var Ve=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))},ze=Me.editor.ScrollType;class Ue{constructor(e){this.editor=e,this.history=[],this.history_index=-1,this.capture_history=!0,this.disposer=new a.a,this.did_change_cursor_position=e=>{this.capture_history&&(this.history.splice(this.history_index+1,1/0),"api"===e.source||-1===this.history_index||Math.abs(e.position.lineNumber-this.history[this.history_index].lineNumber)>=10?(this.history.push(e.position),this.history_index++):this.history[this.history_index]=e.position)},this.back=()=>Ve(this,void 0,void 0,(function*(){this.history_index>0&&this.set_position(this.history[--this.history_index])})),this.forward=()=>Ve(this,void 0,void 0,(function*(){this.history_index+1<this.history.length&&this.set_position(this.history[++this.history_index])})),this.set_position=e=>{this.capture_history=!1,this.editor.setPosition(e),this.editor.revealPositionInCenterIfOutsideViewport(e,ze.Immediate),this.capture_history=!0},this.mouse_up=e=>{const t=e.event.browserEvent.button,i=e.event.browserEvent.buttons;3===t?(0===i&&(e.event.preventDefault(),this.back()),this.editor.focus()):4===t&&(0===i&&(e.event.preventDefault(),this.forward()),this.editor.focus())},this.disposer.add_all(this.editor.onDidChangeCursorPosition(this.did_change_cursor_position),this.editor.addAction({id:"phantasmal.action.back",label:"Back",keybindings:[Me.KeyMod.Alt|Me.KeyCode.LeftArrow],run:this.back}),this.editor.addAction({id:"phantasmal.action.forward",label:"Forward",keybindings:[Me.KeyMod.Alt|Me.KeyCode.RightArrow],run:this.forward}),this.editor.onMouseUp(this.mouse_up))}dispose(){this.disposer.dispose()}reset(){this.history.splice(0,1/0),this.history_index=-1}}i(785);Me.editor.defineTheme("phantasmal-world",{base:"vs-dark",inherit:!0,rules:[{token:"",foreground:"e0e0e0",background:"#181818"},{token:"tag",foreground:"99bbff"},{token:"keyword",foreground:"d0a0ff",fontStyle:"bold"},{token:"predefined",foreground:"bbffbb"},{token:"number",foreground:"ffffaa"},{token:"number.hex",foreground:"ffffaa"},{token:"string",foreground:"88ffff"},{token:"string.escape",foreground:"8888ff"}],colors:{"editor.background":"#181818","editor.lineHighlightBackground":"#202020"}});const $e=Me.editor.createModel("","psoasm");class Ae extends b.a{constructor(e,t,i){super(),this.asm_editor_store=i,this.breakpoint_decoration_ids=[],this.element=Object(u.h)(),this.tool_bar_view=this.add(new Fe(i)),this.element.append(this.tool_bar_view.element),this.editor=this.disposable(Me.editor.create(this.element,{theme:"phantasmal-world",scrollBeyondLastLine:!1,autoIndent:"full",fontSize:13,wordWrap:"on",wrappingIndent:"indent",renderIndentGuides:!1,folding:!1,glyphMargin:e.feature_active("vm")})),this.history=this.disposable(new Ue(this.editor));const o=this.editor.getAction("editor.action.quickCommand");this.disposables(this.editor.addAction({id:"editor.action.quickCommand",label:"Command Palette",keybindings:[Me.KeyMod.CtrlCmd|Me.KeyMod.Shift|Me.KeyCode.KEY_P],run:()=>o.run()})),this.disposables(i.did_undo.observe(({value:e})=>{this.editor.trigger(e,"undo",void 0)}),i.did_redo.observe(({value:e})=>{this.editor.trigger(e,"redo",void 0)}),i.model.observe(({value:e})=>{this.editor.updateOptions({readOnly:!this.enabled.val||!e}),this.editor.setModel(e||$e),this.history.reset(),this.breakpoint_decoration_ids=[],this.execloc_decoration_id="",t.clear_breakpoints()},{call_now:!0}),i.breakpoints.observe_list(e=>{if(e.type===Q.a.ListChange){for(const t of e.removed){const e=this.editor.getLineDecorations(t.line_no);if(e)for(const t of e){const e=this.breakpoint_decoration_ids.indexOf(t.id);if(e>-1){this.editor.deltaDecorations([t.id],[]),this.breakpoint_decoration_ids.splice(e,1);break}}}for(const t of e.inserted){const e=this.editor.getLineDecorations(t.line_no);(null==e?void 0:e.some(e=>this.breakpoint_decoration_ids.includes(e.id)))||this.breakpoint_decoration_ids.push(this.editor.deltaDecorations([],[{range:new Me.Range(t.line_no,0,t.line_no,0),options:{glyphMarginClassName:"quest_editor_AsmEditorView_breakpoint-enabled",glyphMarginHoverMessage:{value:"Breakpoint"}}}])[0])}}}),i.pause_location.observe(e=>{const t=this.old_pause_location,i=e.value;if(this.old_pause_location=i,void 0!==t&&void 0!==this.execloc_decoration_id){this.editor.getLineDecorations(t)&&this.editor.deltaDecorations([this.execloc_decoration_id],[])}void 0!==i&&(this.execloc_decoration_id=this.editor.deltaDecorations([],[{range:new Me.Range(i,0,i,0),options:{className:"quest_editor_AsmEditorView_execution-location",isWholeLine:!0}}])[0],this.editor.revealLineInCenterIfOutsideViewport(i))}),this.editor.onDidFocusEditorWidget(()=>i.undo.make_current()),this.editor.onMouseDown(e=>{switch(e.target.type){case Me.editor.MouseTargetType.GUTTER_GLYPH_MARGIN:{const i=e.target.position;if(!i)return;t.toggle_breakpoint(i.lineNumber)}}}),this.enabled.bind_to(t.running.map(e=>!e))),this.finalize_construction()}focus(){this.editor.focus()}resize(e,t){const i=Math.max(0,t-this.tool_bar_view.height);return this.editor.layout({width:e,height:i}),this}set_enabled(e){super.set_enabled(e),this.tool_bar_view.enabled.val=e,this.editor.updateOptions({readOnly:!e||!this.asm_editor_store.model.val})}}i(786);class Ne extends b.a{constructor(e){super(),this.ctrl=e,this.element=Object(u.h)({className:"quest_editor_EntityInfoView",tabIndex:-1}),this.no_entity_view=new g("No entity selected."),this.table_element=Object(u.t)(),this.pos_x_element=this.add(new r.a(0,{round_to:3})),this.pos_y_element=this.add(new r.a(0,{round_to:3})),this.pos_z_element=this.add(new r.a(0,{round_to:3})),this.rot_x_element=this.add(new r.a(0,{round_to:3})),this.rot_y_element=this.add(new r.a(0,{round_to:3})),this.rot_z_element=this.add(new r.a(0,{round_to:3}));const t="quest_editor_EntityInfoView_coord";this.table_element.append(Object(u.A)(Object(u.y)("Type:"),this.type_element=Object(u.v)()),Object(u.A)(Object(u.y)("Name:"),this.name_element=Object(u.v)()),Object(u.A)(Object(u.y)("Section:"),this.section_id_element=Object(u.v)()),this.wave_row_element=Object(u.A)(Object(u.y)("Wave:"),this.wave_element=Object(u.v)()),Object(u.A)(Object(u.y)({colSpan:2},"Position:")),Object(u.A)(Object(u.y)({className:t},"X:"),Object(u.v)(this.pos_x_element.element)),Object(u.A)(Object(u.y)({className:t},"Y:"),Object(u.v)(this.pos_y_element.element)),Object(u.A)(Object(u.y)({className:t},"Z:"),Object(u.v)(this.pos_z_element.element)),Object(u.A)(Object(u.y)({colSpan:2},"Rotation:")),Object(u.A)(Object(u.y)({className:t},"X:"),Object(u.v)(this.rot_x_element.element)),Object(u.A)(Object(u.y)({className:t},"Y:"),Object(u.v)(this.rot_y_element.element)),Object(u.A)(Object(u.y)({className:t},"Z:"),Object(u.v)(this.rot_z_element.element))),this.element.append(this.table_element,this.no_entity_view.element),this.element.addEventListener("focus",e.focused,!0),this.disposables(Object(u.c)(this.table_element,"hidden",e.unavailable),this.no_entity_view.visible.bind_to(e.unavailable),Object(u.c)(this.type_element,"textContent",e.type),Object(u.c)(this.name_element,"textContent",e.name),Object(u.c)(this.section_id_element,"textContent",e.section_id),Object(u.c)(this.wave_element,"textContent",e.wave),Object(u.c)(this.wave_row_element,"hidden",e.wave_hidden),e.position.observe(({value:{x:e,y:t,z:i}})=>{this.pos_x_element.value.val=e,this.pos_y_element.value.val=t,this.pos_z_element.value.val=i},{call_now:!0}),e.rotation.observe(({value:{x:e,y:t,z:i}})=>{this.rot_x_element.value.val=Object(W.d)(e),this.rot_y_element.value.val=Object(W.d)(t),this.rot_z_element.value.val=Object(W.d)(i)},{call_now:!0}),this.pos_x_element.value.observe(({value:t})=>e.set_pos_x(t)),this.pos_y_element.value.observe(({value:t})=>e.set_pos_y(t)),this.pos_z_element.value.observe(({value:t})=>e.set_pos_z(t)),this.rot_x_element.value.observe(({value:t})=>e.set_rot_x(t)),this.rot_y_element.value.observe(({value:t})=>e.set_rot_y(t)),this.rot_z_element.value.observe(({value:t})=>e.set_rot_z(t)),this.enabled.bind_to(e.enabled)),this.finalize_construction()}set_enabled(e){super.set_enabled(e),this.pos_x_element.enabled.val=e,this.pos_y_element.enabled.val=e,this.pos_z_element.enabled.val=e,this.rot_x_element.enabled.val=e,this.rot_y_element.enabled.val=e,this.rot_z_element.enabled.val=e}}var Ge=i(36);i(787);class He extends b.a{constructor(e,t,i){super(),this.entity_image_renderer=t,this.entities=Object(M.c)(),this.create_entity_element=(e,t)=>{const i=Object(u.h)({className:"quest_editor_EntityListView_entity",data:{index:t.toString()}});i.draggable=!0;const o=Object(u.l)({width:100,height:100});o.style.visibility="hidden",o.style.pointerEvents="none",i.append(o),this.entity_image_renderer.render(e).then(e=>{o.src=e,o.style.visibility="visible"});const s=Object(u.s)(L(e).name);return i.append(s),i};const o=Object(u.h)({className:"quest_editor_EntityListView_entity_list"});this.element=Object(u.h)({className:`${i} quest_editor_EntityListView`,tabIndex:-1},o),this.disposables(Object(u.d)(o,this.entities,this.create_entity_element),function(e,t){function i(e){if(e.target instanceof HTMLElement){const i=t(e.target);i?(ce.set(e.offsetX,e.offsetY),ae={drag_element:i[0],entity_type:i[1]},ae.drag_element.style.position="fixed",ae.drag_element.style.pointerEvents="none",ae.drag_element.style.zIndex="500",ae.drag_element.style.top="0",ae.drag_element.style.left="0",ae.drag_element.style.transform=`translate(${e.clientX-ce.x}px, ${e.clientY-ce.y}px)`,document.body.append(ae.drag_element),e.dataTransfer&&(e.dataTransfer.effectAllowed="copy",e.dataTransfer.setDragImage(Object(u.h)(),0,0),e.dataTransfer.setData("phantasmal-entity",L(ae.entity_type).name))):e.preventDefault()}}return e.addEventListener("dragstart",i),1==++le&&(document.addEventListener("dragover",he),document.addEventListener("dragend",ve)),{dispose(){e.removeEventListener("dragstart",i),0==--le&&(document.removeEventListener("dragover",he),document.removeEventListener("dragend",ve))}}}(o,e=>{if(!this.enabled.val)return;let t=e;do{const i=e.dataset.index;if(null!=i)return[t.querySelector("img").cloneNode(!0),this.entities.get(parseInt(i,10))];t=t.parentElement}while(t&&t!==o)}),this.enabled.bind_to(e.quest_runner.running.map(e=>!e)))}}class Qe extends He{constructor(e,t){super(e,t,"quest_editor_NpcListView"),this.quest_editor_store=e,this.filter_npcs=()=>{const e=this.quest_editor_store.current_quest.val,t=this.quest_editor_store.current_area.val,i=e?e.episode:n.b.I,o=t?t.id:0;this.entities.val=I.b.filter(e=>{const t=Object(I.d)(e);return(null==t.episode||t.episode===i)&&t.area_ids.includes(o)})},this.disposables(e.current_quest.observe(this.filter_npcs),e.current_area.observe(this.filter_npcs)),this.filter_npcs(),this.finalize_construction()}}class Ye extends He{constructor(e,t){super(e,t,"quest_editor_ObjectListView"),this.quest_editor_store=e,this.filter_objects=()=>{const e=this.quest_editor_store.current_quest.val,t=this.quest_editor_store.current_area.val,i=e?e.episode:n.b.I,o=t?t.id:0;this.entities.val=x.filter(e=>{const t=j(e);if(null==t.area_ids)return!0;const s=t.area_ids[i];return s&&s.includes(o)})},this.disposables(e.current_quest.observe(this.filter_objects),e.current_area.observe(this.filter_objects)),this.filter_objects(),this.finalize_construction()}}i(788);var Xe,Je=i(139);!function(e){e[e.NodeAdded=0]="NodeAdded",e[e.NodeRemoved=1]="NodeRemoved",e[e.EdgeAdded=2]="EdgeAdded",e[e.EdgeRemoved=3]="EdgeRemoved"}(Xe||(Xe={}));class Ke{constructor(e){this.area_id=e,this._connected_sub_graphs=Object(M.c)(),this.meta=new Map,this.emitter=Object(M.a)(),this.events=[],this.connected_sub_graphs=this._connected_sub_graphs,Object(q.m)(e,"area_id")}observe(e){return this.emitter.observe(e)}get_index(e){return this.meta.get(e).index}get_sub_graph(e){return this.meta.get(e).sub_graph}get_children(e){return this.meta.get(e).children}get_parents(e){return this.meta.get(e).parents}add_event(e,t,i){this.remove_event(e);const o=this.events.length,s=Object(M.c)(void 0,e);this.meta.set(e,{index:o,sub_graph:s,children:[],parents:[]}),this.events.push(e),this._connected_sub_graphs.push(s);for(const i of t)this.add_edge(i,e);for(const t of i)this.add_edge(e,t);this.emit({type:Xe.NodeAdded,event:e})}insert_event(e,t,i,o){this.remove_event(t);const s=Object(M.c)(void 0,t);this.meta.set(t,{index:e,sub_graph:s,parents:[],children:[]}),this.events.splice(e,0,t);for(let t=e+1;t<this.events.length;t++)this.meta.get(this.events[t]).index=t;this.insert_sub_graph(e,s);for(const e of i)this.add_edge(e,t);for(const e of o)this.add_edge(t,e);this.emit({type:Xe.NodeAdded,event:t})}remove_event(e){const t=this.meta.get(e);if(t){for(;t.children.length;)this.internal_remove_edge(e,t,t.children[0],this.meta.get(t.children[0]));for(;t.parents.length;)this.internal_remove_edge(t.parents[0],this.meta.get(t.parents[0]),e,t);t.sub_graph.remove(e),0===t.sub_graph.length.val&&this._connected_sub_graphs.remove(t.sub_graph),this.meta.delete(e);const i=this.events.indexOf(e);this.events.splice(i,1);for(let e=i;e<this.events.length;e++)this.meta.get(this.events[e]).index=e;this.emit({type:Xe.NodeRemoved,event:e})}}add_edge(e,t){const i=this.meta.get(e);Object(q.f)(i,"parent is not part of the graph");const o=this.meta.get(t);Object(q.f)(o,"child is not part of the graph"),i.children.includes(t)||i.children.push(t),o.parents.includes(e)||o.parents.push(e);const s=i.sub_graph,n=o.sub_graph;if(s!==n){let e=0;for(const t of n){const i=this.meta.get(t);for(;e<s.length.val&&!(this.meta.get(s.get(e)).index>i.index);)e++;i.sub_graph=s,s.splice(e,0,t),e++}this._connected_sub_graphs.remove(n),n.clear()}this.emit({type:Xe.EdgeAdded,parent:e,child:t})}remove_edge(e,t){this.internal_remove_edge(e,this.meta.get(e),t,this.meta.get(t))}internal_remove_edge(e,t,i,o){if(t&&o){const s=t.children.indexOf(i);-1!==s&&t.children.splice(s,1);const n=o.parents.indexOf(e);-1!==n&&o.parents.splice(n,1);const r=new Set;if(!this.connected(e,i,r)){const e=Object(M.c)(void 0,...r);e.sort((e,t)=>this.meta.get(e).index-this.meta.get(t).index);for(const i of e)t.sub_graph.remove(i);this.insert_sub_graph(this.meta.get(e.get(0)).index,e),o.sub_graph=e}this.emit({type:Xe.EdgeRemoved,parent:e,child:i})}}connected(e,t,i){if(e===t)return!0;if(i.has(t))return!1;i.add(t);const o=this.meta.get(t);if(o){for(const t of o.children)if(this.connected(e,t,i))return!0;for(const t of o.parents)if(this.connected(e,t,i))return!0}return!1}insert_sub_graph(e,t){let i=0;for(;i<this._connected_sub_graphs.length.val;){const t=this._connected_sub_graphs.get(i).get(0);if(this.meta.get(t).index>e)break;i++}this._connected_sub_graphs.splice(i,0,t)}emit(e){this.emitter.emit({value:e})}}i(789);var Ze,et=i(64);!function(e){e[e.SpawnNpcs=0]="SpawnNpcs",e[e.Unlock=1]="Unlock",e[e.Lock=2]="Lock"}(Ze||(Ze={}));const tt=Object(et.a)(Ze);class it{constructor(e,t){this.type=Ze.SpawnNpcs,Object(q.m)(e,"section_id"),Object(q.m)(t,"appear_flag"),this.section_id=e,this.appear_flag=t}}class ot{constructor(e){this.type=Ze.Unlock,Object(q.m)(e,"door_id"),this._door_id=Object(M.e)(e),this.door_id=this._door_id}set_door_id(e){Object(q.m)(e,"door_id"),this._door_id.val=e}}class st{constructor(e){this.type=Ze.Lock,Object(q.m)(e,"door_id"),this._door_id=Object(M.e)(e),this.door_id=this._door_id}set_door_id(e){Object(q.m)(e,"door_id"),this._door_id.val=e}}i(790);var nt=i(145),rt=i(65);class at extends rt.a{constructor(e){super(e),this.element=Object(u.h)({className:"core_DropDown"}),this.button_mousedown=()=>{this.just_opened=!this.menu.visible.val,this.menu.visible.val=!0},this.button_mouseup=()=>{this.just_opened?this.menu.focus():this.menu.visible.val=!1,this.just_opened=!1},this.button_keydown=({value:e})=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.just_opened=!this.menu.visible.val,this.menu.visible.val=!0,this.menu.focus(),this.menu.hover_next())},this.button=this.disposable(new Je.a({text:e.text,icon_left:e&&e.icon_left,icon_right:u.a.TriangleDown})),this.menu=this.disposable(new nt.a({items:e.items,to_label:e.to_label,related_element:this.element})),this.element.append(this.button.element,this.menu.element),this._chosen=Object(M.a)(),this.chosen=this._chosen,this.just_opened=!1,this.disposables(Object(u.g)(this.button.element,"mousedown",this.button_mousedown,{capture:!0}),this.button.onmouseup.observe(this.button_mouseup),this.button.onkeydown.observe(this.button_keydown),this.menu.selected.observe(({value:e})=>{void 0!==e&&(this._chosen.emit({value:e}),this.menu.selected.val=void 0)})),this.finalize_construction()}set_enabled(e){super.set_enabled(e),this.button.enabled.val=e}}class dt extends p.a{constructor(e,t){super(),this.ctrl=e,this.event=t,this.inputs_enabled=Object(M.e)(!0),this.create_action_element=e=>{const t=new a.a;let i,o;if(e.type===Ze.SpawnNpcs)i="Spawn:",o=Object(u.h)(Object(u.h)(t.add(new r.a(e.section_id,{min:0,step:1,enabled:!1})).element),Object(u.h)(t.add(new r.a(e.appear_flag,{min:0,step:1,enabled:!1})).element));else{i=e.type===Ze.Unlock?"Unlock:":"Lock:";const s=t.add(new r.a(e.door_id.val,{min:0,step:1,enabled:this.inputs_enabled}));o=s.element,t.add_all(s.value.bind_to(e.door_id),s.value.observe(({value:t})=>e.set_door_id(t)))}const s=t.add(new Je.a({icon_left:u.a.Remove}));return t.add_all(s.onclick.observe(()=>this.ctrl.remove_action(this.event,e))),[Object(u.A)(Object(u.y)(i),Object(u.v)(o),Object(u.v)(s.element)),t]};const i=document.createTextNode(t.wave.id.val.toString());this.delay_input=this.add(new r.a(t.delay.val,{min:0,step:1,enabled:this.inputs_enabled}));const o=Object(u.t)({className:"quest_editor_EventView_actions"}),s=this.add(new at({text:"Add action",items:tt,to_label(e){switch(e){case Ze.SpawnNpcs:return"Spawn NPCs";case Ze.Unlock:return"Unlock door";case Ze.Lock:return"Lock door"}}}));this.element=Object(u.h)({tabIndex:0},Object(u.t)(Object(u.A)(Object(u.y)("ID:"),Object(u.v)(t.id.toString())),Object(u.A)(Object(u.y)("Section:"),Object(u.v)(t.section_id.toString())),Object(u.A)(Object(u.y)("Wave:"),Object(u.v)(i)),Object(u.A)(Object(u.y)("Delay:"),Object(u.v)(this.delay_input.element)),Object(u.A)(Object(u.y)({colSpan:2},"Actions:")),Object(u.A)(Object(u.v)({colSpan:2},o)),Object(u.A)(Object(u.v)({colSpan:2},s.element)))),this.disposables(Object(u.c)(this.element,"className",e.is_selected(t).map(e=>`quest_editor_EventView ${e?"selected":""}`)),t.wave.id.observe(({value:e})=>i.data=e.toString()),Object(u.g)(this.element,"focus",()=>{e.set_selected_wave(t.wave)}),Object(u.g)(this.element,"click",i=>{i.stopPropagation(),e.set_selected_wave(t.wave)}),Object(u.g)(this.element,"keyup",i=>{"Delete"===i.key&&e.remove_event(t)}),this.delay_input.value.bind_to(t.delay),this.delay_input.value.observe(i=>e.set_delay(t,i.value)),Object(u.d)(o,t.actions,this.create_action_element),s.chosen.observe(({value:i})=>e.add_action(t,i))),this.finalize_construction()}set_enabled(e){super.set_enabled(e),this.inputs_enabled.val=e}}i(791);const ct=Y.a.get("quest_editor/gui/EventSubGraphView"),lt=8,_t=20;class ut extends p.a{constructor(e,t,i,o){super(),this.ctrl=e,this.dag=t,this.sub_graph=i,this.max_edge_depth=o,this.event_gui_data=new Map,this.event_container_element=Object(u.h)({className:"quest_editor_EventSubGraphView_event_container"}),this.edge_container_element=Object(u.h)({className:"quest_editor_EventSubGraphView_edge_container"}),this.element=Object(u.h)({className:"quest_editor_EventSubGraphView"},this.edge_container_element,this.event_container_element),this.update_edges=()=>{if(this.edge_container_element.innerHTML="",0===this.sub_graph.length.val)return;const e=Array(this.sub_graph.length.val-1);for(let t=0;t<e.length;t++)e[t]=[];for(const t of this.sub_graph){const i=this.event_gui_data.get(t);if(!i){ct.warn(`No GUI data for event ${t.id}.`);continue}const{event_view:o,position:s}=i,n=o.element,r=n.offsetTop+n.offsetHeight-_t;for(const i of this.dag.get_children(t)){const o=this.event_gui_data.get(i);if(!o){ct.warn(`No GUI data for child event ${i.id}.`);continue}const{event_view:n,position:a}=o,d=n.element.offsetTop+_t,c=Math.min(r,d),l=Math.max(r,d)-c;let _=1;const h=a>s,v=Math.min(s,a),p=Math.max(s,a);e:for(;;){for(let t=h?v:Math.max(0,v-1);t<p;t++)if(e[t][_]){_++;continue e}break}for(let t=v;t<p;t++)e[t][_]=!0;this.max_edge_depth.val=Math.max(_,this.max_edge_depth.val);const g=lt*_,b=Object(u.h)({className:"quest_editor_EventSubGraphView_edge"});b.style.left=`${4-g}px`,b.style.top=`${c}px`,b.style.width=`${g}px`,b.style.height=`${l}px`,b.dataset.parent=t.id.toString(),b.dataset.child=i.id.toString(),this.edge_container_element.append(b)}}},this.create_event_element=(e,t)=>{const i=new a.a,o=i.add(new dt(this.ctrl,e));return this.event_gui_data.set(e,{event_view:o,position:t}),i.add({dispose:()=>this.event_gui_data.delete(e)}),[o.element,i]},this.after_events_changed=e=>{e.type===Q.a.ListChange&&(this.sub_graph.val.forEach((e,t)=>{this.event_gui_data.get(e).position=t}),this.update_edges())},this.disposables(o.observe(({value:e})=>{this.element.style.marginLeft=`${lt*e}px`},{call_now:!0}),Object(u.d)(this.event_container_element,i,this.create_event_element,{after:this.after_events_changed}),t.observe(({value:e})=>{e.type!==Xe.EdgeAdded&&e.type!==Xe.EdgeRemoved||this.update_edges()})),this.finalize_construction()}set_enabled(e){super.set_enabled(e);for(const{event_view:t}of this.event_gui_data.values())t.enabled.val=e}}class ht extends b.a{constructor(e){super(),this.ctrl=e,this.sub_graph_views=new Map,this.unavailable_view=new g("No quest loaded."),this.max_edge_depth=Object(M.e)(0),this.create_sub_graph_element=e=>{let t=this.sub_graph_views.get(e);return t||(t=new ut(this.ctrl,this.ctrl.event_dag.val,e,this.max_edge_depth),this.sub_graph_views.set(e,t)),t.element},this.update_edges=()=>{for(const e of this.sub_graph_views.values())e.element.parentNode&&e.update_edges()},this.after_event_dags_changed=e=>{var t;if(e.type===Q.a.ListChange)for(const i of e.inserted)null===(t=this.sub_graph_views.get(i))||void 0===t||t.update_edges()},this.element=Object(u.h)({className:"quest_editor_EventsView",tabIndex:-1},this.container_element=Object(u.h)({className:"quest_editor_EventsView_container"},this.add(new We.a(this.add_event_button=new Je.a({text:"Add event"}))).element,this.dag_container_element=Object(u.h)({className:"quest_editor_EventsView_sub_graph_container"})),this.unavailable_view.element),this.disposables(Object(u.c)(this.container_element,"hidden",e.unavailable),this.unavailable_view.visible.bind_to(e.unavailable),this.enabled.bind_to(e.enabled),this.add_event_button.onclick.observe(e.add_event),Object(u.d)(this.dag_container_element,e.event_sub_graphs,this.create_sub_graph_element,{after:this.after_event_dags_changed}),Object(u.g)(this.element,"focus",()=>{e.focused()}),Object(u.g)(this.element,"click",()=>{e.set_selected_wave(void 0)})),this.finalize_construction()}dispose(){super.dispose();for(const e of this.sub_graph_views.values())e.dispose();this.sub_graph_views.clear()}resize(e,t){return super.resize(e,t),this.update_edges(),this}focus(){super.focus(),this.update_edges()}set_enabled(e){super.set_enabled(e);for(const t of this.sub_graph_views.values())t.element.parentNode&&(t.enabled.val=e)}}var vt;!function(e){e[e.Any=0]="Any",e[e.Byte=1]="Byte",e[e.Word=2]="Word",e[e.DWord=3]="DWord",e[e.Float=4]="Float",e[e.Label=5]="Label",e[e.ILabel=6]="ILabel",e[e.DLabel=7]="DLabel",e[e.SLabel=8]="SLabel",e[e.String=9]="String",e[e.ILabelVar=10]="ILabelVar",e[e.RegRef=11]="RegRef",e[e.RegTupRef=12]="RegTupRef",e[e.RegRefVar=13]="RegRefVar",e[e.Pointer=14]="Pointer"}(vt||(vt={}));const pt={kind:vt.Any},gt={kind:vt.Byte},bt={kind:vt.Word},ft={kind:vt.DWord},mt={kind:vt.Float},wt={kind:vt.Label},kt={kind:vt.ILabel},yt={kind:vt.DLabel},Rt={kind:vt.SLabel},It={kind:vt.String},xt={kind:vt.ILabelVar},jt={kind:vt.RegRef},Tt={kind:vt.RegRefVar},Ct={kind:vt.Pointer},St=-Math.pow(2,31),Ot=Math.pow(2,31)-1;Math.pow(2,32);var Lt,Dt;function Bt(e,t,i){return{type:e,doc:t,access:i}}!function(e){e[e.Read=0]="Read",e[e.Write=1]="Write",e[e.ReadWrite=2]="ReadWrite"}(Lt||(Lt={})),function(e){e[e.Push=0]="Push",e[e.Pop=1]="Pop"}(Dt||(Dt={}));const Pt=[],Et=new Map;function Mt(e,t,i,o,s){return{code:e,mnemonic:t,doc:i,size:e<256?1:2,params:o,stack:s}}const Wt=Pt[0]=Mt(0,"nop","No operation, does nothing.",[],void 0),qt=Pt[1]=Mt(1,"ret","Returns control to caller.",[],void 0),Ft=Pt[2]=Mt(2,"sync","Yields control for the rest of the current frame. Execution will continue the following frame.",[],void 0),Vt=Pt[3]=Mt(3,"exit",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),zt=Pt[4]=Mt(4,"thread","Starts a new thread. Thread execution will start at the given label.\nOften used to check a register every frame. Make sure to yield control with sync when looping.",[Bt(kt,void 0,void 0)],void 0),Ut=Pt[5]=Mt(5,"va_start","Initializes a variable argument list.\nMake sure to call va_end after va_start and va_call.",[],void 0),$t=Pt[6]=Mt(6,"va_end","Restores the registers overwritten by arg_push* instructions.\nCalled after va_call.",[],void 0),At=Pt[7]=Mt(7,"va_call","Calls the variable argument function at the given label.\nCalled after initializing the argument list with va_start and pushing arguments onto the stack with arg_push* instructions. Make sure to call va_end afterwards.",[Bt(kt,void 0,void 0)],void 0),Nt=Pt[8]=Mt(8,"let","Sets the first register's value to second one's value.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Gt=Pt[9]=Mt(9,"leti","Sets a register to the given value.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),Ht=Pt[10]=Mt(10,"letb","Sets a register to the given value.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(gt,void 0,Lt.Write)]},void 0,void 0),Bt(gt,void 0,void 0)],void 0),Qt=Pt[11]=Mt(11,"letw","Sets a register to the given value.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(bt,void 0,Lt.Write)]},void 0,void 0),Bt(bt,void 0,void 0)],void 0),Yt=Pt[12]=Mt(12,"leta","Sets the first register to the memory address of the second register. Not used by Sega.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(Ct,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Xt=(Pt[13]=Mt(13,"leto","Sets a register to the memory address of the given label. Not used by Sega.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(Ct,void 0,Lt.Write)]},void 0,void 0),Bt(wt,void 0,void 0)],void 0),Pt[14]=Mt(14,"unknown_0e",void 0,[],void 0),Pt[15]=Mt(15,"unknown_0f",void 0,[],void 0),Pt[16]=Mt(16,"set","Sets a register to 1.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0)),Jt=Pt[17]=Mt(17,"clear","Sets a register to 0.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Kt=Pt[18]=Mt(18,"rev","Sets a register to 1 if its current value is 0, otherwise sets it to 0.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.ReadWrite)]},void 0,void 0)],void 0),Zt=(Pt[19]=Mt(19,"gset",void 0,[Bt(bt,void 0,void 0)],void 0),Pt[20]=Mt(20,"gclear",void 0,[Bt(bt,void 0,void 0)],void 0),Pt[21]=Mt(21,"grev",void 0,[Bt(bt,void 0,void 0)],void 0),Pt[22]=Mt(22,"glet",void 0,[Bt(bt,void 0,void 0)],void 0),Pt[23]=Mt(23,"gget","Sets a register to value of the given flag.",[Bt(bt,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(bt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[24]=Mt(24,"add",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0)),ei=Pt[25]=Mt(25,"addi",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),ti=Pt[26]=Mt(26,"sub",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),ii=Pt[27]=Mt(27,"subi",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),oi=Pt[28]=Mt(28,"mul",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),si=Pt[29]=Mt(29,"muli",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),ni=Pt[30]=Mt(30,"div",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),ri=Pt[31]=Mt(31,"divi",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),ai=Pt[32]=Mt(32,"and",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),di=Pt[33]=Mt(33,"andi",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),ci=Pt[34]=Mt(34,"or",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),li=Pt[35]=Mt(35,"ori",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),_i=Pt[36]=Mt(36,"xor",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),ui=Pt[37]=Mt(37,"xori",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),hi=Pt[38]=Mt(38,"mod",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),vi=Pt[39]=Mt(39,"modi",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),pi=Pt[40]=Mt(40,"jmp",void 0,[Bt(kt,void 0,void 0)],void 0),gi=Pt[41]=Mt(41,"call",void 0,[Bt(kt,void 0,void 0)],void 0),bi=Pt[42]=Mt(42,"jmp_on",void 0,[Bt(kt,void 0,void 0),Bt(Tt,void 0,Lt.Read)],void 0),fi=Pt[43]=Mt(43,"jmp_off",void 0,[Bt(kt,void 0,void 0),Bt(Tt,void 0,Lt.Read)],void 0),mi=Pt[44]=Mt(44,"jmp_=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),wi=Pt[45]=Mt(45,"jmpi_=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),ki=Pt[46]=Mt(46,"jmp_!=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),yi=Pt[47]=Mt(47,"jmpi_!=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),Ri=Pt[48]=Mt(48,"ujmp_>",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),Ii=Pt[49]=Mt(49,"ujmpi_>",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),xi=Pt[50]=Mt(50,"jmp_>",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),ji=Pt[51]=Mt(51,"jmpi_>",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),Ti=Pt[52]=Mt(52,"ujmp_<",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),Ci=Pt[53]=Mt(53,"ujmpi_<",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),Si=Pt[54]=Mt(54,"jmp_<",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),Oi=Pt[55]=Mt(55,"jmpi_<",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),Li=Pt[56]=Mt(56,"ujmp_>=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),Di=Pt[57]=Mt(57,"ujmpi_>=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),Bi=Pt[58]=Mt(58,"jmp_>=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),Pi=Pt[59]=Mt(59,"jmpi_>=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),Ei=Pt[60]=Mt(60,"ujmp_<=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),Mi=Pt[61]=Mt(61,"ujmpi_<=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),Wi=Pt[62]=Mt(62,"jmp_<=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(kt,void 0,void 0)],void 0),qi=Pt[63]=Mt(63,"jmpi_<=",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0)],void 0),Fi=Pt[64]=Mt(64,"switch_jmp",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(xt,void 0,void 0)],void 0),Vi=Pt[65]=Mt(65,"switch_call",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(xt,void 0,void 0)],void 0),zi=Pt[66]=Mt(66,"stack_push",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Ui=Pt[67]=Mt(67,"stack_pop",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),$i=Pt[68]=Mt(68,"stack_pushm","Pushes the values of an arbitrary amount of registers onto the stack.",[Bt(jt,void 0,Lt.Read),Bt(ft,void 0,void 0)],void 0),Ai=Pt[69]=Mt(69,"stack_popm","Pops an arbitrary amount of values from the stack and writes them to registers.",[Bt(jt,void 0,Lt.Write),Bt(ft,void 0,void 0)],void 0),Ni=(Pt[70]=Mt(70,"unknown_46",void 0,[],void 0),Pt[71]=Mt(71,"unknown_47",void 0,[],void 0),Pt[72]=Mt(72,"arg_pushr","Pushes the value of the given register onto the stack.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],Dt.Push)),Gi=Pt[73]=Mt(73,"arg_pushl","Pushes the given value onto the stack.",[Bt(ft,void 0,void 0)],Dt.Push),Hi=Pt[74]=Mt(74,"arg_pushb","Pushes the given value onto the stack.",[Bt(gt,void 0,void 0)],Dt.Push),Qi=Pt[75]=Mt(75,"arg_pushw","Pushes the given value onto the stack.",[Bt(bt,void 0,void 0)],Dt.Push),Yi=Pt[76]=Mt(76,"arg_pusha","Pushes the memory address of the given register onto the stack. Not used by Sega.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],Dt.Push),Xi=Pt[77]=Mt(77,"arg_pusho","Pushes the memory address of the given label onto the stack. Not used by Sega.",[Bt(wt,void 0,void 0)],Dt.Push),Ji=Pt[78]=Mt(78,"arg_pushs","Pushes the given value onto the stack.",[Bt(It,void 0,void 0)],Dt.Push),Ki=(Pt[79]=Mt(79,"unknown_4f",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[80]=Mt(80,"message",void 0,[Bt(ft,void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[81]=Mt(81,"list","Used to display a list of items and retrieve the item selected by the player.\nList items should be seperated by newlines. The selected item's index will be written to the given register.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(gt,void 0,Lt.Write)]},void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop)),Zi=(Pt[82]=Mt(82,"fadein",void 0,[],void 0),Pt[83]=Mt(83,"fadeout",void 0,[],void 0),Pt[84]=Mt(84,"se",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[85]=Mt(85,"bgm",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[86]=Mt(86,"unknown_56",void 0,[],void 0),Pt[87]=Mt(87,"unknown_57",void 0,[],void 0),Pt[88]=Mt(88,"enable",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[89]=Mt(89,"disable",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[90]=Mt(90,"window_msg",void 0,[Bt(It,void 0,void 0)],Dt.Pop)),eo=Pt[91]=Mt(91,"add_msg",void 0,[Bt(It,void 0,void 0)],Dt.Pop),to=(Pt[92]=Mt(92,"mesend",void 0,[],void 0),Pt[93]=Mt(93,"gettime",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0)),io=Pt[94]=Mt(94,"winend",void 0,[],void 0),oo=(Pt[95]=Mt(95,"unknown_5f",void 0,[],void 0),Pt[96]=Mt(96,"npc_crt_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[97]=Mt(97,"npc_stop",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[98]=Mt(98,"npc_play",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[99]=Mt(99,"npc_kill",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[100]=Mt(100,"npc_nont",void 0,[],void 0),Pt[101]=Mt(101,"npc_talk",void 0,[],void 0),Pt[102]=Mt(102,"npc_crp_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read),Bt(pt,void 0,Lt.Read),Bt(pt,void 0,Lt.Read),Bt(kt,void 0,Lt.Read),Bt(pt,void 0,Lt.Read),Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[103]=Mt(103,"unknown_67",void 0,[],void 0),Pt[104]=Mt(104,"create_pipe",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[105]=Mt(105,"p_hpstat_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[106]=Mt(106,"p_dead_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,"Player slot.",void 0)],Dt.Pop)),so=(Pt[107]=Mt(107,"p_disablewarp",void 0,[],void 0),Pt[108]=Mt(108,"p_enablewarp",void 0,[],void 0),Pt[109]=Mt(109,"p_move_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[110]=Mt(110,"p_look",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[111]=Mt(111,"unknown_6f",void 0,[],void 0),Pt[112]=Mt(112,"p_action_disable",void 0,[],void 0),Pt[113]=Mt(113,"p_action_enable",void 0,[],void 0),Pt[114]=Mt(114,"disable_movement1",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[115]=Mt(115,"enable_movement1",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[116]=Mt(116,"p_noncol",void 0,[],void 0),Pt[117]=Mt(117,"p_col",void 0,[],void 0),Pt[118]=Mt(118,"p_setpos","Sets a player's position.",[Bt(ft,"Player slot.",void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"X coordinate.",Lt.Read),Bt(ft,"Y coordinate.",Lt.Read),Bt(ft,"Z coordinate.",Lt.Read),Bt(ft,"Y-axis rotation.",Lt.Read)]},void 0,void 0)],Dt.Pop),Pt[119]=Mt(119,"p_return_guild",void 0,[],void 0),Pt[120]=Mt(120,"p_talk_guild",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[121]=Mt(121,"npc_talk_pl_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[122]=Mt(122,"npc_talk_kill",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[123]=Mt(123,"npc_crtpk_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[124]=Mt(124,"npc_crppk_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[125]=Mt(125,"npc_crptalk_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[126]=Mt(126,"p_look_at_v1",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[127]=Mt(127,"npc_crp_id_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[128]=Mt(128,"cam_quake",void 0,[],void 0),Pt[129]=Mt(129,"cam_adj",void 0,[],void 0),Pt[130]=Mt(130,"cam_zmin",void 0,[],void 0),Pt[131]=Mt(131,"cam_zmout",void 0,[],void 0),Pt[132]=Mt(132,"cam_pan_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[133]=Mt(133,"game_lev_super",void 0,[],void 0),Pt[134]=Mt(134,"game_lev_reset",void 0,[],void 0),Pt[135]=Mt(135,"pos_pipe_v3","Create a telepipe at a specific position for the given player slot that takes players back to Pioneer 2 or the Lab.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"X coordinate.",Lt.Read),Bt(ft,"Y coordinate.",Lt.Read),Bt(ft,"Z coordinate.",Lt.Read),Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[136]=Mt(136,"if_zone_clear",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0)),no=(Pt[137]=Mt(137,"chk_ene_num","Retrieves the amount of enemies killed during the quest.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[138]=Mt(138,"unhide_obj",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[139]=Mt(139,"unhide_ene",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[140]=Mt(140,"at_coords_call",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(kt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[141]=Mt(141,"at_coords_talk",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(kt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[142]=Mt(142,"col_npcin",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(kt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[143]=Mt(143,"col_npcinr",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[144]=Mt(144,"switch_on",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[145]=Mt(145,"switch_off",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[146]=Mt(146,"playbgm_epi",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[147]=Mt(147,"set_mainwarp",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[148]=Mt(148,"set_obj_param","Creates a targetable object.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"X coordinate.",Lt.Read),Bt(ft,"Y coordinate.",Lt.Read),Bt(ft,"Z coordinate.",Lt.Read),Bt(ft,"Collision radius.",Lt.Read),Bt(kt,"Function label.",Lt.Read),Bt(ft,"Vertical position of the cursor.",Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},"Object handle.",void 0)],void 0),Pt[149]=Mt(149,"set_floor_handler",void 0,[Bt(ft,"Floor number.",void 0),Bt(kt,"Handler function label.",void 0)],Dt.Pop)),ro=(Pt[150]=Mt(150,"clr_floor_handler",void 0,[Bt(ft,"Floor number.",void 0)],Dt.Pop),Pt[151]=Mt(151,"col_plinaw",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[152]=Mt(152,"hud_hide",void 0,[],void 0),Pt[153]=Mt(153,"hud_show",void 0,[],void 0),Pt[154]=Mt(154,"cine_enable",void 0,[],void 0),Pt[155]=Mt(155,"cine_disable",void 0,[],void 0),Pt[156]=Mt(156,"unknown_9c",void 0,[],void 0),Pt[157]=Mt(157,"unknown_9d",void 0,[],void 0),Pt[158]=Mt(158,"unknown_9e",void 0,[],void 0),Pt[159]=Mt(159,"unknown_9f",void 0,[],void 0),Pt[160]=Mt(160,"unknown_a0",void 0,[],void 0),Pt[161]=Mt(161,"set_qt_failure",void 0,[Bt(kt,void 0,void 0)],void 0),Pt[162]=Mt(162,"set_qt_success",void 0,[Bt(kt,void 0,void 0)],void 0),Pt[163]=Mt(163,"clr_qt_failure",void 0,[],void 0),Pt[164]=Mt(164,"clr_qt_success",void 0,[],void 0),Pt[165]=Mt(165,"set_qt_cancel",void 0,[Bt(kt,void 0,void 0)],void 0),Pt[166]=Mt(166,"clr_qt_cancel",void 0,[],void 0),Pt[167]=Mt(167,"unknown_a7",void 0,[],void 0),Pt[168]=Mt(168,"pl_walk_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[169]=Mt(169,"unknown_a9",void 0,[],void 0),Pt[170]=Mt(170,"unknown_aa",void 0,[],void 0),Pt[171]=Mt(171,"unknown_ab",void 0,[],void 0),Pt[172]=Mt(172,"unknown_ac",void 0,[],void 0),Pt[173]=Mt(173,"unknown_ad",void 0,[],void 0),Pt[174]=Mt(174,"unknown_ae",void 0,[],void 0),Pt[175]=Mt(175,"unknown_af",void 0,[],void 0),Pt[176]=Mt(176,"pl_add_meseta",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[177]=Mt(177,"thread_stg",void 0,[Bt(kt,void 0,void 0)],void 0)),ao=(Pt[178]=Mt(178,"del_obj_param",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},"Object handle.",void 0)],void 0),Pt[179]=Mt(179,"item_create",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[180]=Mt(180,"item_create2",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[181]=Mt(181,"item_delete",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[182]=Mt(182,"item_delete2","Deletes an item from the player's inventory.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[183]=Mt(183,"item_check",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[184]=Mt(184,"setevt",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[185]=Mt(185,"get_difflvl","Sets the given register to the current difficulty. 0 For normal, 1 for hard and 2 for both very hard and ultimate.\nUse get_difficulty_level2 if you want to differentiate between very hard and ultimate.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0)),co=(Pt[186]=Mt(186,"set_qt_exit",void 0,[Bt(kt,void 0,void 0)],void 0),Pt[187]=Mt(187,"clr_qt_exit",void 0,[],void 0),Pt[188]=Mt(188,"unknown_bc",void 0,[],void 0),Pt[189]=Mt(189,"unknown_bd",void 0,[],void 0),Pt[190]=Mt(190,"unknown_be",void 0,[],void 0),Pt[191]=Mt(191,"unknown_bf",void 0,[],void 0),Pt[192]=Mt(192,"particle_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[193]=Mt(193,"npc_text",void 0,[Bt(ft,void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[194]=Mt(194,"npc_chkwarp",void 0,[],void 0),Pt[195]=Mt(195,"pl_pkoff",void 0,[],void 0),Pt[196]=Mt(196,"map_designate",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0)),lo=(Pt[197]=Mt(197,"masterkey_on",void 0,[],void 0),Pt[198]=Mt(198,"masterkey_off",void 0,[],void 0),Pt[199]=Mt(199,"window_time",void 0,[],void 0),Pt[200]=Mt(200,"winend_time",void 0,[],void 0),Pt[201]=Mt(201,"winset_time",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[202]=Mt(202,"getmtime",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[203]=Mt(203,"set_quest_board_handler",void 0,[Bt(ft,void 0,void 0),Bt(kt,void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[204]=Mt(204,"clear_quest_board_handler",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[205]=Mt(205,"particle_id_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[206]=Mt(206,"npc_crptalk_id_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[207]=Mt(207,"npc_lang_clean",void 0,[],void 0),Pt[208]=Mt(208,"pl_pkon",void 0,[],void 0),Pt[209]=Mt(209,"pl_chk_item2",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[210]=Mt(210,"enable_mainmenu",void 0,[],void 0),Pt[211]=Mt(211,"disable_mainmenu",void 0,[],void 0),Pt[212]=Mt(212,"start_battlebgm",void 0,[],void 0),Pt[213]=Mt(213,"end_battlebgm",void 0,[],void 0),Pt[214]=Mt(214,"disp_msg_qb",void 0,[Bt(It,void 0,void 0)],Dt.Pop),Pt[215]=Mt(215,"close_msg_qb",void 0,[],void 0),Pt[216]=Mt(216,"set_eventflag_v3",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[217]=Mt(217,"sync_leti",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0)),_o=(Pt[218]=Mt(218,"set_returnhunter",void 0,[],void 0),Pt[219]=Mt(219,"set_returncity",void 0,[],void 0),Pt[220]=Mt(220,"load_pvr",void 0,[],void 0),Pt[221]=Mt(221,"load_midi",void 0,[],void 0),Pt[222]=Mt(222,"unknown_de",void 0,[],void 0),Pt[223]=Mt(223,"npc_param_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[224]=Mt(224,"pad_dragon",void 0,[],void 0),Pt[225]=Mt(225,"clear_mainwarp",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[226]=Mt(226,"pcam_param_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[227]=Mt(227,"start_setevt_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[228]=Mt(228,"warp_on",void 0,[],void 0),Pt[229]=Mt(229,"warp_off",void 0,[],void 0),Pt[230]=Mt(230,"get_slotnumber",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0)),uo=(Pt[231]=Mt(231,"get_servernumber",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[232]=Mt(232,"set_eventflag2",void 0,[Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],Dt.Pop),Pt[233]=Mt(233,"res",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[234]=Mt(234,"unknown_ea",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0)],void 0),Pt[235]=Mt(235,"enable_bgmctrl",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[236]=Mt(236,"sw_send",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[237]=Mt(237,"create_bgmctrl",void 0,[],void 0),Pt[238]=Mt(238,"pl_add_meseta2",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[239]=Mt(239,"sync_register",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[240]=Mt(240,"send_regwork",void 0,[],void 0),Pt[241]=Mt(241,"leti_fixed_camera_v3",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[242]=Mt(242,"default_camera_pos1",void 0,[],void 0),Pt[243]=Mt(243,"unknown_f3",void 0,[],void 0),Pt[244]=Mt(244,"unknown_f4",void 0,[],void 0),Pt[245]=Mt(245,"unknown_f5",void 0,[],void 0),Pt[246]=Mt(246,"unknown_f6",void 0,[],void 0),Pt[247]=Mt(247,"unknown_f7",void 0,[],void 0),Pt[248]=Mt(248,"unknown_f8",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[249]=Mt(249,"unknown_f9",void 0,[],void 0),Pt[250]=Mt(250,"get_gc_number",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[251]=Mt(251,"unknown_fb",void 0,[Bt(bt,void 0,void 0)],void 0),Pt[252]=Mt(252,"unknown_fc",void 0,[],void 0),Pt[253]=Mt(253,"unknown_fd",void 0,[],void 0),Pt[254]=Mt(254,"unknown_fe",void 0,[],void 0),Pt[255]=Mt(255,"unknown_ff",void 0,[],void 0),Pt[63488]=Mt(63488,"unknown_f800",void 0,[],void 0),Pt[63489]=Mt(63489,"set_chat_callback",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[63490]=Mt(63490,"unknown_f802",void 0,[],void 0),Pt[63491]=Mt(63491,"unknown_f803",void 0,[],void 0),Pt[63492]=Mt(63492,"unknown_f804",void 0,[],void 0),Pt[63493]=Mt(63493,"unknown_f805",void 0,[],void 0),Pt[63494]=Mt(63494,"unknown_f806",void 0,[],void 0),Pt[63495]=Mt(63495,"unknown_f807",void 0,[],void 0),Pt[63496]=Mt(63496,"get_difficulty_level2","Sets the given register to the current difficulty. 0 For normal, 1 for hard, 2 for very hard and 3 for ultimate.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63497]=Mt(63497,"get_number_of_player1","Set the given register to the current number of players. Either 1, 2, 3 or 4.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63498]=Mt(63498,"get_coord_of_player","Retrieves a player's position.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"X coordinate.",Lt.Write),Bt(ft,"Y coordinate.",Lt.Write),Bt(ft,"Z coordinate.",Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63499]=Mt(63499,"enable_map",void 0,[],void 0),Pt[63500]=Mt(63500,"disable_map",void 0,[],void 0),Pt[63501]=Mt(63501,"map_designate_ex",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0)),ho=(Pt[63502]=Mt(63502,"unknown_f80e",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63503]=Mt(63503,"unknown_f80f",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63504]=Mt(63504,"ba_initial_floor",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63505]=Mt(63505,"set_ba_rules",void 0,[],void 0),Pt[63506]=Mt(63506,"unknown_f812",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63507]=Mt(63507,"unknown_f813",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63508]=Mt(63508,"unknown_f814",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63509]=Mt(63509,"unknown_f815",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63510]=Mt(63510,"unknown_f816",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63511]=Mt(63511,"unknown_f817",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63512]=Mt(63512,"unknown_f818",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63513]=Mt(63513,"unknown_f819",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63514]=Mt(63514,"unknown_f81a",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63515]=Mt(63515,"unknown_f81b",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63516]=Mt(63516,"ba_disp_msg",void 0,[Bt(It,void 0,void 0)],Dt.Pop),Pt[63517]=Mt(63517,"death_lvl_up",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63518]=Mt(63518,"death_tech_lvl_up",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63519]=Mt(63519,"unknown_f81f",void 0,[],void 0),Pt[63520]=Mt(63520,"cmode_stage",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63521]=Mt(63521,"unknown_f821",void 0,[],void 0),Pt[63522]=Mt(63522,"unknown_f822",void 0,[],void 0),Pt[63523]=Mt(63523,"unknown_f823",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63524]=Mt(63524,"unknown_f824",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63525]=Mt(63525,"exp_multiplication",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63526]=Mt(63526,"exp_division",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63527]=Mt(63527,"get_user_is_dead",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63528]=Mt(63528,"go_floor","Sends a player to the given floor.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Floor ID.",Lt.Read)]},void 0,void 0)],void 0),Pt[63529]=Mt(63529,"unknown_f829",void 0,[],void 0),Pt[63530]=Mt(63530,"unknown_f82a",void 0,[],void 0),Pt[63531]=Mt(63531,"unlock_door2",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63532]=Mt(63532,"lock_door2",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63533]=Mt(63533,"if_switch_not_pressed",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63534]=Mt(63534,"if_switch_pressed",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Floor ID.",Lt.Read),Bt(ft,"Switch ID.",Lt.Read),Bt(ft,"Will be set to 1 if the switch is pressed, 0 otherwise.",Lt.Write)]},void 0,void 0)],void 0),Pt[63535]=Mt(63535,"unknown_f82f",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63536]=Mt(63536,"control_dragon",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63537]=Mt(63537,"release_dragon",void 0,[],void 0),Pt[63538]=Mt(63538,"unknown_f832",void 0,[],void 0),Pt[63539]=Mt(63539,"unknown_f833",void 0,[],void 0),Pt[63540]=Mt(63540,"unknown_f834",void 0,[],void 0),Pt[63541]=Mt(63541,"unknown_f835",void 0,[],void 0),Pt[63542]=Mt(63542,"unknown_f836",void 0,[],void 0),Pt[63543]=Mt(63543,"unknown_f837",void 0,[],void 0),Pt[63544]=Mt(63544,"shrink",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63545]=Mt(63545,"unshrink",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63546]=Mt(63546,"unknown_f83a",void 0,[],void 0),Pt[63547]=Mt(63547,"unknown_f83b",void 0,[],void 0),Pt[63548]=Mt(63548,"display_clock2",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63549]=Mt(63549,"unknown_f83d",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63550]=Mt(63550,"delete_area_title",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63551]=Mt(63551,"unknown_f83f",void 0,[],void 0),Pt[63552]=Mt(63552,"load_npc_data",void 0,[],void 0),Pt[63553]=Mt(63553,"get_npc_data",void 0,[Bt(yt,void 0,void 0)],void 0),Pt[63554]=Mt(63554,"unknown_f842",void 0,[],void 0),Pt[63555]=Mt(63555,"unknown_f843",void 0,[],void 0),Pt[63556]=Mt(63556,"unknown_f844",void 0,[],void 0),Pt[63557]=Mt(63557,"unknown_f845",void 0,[],void 0),Pt[63558]=Mt(63558,"unknown_f846",void 0,[],void 0),Pt[63559]=Mt(63559,"unknown_f847",void 0,[],void 0),Pt[63560]=Mt(63560,"give_damage_score",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63561]=Mt(63561,"take_damage_score",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63562]=Mt(63562,"unk_score_f84a",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63563]=Mt(63563,"unk_score_f84b",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63564]=Mt(63564,"kill_score",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63565]=Mt(63565,"death_score",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63566]=Mt(63566,"unk_score_f84e",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63567]=Mt(63567,"enemy_death_score",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63568]=Mt(63568,"meseta_score",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63569]=Mt(63569,"unknown_f851",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63570]=Mt(63570,"unknown_f852",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63571]=Mt(63571,"reverse_warps",void 0,[],void 0),Pt[63572]=Mt(63572,"unreverse_warps",void 0,[],void 0),Pt[63573]=Mt(63573,"set_ult_map",void 0,[],void 0),Pt[63574]=Mt(63574,"unset_ult_map",void 0,[],void 0),Pt[63575]=Mt(63575,"set_area_title",void 0,[Bt(It,void 0,void 0)],Dt.Pop),Pt[63576]=Mt(63576,"unknown_f858",void 0,[],void 0),Pt[63577]=Mt(63577,"unknown_f859",void 0,[],void 0),Pt[63578]=Mt(63578,"equip_item",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63579]=Mt(63579,"unequip_item",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63580]=Mt(63580,"unknown_f85c",void 0,[],void 0),Pt[63581]=Mt(63581,"unknown_f85d",void 0,[],void 0),Pt[63582]=Mt(63582,"unknown_f85e",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63583]=Mt(63583,"unknown_f85f",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63584]=Mt(63584,"unknown_f860",void 0,[],void 0),Pt[63585]=Mt(63585,"unknown_f861",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63586]=Mt(63586,"unknown_f862",void 0,[],void 0),Pt[63587]=Mt(63587,"unknown_f863",void 0,[],void 0),Pt[63588]=Mt(63588,"cmode_rank",void 0,[Bt(ft,void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[63589]=Mt(63589,"award_item_name",void 0,[],void 0),Pt[63590]=Mt(63590,"award_item_select",void 0,[],void 0),Pt[63591]=Mt(63591,"award_item_give_to",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63592]=Mt(63592,"unknown_f868",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63593]=Mt(63593,"unknown_f869",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63594]=Mt(63594,"item_create_cmode",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63595]=Mt(63595,"unknown_f86b",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63596]=Mt(63596,"award_item_ok",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63597]=Mt(63597,"unknown_f86d",void 0,[],void 0),Pt[63598]=Mt(63598,"unknown_f86e",void 0,[],void 0),Pt[63599]=Mt(63599,"ba_set_lives",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63600]=Mt(63600,"ba_set_tech_lvl",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63601]=Mt(63601,"ba_set_lvl",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63602]=Mt(63602,"ba_set_time_limit",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63603]=Mt(63603,"boss_is_dead",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63604]=Mt(63604,"unknown_f874",void 0,[],void 0),Pt[63605]=Mt(63605,"unknown_f875",void 0,[],void 0),Pt[63606]=Mt(63606,"unknown_f876",void 0,[],void 0),Pt[63607]=Mt(63607,"enable_techs","Enables technique use for the given player.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63608]=Mt(63608,"disable_techs","Disables technique use for the given player.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63609]=Mt(63609,"get_gender","Retrieves the player's gender. 0 If male, 1 if female.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player gender.",Lt.Write)]},void 0,void 0)],void 0),Pt[63610]=Mt(63610,"get_chara_class","Retrieves the player's race and character class.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player race. 0 If human, 1 if newman, 2 if cast.",Lt.Write),Bt(ft,"Player class. 0 If hunter, 1 if ranger, 2 if force.",Lt.Write)]},void 0,void 0)],void 0),Pt[63611]=Mt(63611,"take_slot_meseta","Takes an amount of meseta from a player's inventory.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read),Bt(ft,"Amount of meseta to take.",Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Will be set to 1 if the meseta was taken, 0 otherwise.",Lt.Write)]},void 0,void 0)],void 0),Pt[63612]=Mt(63612,"unknown_f87c",void 0,[],void 0),Pt[63613]=Mt(63613,"unknown_f87d",void 0,[],void 0),Pt[63614]=Mt(63614,"unknown_f87e",void 0,[],void 0),Pt[63615]=Mt(63615,"read_guildcard_flag",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63616]=Mt(63616,"unknown_f880",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63617]=Mt(63617,"get_pl_name","Sets the value of <pl_name> to the given player's name.",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63618]=Mt(63618,"get_pl_job","Sets the value of <pl_job> to the given player's job (Hunter/Ranger/Force).",[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63619]=Mt(63619,"unknown_f883",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63620]=Mt(63620,"unknown_f884",void 0,[],void 0),Pt[63621]=Mt(63621,"unknown_f885",void 0,[],void 0),Pt[63622]=Mt(63622,"unknown_f886",void 0,[],void 0),Pt[63623]=Mt(63623,"unknown_f887",void 0,[],void 0),Pt[63624]=Mt(63624,"unknown_f888",void 0,[],void 0),Pt[63625]=Mt(63625,"unknown_f889",void 0,[],void 0),Pt[63626]=Mt(63626,"get_player_status",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63627]=Mt(63627,"send_mail",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[63628]=Mt(63628,"online_check",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63629]=Mt(63629,"chl_set_timerecord",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63630]=Mt(63630,"chl_get_timerecord",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63631]=Mt(63631,"unknown_f88f",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63632]=Mt(63632,"unknown_f890",void 0,[],void 0),Pt[63633]=Mt(63633,"load_enemy_data",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63634]=Mt(63634,"get_physical_data",void 0,[Bt(bt,void 0,void 0)],void 0),Pt[63635]=Mt(63635,"get_attack_data",void 0,[Bt(bt,void 0,void 0)],void 0),Pt[63636]=Mt(63636,"get_resist_data",void 0,[Bt(bt,void 0,void 0)],void 0),Pt[63637]=Mt(63637,"get_movement_data",void 0,[Bt(bt,void 0,void 0)],void 0),Pt[63638]=Mt(63638,"unknown_f896",void 0,[],void 0),Pt[63639]=Mt(63639,"unknown_f897",void 0,[],void 0),Pt[63640]=Mt(63640,"shift_left",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0)),vo=Pt[63641]=Mt(63641,"shift_right",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),po=Pt[63642]=Mt(63642,"get_random",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),go=(Pt[63643]=Mt(63643,"reset_map","Sets all registers to 0 and resets the quest.",[],void 0),Pt[63644]=Mt(63644,"disp_chl_retry_menu",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63645]=Mt(63645,"chl_reverser",void 0,[],void 0),Pt[63646]=Mt(63646,"unknown_f89e",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63647]=Mt(63647,"unknown_f89f",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63648]=Mt(63648,"unknown_f8a0",void 0,[],void 0),Pt[63649]=Mt(63649,"unknown_f8a1",void 0,[],void 0),Pt[63650]=Mt(63650,"unknown_f8a2",void 0,[],void 0),Pt[63651]=Mt(63651,"unknown_f8a3",void 0,[],void 0),Pt[63652]=Mt(63652,"unknown_f8a4",void 0,[],void 0),Pt[63653]=Mt(63653,"unknown_f8a5",void 0,[],void 0),Pt[63654]=Mt(63654,"unknown_f8a6",void 0,[],void 0),Pt[63655]=Mt(63655,"unknown_f8a7",void 0,[],void 0),Pt[63656]=Mt(63656,"unknown_f8a8",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63657]=Mt(63657,"unknown_f8a9",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63658]=Mt(63658,"unknown_f8aa",void 0,[],void 0),Pt[63659]=Mt(63659,"unknown_f8ab",void 0,[],void 0),Pt[63660]=Mt(63660,"unknown_f8ac",void 0,[],void 0),Pt[63661]=Mt(63661,"get_number_of_player2",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63662]=Mt(63662,"unknown_f8ae",void 0,[],void 0),Pt[63663]=Mt(63663,"unknown_f8af",void 0,[],void 0),Pt[63664]=Mt(63664,"unknown_f8b0",void 0,[],void 0),Pt[63665]=Mt(63665,"unknown_f8b1",void 0,[],void 0),Pt[63666]=Mt(63666,"unknown_f8b2",void 0,[],void 0),Pt[63667]=Mt(63667,"unknown_f8b3",void 0,[],void 0),Pt[63668]=Mt(63668,"unknown_f8b4",void 0,[],void 0),Pt[63669]=Mt(63669,"unknown_f8b5",void 0,[],void 0),Pt[63670]=Mt(63670,"unknown_f8b6",void 0,[],void 0),Pt[63671]=Mt(63671,"unknown_f8b7",void 0,[],void 0),Pt[63672]=Mt(63672,"unknown_f8b8",void 0,[],void 0),Pt[63673]=Mt(63673,"chl_recovery",void 0,[],void 0),Pt[63674]=Mt(63674,"unknown_f8ba",void 0,[],void 0),Pt[63675]=Mt(63675,"unknown_f8bb",void 0,[],void 0),Pt[63676]=Mt(63676,"set_episode",void 0,[Bt(ft,void 0,void 0)],void 0)),bo=(Pt[63677]=Mt(63677,"unknown_f8bd",void 0,[],void 0),Pt[63678]=Mt(63678,"unknown_f8be",void 0,[],void 0),Pt[63679]=Mt(63679,"unknown_f8bf",void 0,[],void 0),Pt[63680]=Mt(63680,"file_dl_req",void 0,[Bt(ft,void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[63681]=Mt(63681,"get_dl_status",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63682]=Mt(63682,"gba_unknown4",void 0,[],void 0),Pt[63683]=Mt(63683,"get_gba_state",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63684]=Mt(63684,"unknown_f8c4",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63685]=Mt(63685,"unknown_f8c5",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63686]=Mt(63686,"qexit",void 0,[],void 0),Pt[63687]=Mt(63687,"use_animation",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Animation ID.",Lt.Read),Bt(ft,"Animation duration in number of frames.",Lt.Read)]},void 0,void 0)],void 0),Pt[63688]=Mt(63688,"stop_animation",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63689]=Mt(63689,"run_to_coord",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63690]=Mt(63690,"set_slot_invincible",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63691]=Mt(63691,"unknown_f8cb",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63692]=Mt(63692,"set_slot_poison",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63693]=Mt(63693,"set_slot_paralyze",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63694]=Mt(63694,"set_slot_shock",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63695]=Mt(63695,"set_slot_freeze",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63696]=Mt(63696,"set_slot_slow",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63697]=Mt(63697,"set_slot_confuse",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63698]=Mt(63698,"set_slot_shifta",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63699]=Mt(63699,"set_slot_deband",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63700]=Mt(63700,"set_slot_jellen",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63701]=Mt(63701,"set_slot_zalure",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read)]},void 0,void 0)],void 0),Pt[63702]=Mt(63702,"fleti_fixed_camera",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],Dt.Pop),Pt[63703]=Mt(63703,"fleti_locked_camera",void 0,[Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],Dt.Pop),Pt[63704]=Mt(63704,"default_camera_pos2",void 0,[],void 0),Pt[63705]=Mt(63705,"set_motion_blur",void 0,[],void 0),Pt[63706]=Mt(63706,"set_screen_bw",void 0,[],void 0),Pt[63707]=Mt(63707,"unknown_f8db",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(bt,void 0,void 0)],Dt.Pop),Pt[63708]=Mt(63708,"npc_action_string",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt(Rt,void 0,void 0)],void 0),Pt[63709]=Mt(63709,"get_pad_cond",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63710]=Mt(63710,"get_button_cond",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63711]=Mt(63711,"freeze_enemies",void 0,[],void 0),Pt[63712]=Mt(63712,"unfreeze_enemies",void 0,[],void 0),Pt[63713]=Mt(63713,"freeze_everything",void 0,[],void 0),Pt[63714]=Mt(63714,"unfreeze_everything",void 0,[],void 0),Pt[63715]=Mt(63715,"restore_hp",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63716]=Mt(63716,"restore_tp",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63717]=Mt(63717,"close_chat_bubble",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63718]=Mt(63718,"move_coords_object",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63719]=Mt(63719,"at_coords_call_ex",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63720]=Mt(63720,"unknown_f8e8",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63721]=Mt(63721,"unknown_f8e9",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63722]=Mt(63722,"unknown_f8ea",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63723]=Mt(63723,"unknown_f8eb",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63724]=Mt(63724,"unknown_f8ec",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63725]=Mt(63725,"animation_check",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63726]=Mt(63726,"call_image_data",void 0,[Bt(ft,void 0,void 0),Bt(bt,void 0,void 0)],Dt.Pop),Pt[63727]=Mt(63727,"unknown_f8ef",void 0,[],void 0),Pt[63728]=Mt(63728,"turn_off_bgm_p2",void 0,[],void 0),Pt[63729]=Mt(63729,"turn_on_bgm_p2",void 0,[],void 0),Pt[63730]=Mt(63730,"load_unk_data",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(yt,void 0,void 0)],Dt.Pop),Pt[63731]=Mt(63731,"particle2",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(mt,void 0,void 0)],Dt.Pop),Pt[63732]=Mt(63732,"unknown_f8f4",void 0,[],void 0),Pt[63733]=Mt(63733,"unknown_f8f5",void 0,[],void 0),Pt[63734]=Mt(63734,"unknown_f8f6",void 0,[],void 0),Pt[63735]=Mt(63735,"unknown_f8f7",void 0,[],void 0),Pt[63736]=Mt(63736,"unknown_f8f8",void 0,[],void 0),Pt[63737]=Mt(63737,"unknown_f8f9",void 0,[],void 0),Pt[63738]=Mt(63738,"unknown_f8fa",void 0,[],void 0),Pt[63739]=Mt(63739,"unknown_f8fb",void 0,[],void 0),Pt[63740]=Mt(63740,"unknown_f8fc",void 0,[],void 0),Pt[63741]=Mt(63741,"unknown_f8fd",void 0,[],void 0),Pt[63742]=Mt(63742,"unknown_f8fe",void 0,[],void 0),Pt[63743]=Mt(63743,"unknown_f8ff",void 0,[],void 0),Pt[63744]=Mt(63744,"unknown_f900",void 0,[],void 0),Pt[63745]=Mt(63745,"dec2float",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63746]=Mt(63746,"float2dec",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63747]=Mt(63747,"flet",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Read)]},void 0,void 0)],void 0)),fo=Pt[63748]=Mt(63748,"fleti",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt(mt,void 0,void 0)],void 0),mo=(Pt[63749]=Mt(63749,"unknown_f905",void 0,[],void 0),Pt[63750]=Mt(63750,"unknown_f906",void 0,[],void 0),Pt[63751]=Mt(63751,"unknown_f907",void 0,[],void 0),Pt[63752]=Mt(63752,"fadd",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Read)]},void 0,void 0)],void 0)),wo=Pt[63753]=Mt(63753,"faddi",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt(mt,void 0,void 0)],void 0),ko=Pt[63754]=Mt(63754,"fsub",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Read)]},void 0,void 0)],void 0),yo=Pt[63755]=Mt(63755,"fsubi",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt(mt,void 0,void 0)],void 0),Ro=Pt[63756]=Mt(63756,"fmul",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Read)]},void 0,void 0)],void 0),Io=Pt[63757]=Mt(63757,"fmuli",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt(mt,void 0,void 0)],void 0),xo=Pt[63758]=Mt(63758,"fdiv",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Read)]},void 0,void 0)],void 0),jo=Pt[63759]=Mt(63759,"fdivi",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(mt,void 0,Lt.Write)]},void 0,void 0),Bt(mt,void 0,void 0)],void 0),To=(Pt[63760]=Mt(63760,"get_unknown_count",void 0,[Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63761]=Mt(63761,"get_stackable_item_count",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Player slot.",Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read),Bt(ft,void 0,Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63762]=Mt(63762,"freeze_and_hide_equip",void 0,[],void 0),Pt[63763]=Mt(63763,"thaw_and_show_equip",void 0,[],void 0),Pt[63764]=Mt(63764,"set_palettex_callback",void 0,[Bt(ft,"Player slot.",void 0),Bt(kt,void 0,void 0)],Dt.Pop),Pt[63765]=Mt(63765,"activate_palettex",void 0,[Bt(ft,"Player slot.",void 0)],Dt.Pop),Pt[63766]=Mt(63766,"enable_palettex",void 0,[Bt(ft,"Player slot.",void 0)],Dt.Pop),Pt[63767]=Mt(63767,"restore_palettex",void 0,[Bt(ft,"Player slot.",void 0)],Dt.Pop),Pt[63768]=Mt(63768,"disable_palettex",void 0,[Bt(ft,"Player slot.",void 0)],Dt.Pop),Pt[63769]=Mt(63769,"get_palettex_activated",void 0,[Bt(ft,"Player slot.",void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63770]=Mt(63770,"get_unknown_palettex_status",void 0,[Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63771]=Mt(63771,"disable_movement2",void 0,[Bt(ft,"Player slot.",void 0)],Dt.Pop),Pt[63772]=Mt(63772,"enable_movement2",void 0,[Bt(ft,"Player slot.",void 0)],Dt.Pop),Pt[63773]=Mt(63773,"get_time_played",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63774]=Mt(63774,"get_guildcard_total",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63775]=Mt(63775,"get_slot_meseta",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63776]=Mt(63776,"get_player_level",void 0,[Bt(ft,"Player slot.",void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63777]=Mt(63777,"get_section_id",void 0,[Bt(ft,"Player slot.",void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63778]=Mt(63778,"get_player_hp",void 0,[Bt(ft,"Player slot.",void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,"Maximum HP.",Lt.Write),Bt(ft,"Current HP.",Lt.Write),Bt(ft,"Maximum TP.",Lt.Write),Bt(ft,"Current TP.",Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63779]=Mt(63779,"get_floor_number",void 0,[Bt(ft,"Player slot.",void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63780]=Mt(63780,"get_coord_player_detect",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,"Player slot.",Lt.Read)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Read)]},void 0,void 0)],void 0),Pt[63781]=Mt(63781,"read_global_flag",void 0,[Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63782]=Mt(63782,"write_global_flag",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63783]=Mt(63783,"unknown_f927",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63784]=Mt(63784,"floor_player_detect",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write),Bt(ft,void 0,Lt.Write),Bt(ft,void 0,Lt.Write),Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63785]=Mt(63785,"read_disk_file",void 0,[Bt(It,void 0,void 0)],Dt.Pop),Pt[63786]=Mt(63786,"open_pack_select",void 0,[],void 0),Pt[63787]=Mt(63787,"item_select",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63788]=Mt(63788,"get_item_id",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63789]=Mt(63789,"color_change",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63790]=Mt(63790,"send_statistic",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63791]=Mt(63791,"unknown_f92f",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63792]=Mt(63792,"chat_box",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[63793]=Mt(63793,"chat_bubble",void 0,[Bt(ft,void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[63794]=Mt(63794,"unknown_f932",void 0,[],void 0),Pt[63795]=Mt(63795,"unknown_f933",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63796]=Mt(63796,"scroll_text",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(mt,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[63797]=Mt(63797,"gba_unknown1",void 0,[],void 0),Pt[63798]=Mt(63798,"gba_unknown2",void 0,[],void 0),Pt[63799]=Mt(63799,"gba_unknown3",void 0,[],void 0),Pt[63800]=Mt(63800,"add_damage_to",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63801]=Mt(63801,"item_delete3",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63802]=Mt(63802,"get_item_info",void 0,[Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63803]=Mt(63803,"item_packing1",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63804]=Mt(63804,"item_packing2",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63805]=Mt(63805,"get_lang_setting",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(pt,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63806]=Mt(63806,"prepare_statistic",void 0,[Bt(ft,void 0,void 0),Bt(kt,void 0,void 0),Bt(kt,void 0,void 0)],Dt.Pop),Pt[63807]=Mt(63807,"keyword_detect",void 0,[],void 0),Pt[63808]=Mt(63808,"keyword",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,"Player slot.",void 0),Bt(It,void 0,void 0)],Dt.Pop),Pt[63809]=Mt(63809,"get_guildcard_num",void 0,[Bt(ft,"Player slot.",void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63810]=Mt(63810,"unknown_f942",void 0,[],void 0),Pt[63811]=Mt(63811,"unknown_f943",void 0,[],void 0),Pt[63812]=Mt(63812,"get_wrap_status",void 0,[Bt(ft,"Player slot.",void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63813]=Mt(63813,"initial_floor",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63814]=Mt(63814,"sin",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63815]=Mt(63815,"cos",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0)],Dt.Pop),Pt[63816]=Mt(63816,"unknown_f948",void 0,[],void 0),Pt[63817]=Mt(63817,"unknown_f949",void 0,[],void 0),Pt[63818]=Mt(63818,"boss_is_dead2",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63819]=Mt(63819,"unknown_f94b",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63820]=Mt(63820,"unknown_f94c",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63821]=Mt(63821,"is_there_cardbattle",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63822]=Mt(63822,"unknown_f94e",void 0,[],void 0),Pt[63823]=Mt(63823,"unknown_f94f",void 0,[],void 0),Pt[63824]=Mt(63824,"bb_p2_menu",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63825]=Mt(63825,"bb_map_designate",void 0,[Bt(gt,void 0,void 0),Bt(bt,void 0,void 0),Bt(gt,void 0,void 0),Bt(gt,void 0,void 0)],void 0));Pt[63826]=Mt(63826,"bb_get_number_in_pack",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],void 0),Pt[63827]=Mt(63827,"bb_swap_item",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0),Bt(kt,void 0,void 0)],Dt.Pop),Pt[63828]=Mt(63828,"bb_check_wrap",void 0,[Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0)],Dt.Pop),Pt[63829]=Mt(63829,"bb_exchange_pd_item",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0),Bt(kt,void 0,void 0)],Dt.Pop),Pt[63830]=Mt(63830,"bb_exchange_pd_srank",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0),Bt(kt,void 0,void 0)],Dt.Pop),Pt[63831]=Mt(63831,"bb_exchange_pd_special",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0),Bt(kt,void 0,void 0)],Dt.Pop),Pt[63832]=Mt(63832,"bb_exchange_pd_percent",void 0,[Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0),Bt(kt,void 0,void 0)],Dt.Pop),Pt[63833]=Mt(63833,"unknown_f959",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63834]=Mt(63834,"unknown_f95a",void 0,[],void 0),Pt[63835]=Mt(63835,"unknown_f95b",void 0,[],void 0),Pt[63836]=Mt(63836,"bb_exchange_slt",void 0,[Bt(ft,void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(kt,void 0,void 0),Bt(kt,void 0,void 0)],Dt.Pop),Pt[63837]=Mt(63837,"bb_exchange_pc",void 0,[],void 0),Pt[63838]=Mt(63838,"bb_box_create_bp",void 0,[Bt(ft,void 0,void 0),Bt(mt,void 0,void 0),Bt(mt,void 0,void 0)],Dt.Pop),Pt[63839]=Mt(63839,"bb_exchange_pt",void 0,[Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt({kind:vt.RegTupRef,register_tuples:[Bt(ft,void 0,Lt.Write)]},void 0,void 0),Bt(ft,void 0,void 0),Bt(kt,void 0,void 0),Bt(kt,void 0,void 0)],Dt.Pop),Pt[63840]=Mt(63840,"unknown_f960",void 0,[Bt(ft,void 0,void 0)],Dt.Pop),Pt[63841]=Mt(63841,"unknown_f961",void 0,[],void 0),Pt[63842]=Mt(63842,"unknown_f962",void 0,[],void 0),Pt[63843]=Mt(63843,"unknown_f963",void 0,[],void 0),Pt[63844]=Mt(63844,"unknown_f964",void 0,[],void 0),Pt[63845]=Mt(63845,"unknown_f965",void 0,[],void 0),Pt[63846]=Mt(63846,"unknown_f966",void 0,[],void 0),Pt[63847]=Mt(63847,"unknown_f967",void 0,[],void 0),Pt[63848]=Mt(63848,"unknown_f968",void 0,[],void 0),Pt[63849]=Mt(63849,"unknown_f969",void 0,[],void 0),Pt[63850]=Mt(63850,"unknown_f96a",void 0,[],void 0),Pt[63851]=Mt(63851,"unknown_f96b",void 0,[],void 0),Pt[63852]=Mt(63852,"unknown_f96c",void 0,[],void 0),Pt[63853]=Mt(63853,"unknown_f96d",void 0,[],void 0),Pt[63854]=Mt(63854,"unknown_f96e",void 0,[],void 0),Pt[63855]=Mt(63855,"unknown_f96f",void 0,[],void 0),Pt[63856]=Mt(63856,"unknown_f970",void 0,[],void 0),Pt[63857]=Mt(63857,"unknown_f971",void 0,[],void 0),Pt[63858]=Mt(63858,"unknown_f972",void 0,[],void 0),Pt[63859]=Mt(63859,"unknown_f973",void 0,[],void 0),Pt[63860]=Mt(63860,"unknown_f974",void 0,[],void 0),Pt[63861]=Mt(63861,"unknown_f975",void 0,[],void 0),Pt[63862]=Mt(63862,"unknown_f976",void 0,[],void 0),Pt[63863]=Mt(63863,"unknown_f977",void 0,[],void 0),Pt[63864]=Mt(63864,"unknown_f978",void 0,[],void 0),Pt[63865]=Mt(63865,"unknown_f979",void 0,[],void 0),Pt[63866]=Mt(63866,"unknown_f97a",void 0,[],void 0),Pt[63867]=Mt(63867,"unknown_f97b",void 0,[],void 0),Pt[63868]=Mt(63868,"unknown_f97c",void 0,[],void 0),Pt[63869]=Mt(63869,"unknown_f97d",void 0,[],void 0),Pt[63870]=Mt(63870,"unknown_f97e",void 0,[],void 0),Pt[63871]=Mt(63871,"unknown_f97f",void 0,[],void 0),Pt[63872]=Mt(63872,"unknown_f980",void 0,[],void 0),Pt[63873]=Mt(63873,"unknown_f981",void 0,[],void 0),Pt[63874]=Mt(63874,"unknown_f982",void 0,[],void 0),Pt[63875]=Mt(63875,"unknown_f983",void 0,[],void 0),Pt[63876]=Mt(63876,"unknown_f984",void 0,[],void 0),Pt[63877]=Mt(63877,"unknown_f985",void 0,[],void 0),Pt[63878]=Mt(63878,"unknown_f986",void 0,[],void 0),Pt[63879]=Mt(63879,"unknown_f987",void 0,[],void 0),Pt[63880]=Mt(63880,"unknown_f988",void 0,[],void 0),Pt[63881]=Mt(63881,"unknown_f989",void 0,[],void 0),Pt[63882]=Mt(63882,"unknown_f98a",void 0,[],void 0),Pt[63883]=Mt(63883,"unknown_f98b",void 0,[],void 0),Pt[63884]=Mt(63884,"unknown_f98c",void 0,[],void 0),Pt[63885]=Mt(63885,"unknown_f98d",void 0,[],void 0),Pt[63886]=Mt(63886,"unknown_f98e",void 0,[],void 0),Pt[63887]=Mt(63887,"unknown_f98f",void 0,[],void 0),Pt[63888]=Mt(63888,"unknown_f990",void 0,[],void 0),Pt[63889]=Mt(63889,"unknown_f991",void 0,[],void 0),Pt[63890]=Mt(63890,"unknown_f992",void 0,[],void 0),Pt[63891]=Mt(63891,"unknown_f993",void 0,[],void 0),Pt[63892]=Mt(63892,"unknown_f994",void 0,[],void 0),Pt[63893]=Mt(63893,"unknown_f995",void 0,[],void 0),Pt[63894]=Mt(63894,"unknown_f996",void 0,[],void 0),Pt[63895]=Mt(63895,"unknown_f997",void 0,[],void 0),Pt[63896]=Mt(63896,"unknown_f998",void 0,[],void 0),Pt[63897]=Mt(63897,"unknown_f999",void 0,[],void 0),Pt[63898]=Mt(63898,"unknown_f99a",void 0,[],void 0),Pt[63899]=Mt(63899,"unknown_f99b",void 0,[],void 0),Pt[63900]=Mt(63900,"unknown_f99c",void 0,[],void 0),Pt[63901]=Mt(63901,"unknown_f99d",void 0,[],void 0),Pt[63902]=Mt(63902,"unknown_f99e",void 0,[],void 0),Pt[63903]=Mt(63903,"unknown_f99f",void 0,[],void 0),Pt[63904]=Mt(63904,"unknown_f9a0",void 0,[],void 0),Pt[63905]=Mt(63905,"unknown_f9a1",void 0,[],void 0),Pt[63906]=Mt(63906,"unknown_f9a2",void 0,[],void 0),Pt[63907]=Mt(63907,"unknown_f9a3",void 0,[],void 0),Pt[63908]=Mt(63908,"unknown_f9a4",void 0,[],void 0),Pt[63909]=Mt(63909,"unknown_f9a5",void 0,[],void 0),Pt[63910]=Mt(63910,"unknown_f9a6",void 0,[],void 0),Pt[63911]=Mt(63911,"unknown_f9a7",void 0,[],void 0),Pt[63912]=Mt(63912,"unknown_f9a8",void 0,[],void 0),Pt[63913]=Mt(63913,"unknown_f9a9",void 0,[],void 0),Pt[63914]=Mt(63914,"unknown_f9aa",void 0,[],void 0),Pt[63915]=Mt(63915,"unknown_f9ab",void 0,[],void 0),Pt[63916]=Mt(63916,"unknown_f9ac",void 0,[],void 0),Pt[63917]=Mt(63917,"unknown_f9ad",void 0,[],void 0),Pt[63918]=Mt(63918,"unknown_f9ae",void 0,[],void 0),Pt[63919]=Mt(63919,"unknown_f9af",void 0,[],void 0),Pt[63920]=Mt(63920,"unknown_f9b0",void 0,[],void 0),Pt[63921]=Mt(63921,"unknown_f9b1",void 0,[],void 0),Pt[63922]=Mt(63922,"unknown_f9b2",void 0,[],void 0),Pt[63923]=Mt(63923,"unknown_f9b3",void 0,[],void 0),Pt[63924]=Mt(63924,"unknown_f9b4",void 0,[],void 0),Pt[63925]=Mt(63925,"unknown_f9b5",void 0,[],void 0),Pt[63926]=Mt(63926,"unknown_f9b6",void 0,[],void 0),Pt[63927]=Mt(63927,"unknown_f9b7",void 0,[],void 0),Pt[63928]=Mt(63928,"unknown_f9b8",void 0,[],void 0),Pt[63929]=Mt(63929,"unknown_f9b9",void 0,[],void 0),Pt[63930]=Mt(63930,"unknown_f9ba",void 0,[],void 0),Pt[63931]=Mt(63931,"unknown_f9bb",void 0,[],void 0),Pt[63932]=Mt(63932,"unknown_f9bc",void 0,[],void 0),Pt[63933]=Mt(63933,"unknown_f9bd",void 0,[],void 0),Pt[63934]=Mt(63934,"unknown_f9be",void 0,[],void 0),Pt[63935]=Mt(63935,"unknown_f9bf",void 0,[],void 0),Pt[63936]=Mt(63936,"unknown_f9c0",void 0,[],void 0),Pt[63937]=Mt(63937,"unknown_f9c1",void 0,[],void 0),Pt[63938]=Mt(63938,"unknown_f9c2",void 0,[],void 0),Pt[63939]=Mt(63939,"unknown_f9c3",void 0,[],void 0),Pt[63940]=Mt(63940,"unknown_f9c4",void 0,[],void 0),Pt[63941]=Mt(63941,"unknown_f9c5",void 0,[],void 0),Pt[63942]=Mt(63942,"unknown_f9c6",void 0,[],void 0),Pt[63943]=Mt(63943,"unknown_f9c7",void 0,[],void 0),Pt[63944]=Mt(63944,"unknown_f9c8",void 0,[],void 0),Pt[63945]=Mt(63945,"unknown_f9c9",void 0,[],void 0),Pt[63946]=Mt(63946,"unknown_f9ca",void 0,[],void 0),Pt[63947]=Mt(63947,"unknown_f9cb",void 0,[],void 0),Pt[63948]=Mt(63948,"unknown_f9cc",void 0,[],void 0),Pt[63949]=Mt(63949,"unknown_f9cd",void 0,[],void 0),Pt[63950]=Mt(63950,"unknown_f9ce",void 0,[],void 0),Pt[63951]=Mt(63951,"unknown_f9cf",void 0,[],void 0),Pt[63952]=Mt(63952,"unknown_f9d0",void 0,[],void 0),Pt[63953]=Mt(63953,"unknown_f9d1",void 0,[],void 0),Pt[63954]=Mt(63954,"unknown_f9d2",void 0,[],void 0),Pt[63955]=Mt(63955,"unknown_f9d3",void 0,[],void 0),Pt[63956]=Mt(63956,"unknown_f9d4",void 0,[],void 0),Pt[63957]=Mt(63957,"unknown_f9d5",void 0,[],void 0),Pt[63958]=Mt(63958,"unknown_f9d6",void 0,[],void 0),Pt[63959]=Mt(63959,"unknown_f9d7",void 0,[],void 0),Pt[63960]=Mt(63960,"unknown_f9d8",void 0,[],void 0),Pt[63961]=Mt(63961,"unknown_f9d9",void 0,[],void 0),Pt[63962]=Mt(63962,"unknown_f9da",void 0,[],void 0),Pt[63963]=Mt(63963,"unknown_f9db",void 0,[],void 0),Pt[63964]=Mt(63964,"unknown_f9dc",void 0,[],void 0),Pt[63965]=Mt(63965,"unknown_f9dd",void 0,[],void 0),Pt[63966]=Mt(63966,"unknown_f9de",void 0,[],void 0),Pt[63967]=Mt(63967,"unknown_f9df",void 0,[],void 0),Pt[63968]=Mt(63968,"unknown_f9e0",void 0,[],void 0),Pt[63969]=Mt(63969,"unknown_f9e1",void 0,[],void 0),Pt[63970]=Mt(63970,"unknown_f9e2",void 0,[],void 0),Pt[63971]=Mt(63971,"unknown_f9e3",void 0,[],void 0),Pt[63972]=Mt(63972,"unknown_f9e4",void 0,[],void 0),Pt[63973]=Mt(63973,"unknown_f9e5",void 0,[],void 0),Pt[63974]=Mt(63974,"unknown_f9e6",void 0,[],void 0),Pt[63975]=Mt(63975,"unknown_f9e7",void 0,[],void 0),Pt[63976]=Mt(63976,"unknown_f9e8",void 0,[],void 0),Pt[63977]=Mt(63977,"unknown_f9e9",void 0,[],void 0),Pt[63978]=Mt(63978,"unknown_f9ea",void 0,[],void 0),Pt[63979]=Mt(63979,"unknown_f9eb",void 0,[],void 0),Pt[63980]=Mt(63980,"unknown_f9ec",void 0,[],void 0),Pt[63981]=Mt(63981,"unknown_f9ed",void 0,[],void 0),Pt[63982]=Mt(63982,"unknown_f9ee",void 0,[],void 0),Pt[63983]=Mt(63983,"unknown_f9ef",void 0,[],void 0),Pt[63984]=Mt(63984,"unknown_f9f0",void 0,[],void 0),Pt[63985]=Mt(63985,"unknown_f9f1",void 0,[],void 0),Pt[63986]=Mt(63986,"unknown_f9f2",void 0,[],void 0),Pt[63987]=Mt(63987,"unknown_f9f3",void 0,[],void 0),Pt[63988]=Mt(63988,"unknown_f9f4",void 0,[],void 0),Pt[63989]=Mt(63989,"unknown_f9f5",void 0,[],void 0),Pt[63990]=Mt(63990,"unknown_f9f6",void 0,[],void 0),Pt[63991]=Mt(63991,"unknown_f9f7",void 0,[],void 0),Pt[63992]=Mt(63992,"unknown_f9f8",void 0,[],void 0),Pt[63993]=Mt(63993,"unknown_f9f9",void 0,[],void 0),Pt[63994]=Mt(63994,"unknown_f9fa",void 0,[],void 0),Pt[63995]=Mt(63995,"unknown_f9fb",void 0,[],void 0),Pt[63996]=Mt(63996,"unknown_f9fc",void 0,[],void 0),Pt[63997]=Mt(63997,"unknown_f9fd",void 0,[],void 0),Pt[63998]=Mt(63998,"unknown_f9fe",void 0,[],void 0),Pt[63999]=Mt(63999,"unknown_f9ff",void 0,[],void 0);var Co;Pt.forEach(e=>{Et.set(e.mnemonic,e)}),function(e){e[e.DC=0]="DC",e[e.GC=1]="GC",e[e.PC=2]="PC",e[e.BB=3]="BB"}(Co||(Co={}));Co.DC,Co.GC,Co.PC,Co.BB;var So,Oo;function Lo(e){switch(e){case Co.DC:case Co.GC:return So.DC_GC;case Co.PC:return So.PC;case Co.BB:return So.BB}}function Do(e,t,i){const o=Math.min(e.params.length,t.length),s=[];for(let i=0;i<o;i++){const o=e.params[i].type,n=t[i];switch(s[i]=[],o.kind){case vt.ILabelVar:case vt.RegRefVar:for(let e=i;e<t.length;e++)s[i].push(t[e]);break;default:s[i].push(n)}}return{opcode:e,args:t,param_to_args:s,asm:i}}function Bo(e,t){const i=e.opcode,o=Math.min(i.params.length,e.param_to_args.length);let s=0;for(let n=0;n<o;n++){const o=i.params[n].type,r=e.param_to_args[n];switch(o.kind){case vt.Byte:case vt.RegRef:case vt.RegTupRef:s++;break;case vt.Word:case vt.Label:case vt.ILabel:case vt.DLabel:case vt.SLabel:s+=2;break;case vt.DWord:case vt.Float:s+=4;break;case vt.String:t==So.DC_GC?s+=r[0].value.length+1:s+=2*r[0].value.length+2;break;case vt.ILabelVar:s+=1+2*r.length;break;case vt.RegRefVar:s+=1+r.length;break;default:throw new Error(`Parameter type ${vt[o.kind]} not implemented.`)}}return i.size+s}function Po(e){return{value:e}}function Eo(e){const t=e.labels.slice(),i={labels:e.asm.labels.map(e=>Object.assign({},e))};switch(e.type){case Oo.Instructions:return{type:Oo.Instructions,labels:t,instructions:e.instructions.map(e=>(function(e){return{opcode:e.opcode,args:e.args.map(e=>Object.assign({},e)),param_to_args:e.param_to_args.map(e=>e.map(e=>Object.assign({},e))),asm:e.asm}})(e)),asm:i};case Oo.Data:return{type:Oo.Data,labels:t,data:e.data.slice(0),asm:i};case Oo.String:return{type:Oo.String,labels:t,value:e.value,asm:i}}}!function(e){e[e.DC_GC=0]="DC_GC",e[e.PC=1]="PC",e[e.BB=2]="BB"}(So||(So={})),function(e){e[e.Instructions=0]="Instructions",e[e.Data=1]="Data",e[e.String=2]="String"}(Oo||(Oo={}));const Mo={add:(e,t)=>e+t,sub:(e,t)=>e-t,mul:(e,t)=>e*t,div:(e,t)=>e/t,idiv:(e,t)=>Math.floor(e/t),mod:(e,t)=>e%t,and:(e,t)=>e&t,or:(e,t)=>e|t,xor:(e,t)=>e^t,shl:(e,t)=>e<<t,shr:(e,t)=>e>>>t};function Wo(e,t,i){if(e(t,i))return i}function qo(e){return e.slice(1)}const Fo=Y.a.get("quest_editor/scripting/vm/io");class Vo{map_designate(e,t){Fo.warn(`bb_map_designate(${e}, ${t})`)}set_floor_handler(e,t){Fo.warn(`set_floor_handler(${e}, ${t})`)}window_msg(e){Fo.warn(`window_msg("${e}")`)}message(e){Fo.warn(`message("${e}")`)}add_msg(e){Fo.warn(`add_msg("${e}")`)}winend(){Fo.warn("winend")}p_dead_v3(e){return Fo.warn(`p_dead_v3(${e})`),!1}mesend(){Fo.warn("mesend")}list(e){Fo.warn(`list([${e.map(e=>`"${e}"`).join(", ")}])`)}warning(e,t){Fo.warn(e+this.srcloc_to_string(null==t?void 0:t.source_location))}error(e,t){Fo.error(e+this.srcloc_to_string(null==t?void 0:t.source_location))}srcloc_to_string(e){return e?` [${e.line_no}:${e.col}]`:" "}}var zo=i(459);class Uo{constructor(e=Math.floor(performance.now())){this.holdrand=e}next(){const e=214013*this.holdrand+2531011>>>0;return this.holdrand=e,e>>>16&32767}}var $o=i(468);class Ao extends $o.a{constructor(e,t){super(new ArrayBuffer(e),t)}zero(){new Uint32Array(this.backing_buffer).fill(0)}}class No{constructor(e,t,i){Object(q.d)(e>=0,"seg_idx should be greater or equal to 0."),Object(q.d)(e<i.length,`seg_idx should be less than ${i.length}.`);const o=i[e];Object(q.d)(o.type===Oo.Instructions,"seg_idx should point to an instructions segment."),Object(q.d)(t>=0,"inst_idx should be greater or equal to 0."),Object(q.d)(t<o.instructions.length,`inst_idx should be less than ${o.instructions.length}.`),this.seg_idx=e,this.inst_idx=t,this.object_code=i}get segment(){return this.object_code[this.seg_idx]}get instruction(){return this.segment.instructions[this.inst_idx]}get source_location(){var e;return null===(e=this.instruction.asm)||void 0===e?void 0:e.mnemonic}next(){return this.inst_idx+1<this.segment.instructions.length?new No(this.seg_idx,this.inst_idx+1,this.object_code):this.seg_idx+1<this.object_code.length?new No(this.seg_idx+1,0,this.object_code):void 0}equals(e){return this.seg_idx===e.seg_idx&&this.inst_idx==e.inst_idx}}const Go=4,Ho=8;var Qo;!function(e){e[e.BreakPoint=0]="BreakPoint",e[e.Over=1]="Over",e[e.In=2]="In",e[e.Out=3]="Out"}(Qo||(Qo={}));class Yo{constructor(e,t){this.idx=e,this.instruction_pointer=t}}class Xo{constructor(e,t,i){this.io=e,this.arg_stack=new Ao(Ho*Go,zo.a.Little),this.arg_stack_counter=0,this.arg_stack_types=Array(Ho).fill(vt.Any),this._step_mode=Qo.BreakPoint,this.id=Xo.next_id++,this.variable_stack=[],this._call_stack=[new Yo(0,t)],this.call_stack=this._call_stack,this.area_id=i}get step_mode(){return this._step_mode}set step_mode(e){this._step_mode=e,this._step_frame=this.current_stack_frame()}get step_frame(){return this._step_frame}current_stack_frame(){return this._call_stack[this._call_stack.length-1]}set_current_instruction_pointer(e){this._call_stack.length?this._call_stack[this._call_stack.length-1].instruction_pointer=e:this.push_frame(e)}push_frame(e){this._call_stack.push(new Yo(this.call_stack.length,e))}pop_call_stack(){this._call_stack.pop()}push_arg(e,t){if(this.arg_stack_counter>=Ho)throw new Error("Argument stack: Stack overflow");this.arg_stack.write_u32_at(this.arg_stack_counter*Go,e),this.arg_stack_types[this.arg_stack_counter]=t,this.arg_stack_counter++}fetch_args(e){const t=e.instruction;if(t.opcode.stack!==Dt.Pop)return[];const i=[];t.opcode.params.length!==this.arg_stack_counter&&this.io.warning("Argument stack: Argument count mismatch.",e);for(let o=0;o<t.opcode.params.length;o++){const s=t.opcode.params[o];this.check_arg_type(s.type.kind,this.arg_stack_types[o],e);const n=o*Go;switch(s.type.kind){case vt.Byte:i.push(this.arg_stack.u8_at(n));break;case vt.Word:case vt.ILabel:case vt.DLabel:case vt.SLabel:i.push(this.arg_stack.u16_at(n));break;case vt.DWord:case vt.String:i.push(this.arg_stack.u32_at(n));break;case vt.RegTupRef:s.type.register_tuples.length>0&&i.push(this.arg_stack.u8_at(n));break;default:throw new Error(`Argument stack: Unhandled parameter kind: ${vt[s.type.kind]}.`)}}return this.arg_stack_counter=0,i}check_arg_type(e,t,i){let o;switch(e){case vt.Any:o=!0;break;case vt.Byte:case vt.Word:case vt.DWord:case vt.Float:case vt.String:case vt.Pointer:o=t===e;break;case vt.Label:case vt.ILabel:case vt.ILabelVar:case vt.DLabel:case vt.SLabel:o=t===vt.Word;break;case vt.RegRef:case vt.RegTupRef:case vt.RegRefVar:o=t===vt.Byte}o||this.io.warning(`Argument stack: Argument type mismatch, expected ${vt[e]} but received ${vt[t]}.`,i)}}Xo.next_id=0;const Jo=256,Ko=4,Zo=16,es=11085568,ts=1024,is=0,os="\n",ss=Y.a.get("quest_editor/scripting/vm/VirtualMachine");var ns;!function(e){e[e.Suspended=0]="Suspended",e[e.Paused=1]="Paused",e[e.WaitingVsync=2]="WaitingVsync",e[e.WaitingInput=3]="WaitingInput",e[e.WaitingSelection=4]="WaitingSelection",e[e.Halted=5]="Halted"}(ns||(ns={}));class rs{constructor(e=new Vo,t=new Uo){this.io=e,this.random=t,this.episode=n.b.I,this._object_code=[],this.label_to_seg_idx=new Map,this.registers=new Ao(Jo*Ko,zo.a.Little),this.string_arg_store="",this.threads=[],this.thread_idx=0,this.window_msg_open=!1,this.set_episode_called=!1,this.list_open=!1,this.selection_reg=0,this._halted=!0,this.breakpoints=[],this.paused=!1,this.unsupported_opcodes_logged=new Set}get object_code(){return this._object_code}get halted(){return this._halted}set step_mode(e){if(null!=e){const t=this.current_thread();t&&(t.step_mode=e)}}load_object_code(e,t){this.halt(),ss.debug("Starting."),this._object_code=e,this.episode=t,this.label_to_seg_idx.clear();let i=0;for(const e of this._object_code){for(const t of e.labels)this.label_to_seg_idx.set(t,i);i++}this._halted=!1}start_thread(e,t){const i=this.get_segment_index_by_label(e),o=this._object_code[i];if(o.type!==Oo.Instructions)throw new Error(`Label ${e} points to a ${Oo[o.type]} segment, expecting ${Oo[Oo.Instructions]}.`);this.threads.push(new Xo(this.io,new No(i,0,this.object_code),t))}execute(){var e,t,i;if(this._halted)return ns.Halted;let o;try{let s=0;for(;s++<1e4;){if(this.threads.length>=1&&this.thread_idx>=this.threads.length)return ns.WaitingVsync;const s=this.current_thread();if(!s)return ns.Suspended;const n=s.current_stack_frame();o=n.instruction_pointer;const r=o.instruction;if(!this.paused)switch(s.step_mode){case Qo.BreakPoint:if(-1!==this.breakpoints.findIndex(e=>e.equals(o)))return this.paused=!0,ns.Paused;break;case Qo.Over:if(s.step_frame&&n.idx<=s.step_frame.idx&&(null===(e=r.asm)||void 0===e?void 0:e.mnemonic))return this.paused=!0,ns.Paused;break;case Qo.In:if(null===(t=r.asm)||void 0===t?void 0:t.mnemonic)return this.paused=!0,ns.Paused;break;case Qo.Out:if(s.step_frame&&n.idx<s.step_frame.idx&&(null===(i=r.asm)||void 0===i?void 0:i.mnemonic))return this.paused=!0,ns.Paused}this.paused=!1;const a=this.execute_instruction(s,o);if(null!=a&&a!==ns.WaitingVsync)return a}throw new Error("Maximum execution count reached. The code probably contains an infinite loop.")}catch(e){let t=e;t instanceof Error||(t=new Error(String(t)));try{this.io.error(t,o)}finally{this.halt()}return ns.Halted}}vsync(){this.thread_idx>=this.threads.length&&(this.thread_idx=0)}halt(){this._halted||(ss.debug("Halting."),this.registers.zero(),this.string_arg_store="",this.threads=[],this.thread_idx=0,this.window_msg_open=!1,this.set_episode_called=!1,this.list_open=!1,this.selection_reg=0,this._halted=!0,this.paused=!1,this.breakpoints.splice(0,1/0),this.unsupported_opcodes_logged.clear())}get_current_stack_frame(){var e;return null===(e=this.current_thread())||void 0===e?void 0:e.current_stack_frame()}get_instruction_pointer(){var e;return null===(e=this.get_current_stack_frame())||void 0===e?void 0:e.instruction_pointer}get_segment_index_by_label(e){if(!this.label_to_seg_idx.has(e))throw new Error(`Invalid argument: No such label ${e}.`);return this.label_to_seg_idx.get(e)}list_select(e){if(!this.list_open)throw new Error("list_select may not be called if there is no list open");this.set_register_unsigned(this.selection_reg,e)}set_breakpoint(e){-1===this.breakpoints.findIndex(t=>t.equals(e))&&this.breakpoints.push(e)}remove_breakpoint(e){const t=this.breakpoints.findIndex(t=>t.equals(e));-1!==t&&this.breakpoints.splice(t,1)}current_thread(){return this.threads[this.thread_idx]}terminate_thread(e){this.threads.splice(e,1),this.thread_idx>=e&&this.thread_idx>0&&this.thread_idx--}advance(e){const t=e.current_stack_frame();if(!t)return;const i=t.instruction_pointer.next();i?e.set_current_instruction_pointer(i):(e.pop_call_stack(),this.terminate_thread(this.thread_idx))}execute_instruction(e,t){const i=t.instruction;let o=void 0,s=!0;const r=i.args.map(e=>e.value),[a,d,c]=r;this.list_open&&(this.list_open=!1);const l=e.fetch_args(t);switch(i.opcode.code){case Wt.code:break;case qt.code:this.pop_call_stack(this.thread_idx);break;case Ft.code:o=ns.WaitingVsync,this.advance(e),this.thread_idx++,s=!1;break;case Vt.code:this.halt();break;case zt.code:this.start_thread(a);break;case Nt.code:this.set_register_signed(a,this.get_register_signed(d));break;case Gt.code:this.set_register_signed(a,d);break;case Ht.code:this.set_register_byte(a,d);break;case Qt.code:this.set_register_word(a,d);break;case Yt.code:this.set_register_unsigned(a,this.get_register_address(a));break;case bo.code:this.set_register_float(a,this.get_register_float(d));break;case fo.code:this.set_register_float(a,d);break;case Xt.code:this.set_register_signed(a,1);break;case Jt.code:this.set_register_signed(a,0);break;case Kt.code:this.set_register_signed(a,0===this.get_register_signed(a)?1:0);break;case gi.code:this.push_call_stack(e,a),s=!1;break;case pi.code:this.jump_to_label(e,a),s=!1;break;case Ni.code:e.push_arg(this.get_register_signed(a),vt.DWord);break;case Gi.code:e.push_arg(i.args[0].value,vt.DWord);break;case Hi.code:e.push_arg(i.args[0].value,vt.Byte);break;case Qi.code:e.push_arg(i.args[0].value,vt.Word);break;case Yi.code:e.push_arg(this.get_register_address(i.args[0].value),vt.DWord);break;case Ji.code:if("string"==typeof a){const t=this.parse_template_string(a);this.string_arg_store=t.slice(0,ts/2),e.push_arg(es,vt.String)}break;case Zt.code:this.do_integer_op_with_register(a,d,Mo.add);break;case ei.code:this.do_integer_op_with_literal(a,d,Mo.add);break;case ti.code:this.do_integer_op_with_register(a,d,Mo.sub);break;case ii.code:this.do_integer_op_with_literal(a,d,Mo.sub);break;case oi.code:this.do_integer_op_with_register(a,d,Mo.mul);break;case si.code:this.do_integer_op_with_literal(a,d,Mo.mul);break;case ni.code:this.do_integer_op_with_register(a,d,Mo.idiv);break;case ri.code:this.do_integer_op_with_literal(a,d,Mo.idiv);break;case hi.code:this.do_integer_op_with_register(a,d,Mo.mod);break;case vi.code:this.do_integer_op_with_literal(a,d,Mo.mod);break;case mo.code:this.do_float_op_with_register(a,d,Mo.add);break;case wo.code:this.do_float_op_with_literal(a,Math.fround(d),Mo.add);break;case ko.code:this.do_float_op_with_register(a,d,Mo.sub);break;case yo.code:this.do_float_op_with_literal(a,Math.fround(d),Mo.sub);break;case Ro.code:this.do_float_op_with_register(a,d,Mo.mul);break;case Io.code:this.do_float_op_with_literal(a,Math.fround(d),Mo.mul);break;case xo.code:this.do_float_op_with_register(a,d,Mo.div);break;case jo.code:this.do_float_op_with_literal(a,Math.fround(d),Mo.div);break;case ai.code:this.do_integer_op_with_register(a,d,Mo.and);break;case di.code:this.do_integer_op_with_literal(a,d,Mo.and);break;case ci.code:this.do_integer_op_with_register(a,d,Mo.or);break;case li.code:this.do_integer_op_with_literal(a,d,Mo.or);break;case _i.code:this.do_integer_op_with_register(a,d,Mo.xor);break;case ui.code:this.do_integer_op_with_literal(a,d,Mo.xor);break;case ho.code:this.do_integer_op_with_register(a,d,Mo.shl);break;case vo.code:this.do_integer_op_with_register(a,d,Mo.shr);break;case bi.code:this.conditional_jump(e,a,(e,t)=>e===t,1,...qo(r).map(e=>this.get_register_signed(e))),s=!1;break;case fi.code:this.conditional_jump(e,a,(e,t)=>e===t,0,...qo(r).map(e=>this.get_register_signed(e))),s=!1;break;case mi.code:this.signed_cond_jump_with_register(e,c,(e,t)=>e===t,a,d),s=!1;break;case wi.code:this.signed_cond_jump_with_literal(e,c,(e,t)=>e===t,a,d),s=!1;break;case ki.code:this.signed_cond_jump_with_register(e,c,(e,t)=>e!==t,a,d),s=!1;break;case yi.code:this.signed_cond_jump_with_literal(e,c,(e,t)=>e!==t,a,d),s=!1;break;case Ri.code:this.unsigned_cond_jump_with_register(e,c,(e,t)=>e>t,a,d),s=!1;break;case Ii.code:this.unsigned_cond_jump_with_literal(e,c,(e,t)=>e>t,a,d),s=!1;break;case xi.code:this.signed_cond_jump_with_register(e,c,(e,t)=>e>t,a,d),s=!1;break;case ji.code:this.signed_cond_jump_with_literal(e,c,(e,t)=>e>t,a,d),s=!1;break;case Ti.code:this.unsigned_cond_jump_with_register(e,c,(e,t)=>e<t,a,d),s=!1;break;case Ci.code:this.unsigned_cond_jump_with_literal(e,c,(e,t)=>e<t,a,d),s=!1;break;case Si.code:this.signed_cond_jump_with_register(e,c,(e,t)=>e<t,a,d),s=!1;break;case Oi.code:this.signed_cond_jump_with_literal(e,c,(e,t)=>e<t,a,d),s=!1;break;case Li.code:this.unsigned_cond_jump_with_register(e,c,(e,t)=>e>=t,a,d),s=!1;break;case Di.code:this.unsigned_cond_jump_with_literal(e,c,(e,t)=>e>=t,a,d),s=!1;break;case Bi.code:this.signed_cond_jump_with_register(e,c,(e,t)=>e>=t,a,d),s=!1;break;case Pi.code:this.signed_cond_jump_with_literal(e,c,(e,t)=>e>=t,a,d),s=!1;break;case Ei.code:this.unsigned_cond_jump_with_register(e,c,(e,t)=>e<=t,a,d),s=!1;break;case Mi.code:this.unsigned_cond_jump_with_literal(e,c,(e,t)=>e<=t,a,d),s=!1;break;case Wi.code:this.signed_cond_jump_with_register(e,c,(e,t)=>e<=t,a,d),s=!1;break;case qi.code:this.signed_cond_jump_with_literal(e,c,(e,t)=>e<=t,a,d),s=!1;break;case zi.code:this.push_variable_stack(e,a,1);break;case Ui.code:this.pop_variable_stack(e,a,1);break;case $i.code:this.push_variable_stack(e,a,d);break;case Ai.code:this.pop_variable_stack(e,a,d);break;case Ki.code:if(!this.window_msg_open){const e=this.deref_string(l[1]).split(os);o=ns.WaitingSelection,this.list_open=!0,this.selection_reg=l[0],this.io.list(e)}break;case Zi.code:if(!this.window_msg_open){const e=this.deref_string(l[0]);o=ns.WaitingInput,this.window_msg_open=!0,this.io.window_msg(e)}break;case eo.code:if(this.window_msg_open){const e=this.deref_string(l[0]);o=ns.WaitingInput,this.io.add_msg(e)}break;case to.code:this.set_register_unsigned(a,Math.floor(Date.now()/1e3));break;case io.code:this.window_msg_open&&(this.window_msg_open=!1,this.io.winend());break;case oo.code:this.set_register_signed(l[0],this.io.p_dead_v3(l[1])?1:0);break;case no.code:this.io.set_floor_handler(l[0],l[1]);break;case ro.code:this.start_thread(a);break;case co.code:this.io.map_designate(this.get_register_signed(a),this.get_register_signed(a+2));break;case uo.code:this.io.map_designate(this.get_register_signed(a),this.get_register_signed(a+3));break;case po.code:{const e=this.get_register_signed(a),t=this.get_register_signed(a+1),i=this.random.next();let o=Math.floor(Math.fround(i/32768)*t);e>=o&&(o=e),this.set_register_signed(d,o)}break;case go.code:if(this.set_episode_called){this.io.warning("Calling set_episode more than once is not supported.",t);break}if(this.set_episode_called=!0,!this._object_code[t.seg_idx].labels.includes(is)){this.io.warning(`Calling set_episode outside of segment ${is} is not supported.`,t);break}if(function(e){switch(e){case n.b.I:return 0;case n.b.II:return 1;case n.b.IV:return 2}}(this.episode)!==a){this.io.warning("Calling set_episode with an argument that does notmatch the quest's designated episode is not supported.",t);break}break;case To.code:this.io.map_designate(a,c);break;default:this.unsupported_opcodes_logged.has(i.opcode.code)||(this.unsupported_opcodes_logged.add(i.opcode.code),this.io.warning("Unsupported instruction.",t))}return s&&this.advance(e),o}get_register_signed(e){return this.registers.i32_at(Ko*e)}set_register_signed(e,t){this.registers.write_i32_at(Ko*e,t)}get_register_unsigned(e){return this.registers.u32_at(Ko*e)}set_register_unsigned(e,t){this.registers.write_u32_at(Ko*e,t)}get_register_word(e){return this.registers.u16_at(Ko*e)}set_register_word(e,t){this.registers.write_u16_at(Ko*e,t)}get_register_byte(e){return this.registers.u8_at(Ko*e)}set_register_byte(e,t){this.registers.write_u8_at(Ko*e,t)}get_register_float(e){return this.registers.f32_at(Ko*e)}set_register_float(e,t){this.registers.write_f32_at(Ko*e,t)}do_integer_op_with_register(e,t,i){this.do_integer_op_with_literal(e,this.get_register_signed(t),i)}do_integer_op_with_literal(e,t,i){if((i===Mo.div||i===Mo.idiv)&&0===t)throw new Error("Division by zero");this.set_register_signed(e,i(this.get_register_signed(e),t))}do_float_op_with_register(e,t,i){this.do_float_op_with_literal(e,this.get_register_float(t),i)}do_float_op_with_literal(e,t,i){if((i===Mo.div||i===Mo.idiv)&&0===t)throw new Error("Division by zero");this.set_register_float(e,i(this.get_register_float(e),t))}push_call_stack(e,t){const i=this.get_segment_index_by_label(t),o=this._object_code[i];if(o.type!==Oo.Instructions)throw new Error(`Label ${t} points to a ${Oo[o.type]} segment, expecting ${Oo[Oo.Instructions]}.`);e.push_frame(new No(i,0,this.object_code))}pop_call_stack(e){this.threads[e].pop_call_stack(),0===this.threads[e].call_stack.length&&this.terminate_thread(e)}jump_to_label(e,t){e.set_current_instruction_pointer(new No(this.get_segment_index_by_label(t),0,this.object_code))}signed_cond_jump_with_register(e,t,i,o,s){this.conditional_jump(e,t,i,this.get_register_signed(o),this.get_register_signed(s))}signed_cond_jump_with_literal(e,t,i,o,s){this.conditional_jump(e,t,i,this.get_register_signed(o),s)}unsigned_cond_jump_with_register(e,t,i,o,s){this.conditional_jump(e,t,i,this.get_register_unsigned(o),this.get_register_unsigned(s))}unsigned_cond_jump_with_literal(e,t,i,o,s){this.conditional_jump(e,t,i,this.get_register_unsigned(o),s)}conditional_jump(e,t,i,...o){const s=Wo.bind(null,i);var n;void 0!==function(e,t,i){let o=t;for(const t of i){const i=e(o,t);if(void 0===i)return;o=i}return o}(s,(n=o)[0],n.slice(1))?this.jump_to_label(e,t):this.advance(e)}push_variable_stack(e,t,i){const o=t+i;if(o>Jo)throw new Error("Variable stack: Invalid register");if(e.variable_stack.length+i>Zo)throw new Error("Variable stack: Stack overflow");for(let i=t;i<o;i++)e.variable_stack.push(this.get_register_unsigned(i))}pop_variable_stack(e,t,i){const o=t+i;if(o>Jo)throw new Error("Variable stack: Invalid register");if(e.variable_stack.length<i)throw new Error("Variable stack: Stack underflow");for(let i=o-1;i>=t;i--)this.set_register_unsigned(i,e.variable_stack.pop())}get_register_address(e){return e*Ko}deref_string(e){if(e===es)return this.string_arg_store;if(e>0&&e<Jo*Ko)return this.registers.string_utf16_at(e,Jo*Ko,!0);throw new Error(`Failed to dereference string: Invalid address ${e}`)}parse_template_string(e){const t={"hero name":"PLACEHOLDER","hero job":"PLACEHOLDER","name hero":"PLACEHOLDER","name job":"PLACEHOLDER",time:"01:12","award item":"PLACEHOLDER","challenge title":"PLACEHOLDER",pl_name:"PLACEHOLDER",pl_job:"PLACEHOLDER",last_word:"PLACEHOLDER",last_chat:"PLACEHOLDER",team_name:"PLACEHOLDER",meseta_slot_prize:"PLACEHOLDER"},i=[[/^color ([0-9]+)$/,e=>`<color ${e}>`],[/^r([0-9]{1,3})$/,e=>{const t=parseInt(e);return isNaN(t)?"":this.get_register_unsigned(t).toString()}],[/^f([0-9]{1,3})$/,e=>{const t=parseInt(e);return isNaN(t)?"":this.get_register_float(t).toFixed(6)}]];let o=!1,s=-1,n=0,r=e.length;for(;n<r;){const a=e[n];if(o&&">"===a){o=!1;const a=n,d=e.slice(s+1,a);let c=void 0;for(const[e,t]of i){const i=e.exec(d);if(i&&void 0!==i[1]){c=t(i[1]);break}}if(void 0===c&&(c=t[d]),void 0===c)c="";else if("function"==typeof c){const e=c();t[d]=e,c=e}e=e.slice(0,s)+c+e.slice(a+1);const l=c.length-(d.length+2);n+=l,r+=l}else"<"===a&&(o=!0,s=n);n++}return o&&(e=e.slice(0,s)),e}}i(792);var as,ds=i(143);!function(e){e[e.Signed=0]="Signed",e[e.Unsigned=1]="Unsigned",e[e.Word=2]="Word",e[e.Byte=3]="Byte",e[e.Float=4]="Float"}(as||(as={}));class cs extends b.a{constructor(e){super(),this.quest_runner=e,this.type_select=this.add(new ds.a({label:"Display type:",tooltip:"Select which data type register values should be displayed as.",items:[as.Signed,as.Unsigned,as.Word,as.Byte,as.Float],to_label:e=>as[e]})),this.register_getter=this.get_register_getter(as.Signed),this.hex_checkbox=this.add(new qe.a(!1,{label:"Hex",tooltip:"Display register values in hexadecimal."})),this.settings_bar=this.add(new We.a(this.type_select,this.hex_checkbox)),this.list_element=Object(u.h)({className:"quest_editor_RegistersView_list"}),this.container_element=Object(u.h)({className:"quest_editor_RegistersView_container"},this.list_element),this.element=Object(u.h)({className:"quest_editor_RegistersView"},this.settings_bar.element,this.container_element),this.type_select.selected.val=as.Signed;const t=Array(Jo);for(let e=0;e<Jo;e++){const i=this.add(new c("",{class:"quest_editor_RegistersView_value",label:`r${e}:`,readonly:!0})),o=Object(u.h)({className:"quest_editor_RegistersView_register"},i.label.element,i.element);t[e]=i,this.list_element.appendChild(o)}this.register_els=t;const i=()=>!this.quest_runner.paused.val||!this.quest_runner.running.val;this.update(i(),this.hex_checkbox.checked.val),this.disposables(this.quest_runner.running.observe(()=>this.update(i(),this.hex_checkbox.checked.val)),this.quest_runner.paused.observe(()=>this.update(i(),this.hex_checkbox.checked.val)),this.type_select.selected.observe(({value:e})=>{null!=e&&(this.register_getter=this.get_register_getter(e),this.update(i(),this.hex_checkbox.checked.val))}),this.hex_checkbox.checked.observe(e=>this.update(i(),e.value))),this.finalize_construction()}get_register_getter(e){let t;switch(e){case as.Signed:t=this.quest_runner.vm.get_register_signed;break;case as.Unsigned:t=this.quest_runner.vm.get_register_unsigned;break;case as.Word:t=this.quest_runner.vm.get_register_word;break;case as.Byte:t=this.quest_runner.vm.get_register_byte;break;case as.Float:t=this.quest_runner.vm.get_register_float}return t.bind(this.quest_runner.vm)}update(e,t){if(e){const e="??";for(let t=0;t<Jo;t++){this.register_els[t].value.set_val(e,{silent:!0})}}else if(t)for(let e=0;e<Jo;e++){const t=this.register_els[e],i=this.quest_runner.vm.get_register_unsigned(e);t.value.set_val(Object(q.i)(i),{silent:!0})}else for(let e=0;e<Jo;e++){const t=this.register_els[e],i=this.register_getter(e);t.value.set_val(i.toString(),{silent:!0})}}}i(793);var ls=i(27);const _s=Y.a.get("quest_editor/stores/LogStore");const us=new class{constructor(){this.disposer=new a.a,this.default_log_severity=ls.b.Info,this.log_buffer=[],this.logger_name_buffer=[],this._severity=Object(M.e)(this.default_log_severity),this._log=Object(M.c)(),this.handler=(e,t)=>{this.buffer_log_entry(e,t)},this.severity=this._severity,this.log=this._log.filtered(this.severity.map(e=>t=>t.severity>=e))}get_logger(e){const t=Y.a.get(e);return t.handler=this.handler,t}dispose(){this.disposer.dispose()}set_severity(e){this._severity.val=e}buffer_log_entry(e,t){this.log_buffer.push(e),this.logger_name_buffer.push(t),this.add_buffered_log_entries()}add_buffered_log_entries(){null==this.adding_log_entries&&(this.adding_log_entries=requestAnimationFrame(()=>{if(this.log_buffer.length>500){const e=this.log_buffer.length-500;this.log_buffer.splice(250,e,{time:new Date,message:`...dropped ${e} messages...`,severity:ls.b.Warning,logger:_s}),this.logger_name_buffer.splice(250,e,"quest_editor/stores/LogStore")}const e=Math.min(200,this.log_buffer.length),t=this.log_buffer.splice(0,e),i=this.logger_name_buffer.splice(0,e);this._log.push(...t);for(let o=0;o<e;o++){const e=t[o],s=i[o];Y.a.default_handler(e,s)}this._log.length.val>2e3&&this._log.splice(0,1e3),this.adding_log_entries=void 0,this.log_buffer.length&&this.add_buffered_log_entries()}))}},hs=5;class vs extends b.a{constructor(){super(),this.element=Object(u.h)({className:"quest_editor_LogView",tabIndex:-1}),this.should_scroll_to_bottom=!0,this.scrolled=()=>{this.should_scroll_to_bottom=this.list_container.scrollTop>=this.list_container.scrollHeight-this.list_container.offsetHeight-hs},this.scroll_to_bottom=()=>{this.should_scroll_to_bottom&&this.list_container.scrollTo({top:this.list_container.scrollHeight,left:0,behavior:"auto"})},this.create_message_element=({time:e,severity:t,message:i})=>Object(u.h)({className:["quest_editor_LogView_message","quest_editor_LogView_"+ls.b[t]+"_message"].join(" ")},Object(u.h)({className:"quest_editor_LogView_message_timestamp"},Object(Y.b)(e)),Object(u.h)({className:"quest_editor_LogView_message_level"},`[${ls.b[t]}]`),Object(u.h)({className:"quest_editor_LogView_message_contents"},i)),this.list_container=Object(u.h)({className:"quest_editor_LogView_list_container"}),this.list_element=Object(u.h)({className:"quest_editor_LogView_message_list"}),this.level_filter=this.add(new ds.a({class:"quest_editor_LogView_level_filter",label:"Level:",items:ls.a,to_label:e=>ls.b[e]})),this.settings_bar=this.add(new We.a({class:"quest_editor_LogView_settings"},this.level_filter)),this.list_container.addEventListener("scroll",this.scrolled),this.disposables(Object(u.d)(this.list_element,us.log,this.create_message_element,{after:this.scroll_to_bottom}),this.level_filter.selected.observe(({value:e})=>null!=e&&us.set_severity(e)),us.severity.observe(({value:e})=>{this.level_filter.selected.val=e},{call_now:!0})),this.list_container.appendChild(this.list_element),this.element.appendChild(this.settings_bar.element),this.element.appendChild(this.list_container),this.finalize_construction()}}class ps extends te{constructor(e,t,i,o){super(Object(M.e)(void 0),t,i,o),this.quest_runner=e,this.disposer.add_all(this.quest_runner.game_state.current_area_variant.observe(this.area_variant_changed,{call_now:!0}))}get_area_variant_details(){const e=this.quest_runner.game_state;return{episode:e.episode,area_variant:e.current_area_variant.val,npcs:e.npcs,objects:e.objects}}}class gs extends re{constructor(e,t,i,o){super(e,"quest_editor_QuestRunnerRendererView",new G(o,o=>new ps(e.quest_runner,o,t,i))),this.renderer.init_camera_controls(),this.finalize_construction()}}var bs=i(142);i(794);class fs extends bs.a{constructor(e){super(),this.element=Object(u.h)({className:"core_ErrorWidget"}),this.children=[],this.label=this.disposable(new v.a(e,{enabled:!1})),this.element.append(this.label.element),this.finalize_construction()}}var ms=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const ws=Y.a.get("quest_editor/gui/QuestEditorView"),ks={settings:{showPopoutIcon:!1,showMaximiseIcon:!0,showCloseIcon:!0},dimensions:{headerHeight:24},labels:{close:"Close",maximise:"Maximise",minimise:"Minimise",popout:"Open in new window"}};class ys extends b.a{constructor(e,t,i,o,s,n,r,a,d,c,l,_,h,v){super(),this.gui_store=e,this.quest_editor_ui_persister=i,this.tool_bar=o,this.element=Object(u.h)({className:"quest_editor_QuestEditorView"}),this.layout_element=Object(u.h)({className:"quest_editor_gl_container"}),this.sub_views=new Map,this.view_map=new Map([[f,{name:"quest_info",create:s}],[m,{name:"npc_counts",create:n}],[Ee,{name:"quest_renderer",create:r}],[Ae,{name:"asm_editor",create:a}],[Ne,{name:"entity_info",create:d}],[Qe,{name:"npc_list_view",create:c}],[Ye,{name:"object_list_view",create:l}],[ht,{name:"events_view",create:_}]]),e.feature_active("vm")&&(this.view_map.set(gs,{name:"quest_runner",create:h}),this.view_map.set(vs,{name:"log_view",create:()=>new vs}),this.view_map.set(cs,{name:"registers_view",create:v})),this.element.append(this.tool_bar.element,this.layout_element),this.layout=this.init_golden_layout(),this.layout.then(e=>this.loaded_layout=e),this.disposables(e.on_global_keydown(Ge.b.QuestEditor,"Ctrl-Alt-D",()=>t.debug.val=!t.debug.val),t.quest_runner.running.observe(({value:e})=>ms(this,void 0,void 0,(function*(){const i=yield this.layout;if(t.quest_runner.running.val===e){const t=i.root.getItemsById(this.view_map.get(gs).name);if(e){if(0===t.length){i.root.getItemsById(this.view_map.get(Ee).name)[0].parent.addChild({id:this.view_map.get(gs).name,title:"Debug 3D View",type:"component",componentName:this.view_map.get(gs).name,isClosable:!1})}}else for(const e of t)e.remove()}})))),this.finalize_construction()}activate(){super.activate();for(const e of this.sub_views.values())e.activate()}deactivate(){for(const e of this.sub_views.values())e.deactivate();super.deactivate()}resize(e,t){super.resize(e,t);const i=Math.max(0,t-this.tool_bar.height);return this.layout_element.style.width=`${e}px`,this.layout_element.style.height=`${i}px`,this.layout.then(t=>t.updateSize(e,i)),this}dispose(){super.dispose(),this.layout.then(e=>e.destroy());for(const e of this.sub_views.values())e.dispose();this.sub_views.clear()}init_golden_layout(){return ms(this,void 0,void 0,(function*(){const e=this.get_default_layout_content();try{const t=yield this.quest_editor_ui_persister.load_layout_config(e);if(t){const e=this.attempt_gl_init(Object.assign(Object.assign({},ks),{content:t}));return ws.info("Instantiated golden layout with persisted layout."),e}}catch(e){ws.warn("Couldn't instantiate golden layout with persisted layout.",e)}return ws.info("Instantiating golden layout with default layout."),this.attempt_gl_init(Object.assign(Object.assign({},ks),{content:e}))}))}attempt_gl_init(e){const t=new s.a(e,this.layout_element),i=this;try{for(const{name:e,create:o}of this.view_map.values())t.registerComponent(e,(function(t){let s;try{s=o(),i.active&&s.activate()}catch(t){ws.error(`Couldn't instantiate "${e}".`,t),s=new fs("Something went wrong while creating this window.")}t.on("close",()=>s.dispose()),t.on("resize",()=>s.resize(t.width,t.height-4)),s.resize(t.width,t.height),i.sub_views.set(e,s),t.getElement().append(s.element)}));return t.on("stateChanged",()=>{this.quest_editor_ui_persister.persist_layout_config(t.toConfig().content)}),t.on("stackCreated",e=>{e.on("activeContentItemChanged",e=>{if("componentName"in e.config){const t=this.sub_views.get(e.config.componentName);t&&t.focus()}})}),t.init(),t}catch(e){throw t.destroy(),e}}get_default_layout_content(){return[{type:"row",content:[{type:"column",width:2,content:[{type:"stack",content:[{title:"Info",type:"component",componentName:this.view_map.get(f).name,isClosable:!1},{title:"NPC Counts",type:"component",componentName:this.view_map.get(m).name,isClosable:!1}]},{title:"Entity",type:"component",componentName:this.view_map.get(Ne).name,isClosable:!1}]},{type:"stack",width:9,content:[{id:this.view_map.get(Ee).name,title:"3D View",type:"component",componentName:this.view_map.get(Ee).name,isClosable:!1},{title:"Script",type:"component",componentName:this.view_map.get(Ae).name,isClosable:!1},...this.gui_store.feature_active("vm")?[{title:"Debug Log",type:"component",componentName:this.view_map.get(vs).name,isClosable:!1},{title:"Registers",type:"component",componentName:this.view_map.get(cs).name,isClosable:!1}]:[]]},{type:"stack",width:2,content:[{title:"NPCs",type:"component",componentName:this.view_map.get(Qe).name,isClosable:!1},{title:"Objects",type:"component",componentName:this.view_map.get(Ye).name,isClosable:!1},{title:"Events",type:"component",componentName:this.view_map.get(ht).name,isClosable:!1}]}]}]}}const Rs={can_redo:Object(M.e)(!1),can_undo:Object(M.e)(!1),first_redo:Object(M.e)(void 0),first_undo:Object(M.e)(void 0),make_current(){Is.current.val=this},redo:()=>!1,reset(){},undo:()=>!1};const Is=new class{constructor(){this.current=Object(M.e)(Rs),this.can_undo=this.current.flat_map(e=>e.can_undo),this.can_redo=this.current.flat_map(e=>e.can_redo),this.first_undo=this.current.flat_map(e=>e.first_undo),this.first_redo=this.current.flat_map(e=>e.first_redo)}undo(){return this.current.val.undo()}redo(){return this.current.val.redo()}make_noop_current(){Is.current.val=Rs}},xs=Y.a.get("core/undo/UndoStack");class js{constructor(){this.stack=Object(M.c)(),this.index=Object(M.e)(0),this.can_undo=this.index.map(e=>e>0),this.can_redo=Object(M.d)((e,t)=>t<e.length,this.stack,this.index),this.first_undo=this.can_undo.map(e=>e?this.stack.get(this.index.val-1):void 0),this.first_redo=this.can_redo.map(e=>e?this.stack.get(this.index.val):void 0),this.undoing_or_redoing=!1}make_current(){Is.current.val=this}push(e){return this.undoing_or_redoing||(this.stack.splice(this.index.val,1/0,e),this.index.update(e=>e+1)),e}pop(){return this.index.update(e=>e-1),this.stack.splice(this.index.val,1)[0]}undo(){if(this.can_undo.val&&!this.undoing_or_redoing){try{this.undoing_or_redoing=!0,this.index.update(e=>e-1),this.stack.get(this.index.val).undo()}catch(e){xs.warn("Error while undoing action.",e)}finally{this.undoing_or_redoing=!1}return!0}return!1}redo(){if(this.can_redo.val&&!this.undoing_or_redoing){try{this.undoing_or_redoing=!0,this.stack.get(this.index.val).redo(),this.index.update(e=>e+1)}catch(e){xs.warn("Error while redoing action.",e)}finally{this.undoing_or_redoing=!1}return!0}return!1}reset(){this.stack.clear(),this.index.val=0}}class Ts{constructor(e){this._breakpoints=[],this.breakpoints=this._breakpoints,this.vm=e}resume(){this.vm.step_mode=Qo.BreakPoint}step_over(){this.vm.step_mode=Qo.Over}step_in(){this.vm.step_mode=Qo.In}step_out(){this.vm.step_mode=Qo.Out}set_breakpoint(e){return-1===this._breakpoints.findIndex(t=>t.line_no===e)&&(this._breakpoints.push(new Cs(e,void 0,this.vm)),!0)}remove_breakpoint(e){const t=this._breakpoints.findIndex(t=>t.line_no===e);return-1!=t&&(this._breakpoints.splice(t,1)[0].deactivate(),!0)}toggle_breakpoint(e){const t=this._breakpoints.findIndex(t=>t.line_no===e);-1==t?this._breakpoints.push(new Cs(e,void 0,this.vm)):this._breakpoints.splice(t,1)[0].deactivate()}clear_breakpoints(){for(const e of this._breakpoints.splice(0,1/0))e.deactivate()}activate_breakpoints(){for(const e of this._breakpoints)e.activate()}deactivate_breakpoints(){for(const e of this._breakpoints)e.deactivate()}}class Cs{constructor(e,t,i){this.line_no=e,this.ptr=t,this.vm=i,null==t?this.activate():this.vm.set_breakpoint(t)}get active(){return null!=this.ptr}activate(){this.ptr=this.line_no_to_inst_pointer(this.line_no),this.ptr&&this.vm.set_breakpoint(this.ptr)}deactivate(){this.ptr&&this.vm.remove_breakpoint(this.ptr)}line_no_to_inst_pointer(e){var t,i;if(!this.vm.halted)for(let o=0;o<this.vm.object_code.length;o++){const s=this.vm.object_code[o];if(s.type===Oo.Instructions)for(let n=0;n<s.instructions.length;n++){if((null===(i=null===(t=s.instructions[n].asm)||void 0===t?void 0:t.mnemonic)||void 0===i?void 0:i.line_no)===e)return new No(o,n,this.vm.object_code)}}}}var Ss;!function(e){e[e.Stopped=0]="Stopped",e[e.Running=1]="Running",e[e.Paused=2]="Paused"}(Ss||(Ss={}));class Os{constructor(e){this.episode=e,this.floor_handlers=new Map,this.area_variants=new Map,this.current_area_variant=Object(M.e)(void 0),this.npcs=Object(M.c)(),this.objects=Object(M.c)()}}class Ls{constructor(e){this.area_store=e,this.logger=us.get_logger("quest_editor/QuestRunner"),this.startup=!0,this._state=Object(M.e)(Ss.Stopped),this.initial_area_id=0,this.npcs=[],this.objects=[],this._breakpoints=Object(M.c)(),this._pause_location=Object(M.e)(void 0),this._game_state=new Os(n.b.I),this.running=this._state.map(e=>e!==Ss.Stopped),this.paused=this._state.map(e=>e===Ss.Paused),this.breakpoints=this._breakpoints,this.pause_location=this._pause_location,this.execution_loop=()=>{var e,t;let i;switch(this.animation_frame=void 0,this.vm.vsync(),this.vm.execute()){case ns.Suspended:this._state.val=Ss.Running;break;case ns.Paused:this._state.val=Ss.Paused,i=null===(t=null===(e=this.vm.get_instruction_pointer())||void 0===e?void 0:e.source_location)||void 0===t?void 0:t.line_no;break;case ns.WaitingVsync:case ns.WaitingInput:this._state.val=Ss.Running,this.schedule_frame();break;case ns.WaitingSelection:this.vm.list_select(0),this._state.val=Ss.Running,this.schedule_frame();break;case ns.Halted:this.stop()}this._pause_location.val=i,this.startup&&this._state.val===Ss.Running&&(this.startup=!1,this.run_floor_handler(this._game_state.area_variants.get(this.initial_area_id)||this.area_store.get_variant(this._game_state.episode,this.initial_area_id,0)))},this.create_vm_io=()=>{function e(e,t){const i=[e];if(t){const{instruction:e,source_location:o}=t;i.push(` [${e.opcode.mnemonic}`),o&&i.push(` ${o.line_no}:${o.col}`),i.push("]")}return i.join("")}return{map_designate:(e,t)=>{this._game_state.area_variants.set(e,this.area_store.get_variant(this._game_state.episode,e,t))},set_floor_handler:(e,t)=>{this._game_state.floor_handlers.set(e,t)},window_msg:e=>{this.logger.info(`window_msg "${e}"`)},message:e=>{this.logger.info(`message "${e}"`)},add_msg:e=>{this.logger.info(`add_msg "${e}"`)},winend:()=>{},p_dead_v3:()=>!1,mesend:()=>{},list:e=>{this.logger.info(`list "[${e}]"`)},warning:(t,i)=>{this.logger.warn(e(t,i))},error:(t,i)=>{this.logger.error(e(t.message,i))}}},this.vm=new rs(this.create_vm_io()),this.debugger=new Ts(this.vm)}get game_state(){return this._game_state}run(e){this.stop(),this.logger.info("Starting debugger."),this.startup=!0,this.initial_area_id=0,this.npcs.splice(0,this.npcs.length,...e.npcs.val),this.objects.splice(0,this.objects.length,...e.objects.val),this._game_state=new Os(e.episode),this.vm.load_object_code(e.object_code.map(Eo),this.game_state.episode),this.vm.start_thread(0),this.debugger.activate_breakpoints(),this._state.val=Ss.Running,this.schedule_frame()}resume(){this.debugger.resume(),this.schedule_frame()}step_over(){this.debugger.step_over(),this.schedule_frame()}step_into(){this.debugger.step_in(),this.schedule_frame()}step_out(){this.debugger.step_out(),this.schedule_frame()}stop(){this.running.val&&(this.logger.info("Stopping debugger."),null!=this.animation_frame&&(cancelAnimationFrame(this.animation_frame),this.animation_frame=void 0),this.vm.halt(),this.debugger.deactivate_breakpoints(),this._state.val=Ss.Stopped,this._pause_location.val=void 0,this.npcs.splice(0,this.npcs.length),this.objects.splice(0,this.objects.length),this._game_state=new Os(n.b.I))}set_breakpoint(e){const t=this.debugger.set_breakpoint(e);return this._breakpoints.splice(0,1/0,...this.debugger.breakpoints),t}remove_breakpoint(e){const t=this.debugger.remove_breakpoint(e);return this._breakpoints.splice(0,1/0,...this.debugger.breakpoints),t}toggle_breakpoint(e){this.debugger.toggle_breakpoint(e),this._breakpoints.splice(0,1/0,...this.debugger.breakpoints)}clear_breakpoints(){this.debugger.clear_breakpoints(),this._breakpoints.splice(0,1/0,...this.debugger.breakpoints)}schedule_frame(){null==this.animation_frame&&(this.animation_frame=requestAnimationFrame(this.execution_loop))}run_floor_handler(e){const t=e.area.id;this._game_state.current_area_variant.val=e,this._game_state.objects.push(...this.objects.filter(e=>e.area_id===t));const i=this._game_state.floor_handlers.get(t);null==i?this.logger.debug(`No floor handler registered for floor ${t}.`):(this.vm.start_thread(i),this.schedule_frame())}}var Ds=i(59),Bs=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const Ps=Y.a.get("quest_editor/gui/QuestEditorStore");class Es extends Ds.a{constructor(e,t){super(),this.area_store=t,this._current_quest=Object(M.e)(void 0),this._current_area=Object(M.e)(void 0),this._selected_wave=Object(M.e)(void 0),this._selected_entity=Object(M.e)(void 0),this.debug=Object(M.e)(!1),this.undo=new js,this.current_quest=this._current_quest,this.current_area=this._current_area,this.selected_wave=this._selected_wave,this.selected_entity=this._selected_entity,this.set_current_area=e=>{var t,i;e&&e.id!==(null===(i=null===(t=this.selected_wave.val)||void 0===t?void 0:t.area_id)||void 0===i?void 0:i.val)&&this.set_selected_wave(void 0),this._selected_entity.val=void 0,this._current_area.val=e},this.set_selected_wave=e=>{if(e){const t=this.selected_entity.val;t&&t instanceof N&&t.wave.val!==e&&this.set_selected_entity(void 0)}this._selected_wave.val=e},this.set_selected_entity=e=>{e&&this.current_quest.val&&(this._current_area.val=this.area_store.get_area(this.current_quest.val.episode,e.area_id)),this._selected_entity.val=e},this.set_section_on_quest_entity=(e,t)=>{const i=t.find(t=>t.id===e.section_id.val);i?e.set_section(i):Ps.warn(`Section ${e.section_id.val} not found.`)},this.quest_runner=new Ls(t),this.disposables(e.tool.observe(({value:e})=>{e===Ge.b.QuestEditor&&this.undo.make_current()},{call_now:!0}),this.current_quest.flat_map(e=>e?e.npcs:Object(M.e)([])).observe(({value:e})=>{const t=this.selected_entity.val;t instanceof N&&!e.includes(t)&&this.set_selected_entity(void 0)}),this.current_quest.flat_map(e=>e?e.objects:Object(M.e)([])).observe(({value:e})=>{const t=this.selected_entity.val;t instanceof pe&&!e.includes(t)&&this.set_selected_entity(void 0)}),Object(u.g)(window,"beforeunload",e=>{this.quest_runner.stop(),this.undo.can_undo.val&&(e.preventDefault(),e.returnValue=!1)}))}dispose(){this.quest_runner.stop(),super.dispose()}set_current_quest(e){return Bs(this,void 0,void 0,(function*(){if(this.undo.reset(),this.quest_runner.stop(),this._current_area.val=void 0,this._selected_entity.val=void 0,this._current_quest.val=e,e){this._current_area.val=this.area_store.get_area(e.episode,0);for(const t of e.area_variants.val){const i=yield this.area_store.get_area_sections(e.episode,t);t.set_sections(i);for(const o of e.objects.val.filter(e=>e.area_id===t.area.id))try{this.set_section_on_quest_entity(o,i)}catch(e){Ps.error(e)}for(const o of e.npcs.val.filter(e=>e.area_id===t.area.id))try{this.set_section_on_quest_entity(o,i)}catch(e){Ps.error(e)}}}}))}}var Ms,Ws,qs=i(795),Fs=i.n(qs);!function(e){e[e.NewAssembly=0]="NewAssembly",e[e.AssemblyChange=1]="AssemblyChange",e[e.SignatureHelp=2]="SignatureHelp",e[e.Definition=3]="Definition",e[e.SettingsChange=4]="SettingsChange"}(Ms||(Ms={})),function(e){e[e.NewObjectCode=0]="NewObjectCode",e[e.SignatureHelp=1]="SignatureHelp",e[e.Definition=2]="Definition"}(Ws||(Ws={}));const Vs=new DataView(new ArrayBuffer(4));function zs(e){return Vs.setInt32(0,e),Vs.getFloat32(0)}function Us(e){return Vs.setFloat32(0,e),Vs.getInt32(0)}const $s=Y.a.get("quest_editor/scripting/disassembly");function As(e,t){const i=[],o=Math.min(e.length,t.length);for(let s=0;s<o;s++)i.push(Object.assign(Object.assign({},t[s]),{type:e[s].type}));const s=e[e.length-1];if(s&&(s.type.kind===vt.ILabelVar||s.type.kind===vt.RegRefVar)){const e=t.length;for(let o=i.length;o<e;o++)i.push(Object.assign(Object.assign({},t[o]),{type:s.type}))}return i}function Ns(e,t,i){const o=[];for(let s=0;s<e.length;s++){const n=e[s].type,r=t[s];if(null!=r)if(r.type.kind===vt.RegTupRef)o.push("r"+r.value);else switch(n.kind){case vt.Float:i?o.push(zs(r.value).toString()):o.push(r.value.toString());break;case vt.ILabelVar:for(;s<t.length;s++)o.push(t[s].value.toString());break;case vt.RegRefVar:for(;s<t.length;s++)o.push("r"+t[s].value);break;case vt.RegRef:case vt.RegTupRef:o.push("r"+r.value);break;case vt.String:o.push(JSON.stringify(r.value));break;default:o.push(r.value.toString())}else o.push("")}return o}var Gs=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))},Hs=Me.languages.CompletionItemKind;const Qs=Pt.filter(e=>null!=e).map(e=>({label:e.mnemonic,kind:Hs.Function,insertText:e.mnemonic})),Ys=[{label:".code",kind:Hs.Keyword,insertText:"code"},{label:".data",kind:Hs.Keyword,insertText:"data"},{label:".string",kind:Hs.Keyword,insertText:"string"}];class Xs{constructor(e,t,i){this.can_undo=Object(M.e)(!1),this.can_redo=Object(M.e)(!1),this.action=Object(M.e)({description:e,undo:t,redo:i}),this.first_undo=Object(M.d)((e,t)=>t?e:void 0,this.action,this.can_undo),this.first_redo=Object(M.d)((e,t)=>t?e:void 0,this.action,this.can_redo)}make_current(){Is.current.val=this}undo(){return!!this.can_undo&&(this.action.val.undo(),!0)}redo(){return!!this.can_redo&&(this.action.val.redo(),!0)}reset(){this.can_undo.val=!1,this.can_redo.val=!1}}var Js=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const Ks=new class{constructor(){this._issues=Object(M.e)({warnings:[],errors:[]}),this.issues=this._issues,this.worker=new Fs.a,this.promises=new Map,this.message_id=0,this.process_worker_message=e=>{const t=e.data;switch(t.type){case Ws.NewObjectCode:this.quest&&(this.quest.object_code.splice(0,this.quest.object_code.length,...t.object_code),this.quest.set_map_designations(t.map_designations),this._issues.val={warnings:t.warnings,errors:t.errors});break;case Ws.SignatureHelp:{const e=this.promises.get(t.id);if(e)if(this.promises.delete(t.id),t.opcode){let i=t.opcode.mnemonic+" ";const o=[];let s=!0;for(const e of t.opcode.params){let t;switch(s?s=!1:i+=", ",e.type.kind){case vt.ILabel:t="FuncLabel";break;case vt.DLabel:t="DataLabel";break;case vt.SLabel:t="StringLabel";break;case vt.ILabelVar:t="...FuncLabel";break;case vt.RegRef:case vt.RegTupRef:t="Register";break;case vt.RegRefVar:t="...Register";break;default:t=vt[e.type.kind]}o.push({label:[i.length,i.length+t.length],documentation:e.doc}),i+=t}const n={signatures:[{label:i,documentation:t.opcode.doc,parameters:o}],activeSignature:0,activeParameter:t.active_param};e.resolve(n)}else e.resolve(void 0)}break;case Ws.Definition:{const e=this.promises.get(t.id);if(e){this.promises.delete(t.id);const i=[];null!=t.line_no&&i.push({uri:e.uri,range:{startLineNumber:t.line_no,startColumn:t.col,endLineNumber:t.line_no,endColumn:t.col+t.len}}),e.resolve(i)}}}},this.worker.onmessage=this.process_worker_message}disassemble(e,t){this.quest=e;const i=function(e,t=!1){$s.trace("disassemble start");const i=[],o=[];let s=void 0;for(const r of e){let e;switch(r.type){case Oo.Instructions:e=".code";break;case Oo.Data:e=".data";break;case Oo.String:e=".string"}s!==r.type&&(s=r.type,i.length&&i.push(""),i.push(e,""));for(const e of r.labels)i.push(`${e}:`);if(r.type===Oo.Data){const e=new Uint8Array(r.data);let t="    ";for(let o=0;o<e.length;o++)t+="0x"+Object(q.i)(e[o],2),o%16==15?(i.push(t),t="    "):o<e.length-1&&(t+=" ");t.length>4&&i.push(t)}else if(r.type===Oo.String)i.push("    "+(n=r.value,JSON.stringify(n.replace(/<cr>/g,"\n"))));else{let e=!1;for(const s of r.instructions)if(s.opcode.code===Ut.code?e=!0:s.opcode.code===$t.code&&(e=!1),t||e||s.opcode.stack!==Dt.Push){let e=[];s.opcode.stack===Dt.Pop?t||(e=Ns(s.opcode.params,o.splice(Math.max(0,o.length-s.opcode.params.length),s.opcode.params.length),!0)):e=Ns(s.opcode.params,As(s.opcode.params,s.args),!1),i.push("    "+s.opcode.mnemonic+(e.length?" "+e.join(", "):""))}else o.push(...As(s.opcode.params,s.args))}}var n;return i.length&&i.push(""),$s.trace(`disassemble end, line count: ${i.length}`),i}(e.object_code,t),o={type:Ms.NewAssembly,assembly:i};return this.worker.postMessage(o),i}update_assembly(e){const t={type:Ms.AssemblyChange,changes:e.map(e=>({start_line_no:e.range.startLineNumber,start_col:e.range.startColumn,end_line_no:e.range.endLineNumber,end_col:e.range.endColumn,new_text:e.text}))};this.worker.postMessage(t)}provide_completion_items(e){return{suggestions:/^\s*([a-z][a-z0-9_=<>!]*)?$/.test(e)?Qs:/^\s*\.[a-z]+$/.test(e)?Ys:[],incomplete:!1}}provide_signature_help(e,t,i){return Gs(this,void 0,void 0,(function*(){return yield this.send_and_await_response("Signature help provision",e,e=>({type:Ms.SignatureHelp,id:e,line_no:t,col:i}))}))}provide_definition(e,t,i){return Gs(this,void 0,void 0,(function*(){return yield this.send_and_await_response("Definition provision",e,e=>({type:Ms.Definition,id:e,line_no:t,col:i}))}))}update_settings(e){const t={type:Ms.SettingsChange,settings:e};this.worker.postMessage(t)}dispose(){this.worker.terminate()}send_and_await_response(e,t,i){return Gs(this,void 0,void 0,(function*(){const o=this.message_id++;return new Promise((s,n)=>{this.promises.set(o,{uri:t,resolve:s,reject:n});const r=i(o);this.worker.postMessage(r),setTimeout(()=>{this.promises.delete(o)&&n(new Error(`${e} timed out.`))},5e3)})}))}};Me.languages.register({id:"psoasm"}),Me.languages.setMonarchTokensProvider("psoasm",{defaultToken:"invalid",tokenizer:{root:[[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/r\d+/,"predefined"],[/[^\s]+:/,"tag"],[/0x[0-9a-fA-F]+/,"number.hex"],[/-?\d+(\.\d+)?(e-?\d+)?/,"number.float"],[/-?[0-9]+/,"number"],[/\.[^\s]+/,"keyword"],[/[a-z][a-z0-9_=<>!]*/,"identifier"],[/[ \t\r\n]+/,"white"],[/\/\/.*$/,"comment"],[/,/,"delimiter"]],string:[[/[^\\"]+/,"string"],[/\\(?:[n\\"])/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]]}}),Me.languages.registerCompletionItemProvider("psoasm",{provideCompletionItems(e,t){const i=e.getValueInRange({startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:1,endColumn:t.column});return Ks.provide_completion_items(i)}}),Me.languages.registerSignatureHelpProvider("psoasm",{signatureHelpTriggerCharacters:[" ",","],signatureHelpRetriggerCharacters:[", "],provideSignatureHelp(e,t){return Js(this,void 0,void 0,(function*(){const i=yield Ks.provide_signature_help(e.uri,t.lineNumber,t.column);return i&&{value:i,dispose(){}}}))}}),Me.languages.setLanguageConfiguration("psoasm",{indentationRules:{increaseIndentPattern:/^\s*\d+:/,decreaseIndentPattern:/^\s*(\d+|\.)/},autoClosingPairs:[{open:'"',close:'"'}],surroundingPairs:[{open:'"',close:'"'}],comments:{lineComment:"//"}}),Me.languages.registerDefinitionProvider("psoasm",{provideDefinition:(e,t)=>Ks.provide_definition(e.uri,t.lineNumber,t.column)});class Zs extends Ds.a{constructor(e){super(),this.quest_editor_store=e,this.model_disposer=this.disposable(new a.a),this._model=Object(M.e)(void 0),this._did_undo=Object(M.a)(),this._did_redo=Object(M.a)(),this._inline_args_mode=Object(M.e)(!0),this.model=this._model,this.did_undo=this._did_undo,this.did_redo=this._did_redo,this.undo=new Xs("Text edits",()=>this._did_undo.emit({value:"asm undo"}),()=>this._did_redo.emit({value:"asm redo"})),this.inline_args_mode=this._inline_args_mode,this.has_issues=Ks.issues.map(e=>e.warnings.length+e.errors.length>0),this.set_inline_args_mode=e=>{this.has_issues.val||(this._inline_args_mode.val=e,Ks.update_settings({manual_stack:!this.inline_args_mode.val}),this.update_model())},this.quest_changed=()=>{this.update_model()},this.breakpoints=e.quest_runner.breakpoints,this.pause_location=e.quest_runner.pause_location,this.disposables(e.current_quest.observe(this.quest_changed,{call_now:!0}),Ks.issues.observe(({value:e})=>this.update_model_markers(e),{call_now:!0}),Object(u.g)(window,"beforeunload",e=>{this.undo.can_undo.val&&(e.preventDefault(),e.returnValue=!1)}))}setup_editor_model_features(e){const t=e.getAlternativeVersionId();let i=t,o=t;this.model_disposer.add(e.onDidChangeContent(s=>{const n=e.getAlternativeVersionId();n<i?(this.undo.can_redo.val=!0,n===t&&(this.undo.can_undo.val=!1)):(n<=o?n===o&&(this.undo.can_redo.val=!1):(this.undo.can_redo.val=!1,i>o&&(o=i)),this.undo.can_undo.val=!0),i=n,Ks.update_assembly(s.changes),this.update_breakpoints(s.changes)}))}update_model_markers({warnings:e,errors:t}){const i=this.model.val;i&&Me.editor.setModelMarkers(i,"psoasm",e.map(e=>({severity:Me.MarkerSeverity.Hint,message:e.message,startLineNumber:e.line_no,endLineNumber:e.line_no,startColumn:e.col,endColumn:e.col+e.length,tags:[Me.MarkerTag.Unnecessary]})).concat(t.map(e=>({severity:Me.MarkerSeverity.Error,message:e.message,startLineNumber:e.line_no,endLineNumber:e.line_no,startColumn:e.col,endColumn:e.col+e.length}))))}update_model(){this.undo.reset(),this.model_disposer.dispose_all();const e=this.quest_editor_store.current_quest.val;if(e){const t=!this.inline_args_mode.val,i=Ks.disassemble(e,t),o=this.model_disposer.add(Me.editor.createModel(i.join("\n"),"psoasm"));this.setup_editor_model_features(o),this._model.val=o}else this._model.val=void 0}update_breakpoints(e){for(const t of e){const e=[];if(""===t.text){const i=t.range.endLineNumber-t.range.startLineNumber;if(i>0){for(let o=t.range.startLineNumber+1;o<=t.range.endLineNumber;o++){const t=Math.max(o-i,1);this.quest_editor_store.quest_runner.remove_breakpoint(o)&&e.push(t)}for(const o of this.breakpoints.val)o.line_no>t.range.endLineNumber&&(this.quest_editor_store.quest_runner.remove_breakpoint(o.line_no),e.push(o.line_no-i))}}else{const i=t.text.split("\n").length-1;if(i>0)for(const o of this.breakpoints.val)o.line_no>t.range.endLineNumber&&(this.quest_editor_store.quest_runner.remove_breakpoint(o.line_no),e.push(o.line_no+i))}for(const t of e)this.quest_editor_store.quest_runner.set_breakpoint(t)}}}class en{constructor(e,t,i,o){if(!Number.isInteger(e)||e<0)throw new Error(`Expected id to be a non-negative integer, got ${e}.`);if(!t)throw new Error("name is required.");if(!o)throw new Error("area_variants is required.");this.id=e,this.name=t,this.order=i,this.area_variants=o}}class tn{constructor(e,t){if(this._sections=Object(M.c)(),this.sections=this._sections,!Number.isInteger(e)||e<0)throw new Error(`Expected id to be a non-negative integer, got ${e}.`);this.id=e,this.area=t}set_sections(e){return this._sections.val=e,this}}function on(e){return sn[e]}const sn=[];function nn(e,t,i,o){const s={id:e,name:t,order:i,area_variants:[]};for(let e=0;e<o;e++)s.area_variants.push(Object.freeze({id:e,area:s}));return Object.freeze(s)}let rn=0;sn[n.b.I]=[nn(0,"Pioneer II",rn++,1),nn(1,"Forest 1",rn++,1),nn(2,"Forest 2",rn++,1),nn(11,"Under the Dome",rn++,1),nn(3,"Cave 1",rn++,6),nn(4,"Cave 2",rn++,5),nn(5,"Cave 3",rn++,6),nn(12,"Underground Channel",rn++,1),nn(6,"Mine 1",rn++,6),nn(7,"Mine 2",rn++,6),nn(13,"Monitor Room",rn++,1),nn(8,"Ruins 1",rn++,5),nn(9,"Ruins 2",rn++,5),nn(10,"Ruins 3",rn++,5),nn(14,"Dark Falz",rn++,1)],rn=0,sn[n.b.II]=[nn(0,"Lab",rn++,1),nn(1,"VR Temple Alpha",rn++,3),nn(2,"VR Temple Beta",rn++,3),nn(14,"VR Temple Final",rn++,1),nn(3,"VR Spaceship Alpha",rn++,3),nn(4,"VR Spaceship Beta",rn++,3),nn(15,"VR Spaceship Final",rn++,1),nn(5,"Central Control Area",rn++,1),nn(6,"Jungle Area East",rn++,1),nn(7,"Jungle Area North",rn++,1),nn(8,"Mountain Area",rn++,3),nn(9,"Seaside Area",rn++,1),nn(12,"Cliffs of Gal Da Val",rn++,1),nn(10,"Seabed Upper Levels",rn++,3),nn(11,"Seabed Lower Levels",rn++,3),nn(13,"Test Subject Disposal Area",rn++,1),nn(16,"Seaside Area at Night",rn++,2),nn(17,"Control Tower",rn++,5)],rn=0,sn[n.b.IV]=[nn(0,"Pioneer II (Ep. IV)",rn++,1),nn(1,"Crater Route 1",rn++,1),nn(2,"Crater Route 2",rn++,1),nn(3,"Crater Route 3",rn++,1),nn(4,"Crater Route 4",rn++,1),nn(5,"Crater Interior",rn++,1),nn(6,"Subterranean Desert 1",rn++,3),nn(7,"Subterranean Desert 2",rn++,3),nn(8,"Subterranean Desert 3",rn++,3),nn(9,"Meteor Impact Site",rn++,1)],Object.freeze(sn);class an extends Ds.a{constructor(e){super(),this.area_asset_loader=e,this.areas=[],this.get_areas_for_episode=e=>this.areas[e],this.get_area=(e,t)=>{const i=this.areas[e].find(e=>e.id===t);if(!i)throw new Error(`Area id ${t} for episode ${e} is invalid.`);return i},this.get_variant=(e,t,i)=>{const o=this.get_area(e,t).area_variants[i];if(!o)throw new Error(`Area variant id ${i} for area ${t} of episode ${n.b[e]} is invalid.`);return o},this.get_area_sections=(e,t)=>this.area_asset_loader.load_sections(e,t);for(const e of n.a)this.areas[e]=on(e).map(e=>{const t=new en(e.id,e.name,e.order,[]);for(const i of e.area_variants)t.area_variants.push(new tn(i.id,t));return t})}}function dn(e,t){e.seek_end(32);const i=e.u32(),o=e.u32();e.seek(8);const s=e.u32();return e.seek_start(i),{data_offset:s,index:t?function(e,t){const i=e.u16_array(t),o=[];let s=0;for(const t of i){s+=4*t,e.seek_start(s-4);const i=e.u32(),n=e.u32();o.push({offset:n,size:i})}return o}(e,o):[]}}var cn=i(487);function ln(e,t,i){const o=[];for(let s=0;s<i;s++){e.seek_start(t+16*s);let i=e.u32();e.seek(8),4&e.u32()&&(i=e.seek_start(i).u32()),e.seek_start(i),o.push(...Object(cn.e)(e))}return o}class _n{constructor(){this.map=new Map}set(e,t){this.map.set(e,t)}get_or_set(e,t){let i=this.map.get(e);return void 0===i&&(i=t(),this.map.set(e,i)),i}dispose(){for(const e of this.values())e.dispose();this.map.clear()}values(){return this.map.values()}}var un=i(584),hn=i(585);class vn{constructor(e,t,i,o){if(!Number.isInteger(e)||e<-1)throw new Error(`Expected id to be an integer greater than or equal to -1, got ${e}.`);if(!t)throw new Error("position is required.");if(!i)throw new Error("rotation is required.");if(!o)throw new Error("area_variant is required.");this.id=e,this.position=t,this.rotation=i,this.inverse_rotation=V((new y.Quaternion).setFromEuler(i).inverse()),this.area_variant=o}}var pn=i(517);const gn=[new y.MeshBasicMaterial({color:8437968,transparent:!0,opacity:.25}),new y.MeshLambertMaterial({color:4214864,side:y.DoubleSide}),new y.MeshLambertMaterial({color:3170368,side:y.DoubleSide}),new y.MeshLambertMaterial({color:4202576,side:y.DoubleSide})],bn=[new y.MeshBasicMaterial({color:9490656,wireframe:!0,transparent:!0,opacity:.3}),new y.MeshBasicMaterial({color:5267552,wireframe:!0}),new y.MeshBasicMaterial({color:4214864,wireframe:!0}),new y.MeshBasicMaterial({color:5255264,wireframe:!0})];function fn(e,t){const i=[],o=new y.Group;let s=0;for(const n of e.sections){const e=new un.a;for(const t of n.objects)Object(hn.b)(t,e);const r=new y.Mesh(e.build(),new y.MeshBasicMaterial({color:(new y.Color).setHSL(s++%7/7,1,.5),transparent:!0,opacity:.25,side:y.DoubleSide}));if(o.add(r),r.position.set(n.position.x,n.position.y,n.position.z),r.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),r.updateMatrixWorld(),n.id>=0){const e=new vn(n.id,Object(pn.b)(n.position),F(n.rotation.x,n.rotation.y,n.rotation.z),t);i.push(e),r.userData.section=e}}return[i,o]}class mn{constructor(e){this.http_client=e,this.disposer=new a.a,this.render_object_cache=this.disposer.add(new _n),this.collision_object_cache=this.disposer.add(new _n),this.area_sections_cache=this.disposer.add(new _n)}dispose(){this.disposer.dispose()}load_sections(e,t){const i=`${e}-${t.area.id}-${t.id}`;return this.area_sections_cache.get_or_set(i,()=>this.render_object_cache.get_or_set(i,()=>this.load_render_object(e,t)).then(e=>fn(e,t)[0]))}load_render_geometry(e,t){const i=`${e}-${t.area.id}-${t.id}`;return this.render_object_cache.get_or_set(i,()=>this.load_render_object(e,t)).then(e=>fn(e,t)[1])}load_collision_geometry(e,t){const i=`${e}-${t.area.id}-${t.id}`;return this.collision_object_cache.get_or_set(i,()=>this.get_area_asset(e,t,"collision").then(e=>(function(e){const{data_offset:t}=dn(e,!1);e.seek_start(t);const i=e.u32();e.seek_start(i);const o={meshes:[]};for(;e.bytes_left;){const t=e.position,i=e.u32();if(0===i)break;const s={vertices:[],triangles:[]};o.meshes.push(s),e.seek_start(i);const n=e.u32(),r=e.u32(),a=e.u32(),d=e.u32();e.seek_start(r);for(let t=0;t<n;t++)s.vertices.push(e.vec3_f32());e.seek_start(d);for(let t=0;t<a;t++){const t=e.u16(),i=e.u16(),o=e.u16(),n=e.u16(),r=e.vec3_f32();e.seek(16),s.triangles.push({indices:[t,i,o],flags:n,normal:r})}e.seek_start(t+24)}return o})(new $o.a(e,zo.a.Little)))).then(e=>(function(e){const t=new y.Group;for(const i of e.meshes){const e=new y.Geometry;for(const{x:t,y:o,z:s}of i.vertices)e.vertices.push(new y.Vector3(t,o,s));for(const{indices:t,flags:o,normal:s}of i.triangles){const i=16&o,n=1&o,r=64&o?3:i?2:n?1:0;0!==r&&e.faces.push(new y.Face3(t[0],t[1],t[2],new y.Vector3(s.x,s.y,s.z),void 0,r))}if(e.faces.length){e.computeBoundingBox(),e.computeBoundingSphere();const i=new y.Mesh(e,gn);i.renderOrder=1,t.add(i);const o=new y.Mesh(e,bn);o.renderOrder=2,t.add(o)}}return t})(e))}load_render_object(e,t){return this.get_area_asset(e,t,"render").then(e=>(function(e){const t=[];e.seek_end(16);const{data_offset:i}=dn(e,!1);e.seek_start(i),e.seek(8);const o=e.u32();e.seek(4);const s=e.u32();for(let i=0;i<o;i++){e.seek_start(s+52*i);const o=e.i32(),n=e.vec3_f32(),r={x:e.u32()*cn.a,y:e.u32()*cn.a,z:e.u32()*cn.a};e.seek(4);const a=e.u32();e.seek(4);const d=e.u32(),c=ln(e,a,d);t.push({id:o,position:n,rotation:r,objects:c})}return{sections:t}})(new $o.a(e,zo.a.Little)))}get_area_asset(e,t,i){const o=function(e,t){let i=t.area.id,o=t.id;16===i&&1===o&&(i=17,o=1);const s=wn[e-1];if(0<=i&&i<s.length){const[t,n]=s[i];if(0<=o&&o<n){let e;return 1===n?e="":(e=String(o),e=e.padStart(2,"0")),`/maps/map_${t}${e}`}throw new Error(`Unknown variant ${o} of area ${i} in episode ${e}.`)}throw new Error(`Unknown episode ${e} area ${i}.`)}(e,t),s="render"===i?"n.rel":"c.rel";return this.http_client.get(o+s).array_buffer()}}const wn=[[["city00_00",1],["forest01",1],["forest02",1],["cave01_",6],["cave02_",5],["cave03_",6],["machine01_",6],["machine02_",6],["ancient01_",5],["ancient02_",5],["ancient03_",5],["boss01",1],["boss02",1],["boss03",1],["darkfalz00",1]],[["labo00_00",1],["ruins01_",3],["ruins02_",3],["space01_",3],["space02_",3],["jungle01_00",1],["jungle02_00",1],["jungle03_00",1],["jungle04_",3],["jungle05_00",1],["seabed01_",3],["seabed02_",3],["boss05",1],["boss06",1],["boss07",1],["boss08",1],["jungle06_00",1],["jungle07_",5]],[],[["city02_00",1],["wilds01_00",1],["wilds01_01",1],["wilds01_02",1],["wilds01_03",1],["crater01_00",1],["desert01_",3],["desert02_",3],["desert03_",3],["boss09_00",1]]];var kn=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};function yn(e){const t=[];return function(...i){const o=new Promise((e,o)=>t.push({args:i,resolve:e,reject:o}));return 1===t.length&&function(){kn(this,void 0,void 0,(function*(){for(;t.length;){const{args:i,resolve:o,reject:s}=t[0];try{o(yield e(...i))}catch(e){s(e)}finally{t.shift()}}}))}(),o}}var Rn=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const In=new y.HemisphereLight(16777215,5263440,1.2),xn=new y.Scene,jn=new y.PerspectiveCamera(30,1,10,2e3),Tn=new y.Vector3(1,1,2).normalize(),Cn=1.3/Math.tan(jn.fov/180*Math.PI/2);class Sn{constructor(e,t){this.entity_asset_loader=e,this.cache=new _n,this.render_to_image=yn(e=>this.entity_asset_loader.load_geometry(e).then(t=>this.entity_asset_loader.load_textures(e).then(i=>{xn.remove(...xn.children),xn.add(In);const o=E(e,t,[],new y.MeshBasicMaterial({color:2500134,side:y.DoubleSide}));xn.add(o);const s=o.geometry.boundingSphere;jn.position.copy(Tn),jn.position.multiplyScalar(s.radius*Cn),jn.lookAt(s.center),this.renderer.render(xn,jn),xn.remove(o);const n=E(e,t,i);return xn.add(n),this.renderer.autoClearColor=!1,this.renderer.render(xn,jn),this.renderer.autoClearColor=!0,this.renderer.domElement.toDataURL()}))),this.renderer=t(),this.renderer.setSize(100,100)}dispose(){this.renderer.dispose(),this.cache.dispose()}render(e){return Rn(this,void 0,void 0,(function*(){return this.cache.get_or_set(e,()=>this.render_to_image(e))}))}}var On=i(518),Ln=i(545),Dn=i(135);const Bn=Y.a.get("quest_editor/loading/EntityAssetLoader"),Pn=new y.CylinderBufferGeometry(3,3,20);Pn.translate(0,10,0),Pn.computeBoundingBox(),Pn.computeBoundingSphere();const En=Dn.a.resolve(Pn),Mn=[],Wn=Dn.a.resolve(Mn);class qn{constructor(e){this.http_client=e,this.disposer=new a.a,this.geom_cache=this.disposer.add(new _n),this.tex_cache=this.disposer.add(new _n),this.warm_up_caches()}dispose(){this.disposer.dispose()}load_geometry(e){return this.geom_cache.get_or_set(e,()=>Dn.a.all(function(e){switch(e){case w.Teleporter:case w.Warp:case w.BossTeleporter:case w.QuestWarp:case w.Epilogue:case w.MainRagolTeleporter:case w.PrincipalWarp:case w.TeleporterDoor:case w.EasterEgg:return[void 0,2];case w.ValentinesHeart:return[void 0,2,3];case w.ChristmasTree:return[void 0,2,3,4];case w.TwentyFirstCentury:return[void 0,2];case w.WelcomeBoard:return[void 0];case w.ForestDoor:return[void 0,2,3,4,5];case w.ForestSwitch:return[void 0,2,3];case w.LaserFence:case w.LaserSquareFence:return[void 0,2];case w.ForestLaserFenceSwitch:return[void 0,2,3];case w.Probe:return[0];case w.RandomTypeBox1:return[2];case w.BlackSlidingDoor:case w.EnergyBarrier:case w.SwitchNoneDoor:return[void 0,2];case w.EnemyBoxGrey:return[2];case w.FixedTypeBox:case w.EnemyBoxBrown:return[3];case w.LaserFenceEx:case w.LaserSquareFenceEx:return[void 0,2];case w.CavesSmashingPillar:return[void 0,3];case w.RobotRechargeStation:return[void 0,2];case w.RuinsTeleporter:return[void 0,2,3,4];case w.RuinsWarpSiteToSite:case w.RuinsSwitch:return[void 0,2];case w.RuinsPillarTrap:return[void 0,2,3,4];case w.RuinsCrystal:return[void 0,2,3];case w.FloatingRocks:return[0];case w.ItemBoxCca:return[void 0,3];case w.TeleporterEp2:case w.CCADoor:return[void 0,2];case w.SpecialBoxCCA:return[void 0,4];case w.BigCCADoor:return[void 0,2,3,4];case w.BigCCADoorSwitch:case w.LaserDetect:case w.LabCeilingWarp:return[void 0,2];case w.BigBrownRock:return[0];case w.BigBlackRocks:return[void 0];case w.BeeHive:return[void 0,0,1];default:return[void 0]}}(e).map(t=>this.load_data(e,Fn.Geometry,t).then(({url:t,data:i})=>{const o=new $o.a(i,zo.a.Little),s=t.endsWith(".nj")?Object(cn.c)(o):Object(cn.d)(o);return s.success&&s.value.length?s.value:(Bn.warn(`Couldn't parse ${t} for ${S(e)}.`),[])}).catch(t=>(Bn.warn(`Couldn't load geometry file for ${S(e)}.`,t),[])))).then(e=>{const t=e.flat(),i=t[0];for(let e=1;e<t.length;e++)i.evaluation_flags.break_child_trace=!1,i.add_child(t[e]);return i?Object(hn.a)(i):Pn}))}load_textures(e){return this.tex_cache.get_or_set(e,()=>this.load_data(e,Fn.Texture,function(e){switch(e){case w.FloatingRocks:case w.BigBrownRock:return 0;default:return}}(e)).then(({data:e})=>{const t=new $o.a(e,zo.a.Little),i=Object(On.b)(t);return i.success?Object(Ln.a)(i.value):[]}).catch(t=>(Bn.warn(`Couldn't load texture file for ${S(e)}.`,t),Mn)))}load_data(e,t,i){const o=function e(t,i,o){const s=null==o?"":`-${o}`;if(O(t))switch(t){case I.c.Dubswitch:return`/npcs/${I.c[t]}.${i===Fn.Geometry?"xj":"xvm"}`;case I.c.Hildebear2:return e(I.c.Hildebear,i,o);case I.c.Hildeblue2:return e(I.c.Hildeblue,i,o);case I.c.RagRappy2:return e(I.c.RagRappy,i,o);case I.c.Monest2:return e(I.c.Monest,i,o);case I.c.Mothmant2:return e(I.c.Mothmant,i,o);case I.c.PoisonLily2:return e(I.c.PoisonLily,i,o);case I.c.NarLily2:return e(I.c.NarLily,i,o);case I.c.GrassAssassin2:return e(I.c.GrassAssassin,i,o);case I.c.Dimenian2:return e(I.c.Dimenian,i,o);case I.c.LaDimenian2:return e(I.c.LaDimenian,i,o);case I.c.SoDimenian2:return e(I.c.SoDimenian,i,o);case I.c.DarkBelra2:return e(I.c.DarkBelra,i,o);case I.c.SavageWolf2:return e(I.c.SavageWolf,i,o);case I.c.BarbarousWolf2:return e(I.c.BarbarousWolf,i,o);case I.c.PanArms2:return e(I.c.PanArms,i,o);case I.c.Dubchic2:return e(I.c.Dubchic,i,o);case I.c.Gilchic2:return e(I.c.Gilchic,i,o);case I.c.Garanz2:return e(I.c.Garanz,i,o);case I.c.Dubswitch2:return e(I.c.Dubswitch,i,o);case I.c.Delsaber2:return e(I.c.Delsaber,i,o);case I.c.ChaosSorcerer2:return e(I.c.ChaosSorcerer,i,o);default:return`/npcs/${I.c[t]}${s}.${i===Fn.Geometry?"nj":"xvm"}`}else{if(i!==Fn.Geometry)return`/objects/${j(t).pso_id}${s}.xvm`;switch(t){case w.EasterEgg:case w.ChristmasTree:case w.ChristmasWreath:case w.TwentyFirstCentury:case w.Sonic:case w.WelcomeBoard:case w.FloatingJellyfish:case w.RuinsSeal:case w.Dolphin:case w.Cactus:case w.BigBrownRock:case w.PoisonPlant:case w.BigBlackRocks:case w.FallingRock:case w.DesertFixedTypeBoxBreakableCrystals:case w.BeeHive:return`/objects/${j(t).pso_id}${s}.nj`;default:return`/objects/${j(t).pso_id}${s}.xj`}}}(e,t,i);return this.http_client.get(o).array_buffer().then(e=>({url:o,data:e}))}warm_up_caches(){for(const e of[I.c.Unknown,I.c.Migium,I.c.Hidoom,I.c.DeathGunner,I.c.StRappy,I.c.HalloRappy,I.c.EggRappy,I.c.Migium2,I.c.Hidoom2,I.c.Recon,w.Unknown,w.PlayerSet,w.Particle,w.LightCollision,w.EnvSound,w.FogCollision,w.EventCollision,w.CharaCollision,w.ObjRoomID,w.LensFlare,w.ScriptCollision,w.MapCollision,w.ScriptCollisionA,w.ItemLight,w.RadarCollision,w.FogCollisionSW,w.ImageBoard,w.UnknownItem29,w.UnknownItem30,w.UnknownItem31,w.MenuActivation,w.BoxDetectObject,w.SymbolChatObject,w.TouchPlateObject,w.TargetableObject,w.EffectObject,w.CountDownObject,w.UnknownItem38,w.UnknownItem39,w.UnknownItem40,w.UnknownItem41,w.TelepipeLocation,w.BGMCollision,w.Pioneer2InvisibleTouchplate,w.TempleMapDetect,w.Firework,w.MainRagolTeleporterBattleInNextArea,w.Rainbow,w.FloatingBlueLight,w.PopupTrapNoTech,w.Poison,w.EnemyTypeBoxYellow,w.EnemyTypeBoxBlue,w.EmptyTypeBoxBlue,w.FloatingSoul,w.Butterfly,w.UnknownItem400,w.CCAAreaTeleporter,w.UnknownItem523,w.WhiteBird,w.OrangeBird,w.UnknownItem529,w.UnknownItem530,w.Seagull,w.UnknownItem576,w.WarpInBarbaRayRoom,w.UnknownItem672,w.InstaWarp,w.LabInvisibleObject,w.UnknownItem700,w.Ep4LightSource,w.BreakableBrownRock,w.UnknownItem897,w.UnknownItem898,w.OozingDesertPlant,w.UnknownItem901,w.UnknownItem903,w.UnknownItem904,w.UnknownItem905,w.UnknownItem906,w.DesertPlantHasCollision,w.UnknownItem910,w.UnknownItem912,w.Heat,w.TopOfSaintMillionEgg,w.UnknownItem961])this.geom_cache.set(e,En),this.tex_cache.set(e,Wn)}}var Fn;!function(e){e[e.Geometry=0]="Geometry",e[e.Texture=1]="Texture"}(Fn||(Fn={}));var Vn=i(586),zn=i(84),Un=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const $n="QuestEditorUiPersister.layout_config";class An extends Vn.a{constructor(){super(...arguments),this.persist_layout_config=Object(zn.throttle)(e=>{this.persist($n,this.to_persisted_item_config(e))},500,{leading:!1,trailing:!0})}load_layout_config(e){return Un(this,void 0,void 0,(function*(){const t=yield this.load($n);if(t){const i=this.extract_components(e),o=this.sanitized_layout_config(this.from_persisted_item_config(t),i);if(o)return o}}))}sanitized_layout_config(e,t){const i=new Set,o=e.map(e=>this.sanitize_layout_child(e,t,i));if(i.size===t.size)return o.filter(e=>e)}sanitize_layout_child(e,t,i){if(!e)return;switch(e.type){case"component":{if(!("componentName"in e))return;const o=t.get(e.componentName);if(!o)return;i.add(e.componentName),e.id=o.id,e.title=o.title}break;case"stack":if(null==e.content||0===e.content.length)return}e.content&&(e.content=e.content.map(e=>this.sanitize_layout_child(e,t,i)).filter(e=>e));const o=e;return null!=o.activeItemIndex&&(null==o.content||o.activeItemIndex>=o.content.length)&&(o.activeItemIndex=void 0),e}extract_components(e,t=new Map){for(const i of e)"componentName"in i&&t.set(i.componentName,i),i.content&&this.extract_components(i.content,t);return t}to_persisted_item_config(e){return e.map(e=>({id:e.id,type:e.type,componentName:e.componentName,width:e.width,height:e.height,activeItemIndex:e.activeItemIndex,content:e.content&&this.to_persisted_item_config(e.content)}))}from_persisted_item_config(e){return e.map(e=>({id:e.id,type:e.type,componentName:e.componentName,width:e.width,height:e.height,activeItemIndex:e.activeItemIndex,content:e.content&&this.from_persisted_item_config(e.content),isClosable:"component"!==e.type&&void 0}))}}var Nn=i(546),Gn=i(530),Hn=(i(796),i(548));class Qn extends p.a{constructor(e){super();const t=new at({text:"New quest",icon_left:u.a.NewFile,items:[n.b.I],to_label:e=>`Episode ${n.b[e]}`}),i=new Nn.a({icon_left:u.a.File,text:"Open file...",accept:".bin, .dat, .qst",multiple:!0,tooltip:"Open a quest file (Ctrl-O)"}),o=new Je.a({text:"Save as...",icon_left:u.a.Save,tooltip:"Save this quest to new file (Ctrl-Shift-S)"}),s=new Je.a({text:"Undo",icon_left:u.a.Undo,tooltip:Is.first_undo.map(e=>(e?`Undo "${e.description}"`:"Nothing to undo")+" (Ctrl-Z)")}),r=new Je.a({text:"Redo",icon_left:u.a.Redo,tooltip:Is.first_redo.map(e=>(e?`Redo "${e.description}"`:"Nothing to redo")+" (Ctrl-Shift-Z)")}),a=new ds.a({items:e.areas,to_label:({label:e})=>e}),d=new Je.a({text:"Debug",icon_left:u.a.Play,tooltip:"Debug the current quest in a virtual machine (F5)"}),l=new Je.a({text:"Continue",icon_left:u.a.SquareArrowRight,tooltip:"Resume execution (F6)"}),_=new Je.a({text:"Step over",icon_left:u.a.LongArrowRight,tooltip:"Execute the next line and step over any function calls (F8)"}),h=new Je.a({text:"Step into",icon_left:u.a.LevelDown,tooltip:"Execute the next line and step inside any function calls (F7)"}),v=new Je.a({text:"Step out",icon_left:u.a.LevelUp,tooltip:"Execute until outside of current call frame (Shift-F8)"}),p=new Je.a({text:"Stop",icon_left:u.a.Stop,tooltip:"Stop execution (Shift-F5)"}),g=this.disposable(new Hn.a({visible:e.result_dialog_visible,result:e.result,problems_message:e.result_problems_message,error_message:e.result_error_message})),b=[t,i,o,s,r,a];e.vm_feature_active&&b.push(d,l,_,h,v,p),this.toolbar=this.disposable(new We.a(...b));const f=this.disposable(new c(e.filename.val,{label:"File name:"})),m=this.disposable(new ds.a({label:"Version:",items:[Co.GC,Co.BB],selected:e.version,to_label:e=>{switch(e){case Co.DC:return"Dreamcast";case Co.GC:return"GameCube";case Co.PC:return"PC";case Co.BB:return"BlueBurst"}}})),w=this.disposable(new Je.a({text:"Save"})),k=this.disposable(new Je.a({text:"Cancel"})),y=this.disposable(new Gn.a({title:"Save As",visible:e.save_as_dialog_visible,content:Object(u.h)({className:"quest_editor_QuestEditorToolBarView_save_as_dialog_content"},f.label.element,f.element,m.label.element,m.element),footer:[w.element,k.element]}));y.element.addEventListener("keydown",t=>{"Enter"===t.key&&e.save_as()}),this.disposables(t.chosen.observe(({value:t})=>e.create_new_quest(t)),i.files.observe(({value:t})=>e.parse_files(t)),o.onclick.observe(e.save_as_clicked),o.enabled.bind_to(e.can_save),y.ondismiss.observe(e.dismiss_save_as_dialog),f.value.bind_to(e.filename),f.value.observe(({value:t})=>e.set_filename(t)),m.selected.observe(({value:t})=>{null!=t&&e.set_version(t)}),w.onclick.observe(e.save_as),k.onclick.observe(e.dismiss_save_as_dialog),s.onclick.observe(()=>Is.undo()),s.enabled.bind_to(e.can_undo),r.onclick.observe(()=>Is.redo()),r.enabled.bind_to(e.can_redo),a.selected.bind_to(e.current_area),a.selected.observe(({value:t})=>e.set_area(t)),a.enabled.bind_to(e.can_select_area),d.onclick.observe(e.debug),d.enabled.bind_to(e.can_debug),l.onclick.observe(e.resume),l.enabled.bind_to(e.can_step),_.onclick.observe(e.step_over),_.enabled.bind_to(e.can_step),h.onclick.observe(e.step_in),h.enabled.bind_to(e.can_step),v.onclick.observe(e.step_out),v.enabled.bind_to(e.can_step),p.onclick.observe(e.stop),p.enabled.bind_to(e.can_stop),g.ondismiss.observe(e.dismiss_result_dialog)),this.finalize_construction()}get element(){return this.toolbar.element}get height(){return this.toolbar.height}}var Yn=i(141);const Xn=Y.a.get("quest_editor/model/QuestModel");class Jn{constructor(e,t,i,o,s,r,a,d,c,l,_,u,h,v){this.area_store=e,this._id=Object(M.e)(0),this._language=Object(M.e)(0),this._name=Object(M.e)(""),this._short_description=Object(M.e)(""),this._long_description=Object(M.e)(""),this._area_variants=Object(M.c)(),this.id=this._id,this.language=this._language,this.name=this._name,this.short_description=this._short_description,this.long_description=this._long_description,this.area_variants=this._area_variants,this.update_area_variants=()=>{const e=new Map;for(const t of this.entities_per_area.val.keys())try{e.set(t,this.area_store.get_variant(this.episode,t,0))}catch(e){Xn.warn(e)}for(const[t,i]of this.map_designations.val)try{e.set(t,this.area_store.get_variant(this.episode,t,i))}catch(e){Xn.warn(e)}this._area_variants.val=[...e.values()]},Object(n.c)(a),Object(q.f)(d,"map_designations"),Object(q.j)(c,"objs"),Object(q.j)(l,"npcs"),Object(q.f)(_,"event_dags"),Object(q.j)(u,"dat_unknowns"),Object(q.j)(h,"object_code"),Object(q.j)(v,"shop_items"),this.set_id(t),this.set_language(i),this.set_name(o),this.set_short_description(s),this.set_long_description(r),this.episode=a,this._map_designations=Object(M.e)(d),this.map_designations=this._map_designations,this._objects=Object(M.c)(void 0,...c),this.objects=this._objects,this._npcs=Object(M.c)(void 0,...l),this.npcs=this._npcs,this.event_dags=_,this.dat_unknowns=u,this.object_code=h,this.shop_items=v,this.entities_per_area=Object(M.d)((e,t)=>{const i=new Map;for(const t of e)i.set(t.area_id,(i.get(t.area_id)||0)+1);for(const e of t)i.set(e.area_id,(i.get(e.area_id)||0)+1);return i},this.npcs,this.objects),this.entities_per_area.observe(this.update_area_variants,{call_now:!0}),this.map_designations.observe(this.update_area_variants,{call_now:!0})}set_id(e){return Object(q.d)(e>=0,`id should be greater than or equal to 0, was ${e}.`),this._id.val=e,this}set_language(e){return Object(q.d)(e>=0,`language should be greater than or equal to 0, was ${e}.`),this._language.val=e,this}set_name(e){return Object(q.d)(e.length<=32,`name can't be longer than 32 characters, got "${e}".`),this._name.val=e,this}set_short_description(e){return Object(q.d)(e.length<=128,`short_description can't be longer than 128 characters, got "${e}".`),this._short_description.val=e,this}set_long_description(e){return Object(q.d)(e.length<=288,`long_description can't be longer than 288 characters, got "${e}".`),this._long_description.val=e,this}set_map_designations(e){return this._map_designations.val=e,this}add_entity(e){if(e instanceof pe)this.add_object(e);else{if(!(e instanceof N))throw new Error(`${S(e.type)} not supported.`);this.add_npc(e)}}add_object(e){this._objects.push(e)}add_npc(e){this._npcs.push(e)}remove_entity(e){if(e instanceof pe)this._objects.remove(e);else{if(!(e instanceof N))throw new Error(`${S(e.type)} not supported.`);this._npcs.remove(e)}}insert_event(e,t,i,o){const s=t.wave.area_id.val;let n=this.event_dags.get(s);n||(n=new Ke(s),this.event_dags.set(s,n)),n.insert_event(e,t,i,o)}get_event_dag_or_create(e){let t=this.event_dags.get(e);return t||(t=new Ke(e),this.event_dags.set(e,t)),t}add_event(e,t,i){const o=e.wave.area_id.val;let s=this.event_dags.get(o);s||(s=new Ke(o),this.event_dags.set(o,s)),s.add_event(e,t,i)}remove_event(e,t){for(const e of this.npcs)e.wave.val===t.wave&&e.set_wave(void 0);e.remove_event(t)}}var Kn;!function(e){e[e.Int=0]="Int",e[e.Float=1]="Float",e[e.InvalidNumber=2]="InvalidNumber",e[e.Register=3]="Register",e[e.Label=4]="Label",e[e.CodeSection=5]="CodeSection",e[e.DataSection=6]="DataSection",e[e.StringSection=7]="StringSection",e[e.InvalidSection=8]="InvalidSection",e[e.String=9]="String",e[e.UnterminatedString=10]="UnterminatedString",e[e.Ident=11]="Ident",e[e.InvalidIdent=12]="InvalidIdent",e[e.ArgSeparator=13]="ArgSeparator"}(Kn||(Kn={}));class Zn{constructor(){this.index=0,this._mark=0}get col(){return this.index+1}tokenize_line(e){this.line=e,this.index=0,this._mark=0;const t=[];for(;this.has_next();){const e=this.peek();let i;if("/"===e){if(this.skip(),"/"===this.peek())break;this.back()}/\s/.test(e)?this.skip():(/[-\d]/.test(e)?i=this.tokenize_number_or_label():","===e?(i={type:Kn.ArgSeparator,col:this.col,len:1},this.skip()):i="."===e?this.tokenize_section():'"'===e?this.tokenize_string():"r"===e?this.tokenize_register_or_ident():this.tokenize_ident(),t.push(i))}return t}has_next(){return this.index<this.line.length}next(){return this.line.charAt(this.index++)}peek(){return this.line.charAt(this.index)}skip(){this.index++}back(){this.index--}mark(){this._mark=this.index}marked_len(){return this.index-this._mark}slice(){return this.line.slice(this._mark,this.index)}eat_rest_of_token(){for(;this.has_next();){const e=this.next();if(/[\s,]/.test(e)){this.back();break}}}tokenize_number_or_label(){this.mark();const e=this.col;this.skip();let t=!1;for(;this.has_next();){const i=this.peek();if("."===i||"e"===i)return this.tokenize_float(e);if("x"===i)return this.tokenize_hex_number(e);if(":"===i){t=!0,this.skip();break}if(/[\s,]/.test(i))break;this.skip()}const i=parseInt(this.slice(),10);return{type:Number.isInteger(i)?t?Kn.Label:Kn.Int:Kn.InvalidNumber,col:e,len:this.marked_len(),value:i}}tokenize_hex_number(e){this.eat_rest_of_token();const t=this.slice();if(/^0x[\da-fA-F]+$/.test(t)){const i=parseInt(t,16);if(Number.isInteger(i))return{type:Kn.Int,col:e,len:this.marked_len(),value:i}}return{type:Kn.InvalidNumber,col:e,len:this.marked_len()}}tokenize_float(e){this.eat_rest_of_token();const t=this.slice();if(/^-?\d+(\.\d+)?(e-?\d+)?$/.test(t)){const i=parseFloat(t);if(Number.isFinite(i))return{type:Kn.Float,col:e,len:this.marked_len(),value:i}}return{type:Kn.InvalidNumber,col:e,len:this.marked_len()}}tokenize_register_or_ident(){const e=this.col;this.skip(),this.mark();let t=!1;for(;this.has_next();){const e=this.peek();if(!/\d/.test(e))break;t=!0,this.skip()}if(t){const t=parseInt(this.slice(),10);return{type:Kn.Register,col:e,len:this.marked_len()+1,value:t}}return this.back(),this.tokenize_ident()}tokenize_section(){const e=this.col;for(this.mark();this.has_next()&&!/\s/.test(this.peek());)this.skip();switch(this.slice()){case".code":return{type:Kn.CodeSection,col:e,len:5};case".data":return{type:Kn.DataSection,col:e,len:5};case".string":return{type:Kn.StringSection,col:e,len:7};default:return{type:Kn.InvalidSection,col:e,len:this.marked_len()}}}tokenize_string(){const e=this.col;this.mark(),this.skip();let t,i=!1,o=!1;e:for(;this.has_next();)switch(this.next()){case"\\":i=!0;break;case'"':if(!i){o=!0;break e}i=!1;break;default:i=!1}return t=o?JSON.parse(this.slice()):JSON.parse(this.slice()+'"'),{type:o?Kn.String:Kn.UnterminatedString,col:e,len:this.marked_len(),value:t}}tokenize_ident(){const e=this.col;for(this.mark();this.has_next();){const e=this.peek();if(/[\s,]/.test(e))break;if("/"===e){if(this.skip(),"/"===this.peek()){this.back();break}}else this.skip()}const t=this.slice(),i=/^[a-z][a-z0-9_=<>!]*$/.test(t)?Kn.Ident:Kn.InvalidIdent;return i===Kn.Ident?{type:i,col:e,len:this.marked_len(),value:t}:{type:i,col:e,len:this.marked_len()}}}const er=Y.a.get("quest_editor/scripting/assembly");class tr{constructor(e,t){this.assembly=e,this.manual_stack=t,this.lexer=new Zn,this.section=Oo.Instructions,this.first_section_marker=!0,this.prev_line_had_label=!1}assemble(){this.line_no=1,this.object_code=[],this.warnings=[],this.errors=[],this.labels=new Set,this.section=Oo.Instructions,this.first_section_marker=!0,this.prev_line_had_label=!1;for(const e of this.assembly){if(this.tokens=this.lexer.tokenize_line(e),this.tokens.length>0){const e=this.tokens.shift();let t=!1;switch(e.type){case Kn.Label:this.parse_label(e),t=!0;break;case Kn.CodeSection:case Kn.DataSection:case Kn.StringSection:this.parse_section(e);break;case Kn.Int:this.section===Oo.Data?this.parse_bytes(e):this.add_error({col:e.col,length:e.len,message:"Unexpected token."});break;case Kn.String:this.section===Oo.String?this.parse_string(e):this.add_error({col:e.col,length:e.len,message:"Unexpected token."});break;case Kn.Ident:this.section===Oo.Instructions?this.parse_instruction(e):this.add_error({col:e.col,length:e.len,message:"Unexpected token."});break;case Kn.InvalidSection:this.add_error({col:e.col,length:e.len,message:"Invalid section type."});break;case Kn.InvalidIdent:this.add_error({col:e.col,length:e.len,message:"Invalid identifier."});break;default:this.add_error({col:e.col,length:e.len,message:"Unexpected token."})}this.prev_line_had_label=t}this.line_no++}return{object_code:this.object_code,warnings:this.warnings,errors:this.errors}}add_instruction(e,t,i,o,s,n){if(this.segment)this.segment.type===Oo.Instructions?this.segment.instructions.push(Do(e,t,{mnemonic:o&&{line_no:this.line_no,col:o.col,len:o.len},args:s.map(e=>({line_no:this.line_no,col:e.col,len:e.len})),stack_args:n.map((e,t)=>({line_no:this.line_no,col:e.col,len:e.len,value:i[t].value}))})):er.error(`Line ${this.line_no}: Expected instructions segment.`);else{const e={labels:[],type:Oo.Instructions,instructions:[],asm:{labels:[]}};this.segment=e,this.object_code.push(e)}}add_bytes(e){if(this.segment)if(this.segment.type===Oo.Data){const t=new ArrayBuffer(this.segment.data.byteLength+e.length),i=new Uint8Array(t);i.set(new Uint8Array(this.segment.data)),i.set(new Uint8Array(e),this.segment.data.byteLength),this.segment.data=t}else er.error(`Line ${this.line_no}: Expected data segment.`);else{const t={labels:[],type:Oo.Data,data:new Uint8Array(e).buffer,asm:{labels:[]}};this.segment=t,this.object_code.push(t)}}add_string(e){if(this.segment)this.segment.type===Oo.String?this.segment.value+=e:er.error(`Line ${this.line_no}: Expected string segment.`);else{const t={labels:[],type:Oo.String,value:e,asm:{labels:[]}};this.segment=t,this.object_code.push(t)}}add_error({col:e,length:t,message:i}){this.errors.push({line_no:this.line_no,col:e,length:t,message:i})}add_warning({col:e,length:t,message:i}){this.warnings.push({line_no:this.line_no,col:e,length:t,message:i})}parse_label({col:e,len:t,value:i}){this.labels.has(i)&&this.add_error({col:e,length:t,message:"Duplicate label."}),this.labels.add(i);const o=this.tokens.shift(),s={line_no:this.line_no,col:e,len:t};if(this.prev_line_had_label){const e=this.object_code[this.object_code.length-1];e.labels.push(i),e.asm.labels.push(s)}switch(this.section){case Oo.Instructions:this.prev_line_had_label||(this.segment={type:Oo.Instructions,labels:[i],instructions:[],asm:{labels:[s]}},this.object_code.push(this.segment)),o&&(o.type===Kn.Ident?this.parse_instruction(o):this.add_error({col:o.col,length:o.len,message:"Expected opcode mnemonic."}));break;case Oo.Data:this.prev_line_had_label||(this.segment={type:Oo.Data,labels:[i],data:new ArrayBuffer(0),asm:{labels:[s]}},this.object_code.push(this.segment)),o&&(o.type===Kn.Int?this.parse_bytes(o):this.add_error({col:o.col,length:o.len,message:"Expected bytes."}));break;case Oo.String:this.prev_line_had_label||(this.segment={type:Oo.String,labels:[i],value:"",asm:{labels:[s]}},this.object_code.push(this.segment)),o&&(o.type===Kn.String?this.parse_string(o):this.add_error({col:o.col,length:o.len,message:"Expected a string."}))}}parse_section({type:e,col:t,len:i}){let o;switch(e){case Kn.CodeSection:o=Oo.Instructions;break;case Kn.DataSection:o=Oo.Data;break;case Kn.StringSection:o=Oo.String}this.section!==o||this.first_section_marker||this.add_warning({col:t,length:i,message:"Unnecessary section marker."}),this.section=o,this.first_section_marker=!1;const s=this.tokens.shift();s&&this.add_error({col:s.col,length:s.len,message:"Unexpected token."})}parse_instruction(e){const{col:t,len:i,value:o}=e,s=Et.get(o);if(s){const i=-1!==s.params.findIndex(e=>e.type.kind===vt.ILabelVar||e.type.kind===vt.RegRefVar),o=this.manual_stack&&s.stack===Dt.Pop?0:s.params.length;let n=0;for(const e of this.tokens)e.type!==Kn.ArgSeparator&&n++;const r=this.tokens[this.tokens.length-1],a=r?r.col+r.len-t:0,d=[],c=[];if(!i&&n!==o)return void this.add_error({col:t,length:a,message:`Expected ${o} argument${1===o?"":"s"}, got ${n}.`});if(i&&n<o)return void this.add_error({col:t,length:a,message:`Expected at least ${o} argument${1===o?"":"s"}, got ${n}.`});if(s.stack!==Dt.Pop){if(!this.parse_args(s.params,d,!1))return}else{if(!this.parse_args(s.params,c,!0))return;for(let e=0;e<s.params.length;e++){const t=s.params[e],i=c[e];if(null==i)continue;const[o,n]=i;if(n.type===Kn.Register)t.type.kind===vt.RegTupRef?this.add_instruction(Hi,[o],[],void 0,[n],[]):this.add_instruction(Ni,[o],[],void 0,[n],[]);else switch(t.type.kind){case vt.Byte:case vt.RegRef:case vt.RegTupRef:this.add_instruction(Hi,[o],[],void 0,[n],[]);break;case vt.Word:case vt.Label:case vt.ILabel:case vt.DLabel:case vt.SLabel:this.add_instruction(Qi,[o],[],void 0,[n],[]);break;case vt.DWord:this.add_instruction(Gi,[o],[],void 0,[n],[]);break;case vt.Float:this.add_instruction(Gi,[{value:Us(o.value)}],[],void 0,[n],[]);break;case vt.String:this.add_instruction(Ji,[o],[],void 0,[n],[]);break;default:er.error(`Line ${this.line_no}: Type ${vt[t.type.kind]} not implemented.`)}}}const l=[],_=[],u=[],h=[];for(const[e,t]of d)l.push(e),_.push(t);for(const[e,t]of c)u.push(e),h.push(t);this.add_instruction(s,l,u,e,_,h)}else this.add_error({col:t,length:i,message:"Unknown instruction."})}parse_args(e,t,i){let o=!0,s=!0,n=0;for(let r=0;r<this.tokens.length;r++){const a=this.tokens[r],d=e[n];if(a.type===Kn.ArgSeparator)s?this.add_error({col:a.col,length:a.len,message:"Expected an argument."}):d.type.kind!==vt.ILabelVar&&d.type.kind!==vt.RegRefVar&&n++,s=!0;else{if(!s){const e=this.tokens[r-1],t=e.col+e.len;this.add_error({col:t,length:a.col-t,message:"Expected a comma."})}let e;switch(s=!1,a.type){case Kn.Int:switch(d.type.kind){case vt.Byte:e=!0,this.parse_int(1,a,t);break;case vt.Word:case vt.Label:case vt.ILabel:case vt.DLabel:case vt.SLabel:case vt.ILabelVar:e=!0,this.parse_int(2,a,t);break;case vt.DWord:e=!0,this.parse_int(4,a,t);break;case vt.Float:e=!0,t.push([{value:a.value},a]);break;default:e=!1}break;case Kn.Float:e=d.type.kind===vt.Float,e&&t.push([{value:a.value},a]);break;case Kn.Register:e=i||d.type.kind===vt.RegRef||d.type.kind===vt.RegRefVar||d.type.kind===vt.RegTupRef,this.parse_register(a,t);break;case Kn.String:e=d.type.kind===vt.String,e&&t.push([{value:a.value},a]);break;default:e=!1}if(!e){let e;switch(o=!1,d.type.kind){case vt.Byte:e="an 8-bit integer";break;case vt.Word:e="a 16-bit integer";break;case vt.DWord:e="a 32-bit integer";break;case vt.Float:e="a float";break;case vt.Label:e="a label";break;case vt.ILabel:case vt.ILabelVar:e="an instruction label";break;case vt.DLabel:e="a data label";break;case vt.SLabel:e="a string label";break;case vt.String:e="a string";break;case vt.RegRef:case vt.RegRefVar:case vt.RegTupRef:e="a register reference"}e?this.add_error({col:a.col,length:a.len,message:`Expected ${e}.`}):this.add_error({col:a.col,length:a.len,message:"Unexpected token."})}}}return this.tokens=[],o}parse_int(e,t,i){const{value:o,col:s,len:n}=t,r=8*e,a=-Math.pow(2,r-1),d=Math.pow(2,r)-1;o<a?this.add_error({col:s,length:n,message:`${r}-Bit integer can't be less than ${a}.`}):o>d?this.add_error({col:s,length:n,message:`${r}-Bit integer can't be greater than ${d}.`}):i.push([{value:o},t])}parse_register(e,t){const{col:i,len:o,value:s}=e;s>255?this.add_error({col:i,length:o,message:"Invalid register reference, expected r0-r255."}):t.push([{value:s},e])}parse_bytes(e){const t=[];let i=e,o=0;for(;i.type===Kn.Int&&(i.value<0?this.add_error({col:i.col,length:i.len,message:"Unsigned 8-bit integer can't be less than 0."}):i.value>255&&this.add_error({col:i.col,length:i.len,message:"Unsigned 8-bit integer can't be greater than 255."}),t.push(i.value),o<this.tokens.length);)i=this.tokens[o++];o<this.tokens.length&&this.add_error({col:i.col,length:i.len,message:"Expected an unsigned 8-bit integer."}),this.add_bytes(t)}parse_string(e){const t=this.tokens.shift();t&&this.add_error({col:t.col,length:t.len,message:"Unexpected token."}),this.add_string(e.value.replace(/\n/g,"<cr>"))}}function ir(e,t){if(t===n.b.II)throw new Error("Episode II not yet supported.");if(t===n.b.IV)throw new Error("Episode IV not yet supported.");return new Jn(e,0,0,"Untitled","Created with phantasmal.world.","Created with phantasmal.world.",t,(new Map).set(0,0),[new pe(w.MenuActivation,16384,0,0,10,new y.Vector3(-16.313568115234375,3,-579.5118408203125),F(.0009587526218325454,0,0),new Map([["property_0",1],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365279104]]),[[2,0,0,0,0,0],[0,0]]),new pe(w.MenuActivation,16385,0,0,10,new y.Vector3(-393.07318115234375,10,-12.964752197265625),F(0,0,0),new Map([["property_0",9183549615799121e-56],["property_1",1.0000011920928955],["property_2",1],["property_3",0],["property_4",0],["property_5",0],["property_6",2365279264]]),[[2,0,1,0,0,0],[0,0]]),new pe(w.MenuActivation,16386,0,0,10,new y.Vector3(-458.60699462890625,10,-51.270660400390625),F(0,0,0),new Map([["property_0",1],["property_1",1],["property_2",1],["property_3",2],["property_4",65536],["property_5",10],["property_6",2365279424]]),[[2,0,2,0,0,0],[0,0]]),new pe(w.MenuActivation,16387,0,0,10,new y.Vector3(-430.19696044921875,10,-24.490447998046875),F(0,0,0),new Map([["property_0",1],["property_1",1],["property_2",1],["property_3",3],["property_4",0],["property_5",0],["property_6",2365279584]]),[[2,0,3,0,0,0],[0,0]]),new pe(w.PlayerSet,16388,0,0,10,new y.Vector3(.995330810546875,0,-37.0010986328125),F(0,4.712460886831327,0),new Map([["property_0",0],["property_1",1],["property_2",1],["property_3",0],["property_4",0],["property_5",0],["property_6",2365279744]]),[[2,0,4,0,0,0],[0,0]]),new pe(w.PlayerSet,16389,0,0,10,new y.Vector3(3.0009307861328125,0,-23.99688720703125),F(0,4.859725289544806,0),new Map([["property_0",1.000000238418579],["property_1",1],["property_2",1],["property_3",0],["property_4",0],["property_5",0],["property_6",2365279904]]),[[2,0,5,0,0,0],[0,0]]),new pe(w.PlayerSet,16390,0,0,10,new y.Vector3(2.0015106201171875,0,-50.00386047363281),F(0,4.565196484117848,0),new Map([["property_0",2.000002384185791],["property_1",1],["property_2",1],["property_3",0],["property_4",0],["property_5",0],["property_6",2365280064]]),[[2,0,6,0,0,0],[0,0]]),new pe(w.PlayerSet,16391,0,0,10,new y.Vector3(4.9973907470703125,0,-61.99664306640625),F(0,4.368843947166543,0),new Map([["property_0",3.0000007152557373],["property_1",1],["property_2",1],["property_3",65536],["property_4",10],["property_5",0],["property_6",2365280224]]),[[2,0,7,0,0,0],[0,0]]),new pe(w.MainRagolTeleporter,18264,0,0,10,new y.Vector3(132.00314331054688,1.000000238418579,-265.002197265625),F(0,.49088134237826325,0),new Map([["property_0",1.000000238418579],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365227216]]),[[0,0,87,7,0,0],[0,0]]),new pe(w.PrincipalWarp,16393,0,0,10,new y.Vector3(-228,0,-2020.99951171875),F(0,2.9452880542695796,0),new Map([["property_0",-10.000004768371582],["property_1",0],["property_2",-30.000030517578125],["property_3",0],["property_4",65536],["property_5",65536],["property_6",2365280688]]),[[2,0,9,0,0,0],[0,0]]),new pe(w.MenuActivation,16394,0,0,10,new y.Vector3(-41.000030517578125,0,42.37322998046875),F(0,0,0),new Map([["property_0",1],["property_1",1],["property_2",1],["property_3",4],["property_4",0],["property_5",0],["property_6",2365280992]]),[[2,0,10,0,0,0],[1,0]]),new pe(w.MenuActivation,16395,0,0,10,new y.Vector3(-479.21673583984375,8.781256675720215,-322.465576171875),F(6.28328118244177,.0009587526218325454,0),new Map([["property_0",1],["property_1",1],["property_2",1],["property_3",5],["property_4",0],["property_5",0],["property_6",2365281152]]),[[2,0,11,0,0,0],[0,0]]),new pe(w.PrincipalWarp,16396,0,0,10,new y.Vector3(-228,0,-351.0015869140625),F(0,0,0),new Map([["property_0",10.000006675720215],["property_1",0],["property_2",-1760.0010986328125],["property_3",32768],["property_4",0],["property_5",0],["property_6",2365281312]]),[[2,0,12,0,0,0],[0,0]]),new pe(w.TelepipeLocation,16397,0,0,10,new y.Vector3(-561.88232421875,0,-406.8829345703125),F(0,0,0),new Map([["property_0",1],["property_1",1],["property_2",1],["property_3",0],["property_4",0],["property_5",0],["property_6",2365281616]]),[[2,0,13,0,0,0],[0,0]]),new pe(w.TelepipeLocation,16398,0,0,10,new y.Vector3(-547.8557739257812,0,-444.8822326660156),F(0,0,0),new Map([["property_0",1],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365281808]]),[[2,0,14,0,0,0],[0,0]]),new pe(w.TelepipeLocation,16399,0,0,10,new y.Vector3(-486.441650390625,0,-497.4501647949219),F(0,0,0),new Map([["property_0",9183549615799121e-56],["property_1",1.0000011920928955],["property_2",1],["property_3",3],["property_4",0],["property_5",0],["property_6",2365282e3]]),[[2,0,15,0,0,0],[0,0]]),new pe(w.TelepipeLocation,16400,0,0,10,new y.Vector3(-522.4052734375,0,-474.1882629394531),F(0,0,0),new Map([["property_0",1],["property_1",1],["property_2",1],["property_3",2],["property_4",65536],["property_5",10],["property_6",2365282192]]),[[2,0,16,0,0,0],[0,0]]),new pe(w.MedicalCenterDoor,16401,0,0,10,new y.Vector3(-34.49853515625,0,-384.4951171875),F(0,5.497871034636549,0),new Map([["property_0",3.0000007152557373],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365282384]]),[[2,0,17,0,0,0],[0,0]]),new pe(w.ShopDoor,16402,0,0,10,new y.Vector3(-393.0031433105469,0,-143.49981689453125),F(0,3.141640591220885,0),new Map([["property_0",3.0000007152557373],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365282640]]),[[2,0,18,0,0,0],[0,0]]),new pe(w.MenuActivation,16403,0,0,10,new y.Vector3(-355.17462158203125,0,-43.15193176269531),F(0,0,0),new Map([["property_0",1.000000238418579],["property_1",1],["property_2",1],["property_3",6],["property_4",0],["property_5",0],["property_6",2365282896]]),[[2,0,19,0,0,0],[0,0]]),new pe(w.HuntersGuildDoor,16404,0,0,10,new y.Vector3(-43.00239562988281,0,-118.00120544433594),F(0,3.141640591220885,0),new Map([["property_0",3.0000007152557373],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365283056]]),[[2,0,20,0,0,0],[0,0]]),new pe(w.TeleporterDoor,16405,0,0,10,new y.Vector3(26.000823974609375,0,-265.99810791015625),F(0,3.141640591220885,0),new Map([["property_0",3.0000007152557373],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365283312]]),[[2,0,21,0,0,0],[0,0]]),new pe(w.PlayerSet,16406,0,0,10,new y.Vector3(57.81005859375,0,-268.5472412109375),F(0,4.712460886831327,0),new Map([["property_0",0],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365283568]]),[[2,0,22,0,0,0],[0,0]]),new pe(w.PlayerSet,16407,0,0,10,new y.Vector3(66.769287109375,0,-252.3748779296875),F(0,4.712460886831327,0),new Map([["property_0",1.000000238418579],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365283728]]),[[2,0,23,0,0,0],[0,0]]),new pe(w.PlayerSet,16408,0,0,10,new y.Vector3(67.36819458007812,0,-284.9297180175781),F(0,4.712460886831327,0),new Map([["property_0",2.000000476837158],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365283888]]),[[2,0,24,0,0,0],[0,0]]),new pe(w.PlayerSet,16409,0,0,10,new y.Vector3(77.10488891601562,0,-269.2830505371094),F(0,4.712460886831327,0),new Map([["property_0",3.0000007152557373],["property_1",1],["property_2",1],["property_3",1],["property_4",0],["property_5",0],["property_6",2365284048]]),[[2,0,25,0,0,0],[0,0]])],[new N(I.c.GuildLady,29,1011.0010986328125,void 0,0,850,0,0,10,new y.Vector3(-49.0010986328125,0,50.996429443359375),F(0,2.3562304434156633,0),new y.Vector3(0,0,0),[[0,0,7,86,0,0,0,0,23,87],[128,238,223,176]]),new N(I.c.FemaleFat,4,1016.0010986328125,void 0,0,100,1,0,20,new y.Vector3(167.99769592285156,0,83.99686431884766),F(0,3.927050739026106,0),new y.Vector3(24.000009536743164,0,0),[[0,0,7,88,0,0,0,0,23,89],[128,238,232,48]]),new N(I.c.MaleDwarf,10,1015.0010986328125,void 0,0,90,1,0,20,new y.Vector3(156.0028839111328,0,-49.99967575073242),F(0,5.497871034636549,0),new y.Vector3(30.000009536743164,0,0),[[0,0,7,89,0,0,0,0,23,90],[128,238,236,176]]),new N(I.c.RedSoldier,26,1020.0010986328125,void 0,0,130,0,0,20,new y.Vector3(237.9988250732422,0,-14.0001220703125),F(0,5.497871034636549,0),new y.Vector3(0,0,0),[[0,0,7,90,0,0,0,0,23,91],[128,238,241,48]]),new N(I.c.BlueSoldier,25,1019.0010986328125,void 0,0,120,0,0,20,new y.Vector3(238.00379943847656,0,63.00413513183594),F(0,3.927050739026106,0),new y.Vector3(0,0,0),[[0,0,7,91,0,0,0,0,23,92],[128,238,245,176]]),new N(I.c.FemaleMacho,5,1014.0010986328125,void 0,0,80,1,0,20,new y.Vector3(-2.001882553100586,0,35.0036506652832),F(0,3.141640591220885,0),new y.Vector3(26.000009536743164,0,0),[[0,0,7,92,0,0,0,0,23,93],[128,238,250,48]]),new N(I.c.Scientist,30,1013.0010986328125,void 0,0,70,1,0,20,new y.Vector3(-147.0000457763672,0,-7.996537208557129),F(0,2.577127047485882,0),new y.Vector3(30.000009536743164,0,0),[[0,0,7,93,0,0,0,0,23,94],[128,238,254,176]]),new N(I.c.MaleOld,13,1012.0010986328125,void 0,0,60,1,0,20,new y.Vector3(-219.99710083007812,0,-100.0008316040039),F(0,0,0),new y.Vector3(30.000011444091797,0,0),[[0,0,7,94,0,0,0,0,23,95],[128,239,3,48]]),new N(I.c.GuildLady,29,1010.0010986328125,void 0,0,840,0,0,20,new y.Vector3(-262.5099792480469,0,-24.53999900817871),F(0,1.963525369513053,0),new y.Vector3(0,0,0),[[0,0,7,95,0,0,0,0,23,106],[128,239,100,192]]),new N(I.c.Tekker,28,1009,void 0,0,830,0,0,30,new y.Vector3(-43.70983123779297,2.5999999046325684,-52.78248596191406),F(0,.7854101478052212,0),new y.Vector3(0,0,0),[[0,0,7,97,0,0,0,0,23,98],[128,239,16,176]]),new N(I.c.MaleMacho,12,1006,void 0,0,800,0,0,30,new y.Vector3(.33990478515625,2.5999999046325684,-84.71995544433594),F(0,0,0),new y.Vector3(0,0,0),[[0,0,7,98,0,0,0,0,23,99],[128,239,21,48]]),new N(I.c.FemaleMacho,5,1008,void 0,0,820,0,0,30,new y.Vector3(43.87113952636719,2.5999996662139893,-74.80299377441406),new y.Euler(0,-.5645135437350027,0,"ZXY"),new y.Vector3(0,0,0),[[0,0,7,99,0,0,0,0,23,100],[128,239,25,176]]),new N(I.c.MaleFat,11,1007.0010986328125,void 0,0,810,0,0,30,new y.Vector3(75.88380432128906,2.5999996662139893,-42.69328308105469),new y.Euler(0,-1.0308508189943528,0,"ZXY"),new y.Vector3(0,0,0),[[0,0,7,100,0,0,0,0,23,101],[128,239,30,48]]),new N(I.c.FemaleTall,7,1021.0010986328125,void 0,0,140,1,0,30,new y.Vector3(16.003997802734375,0,5.995697021484375),new y.Euler(0,-1.1781152217078317,0,"ZXY"),new y.Vector3(22.000009536743164,0,0),[[0,0,7,101,0,0,0,0,23,102],[128,239,34,176]]),new N(I.c.Nurse,31,1017,void 0,0,860,0,0,40,new y.Vector3(.3097381591796875,3,-105.3865966796875),F(0,0,0),new y.Vector3(0,0,0),[[0,0,7,102,0,0,0,0,23,103],[128,239,39,48]]),new N(I.c.Nurse,31,1018.0010986328125,void 0,0,110,1,0,40,new y.Vector3(53.499176025390625,0,-26.496688842773438),F(0,5.497871034636549,0),new y.Vector3(18.000009536743164,0,0),[[0,0,7,103,0,0,0,0,23,104],[128,239,43,176]])],new Map,[],function(e,t=!1){er.trace("assemble start");const i=new tr(e,t).assemble();return er.trace(`assemble end with ${i.warnings.length} warnings and ${i.errors.length} errors.`),i}(".code\n\n0:\n    set_episode 0\n    set_floor_handler 0, 150\n    bb_map_designate 0, 0, 0, 0\n    ret\n150:\n    leti r60, 237\n    leti r61, 0\n    leti r62, 333\n    leti r63, -15\n    p_setpos 0, r60\n    leti r60, 255\n    leti r61, 0\n    leti r62, 338\n    leti r63, -43\n    p_setpos 1, r60\n    leti r60, 222\n    leti r61, 0\n    leti r62, 322\n    leti r63, 25\n    p_setpos 2, r60\n    leti r60, 248\n    leti r61, 0\n    leti r62, 323\n    leti r63, -20\n    p_setpos 3, r60\n    ret".split("\n")).object_code,[])}var or=i(483),sr=i(484),nr=i(497);function rr(e){const t=new ar(e.size,e.endianness);for(;e.bytes_left;){let i=0,o=0;const s=Math.max(0,e.position-Math.min(2048,e.bytes_left));for(let t=e.position-255;t>=s;t--){let s=e.position,n=t,r=0;for(;s+3<e.size&&r<252&&e.u32_at(s)===e.u32_at(n);)r+=4,s+=4,n+=4;for(;s<e.size&&r<255&&e.u8_at(s)===e.u8_at(n);)r++,s++,n++;if(r>=o&&(i=t,o=r,r>=255))break}o<3?t.add_u8(e.u8()):(t.copy(i-e.position,o),e.seek(o))}return t.finalize()}class ar{constructor(e,t){this.flags=0,this.flag_bits_left=0,this.flag_offset=0,this.output=new sr.a(new nr.a(e),t)}add_u8(e){this.write_control_bit(1),this.write_u8(e)}copy(e,t){e>-256&&t<=5?this.short_copy(e,t):this.long_copy(e,t)}finalize(){this.write_control_bit(0),this.write_control_bit(1),this.flags>>>=this.flag_bits_left;const e=this.output.position;return this.output.seek_start(this.flag_offset).write_u8(this.flags).seek_start(e),this.write_u8(0),this.write_u8(0),this.output.seek_start(0)}write_control_bit(e){if(0==this.flag_bits_left--){const e=this.output.position;this.output.seek_start(this.flag_offset),this.output.write_u8(this.flags),this.output.seek_start(e),this.output.write_u8(0),this.flag_offset=e,this.flag_bits_left=7}this.flags>>>=1,e&&(this.flags|=128)}write_u8(e){this.output.write_u8(e)}short_copy(e,t){t-=2,this.write_control_bit(0),this.write_control_bit(0),this.write_control_bit(t>>>1&1),this.write_control_bit(1&t),this.write_u8(255&e)}long_copy(e,t){t<=9?(this.write_control_bit(0),this.write_control_bit(1),this.write_u8(e<<3&248|t-2&7),this.write_u8(e>>5&255)):(this.write_control_bit(0),this.write_control_bit(1),this.write_u8(e<<3&248),this.write_u8(e>>5&255),this.write_u8(t-1))}}var dr=i(549);const cr=Y.a.get("core/data_formats/parsing/quest/bin"),lr=468,_r=920,ur=4652;const hr=Y.a.get("core/data_formats/parsing/quest/dat"),vr=68,pr=72;var gr;function br({objs:e,npcs:t,events:i,unknowns:o}){const s=new nr.a(e.length*(16+vr)+t.length*(16+pr)+o.reduce((e,t)=>e+t.total_size,0)),n=new sr.a(s,zo.a.Little);!function(e,t){const i=Object(zn.groupBy)(t,e=>e.area_id),o=Object.keys(i).map(e=>parseInt(e,10)).sort((e,t)=>e-t);for(const t of o){const o=i[t],s=o.length*vr;e.write_u32(1),e.write_u32(s+16),e.write_u32(t),e.write_u32(s);for(const t of o)Object(q.d)(2===t.unknown.length,()=>`unknown should be of length 2, was ${t.unknown.length}`),e.write_u16(t.type_id),Object(q.d)(6===t.unknown[0].length,()=>`unknown[0] should be of length 6, was ${t.unknown[0].length}`),e.write_u8_array(t.unknown[0]),e.write_u16(t.id),e.write_u16(t.group_id),e.write_u16(t.section_id),Object(q.d)(2===t.unknown[1].length,()=>`unknown[1] should be of length 2, was ${t.unknown[1].length}`),e.write_u8_array(t.unknown[1]),e.write_vec3_f32(t.position),e.write_i32(Math.round(t.rotation.x/(2*Math.PI)*65535)),e.write_i32(Math.round(t.rotation.y/(2*Math.PI)*65535)),e.write_i32(Math.round(t.rotation.z/(2*Math.PI)*65535)),Object(q.d)(7===t.properties.length,()=>`properties should be of length 7, was ${t.properties.length}`),e.write_f32(t.properties[0]),e.write_f32(t.properties[1]),e.write_f32(t.properties[2]),e.write_u32(t.properties[3]),e.write_u32(t.properties[4]),e.write_u32(t.properties[5]),e.write_u32(t.properties[6])}}(n,e),function(e,t){const i=Object(zn.groupBy)(t,e=>e.area_id),o=Object.keys(i).map(e=>parseInt(e,10)).sort((e,t)=>e-t);for(const t of o){const o=i[t],s=o.length*pr;e.write_u32(2),e.write_u32(s+16),e.write_u32(t),e.write_u32(s);for(const t of o)Object(q.d)(2===t.unknown.length,()=>`unknown should be of length 2, was ${t.unknown.length}`),e.write_u16(t.type_id),Object(q.d)(10===t.unknown[0].length,()=>`unknown[0] should be of length 10, was ${t.unknown[0].length}`),e.write_u8_array(t.unknown[0]),e.write_u16(t.section_id),e.write_u16(t.wave),e.write_u32(t.wave2),e.write_vec3_f32(t.position),e.write_i32(Math.round(t.rotation.x/(2*Math.PI)*65535)),e.write_i32(Math.round(t.rotation.y/(2*Math.PI)*65535)),e.write_i32(Math.round(t.rotation.z/(2*Math.PI)*65535)),e.write_vec3_f32(t.scale),e.write_f32(t.npc_id),e.write_f32(t.script_label),e.write_u32(t.roaming),Object(q.d)(4===t.unknown[1].length,()=>`unknown[1] should be of length 4, was ${t.unknown[1].length}`),e.write_u8_array(t.unknown[1])}}(n,t),function(e,t){const i=Object(zn.groupBy)(t,e=>e.area_id),o=Object.keys(i).map(e=>parseInt(e,10)).sort((e,t)=>e-t);for(const t of o){const o=i[t];e.write_u32(3);const s=e.position;e.write_u32(0),e.write_u32(t);const n=e.position;e.write_u32(0);const r=e.position,a=r+16+20*o.length;e.size=Math.max(a,e.size),e.write_u32(a-r),e.write_u32(16),e.write_u32(o.length),e.write_u32(0);let d=0;for(const t of o){e.write_u32(t.id),e.write_u32(65536),e.write_u16(t.section_id),e.write_u16(t.wave),e.write_u16(t.delay),e.write_u16(t.unknown),e.write_u32(d);const i=e.position;e.seek_start(a+d);for(const i of t.actions)switch(e.write_u8(i.type),i.type){case gr.SpawnNpcs:e.write_u16(i.section_id),e.write_u16(i.appear_flag);break;case gr.Unlock:case gr.Lock:e.write_u16(i.door_id);break;case gr.TriggerEvent:e.write_u32(i.event_id);break;default:throw new Error(`Unknown event action type ${i.type}.`)}e.write_u8(1),d=e.position-a,e.seek_start(i)}for(e.seek_start(a+d);(e.position-a)%4!=0;)e.write_u8(255);const c=e.position;e.seek_start(s),e.write_u32(c-r+16),e.seek_start(n),e.write_u32(c-r),e.seek_start(c)}}(n,i);for(const e of o)n.write_u32(e.entity_type),n.write_u32(e.total_size),n.write_u32(e.area_id),n.write_u32(e.entities_size),n.write_u8_array(e.data);return n.write_u32(0),n.write_u32(0),n.write_u32(0),n.write_u32(0),s}function fr(e,t,i){const o=Math.floor(e.size/vr);for(let s=0;s<o;++s){const o=e.u16(),s=e.u8_array(6),n=e.u16(),r=e.u16(),a=e.u16(),d=e.u8_array(2),c=e.vec3_f32(),l={x:e.i32()/65535*2*Math.PI,y:e.i32()/65535*2*Math.PI,z:e.i32()/65535*2*Math.PI},_=[e.f32(),e.f32(),e.f32(),e.u32(),e.u32(),e.u32(),e.u32()];i.push({type_id:o,id:n,group_id:r,section_id:a,position:c,rotation:l,properties:_,area_id:t,unknown:[s,d]})}}function mr(e,t,i){const o=Math.floor(e.size/pr);for(let s=0;s<o;++s){const o=e.u16(),s=e.u8_array(10),n=e.u16(),r=e.u16(),a=e.u32(),d=e.vec3_f32(),c=e.i32()/65535*2*Math.PI,l=e.i32()/65535*2*Math.PI,_=e.i32()/65535*2*Math.PI,u=e.vec3_f32(),h=e.f32(),v=e.f32(),p=e.u32(),g=e.u8_array(4);i.push({type_id:o,section_id:n,wave:r,wave2:a,position:d,rotation:{x:c,y:l,z:_},scale:u,npc_id:h,script_label:v,roaming:p,area_id:t,unknown:[s,g]})}}function wr(e,t,i){const o=e.u32();e.seek(4);const s=e.u32();if(e.seek(3),50===e.u8())throw new Error("Can't parse challenge mode quests yet.");e.seek_start(o);const n=e.take(e.bytes_left);e.seek_start(16);for(let o=0;o<s;++o){const o=e.u32();e.seek(4);const s=e.u16(),r=e.u16(),a=e.u16(),d=e.u16(),c=e.u32();let l=[];c<n.size?(n.seek_start(c),l=kr(n)):hr.warn(`Invalid event actions offset ${c} for event ${o}.`),i.push({id:o,section_id:s,wave:r,delay:a,actions:l,area_id:t,unknown:d})}e.position!==o&&hr.warn(`Read ${e.position-16} bytes of event data instead of expected ${o-16}.`);let r=255;for(;n.bytes_left&&(r=n.u8(),255===r););255!==r&&n.seek(-1),e.seek_start(o+n.position)}function kr(e){const t=[];e:for(;e.bytes_left;){const i=e.u8();switch(i){case 1:break e;case gr.SpawnNpcs:t.push({type:gr.SpawnNpcs,section_id:e.u16(),appear_flag:e.u16()});break;case gr.Unlock:t.push({type:gr.Unlock,door_id:e.u16()});break;case gr.Lock:t.push({type:gr.Lock,door_id:e.u16()});break;case gr.TriggerEvent:t.push({type:gr.TriggerEvent,event_id:e.u32()});break;default:hr.warn(`Unexpected event action type ${i}.`);break e}}return t}!function(e){e[e.SpawnNpcs=8]="SpawnNpcs",e[e.Unlock=10]="Unlock",e[e.Lock=11]="Lock",e[e.TriggerEvent=12]="TriggerEvent"}(gr||(gr={}));const yr=Y.a.get("core/data_formats/parsing/quest/qst"),Rr=60,Ir=88,xr=68,jr=166,Tr=1024,Cr=4,Sr=Tr+20+Cr,Or=8,Lr=Tr+24+Or;function Dr(e){const t=function(e){const t=[];let i=void 0,o=void 0;for(let s=0;s<4;++s){let s,n;const r=e.u8();e.seek(1);const a=e.u8();if(e.seek(-3),r===Ir&&a===xr)s=Co.BB,n=!0;else if(r===Rr&&a===xr)s=Co.PC,n=!0;else{if(a!==Rr)break;{const t=e.position;if(e.seek(35),s=0===e.u8()?Co.GC:Co.DC,e.seek_start(t),r===xr)n=!0;else{if(r!==jr)break;n=!1}}}let d,c,l,_,u;switch(s){case Co.DC:e.seek(1),c=e.u8(),d=e.u16(),l=e.string_ascii(32,!0,!0),e.seek(3),_=e.string_ascii(16,!0,!0),e.seek(1),u=e.u32();break;case Co.GC:e.seek(1),c=e.u8(),d=e.u16(),l=e.string_ascii(32,!0,!0),e.seek(4),_=e.string_ascii(16,!0,!0),u=e.u32();break;case Co.PC:d=e.u16(),e.seek(1),c=e.u8(),l=e.string_ascii(32,!0,!0),e.seek(4),_=e.string_ascii(16,!0,!0),u=e.u32();break;case Co.BB:d=e.u16(),e.seek(2),c=e.u16(),e.seek(38),_=e.string_ascii(16,!0,!0),u=e.u32(),l=e.string_ascii(24,!0,!0)}if(null!=i&&null!=o&&(c!==i||Object(q.e)(_)!==Object(q.e)(o))){e.seek(-d);break}i=c,o=_,t.push({version:s,online:n,quest_id:c,name:l,filename:_,size:u})}return t}(e);if(t.length<2)return void yr.error(`Corrupt .qst file, expected at least 2 headers but only found ${t.length}.`);let i=void 0,o=void 0;for(const e of t){if(null!=i&&e.version!==i)return void yr.error(`Corrupt .qst file, header version ${Co[e.version]} for file ${e.filename} doesn't match the previous header's version ${Co[i]}.`);if(null!=o&&e.online!==o)return void yr.error(`Corrupt .qst file, header type ${e.online?'"online"':'"download"'} for file ${e.filename} doesn't match the previous header's type ${o?'"online"':'"download"'}.`);i=e.version,o=e.online}return Object(q.f)(i,"version"),Object(q.f)(o,"online"),{version:i,online:o,files:function(e,t,i){var o,s;const n=new Map;let r,a;switch(t){case Co.DC:case Co.GC:case Co.PC:r=Sr,a=Cr;break;case Co.BB:r=Lr,a=Or}for(;e.bytes_left>=r;){const s=e.position;let d;switch(t){case Co.DC:case Co.GC:e.seek(1),d=e.u8(),e.seek(2);break;case Co.PC:e.seek(3),d=e.u8();break;case Co.BB:e.seek(4),d=e.u32()}const c=e.string_ascii(16,!0,!0);let l=n.get(c);if(!l){const e=i.get(c);l={name:c,expected_size:null==e?void 0:e.size,cursor:new sr.a(new nr.a(null!==(o=null==e?void 0:e.size)&&void 0!==o?o:10*Tr),zo.a.Little),chunk_nos:new Set},n.set(c,l)}l.chunk_nos.has(d)?yr.warn(`File chunk number ${d} of file ${c} was already encountered, overwriting previous chunk.`):l.chunk_nos.add(d);let _=e.seek(Tr).u32();e.seek(-Tr-4),_>Tr&&(yr.warn(`Data segment size of ${_} is larger than expected maximum size, reading just ${Tr} bytes.`),_=Tr);const u=e.take(_),h=d*Tr;if(l.cursor.size=Math.max(h+_,l.cursor.size),l.cursor.seek_start(h).write_cursor(u),e.seek(Tr+a-u.size),e.position!==s+r)throw new Error(`Read ${e.position-s} file chunk message bytes instead of expected ${r}.`)}e.bytes_left&&yr.warn(`${e.bytes_left} Bytes left in file.`);for(const e of n.values()){e.cursor.seek_start(0),e.chunk_nos=new Set(Array.from(e.chunk_nos.values()).sort((e,t)=>e-t)),null!=e.expected_size&&e.cursor.size!==e.expected_size&&yr.warn(`File ${e.name} has an actual size of ${e.cursor.size} instead of the expected size ${e.expected_size}.`);const t=Math.max(e.cursor.size,null!==(s=e.expected_size)&&void 0!==s?s:0),i=Math.ceil(t/Tr);for(let t=0;t<i;++t)e.chunk_nos.has(t)||yr.warn(`File ${e.name} is missing chunk ${t}.`)}const d=[];for(const e of n.values()){const t=i.get(e.name);d.push({id:null==t?void 0:t.quest_id,filename:e.name,quest_name:null==t?void 0:t.name,data:e.cursor.seek_start(0).array_buffer()})}return d}(e,i,new Map(t.map(e=>[e.filename,e])))}}function Br({version:e,online:t,files:i}){let o,s;switch(e){case Co.DC:case Co.GC:case Co.PC:o=Rr,s=Sr;break;case Co.BB:o=Ir,s=Lr}const n=i.map(e=>o+Math.ceil(e.data.byteLength/Tr)*s).reduce((e,t)=>e+t),r=new ArrayBuffer(n),a=new $o.a(r,zo.a.Little);if(function(e,t,i,o,s){var n,r,a,d,c,l,_,u;let h,v;i===Co.BB?(h=65535,v=23):(h=255,v=31);for(const p of t)switch(Object(q.d)(null==p.id||0<=p.id&&p.id<=h,()=>`Quest ID should be between 0 and ${h}, inclusive.`),Object(q.d)(null==p.quest_name||p.quest_name.length<=v,()=>`File ${p.filename} has a quest name longer than ${v} characters (${p.quest_name}).`),Object(q.d)(p.filename.length<=15,()=>`File ${p.filename} has a filename longer than 15 characters.`),i){case Co.DC:e.write_u8(o?xr:jr),e.write_u8(null!==(n=p.id)&&void 0!==n?n:0),e.write_u16(s),e.write_string_ascii(null!==(r=p.quest_name)&&void 0!==r?r:p.filename,32),e.write_u8(0),e.write_u8(0),e.write_u8(0),e.write_string_ascii(p.filename,16),e.write_u8(0),e.write_u32(p.data.byteLength);break;case Co.GC:e.write_u8(o?xr:jr),e.write_u8(null!==(a=p.id)&&void 0!==a?a:0),e.write_u16(s),e.write_string_ascii(null!==(d=p.quest_name)&&void 0!==d?d:p.filename,32),e.write_u32(0),e.write_string_ascii(p.filename,16),e.write_u32(p.data.byteLength);break;case Co.PC:e.write_u16(s),e.write_u8(o?xr:jr),e.write_u8(null!==(c=p.id)&&void 0!==c?c:0),e.write_string_ascii(null!==(l=p.quest_name)&&void 0!==l?l:p.filename,32),e.write_u32(0),e.write_string_ascii(p.filename,16),e.write_u32(p.data.byteLength);break;case Co.BB:e.write_u16(s),e.write_u16(o?xr:jr),e.write_u16(null!==(_=p.id)&&void 0!==_?_:0);for(let t=0;t<38;t++)e.write_u8(0);e.write_string_ascii(p.filename,16),e.write_u32(p.data.byteLength),e.write_string_ascii(null!==(u=p.quest_name)&&void 0!==u?u:p.filename,24)}}(a,i,e,t,o),function(e,t,i){const o=t.map(e=>({no:0,data:new $o.a(e.data,zo.a.Little),name:e.filename}));let s=0;for(;s<o.length;)for(const t of o)t.data.bytes_left&&(Pr(e,t.data,t.no++,t.name,i)||s++);for(const e of o){const t=Math.ceil(e.data.size/Tr);if(e.no!==t)throw new Error(`Expected to write ${t} chunks for file "${e.name}" but ${e.no} where written.`)}}(a,i,e),a.position!==n)throw new Error(`Expected a final file size of ${n}, but got ${a.position}.`);return r}function Pr(e,t,i,o,s){switch(s){case Co.DC:case Co.GC:e.write_u8(0),e.write_u8(i),e.write_u16(0);break;case Co.PC:e.write_u8(0),e.write_u8(0),e.write_u8(0),e.write_u8(i);break;case Co.BB:e.write_u8_array([28,4,19,0]),e.write_u32(i)}e.write_string_ascii(o,16);const n=Math.min(Tr,t.bytes_left);e.write_cursor(t.take(n));for(let t=n;t<Tr;++t)e.write_u8(0);return e.write_u32(n),s===Co.BB&&e.write_u32(0),t.bytes_left>0}var Er;!function(e){e[e.None=0]="None",e[e.Return=1]="Return",e[e.Jump=2]="Jump",e[e.ConditionalJump=3]="ConditionalJump",e[e.Call=4]="Call"}(Er||(Er={}));class Mr{constructor(e,t,i,o,s){this.from=[],this.to=[],this.segment=e,this.start=t,this.end=i,this.branch_type=o,this.branch_labels=s}link_to(e){this.to.includes(e)||(this.to.push(e),e.from.push(this))}index_of_instruction(e){const t=this.segment.instructions.indexOf(e,this.start);return t<this.end?t:-1}}class Wr{constructor(){this.blocks=[],this.instructions_to_block=new Map,this.labels_to_block=new Map}get_block_for_instruction(e){return this.instructions_to_block.get(e)}static create(e){const t=new Wr;for(const i of e)this.create_basic_blocks(t,i);return this.link_blocks(t),t}static create_basic_blocks(e,t){const i=t.instructions.length;let o=0,s=!0;for(let n=0;n<i;n++){const r=t.instructions[n];let a,d;switch(r.opcode.code){case qt.code:a=Er.Return,d=[];break;case pi.code:a=Er.Jump,d=[r.args[0].value];break;case bi.code:case fi.code:a=Er.ConditionalJump,d=[r.args[0].value];break;case mi.code:case wi.code:case ki.code:case yi.code:case Ri.code:case Ii.code:case xi.code:case ji.code:case Ti.code:case Ci.code:case Si.code:case Oi.code:case Li.code:case Di.code:case Bi.code:case Pi.code:case Ei.code:case Mi.code:case Wi.code:case qi.code:a=Er.ConditionalJump,d=[r.args[2].value];break;case Fi.code:a=Er.ConditionalJump,d=r.args.slice(1).map(e=>e.value);break;case gi.code:case At.code:a=Er.Call,d=[r.args[0].value];break;case Vi.code:a=Er.Call,d=r.args.slice(1).map(e=>e.value);break;default:if(n===i-1){a=Er.None,d=[];break}continue}const c=new Mr(t,o,n+1,a,d);for(let t=c.start;t<c.end;t++)e.instructions_to_block.set(c.segment.instructions[t],c);if(e.blocks.push(c),s){for(const i of t.labels)e.labels_to_block.set(i,c);s=!1}o=n+1}}static link_blocks(e){const t=[];for(let i=0;i<e.blocks.length;i++){const o=e.blocks[i],s=e.blocks[i+1];switch(o.branch_type){case Er.Return:continue;case Er.Call:s&&t.push([o,s]);break;case Er.None:case Er.ConditionalJump:s&&o.link_to(s)}for(const t of o.branch_labels){const i=e.labels_to_block.get(t);i&&o.link_to(i)}}for(const[i,o]of t)qr(e.labels_to_block,o,i)}}function qr(e,t,i){for(const o of i.branch_labels){const i=e.get(o);i&&(i.branch_type===Er.Return?i.link_to(t):Fr(new Set,t,i))}}function Fr(e,t,i){if(!e.has(i)){e.add(i);for(const o of i.to)o.branch_type===Er.Return?o.link_to(t):Fr(e,t,o)}}class Vr{constructor(){this.intervals=[],this[Symbol.iterator]=()=>{let e=0,t=NaN;return{next:()=>{let i=!0;return e<this.intervals.length&&(isNaN(t)?(t=this.intervals[e].start,i=!1):t>this.intervals[e].end?(e++,e<this.intervals.length&&(t=this.intervals[e].start,i=!1)):i=!1),{done:i,value:t++}}}}}size(){return this.intervals.reduce((e,t)=>e+t.end-t.start+1,0)}get(e){for(const{start:t,end:i}of this.intervals){const o=i-t+1;if(e<o)return t+e;e-=o}}min(){return this.intervals.length?this.intervals[0].start:void 0}max(){return this.intervals.length?this.intervals[this.intervals.length-1].end:void 0}has(e){for(const t of this.intervals)if(t.start<=e&&e<=t.end)return!0;return!1}set_value(e){return this.intervals=[{start:e,end:e}],this}set_interval(e,t){if(t<e)throw new Error(`Interval upper bound should be greater than or equal to lower bound, got [${e}, ${t}].`);return this.intervals=[{start:e,end:t}],this}scalar_add(e){for(const t of this.intervals)t.start+=e,t.end+=e;return this}scalar_sub(e){return this.scalar_add(-e)}scalar_mul(e){for(const t of this.intervals)t.start*=e,t.end*=e;return this}scalar_div(e){for(const t of this.intervals)t.start=Math.floor(t.start/e),t.end=Math.floor(t.end/e);return this}union(e){let t=0;e:for(const i of e.intervals){for(;t<this.intervals.length;){const e=this.intervals[t];if(i.end<e.start-1){this.intervals.splice(t,0,i),t++;continue e}if(i.start<=e.end+1){e.start=Math.min(e.start,i.start);let o=t;for(;o<this.intervals.length&&i.end>this.intervals[o].start;)e.end=this.intervals[o].end,o++;this.intervals.splice(t+1,o-t-1),e.end=Math.max(e.end,i.end),t++;continue e}t++}this.intervals.push(i)}return this}to_array(){const e=[];for(const{start:t,end:i}of this.intervals)for(let o=t;o<=i;o++)e.push(o);return e}}const zr=Y.a.get("core/data_formats/asm/data_flow_analysis/register_value"),Ur=St,$r=Ot;Math.pow(2,32);function Ar(e,t,i){const o=e.get_block_for_instruction(t);return o?function e(t,i,o,s,n){if(++t.iterations>100)return zr.warn("Too many iterations."),(new Vr).set_interval(Ur,$r);for(let r=s-1;r>=o.start;r--){const s=o.segment.instructions[r],a=s.args;switch(s.opcode.code){case Nt.code:if(a[0].value===n)return e(t,new Set(i),o,r,a[1].value);break;case Gt.code:case Ht.code:case Qt.code:case lo.code:if(a[0].value===n)return(new Vr).set_value(a[1].value);break;case Xt.code:if(a[0].value===n)return(new Vr).set_value(1);break;case Jt.code:if(a[0].value===n)return(new Vr).set_value(0);break;case Kt.code:if(a[0].value===n){const s=e(t,new Set(i),o,r,n),a=s.size();return 0===a||1===a&&0===s.get(0)?(new Vr).set_value(1):s.has(0)?(new Vr).set_interval(0,1):(new Vr).set_value(0)}break;case ei.code:if(a[0].value===n){return e(t,new Set(i),o,r,n).scalar_add(a[1].value)}break;case ii.code:if(a[0].value===n){return e(t,new Set(i),o,r,n).scalar_sub(a[1].value)}break;case si.code:if(a[0].value===n){return e(t,new Set(i),o,r,n).scalar_mul(a[1].value)}break;case ri.code:if(a[0].value===n){return e(t,new Set(i),o,r,n).scalar_div(a[1].value)}break;case so.code:if(a[0].value===n)return(new Vr).set_interval(0,1);break;case ao.code:if(a[0].value===n)return(new Vr).set_interval(0,2);break;case _o.code:if(a[0].value===n)return(new Vr).set_interval(0,3);break;case po.code:if(a[1].value===n){const s=e(t,new Set(i),o,r,a[0].value).min()||0,n=Math.max(e(t,new Set(i),o,r,a[0].value+1).max()||0,s+1);return(new Vr).set_interval(s,n-1)}break;case $i.code:case Ai.code:{const e=a[0].value,t=a[0].value+a[1].value;if(e<=n&&n<t)return(new Vr).set_interval(Ur,$r)}break;default:{const e=s.opcode.params,t=Math.min(a.length,e.length);for(let i=0;i<t;i++){const t=e[i];if(t.type.kind==vt.RegTupRef){const e=a[i].value;let o=0;for(const i of t.type.register_tuples){if((i.access===Lt.Write||i.access===Lt.ReadWrite)&&e+o===n)return(new Vr).set_interval(Ur,$r);o++}}}}}}const r=new Vr;i.add(o);for(const s of o.from){if(i.has(s)){r.set_interval(Ur,$r);break}r.union(e(t,new Set(i),s,s.end,n))}return r}(new Nr,new Set,o,o.index_of_instruction(t),i):new Vr}class Nr{constructor(){this.iterations=0}}const Gr=Y.a.get("core/data_formats/asm/data_flow_analysis/stack_value"),Hr=St,Qr=Ot;function Yr(e,t,i){const o=e.get_block_for_instruction(t);return o?function e(t,i,o,s,n){if(++t.iterations>100)return Gr.warn("Too many iterations."),(new Vr).set_interval(Hr,Qr);for(let e=s-1;e>=o.start;e--){const i=o.segment.instructions[e];if(i.opcode.stack===Dt.Pop){n+=i.opcode.params.length;continue}const s=i.args;switch(i.opcode.code){case Ni.code:if(0===n)return Ar(t.cfg,i,s[0].value);n--;break;case Gi.code:case Hi.code:case Qi.code:if(0===n)return(new Vr).set_value(s[0].value);n--;break;case Yi.code:case Xi.code:case Ji.code:if(0===n)return(new Vr).set_interval(Hr,Qr);n--}}const r=new Vr;i.add(o);for(const s of o.from){if(i.has(s)){r.set_interval(Hr,Qr);break}r.union(e(t,new Set(i),s,s.end,n))}return r}(new Xr(e),new Set,o,o.index_of_instruction(t),i):new Vr}class Xr{constructor(e){this.cfg=e,this.iterations=0}}const Jr=Y.a.get("core/data_formats/parsing/quest/object_code"),Kr=[];function Zr(e,t,i,o,s){return function(e,t,i,o,s){const n=new Map;!function(e,t,i,o,s,n){let r;do{r=o.size;for(const[r,a]of i)ta(o,t,e,r,a,s,n);const a=[...o.entries()].filter(([,e])=>e.type===Oo.Instructions).sort(([e],[t])=>e-t).map(([,e])=>e),d=Wr.create(a);i=new Map;for(const e of a)for(const t of e.instructions)for(let e=0;e<t.opcode.params.length;e++){const o=t.opcode.params[e];switch(o.type.kind){case vt.ILabel:ea(d,i,t,e,Oo.Instructions);break;case vt.ILabelVar:for(;e<t.args.length;e++)i.set(t.args[e].value,Oo.Instructions);break;case vt.DLabel:ea(d,i,t,e,Oo.Data);break;case vt.SLabel:ea(d,i,t,e,Oo.String);break;case vt.RegTupRef:{const s=t.args[e];for(let e=0;e<o.type.register_tuples.length;e++){if(o.type.register_tuples[e].type.kind===vt.ILabel){const o=Ar(d,t,s.value+e);if(o.size()<=10)for(const e of o)i.set(e,Oo.Instructions)}}}}}}while(o.size>r)}(e,t,i.reduce((e,t)=>e.set(t,Oo.Instructions),new Map),n,o,s);const r=[];let a=0;for(;a<e.size;){let i=n.get(a);if(!i){const o=t.get_labels(a);let s;if(o){const i=t.get_info(o[0]);s=i.next?i.next.offset:e.size}else{s=e.size;for(const e of t.labels)if(e.offset>a){s=e.offset;break}}if(e.seek_start(a),ia(n,e,s,o||[]),i=n.get(a),s<=a){Jr.error(`Next offset ${s} was smaller than or equal to current offset ${a}.`);break}if(!i){Jr.error(`Couldn't create segment for offset ${a}.`);break}}switch(r.push(i),i.type){case Oo.Instructions:for(const e of i.instructions)a+=Bo(e,s);break;case Oo.Data:a+=i.data.byteLength;break;case Oo.String:a+=4*Math.ceil((i.value.length+1)/2);break;default:throw new Error(`${Oo[i.type]} not implemented.`)}}for(const{label:e,offset:i}of t.labels){const t=n.get(i);t?t.labels.includes(e)||(t.labels.push(e),t.labels.sort((e,t)=>e-t)):Jr.warn(`Label ${e} with offset ${i} does not point to anything.`)}if(e.size!==a){const t=`Expected to parse ${e.size} bytes but parsed ${a} instead.`;if(!o)throw new Error(t);Jr.error(t)}return r}(new $o.a(e,zo.a.Little),new sa(t),i,o,s)}function ea(e,t,i,o,s){if(i.opcode.stack===Dt.Pop){const n=Yr(e,i,i.opcode.params.length-o-1);if(n.size()<=10)for(const e of n){const i=t.get(e);(null==i||Kr[s]>Kr[i])&&t.set(e,s)}}else{const e=i.args[o].value,n=t.get(e);(null==n||Kr[s]>Kr[n])&&t.set(e,s)}}function ta(e,t,i,o,s,n,r){try{const a=t.get_info(o);if(null==a)return void Jr.warn(`Label ${o} is not registered in the label table.`);const d=e.get(a.offset);let c;if(d){if(d.labels.includes(o)||(d.labels.push(o),d.labels.sort((e,t)=>e-t)),!(Kr[s]>Kr[d.type]))return;c=d.labels}else c=[o];const l=a.next?a.next.offset:i.size;switch(i.seek_start(a.offset),s){case Oo.Instructions:!function(e,t,i,o,s,n,r,a){const d=[],c={type:Oo.Instructions,labels:s,instructions:d,asm:{labels:[]}};e.set(i.position,c);for(;i.position<o;){const e=i.u8();let t;switch(e){case 248:case 249:t=e<<8|i.u8();break;default:t=e}const o=Pt[t];try{const e=oa(i,o,a);d.push(Do(o,e))}catch(e){if(!r)throw e;Jr.error(`Exception occurred while parsing arguments for instruction ${o.mnemonic}.`,e),d.push(Do(o,[]))}}if(null!=n){let o=!0;for(let e=d.length-1;e>=0;e--){const t=d[e].opcode;if(t.code===qt.code||t.code===pi.code){o=!1;break}}o&&ta(e,t,i,n,Oo.Instructions,r,a)}}(e,t,i,l,c,a.next&&a.next.label,n,r);break;case Oo.Data:ia(e,i,l,c);break;case Oo.String:!function(e,t,i,o,s){const n=t.position,r={type:Oo.String,labels:o,value:s===So.DC_GC?t.string_ascii(i-n,!0,!0):t.string_utf16(i-n,!0,!0),asm:{labels:[]}};e.set(n,r)}(e,i,l,c,r);break;default:throw new Error(`Segment type ${Oo[s]} not implemented.`)}}catch(e){if(!n)throw e;Jr.error("Couldn't fully parse object code segment.",e)}}function ia(e,t,i,o){const s=t.position,n={type:Oo.Data,labels:o,data:t.array_buffer(i-s),asm:{labels:[]}};e.set(s,n)}function oa(e,t,i){const o=[];if(t.stack!==Dt.Pop)for(const s of t.params)switch(s.type.kind){case vt.Byte:o.push(Po(e.u8()));break;case vt.Word:o.push(Po(e.u16()));break;case vt.DWord:o.push(Po(e.i32()));break;case vt.Float:o.push(Po(e.f32()));break;case vt.Label:case vt.ILabel:case vt.DLabel:case vt.SLabel:o.push(Po(e.u16()));break;case vt.String:{const t=Math.min(4096,e.bytes_left);o.push(Po(i===So.DC_GC?e.string_ascii(t,!0,!1):e.string_utf16(t,!0,!1)))}break;case vt.ILabelVar:{const t=e.u8();o.push(...e.u16_array(t).map(e=>Po(e)))}break;case vt.RegRef:case vt.RegTupRef:o.push(Po(e.u8()));break;case vt.RegRefVar:{const t=e.u8();o.push(...e.u8_array(t).map(e=>Po(e)))}break;default:throw new Error(`Parameter type ${vt[s.type.kind]} not implemented.`)}return o}Kr[Oo.Instructions]=2,Kr[Oo.String]=1,Kr[Oo.Data]=0;class sa{constructor(e){this.labels=[],this.label_map=new Map,this.offset_map=new Map;for(let t=0;t<e.length;t++){const i=e[t];-1!==i&&this.labels.push({label:t,offset:i})}this.labels.sort((e,t)=>e.offset-t.offset||e.label-t.label);for(let e=0;e<this.labels.length;e++){const{label:t,offset:i}=this.labels[e];this.label_map.set(t,{offset:i,index:e});const o=this.offset_map.get(i)||[];o.push(t),this.offset_map.set(i,o)}}get_labels(e){return this.offset_map.get(e)}get_info(e){const t=this.label_map.get(e);if(null==t)return;let i;for(let e=t.index+1;e<this.labels.length&&(i=this.labels[e],!(i.offset>t.offset));e++)i=void 0;return{offset:t.offset,next:i}}}const na=Y.a.get("core/data_formats/asm/data_flow_analysis/map_designations");const ra=Y.a.get("core/data_formats/parsing/quest");function aa(e,t,i=!1){const o=Object(dr.a)(e),{bin:s,format:r}=function(e){const t=e.u32(),i=e.u32(),o=e.u32();let s,n,r,a,d,c,l;switch(e.seek(4),t){case lr:s=So.DC_GC;break;case ur:s=So.BB;break;default:s=So.PC}s===So.DC_GC?(e.seek(1),r=e.u8(),n=e.u16(),a=e.string_ascii(32,!0,!0),d=e.string_ascii(128,!0,!0),c=e.string_ascii(288,!0,!0)):(n=e.u32(),r=e.u32(),a=e.string_utf16(64,!0,!0),d=e.string_utf16(256,!0,!0),c=e.string_utf16(576,!0,!0)),o!==e.size&&cr.warn(`Value ${o} in bin size field does not match actual size ${e.size}.`),s===So.BB?(e.seek(4),l=e.u32_array(932)):l=[];const _=Math.floor((e.size-i)/4),u=e.seek_start(i).i32_array(_);return{bin:{quest_id:n,language:r,quest_name:a,short_description:d,long_description:c,object_code:e.seek_start(t).array_buffer(i-t),label_offsets:u,shop_items:l},format:s}}(o),a=function(e){const t=[],i=[],o=[],s=[];for(;e.bytes_left;){const n=e.u32(),r=e.u32(),a=e.u32(),d=e.u32();if(0===n)break;{if(d!==r-16)throw Error(`Malformed DAT file. Expected an entities size of ${r-16}, got ${d}.`);const c=e.take(d);1===n?fr(c,a,t):2===n?mr(c,a,i):3===n?wr(c,a,o):s.push({entity_type:n,total_size:r,area_id:a,entities_size:d,data:e.u8_array(d)}),c.bytes_left&&hr.warn(`Read ${c.position} bytes instead of expected ${c.size} for entity type ${n}.`)}}return{objs:t,npcs:i,events:o,unknowns:s}}(Object(dr.a)(t)),d=a.objs.map(e=>{const t=function(e){switch(e){default:return w.Unknown;case 0:return w.PlayerSet;case 1:return w.Particle;case 2:return w.Teleporter;case 3:return w.Warp;case 4:return w.LightCollision;case 5:return w.Item;case 6:return w.EnvSound;case 7:return w.FogCollision;case 8:return w.EventCollision;case 9:return w.CharaCollision;case 10:return w.ElementalTrap;case 11:return w.StatusTrap;case 12:return w.HealTrap;case 13:return w.LargeElementalTrap;case 14:return w.ObjRoomID;case 15:return w.Sensor;case 16:return w.UnknownItem16;case 17:return w.LensFlare;case 18:return w.ScriptCollision;case 19:return w.HealRing;case 20:return w.MapCollision;case 21:return w.ScriptCollisionA;case 22:return w.ItemLight;case 23:return w.RadarCollision;case 24:return w.FogCollisionSW;case 25:return w.BossTeleporter;case 26:return w.ImageBoard;case 27:return w.QuestWarp;case 28:return w.Epilogue;case 29:return w.UnknownItem29;case 30:return w.UnknownItem30;case 31:return w.UnknownItem31;case 32:return w.BoxDetectObject;case 33:return w.SymbolChatObject;case 34:return w.TouchPlateObject;case 35:return w.TargetableObject;case 36:return w.EffectObject;case 37:return w.CountDownObject;case 38:return w.UnknownItem38;case 39:return w.UnknownItem39;case 40:return w.UnknownItem40;case 41:return w.UnknownItem41;case 64:return w.MenuActivation;case 65:return w.TelepipeLocation;case 66:return w.BGMCollision;case 67:return w.MainRagolTeleporter;case 68:return w.LobbyTeleporter;case 69:return w.PrincipalWarp;case 70:return w.ShopDoor;case 71:return w.HuntersGuildDoor;case 72:return w.TeleporterDoor;case 73:return w.MedicalCenterDoor;case 74:return w.Elevator;case 75:return w.EasterEgg;case 76:return w.ValentinesHeart;case 77:return w.ChristmasTree;case 78:return w.ChristmasWreath;case 79:return w.HalloweenPumpkin;case 80:return w.TwentyFirstCentury;case 81:return w.Sonic;case 82:return w.WelcomeBoard;case 83:return w.Firework;case 84:return w.LobbyScreenDoor;case 85:return w.MainRagolTeleporterBattleInNextArea;case 86:return w.LabTeleporterDoor;case 87:return w.Pioneer2InvisibleTouchplate;case 128:return w.ForestDoor;case 129:return w.ForestSwitch;case 130:return w.LaserFence;case 131:return w.LaserSquareFence;case 132:return w.ForestLaserFenceSwitch;case 133:return w.LightRays;case 134:return w.BlueButterfly;case 135:return w.Probe;case 136:return w.RandomTypeBox1;case 137:return w.ForestWeatherStation;case 138:return w.Battery;case 139:return w.ForestConsole;case 140:return w.BlackSlidingDoor;case 141:return w.RicoMessagePod;case 142:return w.EnergyBarrier;case 143:return w.ForestRisingBridge;case 144:return w.SwitchNoneDoor;case 145:return w.EnemyBoxGrey;case 146:return w.FixedTypeBox;case 147:return w.EnemyBoxBrown;case 149:return w.EmptyTypeBox;case 150:return w.LaserFenceEx;case 151:return w.LaserSquareFenceEx;case 192:return w.FloorPanel1;case 193:return w.Caves4ButtonDoor;case 194:return w.CavesNormalDoor;case 195:return w.CavesSmashingPillar;case 196:return w.CavesSign1;case 197:return w.CavesSign2;case 198:return w.CavesSign3;case 199:return w.HexagonalTank;case 200:return w.BrownPlatform;case 201:return w.WarningLightObject;case 203:return w.Rainbow;case 204:return w.FloatingJellyfish;case 205:return w.FloatingDragonfly;case 206:return w.CavesSwitchDoor;case 207:return w.RobotRechargeStation;case 208:return w.CavesCakeShop;case 209:return w.Caves1SmallRedRock;case 210:return w.Caves1MediumRedRock;case 211:return w.Caves1LargeRedRock;case 212:return w.Caves2SmallRock1;case 213:return w.Caves2MediumRock1;case 214:return w.Caves2LargeRock1;case 215:return w.Caves2SmallRock2;case 216:return w.Caves2MediumRock2;case 217:return w.Caves2LargeRock2;case 218:return w.Caves3SmallRock;case 219:return w.Caves3MediumRock;case 220:return w.Caves3LargeRock;case 222:return w.FloorPanel2;case 223:return w.DestructableRockCaves1;case 224:return w.DestructableRockCaves2;case 225:return w.DestructableRockCaves3;case 256:return w.MinesDoor;case 257:return w.FloorPanel3;case 258:return w.MinesSwitchDoor;case 259:return w.LargeCryoTube;case 260:return w.ComputerLikeCalus;case 261:return w.GreenScreenOpeningAndClosing;case 262:return w.FloatingRobot;case 263:return w.FloatingBlueLight;case 264:return w.SelfDestructingObject1;case 265:return w.SelfDestructingObject2;case 266:return w.SelfDestructingObject3;case 267:return w.SparkMachine;case 268:return w.MinesLargeFlashingCrate;case 304:return w.RuinsSeal;case 320:return w.RuinsTeleporter;case 321:return w.RuinsWarpSiteToSite;case 322:return w.RuinsSwitch;case 323:return w.FloorPanel4;case 324:return w.Ruins1Door;case 325:return w.Ruins3Door;case 326:return w.Ruins2Door;case 327:return w.Ruins11ButtonDoor;case 328:return w.Ruins21ButtonDoor;case 329:return w.Ruins31ButtonDoor;case 330:return w.Ruins4ButtonDoor;case 331:return w.Ruins2ButtonDoor;case 332:return w.RuinsSensor;case 333:return w.RuinsFenceSwitch;case 334:return w.RuinsLaserFence4x2;case 335:return w.RuinsLaserFence6x2;case 336:return w.RuinsLaserFence4x4;case 337:return w.RuinsLaserFence6x4;case 338:return w.RuinsPoisonBlob;case 339:return w.RuinsPillarTrap;case 340:return w.PopupTrapNoTech;case 341:return w.RuinsCrystal;case 342:return w.Monument;case 345:return w.RuinsRock1;case 346:return w.RuinsRock2;case 347:return w.RuinsRock3;case 348:return w.RuinsRock4;case 349:return w.RuinsRock5;case 350:return w.RuinsRock6;case 351:return w.RuinsRock7;case 352:return w.Poison;case 353:return w.FixedBoxTypeRuins;case 354:return w.RandomBoxTypeRuins;case 355:return w.EnemyTypeBoxYellow;case 356:return w.EnemyTypeBoxBlue;case 357:return w.EmptyTypeBoxBlue;case 358:return w.DestructableRock;case 359:return w.PopupTrapsTechs;case 368:return w.FlyingWhiteBird;case 369:return w.Tower;case 370:return w.FloatingRocks;case 371:return w.FloatingSoul;case 372:return w.Butterfly;case 384:return w.LobbyGameMenu;case 385:return w.LobbyWarpObject;case 386:return w.Lobby1EventObjectDefaultTree;case 387:return w.UnknownItem387;case 388:return w.UnknownItem388;case 389:return w.UnknownItem389;case 390:return w.LobbyEventObjectStaticPumpkin;case 391:return w.LobbyEventObject3ChristmasWindows;case 392:return w.LobbyEventObjectRedAndWhiteCurtain;case 393:return w.UnknownItem393;case 394:return w.UnknownItem394;case 395:return w.LobbyFishTank;case 396:return w.LobbyEventObjectButterflies;case 400:return w.UnknownItem400;case 401:return w.GreyWallLow;case 402:return w.SpaceshipDoor;case 403:return w.GreyWallHigh;case 416:return w.TempleNormalDoor;case 417:return w.BreakableWallWallButUnbreakable;case 418:return w.BrokenCylinderAndRubble;case 419:return w.ThreeBrokenWallPiecesOnFloor;case 420:return w.HighBrickCylinder;case 421:return w.LyingCylinder;case 422:return w.BrickConeWithFlatTop;case 423:return w.BreakableTempleWall;case 424:return w.TempleMapDetect;case 425:return w.SmallBrownBrickRisingBridge;case 426:return w.LongRisingBridgeWithPinkHighEdges;case 427:return w.FourSwitchTempleDoor;case 448:return w.FourButtonSpaceshipDoor;case 512:return w.ItemBoxCca;case 513:return w.TeleporterEp2;case 514:return w.CCADoor;case 515:return w.SpecialBoxCCA;case 516:return w.BigCCADoor;case 517:return w.BigCCADoorSwitch;case 518:return w.LittleRock;case 519:return w.Little3StoneWall;case 520:return w.Medium3StoneWall;case 521:return w.SpiderPlant;case 522:return w.CCAAreaTeleporter;case 523:return w.UnknownItem523;case 524:return w.WhiteBird;case 525:return w.OrangeBird;case 527:return w.Saw;case 528:return w.LaserDetect;case 529:return w.UnknownItem529;case 530:return w.UnknownItem530;case 531:return w.Seagull;case 544:return w.Fish;case 545:return w.SeabedDoorWithBlueEdges;case 546:return w.SeabedDoorAlwaysOpenNonTriggerable;case 547:return w.LittleCryotube;case 548:return w.WideGlassWallBreakable;case 549:return w.BlueFloatingRobot;case 550:return w.RedFloatingRobot;case 551:return w.Dolphin;case 552:return w.CaptureTrap;case 553:return w.VRLink;case 576:return w.UnknownItem576;case 640:return w.WarpInBarbaRayRoom;case 672:return w.UnknownItem672;case 688:return w.GeeNest;case 689:return w.LabComputerConsole;case 690:return w.LabComputerConsoleGreenScreen;case 691:return w.ChairYellowPillow;case 692:return w.OrangeWallWithHoleInMiddle;case 693:return w.GreyWallWithHoleInMiddle;case 694:return w.LongTable;case 695:return w.GBAStation;case 696:return w.TalkLinkToSupport;case 697:return w.InstaWarp;case 698:return w.LabInvisibleObject;case 699:return w.LabGlassWindowDoor;case 700:return w.UnknownItem700;case 701:return w.LabCeilingWarp;case 768:return w.Ep4LightSource;case 769:return w.Cactus;case 770:return w.BigBrownRock;case 771:return w.BreakableBrownRock;case 832:return w.UnknownItem832;case 833:return w.UnknownItem833;case 896:return w.PoisonPlant;case 897:return w.UnknownItem897;case 898:return w.UnknownItem898;case 899:return w.OozingDesertPlant;case 901:return w.UnknownItem901;case 902:return w.BigBlackRocks;case 903:return w.UnknownItem903;case 904:return w.UnknownItem904;case 905:return w.UnknownItem905;case 906:return w.UnknownItem906;case 907:return w.FallingRock;case 908:return w.DesertPlantHasCollision;case 909:return w.DesertFixedTypeBoxBreakableCrystals;case 910:return w.UnknownItem910;case 911:return w.BeeHive;case 912:return w.UnknownItem912;case 913:return w.Heat;case 960:return w.TopOfSaintMillionEgg;case 961:return w.UnknownItem961}}(e.type_id);return{type:t,id:e.id,group_id:e.group_id,area_id:e.area_id,section_id:e.section_id,position:e.position,rotation:e.rotation,properties:new Map(e.properties.map((e,i)=>3!==i||t!==w.ScriptCollision&&t!==w.ForestConsole&&t!==w.TalkLinkToSupport?4===i&&t===w.RicoMessagePod?["script_label",e]:5===i&&t===w.RicoMessagePod?["script_label_2",e]:[`property_${i}`,e]:["script_label",e])),unknown:e.unknown}});let c=n.b.I,l=new Map;const _=Zr(s.object_code,s.label_offsets,function(e,t){const i=new Set([0]);for(const t of e){const e=t.properties.get("script_label");null!=e&&i.add(e);const o=t.properties.get("script_label_2");null!=o&&i.add(o)}for(const e of t)i.add(Math.round(e.script_label));return[...i]}(d,a.npcs),i,r);if(_.length){const e=_.filter(e=>e.type===Oo.Instructions);let t;for(const i of e)if(i.labels.includes(0)){t=i;break}t?(c=function(e){const t=e.instructions.find(e=>e.opcode.code===go.code);if(!t)return ra.debug("Function 0 has no set_episode instruction."),n.b.I;{const e=t.args[0].value;switch(e){case 0:return n.b.I;case 1:return n.b.II;case 2:return n.b.IV;default:return ra.warn(`Unknown episode ${e} in function 0 set_episode instruction.`),n.b.I}}}(t),l=function(e,t){const i=new Map;let o;for(const s of t.instructions)switch(s.opcode.code){case co.code:case uo.code:{o||(o=Wr.create(e));const t=Ar(o,s,s.args[0].value);if(1!==t.size()){na.warn("Couldn't determine area ID for map_designate instruction.");continue}const n=Ar(o,s,s.args[0].value+(s.opcode.code===co.code?2:3));if(1!==n.size()){na.warn("Couldn't determine area variant ID for map_designate instruction.");continue}i.set(t.get(0),n.get(0))}break;case To.code:i.set(s.args[0].value,s.args[2].value)}return i}(e,t)):ra.warn("No instruction for label 0 found.")}else ra.warn("File contains no instruction labels.");return{id:s.quest_id,language:s.language,name:s.quest_name,short_description:s.short_description,long_description:s.long_description,episode:c,objects:d,npcs:ca(c,a.npcs),events:a.events,dat_unknowns:a.unknowns,object_code:_,shop_items:s.shop_items,map_designations:l}}function da(e,t,i,o){const s=br({objs:(r=e.objects,r.map(e=>({type_id:j(e.type).pso_id,id:e.id,group_id:e.group_id,section_id:e.section_id,position:e.position,rotation:e.rotation,properties:[...e.properties.values()],area_id:e.area_id,unknown:e.unknown}))),npcs:(n=e.npcs,n.map(e=>{const t=Object(I.d)(e.type),i=null==t.pso_type_id?e.pso_type_id:t.pso_type_id,o=null==t.pso_roaming?e.pso_roaming:t.pso_roaming,s=null==t.pso_regular||t.pso_regular,n=zs(-8388609&Us(e.scale.y)|(s?0:8388608)),r={x:e.scale.x,y:n,z:e.scale.z};return{type_id:i,wave:e.wave,wave2:e.pso_wave2,section_id:e.section_id,position:e.position,rotation:e.rotation,scale:r,npc_id:e.npc_id,script_label:e.script_label,roaming:o,area_id:e.area_id,unknown:e.unknown}})),events:e.events,unknowns:e.dat_unknowns});var n,r;const{object_code:a,label_offsets:d}=function(e,t){const i=new sr.a(new nr.a(100*e.length),zo.a.Little),o=i.position,s=[];for(const n of e){for(const e of n.labels)s[e]=i.position-o;if(n.type===Oo.Instructions)for(const e of n.instructions){const o=e.opcode;if(2===o.size&&i.write_u8(o.code>>>8),i.write_u8(255&o.code),o.stack!==Dt.Pop)for(let s=0;s<o.params.length;s++){const n=o.params[s],r=e.param_to_args[s],[a]=r;switch(n.type.kind){case vt.Byte:a.value>=0?i.write_u8(a.value):i.write_i8(a.value);break;case vt.Word:a.value>=0?i.write_u16(a.value):i.write_i16(a.value);break;case vt.DWord:a.value>=0?i.write_u32(a.value):i.write_i32(a.value);break;case vt.Float:i.write_f32(a.value);break;case vt.Label:case vt.ILabel:case vt.DLabel:case vt.SLabel:i.write_u16(a.value);break;case vt.String:t===So.DC_GC?i.write_string_ascii(a.value,a.value.length+1):i.write_string_utf16(a.value,2*a.value.length+2);break;case vt.ILabelVar:i.write_u8(r.length),i.write_u16_array(r.map(e=>e.value));break;case vt.RegRef:case vt.RegTupRef:i.write_u8(a.value);break;case vt.RegRefVar:i.write_u8(r.length),i.write_u8_array(r.map(e=>e.value));break;default:throw new Error(`Parameter type ${vt[n.type.kind]} not implemented.`)}}}else if(n.type===Oo.String)if(t===So.DC_GC){const e=4*Math.ceil((n.value.length+1)/4);i.write_string_ascii(n.value,e)}else{const e=4*Math.ceil((n.value.length+1)/2);i.write_string_utf16(n.value,e)}else i.write_cursor(new $o.a(n.data,i.endianness))}for(let e=0;e<s.length;e++)null==s[e]&&(s[e]=-1);return{object_code:i.seek_start(0).array_buffer(),label_offsets:s}}(e.object_code,Lo(i)),c=function(e,t){let i;switch(Object(q.d)(e.quest_name.length<=32,()=>`quest_name can't be longer than 32 characters, was ${e.quest_name.length}`),Object(q.d)(e.short_description.length<=127,()=>`short_description can't be longer than 127 characters, was ${e.short_description.length}`),Object(q.d)(e.long_description.length<=287,()=>`long_description can't be longer than 287 characters, was ${e.long_description.length}`),Object(q.d)(0===e.shop_items.length||t===So.BB,"shop_items is only supported in BlueBurst quests."),Object(q.d)(e.shop_items.length<=932,()=>`shop_items can't be larger than 932, was ${e.shop_items.length}.`),t){case So.DC_GC:i=lr;break;case So.PC:i=_r;break;case So.BB:i=ur}const o=i+e.object_code.byteLength+4*e.label_offsets.length,s=new ArrayBuffer(o),n=new $o.a(s,zo.a.Little);if(n.write_u32(i),n.write_u32(i+e.object_code.byteLength),n.write_u32(o),n.write_u32(4294967295),t===So.DC_GC?(n.write_u8(0),n.write_u8(e.language),n.write_u16(e.quest_id),n.write_string_ascii(e.quest_name,32),n.write_string_ascii(e.short_description,128),n.write_string_ascii(e.long_description,288)):(n.write_u32(e.quest_id),n.write_u32(e.language),n.write_string_utf16(e.quest_name,64),n.write_string_utf16(e.short_description,256),n.write_string_utf16(e.long_description,576)),t===So.BB){n.write_u32(0),n.write_u32_array(e.shop_items);for(let t=e.shop_items.length;t<932;t++)n.write_u32(0)}return Object(q.d)(n.position===i,()=>`Expected to write ${i} bytes before object code, but wrote ${n.position}.`),n.write_cursor(new $o.a(e.object_code,zo.a.Little)),n.write_i32_array(e.label_offsets),Object(q.d)(n.position===o,`Expected to write ${o} bytes, but wrote ${n.position}.`),s}({quest_id:e.id,language:e.language,quest_name:e.name,short_description:e.short_description,long_description:e.long_description,object_code:a,label_offsets:d,shop_items:e.shop_items},Lo(i)),l=Object(q.e)(t).slice(0,11);return Br({version:i,online:o,files:[{id:e.id,filename:l+".dat",quest_name:e.name,data:rr(new sr.a(s,zo.a.Little)).array_buffer()},{id:e.id,filename:l+".bin",quest_name:e.name,data:rr(new $o.a(c,zo.a.Little)).array_buffer()}]})}function ca(e,t){return t.map(t=>({type:la(e,t),area_id:t.area_id,section_id:t.section_id,wave:t.wave,pso_wave2:t.wave2,position:t.position,rotation:t.rotation,scale:t.scale,unknown:t.unknown,pso_type_id:t.type_id,npc_id:t.npc_id,script_label:Math.round(t.script_label),pso_roaming:t.roaming}))}function la(e,{type_id:t,scale:i,roaming:o,area_id:s}){const n=Math.abs(i.y-1)>1e-5;switch(`${t}, ${o%3}, ${e}`){case"68, 0, 1":return I.c.Booma;case"68, 1, 1":return I.c.Gobooma;case"68, 2, 1":return I.c.Gigobooma;case"99, 0, 1":return I.c.EvilShark;case"99, 1, 1":return I.c.PalShark;case"99, 2, 1":return I.c.GuilShark;case"166, 0, 1":return I.c.Dimenian;case"166, 0, 2":return I.c.Dimenian2;case"166, 1, 1":return I.c.LaDimenian;case"166, 1, 2":return I.c.LaDimenian2;case"166, 2, 1":return I.c.SoDimenian;case"166, 2, 2":return I.c.SoDimenian2;case"214, 0, 2":return I.c.Mericarol;case"214, 1, 2":return I.c.Mericus;case"214, 2, 2":return I.c.Merikle;case"277, 0, 4":return I.c.Boota;case"277, 1, 4":return I.c.ZeBoota;case"277, 2, 4":return I.c.BaBoota;case"279, 0, 4":return I.c.Goran;case"279, 1, 4":return I.c.PyroGoran;case"279, 2, 4":return I.c.GoranDetonator}switch(`${t}, ${o%2}, ${e}`){case"64, 0, 1":return I.c.Hildebear;case"64, 0, 2":return I.c.Hildebear2;case"64, 1, 1":return I.c.Hildeblue;case"64, 1, 2":return I.c.Hildeblue2;case"65, 0, 1":return I.c.RagRappy;case"65, 0, 2":return I.c.RagRappy2;case"65, 0, 4":return I.c.SandRappy;case"65, 1, 1":return I.c.AlRappy;case"65, 1, 2":return I.c.LoveRappy;case"65, 1, 4":return I.c.DelRappy;case"128, 0, 1":return I.c.Dubchic;case"128, 0, 2":return I.c.Dubchic2;case"128, 1, 1":return I.c.Gilchic;case"128, 1, 2":return I.c.Gilchic2;case"212, 0, 2":return I.c.SinowBerill;case"212, 1, 2":return I.c.SinowSpigell;case"213, 0, 2":return I.c.Merillia;case"213, 1, 2":return I.c.Meriltas;case"215, 0, 2":return I.c.UlGibbon;case"215, 1, 2":return I.c.ZolGibbon;case"221, 0, 2":return I.c.Dolmolm;case"221, 1, 2":return I.c.Dolmdarl;case"224, 0, 2":return s>15?I.c.Epsilon:I.c.SinowZoa;case"224, 1, 2":return s>15?I.c.Epsilon:I.c.SinowZele;case"274, 0, 4":return I.c.MerissaA;case"274, 1, 4":return I.c.MerissaAA;case"276, 0, 4":return I.c.Zu;case"276, 1, 4":return I.c.Pazuzu;case"278, 0, 4":return I.c.Dorphon;case"278, 1, 4":return I.c.DorphonEclair;case"281, 0, 4":return n?I.c.SaintMilion:I.c.Kondrieu;case"281, 1, 4":return n?I.c.Shambertin:I.c.Kondrieu}switch(`${t}, ${e}`){case"66, 1":return I.c.Monest;case"66, 2":return I.c.Monest2;case"67, 1":return n?I.c.SavageWolf:I.c.BarbarousWolf;case"67, 2":return n?I.c.SavageWolf2:I.c.BarbarousWolf2;case"96, 1":return I.c.GrassAssassin;case"96, 2":return I.c.GrassAssassin2;case"97, 1":return s>15?I.c.DelLily:n?I.c.PoisonLily:I.c.NarLily;case"97, 2":return s>15?I.c.DelLily:n?I.c.PoisonLily2:I.c.NarLily2;case"98, 1":return I.c.NanoDragon;case"100, 1":return n?I.c.PofuillySlime:I.c.PouillySlime;case"101, 1":return I.c.PanArms;case"101, 2":return I.c.PanArms2;case"129, 1":return I.c.Garanz;case"129, 2":return I.c.Garanz2;case"130, 1":return n?I.c.SinowBeat:I.c.SinowGold;case"131, 1":return I.c.Canadine;case"132, 1":return I.c.Canane;case"133, 1":return I.c.Dubswitch;case"133, 2":return I.c.Dubswitch2;case"160, 1":return I.c.Delsaber;case"160, 2":return I.c.Delsaber2;case"161, 1":return I.c.ChaosSorcerer;case"161, 2":return I.c.ChaosSorcerer2;case"162, 1":return I.c.DarkGunner;case"164, 1":return I.c.ChaosBringer;case"165, 1":return I.c.DarkBelra;case"165, 2":return I.c.DarkBelra2;case"167, 1":return I.c.Bulclaw;case"168, 1":return I.c.Claw;case"192, 1":return I.c.Dragon;case"192, 2":return I.c.GalGryphon;case"193, 1":return I.c.DeRolLe;case"194, 1":return I.c.VolOptPart1;case"197, 1":return I.c.VolOptPart2;case"200, 1":return I.c.DarkFalz;case"202, 2":return I.c.OlgaFlow;case"203, 2":return I.c.BarbaRay;case"204, 2":return I.c.GolDragon;case"216, 2":return I.c.Gibbles;case"217, 2":return I.c.Gee;case"218, 2":return I.c.GiGue;case"219, 2":return I.c.Deldepth;case"220, 2":return I.c.Delbiter;case"222, 2":return I.c.Morfos;case"223, 2":return I.c.Recobox;case"225, 2":return I.c.IllGill;case"272, 4":return I.c.Astark;case"273, 4":return n?I.c.SatelliteLizard:I.c.Yowie;case"275, 4":return I.c.Girtablulu}switch(t){case 4:return I.c.FemaleFat;case 5:return I.c.FemaleMacho;case 7:return I.c.FemaleTall;case 10:return I.c.MaleDwarf;case 11:return I.c.MaleFat;case 12:return I.c.MaleMacho;case 13:return I.c.MaleOld;case 25:return I.c.BlueSoldier;case 26:return I.c.RedSoldier;case 27:return I.c.Principal;case 28:return I.c.Tekker;case 29:return I.c.GuildLady;case 30:return I.c.Scientist;case 31:return I.c.Nurse;case 32:return I.c.Irene;case 241:return I.c.ItemShop;case 254:return I.c.Nurse2}return I.c.Unknown}class _a{constructor(e,t,i,o,s){this._actions=Object(M.c)(),this.actions=this._actions,Object(q.m)(e,"id"),Object(q.m)(t,"section_id"),Object(q.f)(i,"wave"),Object(q.m)(o,"delay"),Object(q.l)(s,"unknown"),this.id=e,this.section_id=t,this.wave=i,this._delay=Object(M.e)(o),this.delay=this._delay,this.unknown=s}set_delay(e){Object(q.m)(e,"delay"),this._delay.val=e}add_action(e){this._actions.push(e)}remove_action(e){this._actions.remove(e)}}class ua{constructor(e,t,i){Object(q.m)(e,"id"),Object(q.m)(t,"area_id"),Object(q.m)(i,"section_id"),this._id=Object(M.e)(e),this.id=this._id,this._area_id=Object(M.e)(t),this.area_id=this._area_id,this._section_id=Object(M.e)(i),this.section_id=this._section_id}}const ha=Y.a.get("quest_editor/stores/model_conversion");function va(e,t){const i=new Map;return new Jn(e,t.id,t.language,t.name,t.short_description,t.long_description,t.episode,t.map_designations,t.objects.map(e=>new pe(e.type,e.id,e.group_id,e.area_id,e.section_id,Object(pn.b)(e.position),F(e.rotation.x,e.rotation.y,e.rotation.z),e.properties,e.unknown)),t.npcs.map(e=>(function(e,t){const i=0===t.wave?void 0:pa(e,t.area_id,t.section_id,t.wave);return new N(t.type,t.pso_type_id,t.npc_id,i,t.pso_wave2,t.script_label,t.pso_roaming,t.area_id,t.section_id,Object(pn.b)(t.position),F(t.rotation.x,t.rotation.y,t.rotation.z),Object(pn.b)(t.scale),t.unknown)})(i,e)),function(e,t){const i=new Map;for(const o of t){const t=`${o.id}-${o.area_id}`;let s=i.get(t);if(s&&s.event){ha.warn(`Ignored duplicate event #${o.id} for area ${o.area_id}.`);continue}const n=pa(e,o.area_id,o.section_id,o.wave),r=new _a(o.id,o.section_id,n,o.delay,o.unknown);s?s.event=r:(s={event:r,area_id:o.area_id,parents:[],child_ids:[]},i.set(t,s));for(const e of o.actions)switch(e.type){case gr.SpawnNpcs:r.add_action(new it(e.section_id,e.appear_flag));break;case gr.Unlock:r.add_action(new ot(e.door_id));break;case gr.Lock:r.add_action(new st(e.door_id));break;case gr.TriggerEvent:{s.child_ids.push(e.event_id);const t=`${e.event_id}-${o.area_id}`,n=i.get(t);n?n.parents.push(r):i.set(t,{area_id:o.area_id,parents:[r],child_ids:[]})}break;default:ha.warn(`Unknown event action type: ${e.type}.`)}}const o=new Map;for(const{area_id:e,event:t}of i.values())if(t){let i=o.get(e);i||(i=new Ke(e),o.set(e,i)),i.add_event(t,[],[])}for(const e of i.values())if(e.event)for(const t of e.child_ids){const s=i.get(`${t}-${e.area_id}`);s.event?o.get(e.area_id).add_edge(e.event,s.event):ha.warn(`Event ${e.event.id} calls nonexistent event ${t}.`)}return o}(i,t.events),t.dat_unknowns,t.object_code.slice(),t.shop_items)}function pa(e,t,i,o){const s=`${t}-${i}-${o}`;let n=e.get(s);return n||(n=new ua(o,t,i),e.set(s,n)),n}function ga(e){const t=[];for(const i of e.values())for(const e of i.events){const o=e.actions.val.map(e=>{switch(e.type){case Ze.SpawnNpcs:return{type:gr.SpawnNpcs,section_id:e.section_id,appear_flag:e.appear_flag};case Ze.Unlock:return{type:gr.Unlock,door_id:e.door_id.val};case Ze.Lock:return{type:gr.Lock,door_id:e.door_id.val}}});for(const t of i.get_children(e))o.push({type:gr.TriggerEvent,event_id:t.id});t.push({id:e.id,section_id:e.section_id,wave:e.wave.id.val,delay:e.delay.val,actions:o,area_id:i.area_id,unknown:e.unknown})}return t}var ba=i(455),fa=function(e,t,i,o){return new(i||(i=Promise))((function(s,n){function r(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const ma=Y.a.get("quest_editor/controllers/QuestEditorToolBarController");class wa extends Yn.a{constructor(e,t,i){super(),this.area_store=t,this.quest_editor_store=i,this._result_dialog_visible=Object(M.e)(!1),this._result=Object(M.e)(void 0),this._result_problems_message=Object(M.e)(""),this._result_error_message=Object(M.e)(""),this._save_as_dialog_visible=Object(M.e)(!1),this._filename=Object(M.e)(""),this._version=Object(M.e)(Co.BB),this.result_dialog_visible=this._result_dialog_visible,this.result=this._result,this.result_problems_message=this._result_problems_message,this.result_error_message=this._result_error_message,this.save_as_dialog_visible=this._save_as_dialog_visible,this.filename=this._filename,this.version=this._version,this.create_new_quest=e=>fa(this,void 0,void 0,(function*(){this.set_filename(""),this.set_version(Co.BB),this.quest_editor_store.set_current_quest(ir(this.area_store,e))})),this.parse_files=e=>fa(this,void 0,void 0,(function*(){try{if(0===e.length)return;let t;const i=e.find(e=>e.name.toLowerCase().endsWith(".qst"));if(i){const e=yield Object(or.b)(i),o=function(e,t=!1){const i=Dr(e);if(!i)return;let o,s;for(const e of i.files){const t=e.filename.trim().toLowerCase();t.endsWith(".dat")?o=e:t.endsWith(".bin")&&(s=e)}if(!o)return void ra.error("File contains no DAT file.");if(!s)return void ra.error("File contains no BIN file.");const n=aa(new $o.a(s.data,zo.a.Little),new $o.a(o.data,zo.a.Little),t);return n&&{quest:n,version:i.version,online:i.online}}(new $o.a(e,zo.a.Little));if(!o||!o.quest)throw new Error("Couldn't parse quest file.");t=o.quest,this.set_version(o.version),this.set_filename(Object(q.e)(i.name))}else{const i=e.find(e=>e.name.toLowerCase().endsWith(".bin")),o=e.find(e=>e.name.toLowerCase().endsWith(".dat"));if(!i||!o)throw new Error("Please select one .qst file or one .bin and one .dat file.");{const e=yield Object(or.b)(i),s=yield Object(or.b)(o);if(t=aa(new $o.a(e,zo.a.Little),new $o.a(s,zo.a.Little)),!t)throw new Error("Couldn't parse .bin or .dat file.");this.set_filename(Object(q.e)(i.name||o.name))}}yield this.quest_editor_store.set_current_quest(t&&va(this.area_store,t))}catch(e){ma.error("Couldn't read file.",e),this.set_result(Object(ba.a)([{severity:ls.b.Error,ui_message:e.message}]))}})),this.set_area=({area:e})=>{this.quest_editor_store.set_current_area(e)},this.save_as_clicked=()=>{this.quest_editor_store.current_quest.val&&(this._save_as_dialog_visible.val=!0)},this.save_as=()=>{const e=this.quest_editor_store.current_quest.val;if(!e)return;const t=this.version.val;if(void 0===t)return;let i=this.filename.val;const o=da(function(e){return{id:e.id.val,language:e.language.val,name:e.name.val,short_description:e.short_description.val,long_description:e.long_description.val,episode:e.episode,objects:e.objects.val.map(e=>({type:e.type,area_id:e.area_id,section_id:e.section_id.val,position:e.position.val.clone(),rotation:e.rotation.val.clone(),unknown:e.unknown,id:e.id,group_id:e.group_id,properties:new Map(e.properties)})),npcs:e.npcs.val.map(e=>{var t,i;return{type:e.type,area_id:e.area_id,section_id:e.section_id.val,wave:null!==(i=null===(t=e.wave.val)||void 0===t?void 0:t.id.val)&&void 0!==i?i:0,pso_wave2:e.pso_wave2.val,position:e.position.val.clone(),rotation:e.rotation.val.clone(),scale:e.scale.clone(),unknown:e.unknown,pso_type_id:e.pso_type_id,npc_id:e.npc_id,script_label:e.script_label,pso_roaming:e.pso_roaming}}),events:ga(e.event_dags),dat_unknowns:e.dat_unknowns.map(e=>Object.assign({},e)),object_code:e.object_code.map(e=>Eo(e)),shop_items:e.shop_items.slice(),map_designations:new Map(e.map_designations.val)}}(e),i,t,!0);i.endsWith(".qst")||(i+=".qst");const s=document.createElement("a");s.href=URL.createObjectURL(new Blob([o],{type:"application/octet-stream"})),s.download=i,document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s),this.dismiss_save_as_dialog()},this.dismiss_save_as_dialog=()=>{this._save_as_dialog_visible.val=!1},this.set_filename=e=>{this._filename.val=e},this.set_version=e=>{switch(e){case Co.DC:case Co.GC:this._version.val=Co.GC;break;case Co.PC:case Co.BB:this._version.val=Co.BB}},this.debug=()=>{const e=this.quest_editor_store.current_quest.val;e&&this.quest_editor_store.quest_runner.run(e)},this.resume=()=>{this.quest_editor_store.quest_runner.resume()},this.step_over=()=>{this.quest_editor_store.quest_runner.step_over()},this.step_in=()=>{this.quest_editor_store.quest_runner.step_into()},this.step_out=()=>{this.quest_editor_store.quest_runner.step_out()},this.stop=()=>{this.quest_editor_store.quest_runner.stop()},this.dismiss_result_dialog=()=>{this._result_dialog_visible.val=!1},this.vm_feature_active=e.feature_active("vm"),this.areas=i.current_quest.flat_map(e=>e?null==e?void 0:e.entities_per_area.flat_map(i=>Object(M.c)(void 0,...t.get_areas_for_episode(e.episode).map(e=>{const t=i.get(e.id);return{area:e,label:e.name+(t?` (${t})`:"")}}))):Object(M.c)()),this.current_area=Object(M.d)((e,t)=>e.find(e=>e.area==t),this.areas,i.current_area);const o=i.current_quest.map(e=>null!=e);this.can_save=o,this.can_select_area=o,this.can_debug=o,this.can_undo=Object(M.d)((e,t)=>e&&!t,Is.can_undo,i.quest_runner.running),this.can_redo=Object(M.d)((e,t)=>e&&!t,Is.can_redo,i.quest_runner.running),this.can_step=i.quest_runner.paused,this.can_stop=i.quest_runner.running,this.disposables(e.on_global_keydown(Ge.b.QuestEditor,"Ctrl-O",()=>fa(this,void 0,void 0,(function*(){const e=yield Object(or.a)({accept:".bin, .dat, .qst",multiple:!0});this.parse_files(e)}))),e.on_global_keydown(Ge.b.QuestEditor,"Ctrl-Shift-S",this.save_as_clicked),e.on_global_keydown(Ge.b.QuestEditor,"Ctrl-Z",()=>{Is.undo()}),e.on_global_keydown(Ge.b.QuestEditor,"Ctrl-Shift-Z",()=>{Is.redo()}),e.on_global_keydown(Ge.b.QuestEditor,"Ctrl-Y",()=>{Is.redo()}),e.on_global_keydown(Ge.b.QuestEditor,"F5",this.debug),e.on_global_keydown(Ge.b.QuestEditor,"Shift-F5",this.stop),e.on_global_keydown(Ge.b.QuestEditor,"F6",this.resume),e.on_global_keydown(Ge.b.QuestEditor,"F8",this.step_over),e.on_global_keydown(Ge.b.QuestEditor,"F7",this.step_in),e.on_global_keydown(Ge.b.QuestEditor,"Shift-F8",this.step_out))}set_result(e){this._result.val=e,e.problems.length&&(this._result_dialog_visible.val=!0)}}class ka{constructor(e,t,i){this.quest=e,this.old=t,this.new=i}}class ya extends ka{constructor(){super(...arguments),this.description="Edit ID"}undo(){this.quest.set_id(this.old)}redo(){this.quest.set_id(this.new)}}class Ra extends ka{constructor(){super(...arguments),this.description="Edit name"}undo(){this.quest.set_name(this.old)}redo(){this.quest.set_name(this.new)}}class Ia extends ka{constructor(){super(...arguments),this.description="Edit short description"}undo(){this.quest.set_short_description(this.old)}redo(){this.quest.set_short_description(this.new)}}class xa extends ka{constructor(){super(...arguments),this.description="Edit long description"}undo(){this.quest.set_long_description(this.old)}redo(){this.quest.set_long_description(this.new)}}class ja extends Yn.a{constructor(e){super(),this.store=e,this.focused=()=>{this.store.undo.make_current()},this.set_id=e=>{const t=this.current_quest.val;t&&this.store.undo.push(new ya(t,t.id.val,e)).redo()},this.set_name=e=>{const t=this.current_quest.val;t&&this.store.undo.push(new Ra(t,t.name.val,e)).redo()},this.set_short_description=e=>{const t=this.current_quest.val;t&&this.store.undo.push(new Ia(t,t.short_description.val,e)).redo()},this.set_long_description=e=>{const t=this.current_quest.val;t&&this.store.undo.push(new xa(t,t.long_description.val,e)).redo()},this.current_quest=e.current_quest,this.enabled=e.quest_runner.running.map(e=>!e),this.unavailable=this.current_quest.map(e=>null==e)}}const Ta=Object.freeze(new y.Vector3),Ca=Object.freeze(new y.Euler);class Sa extends Yn.a{constructor(e){super(),this.store=e,this.focused=()=>{this.store.undo.make_current()};const t=e.selected_entity;this.unavailable=t.map(e=>null==e),this.enabled=e.quest_runner.running.map(e=>!e),this.type=t.map(e=>e instanceof N?"NPC":"Object"),this.name=t.map(e=>null==e?"":L(e.type).name),this.section_id=t.flat_map(e=>null==e?Object(M.e)(""):e.section_id.map(e=>e.toString())),this.wave=t.flat_map(e=>e instanceof N?e.wave.flat_map(e=>{var t,i;return null!==(i=null===(t=null==e?void 0:e.id)||void 0===t?void 0:t.map(e=>e.toString()))&&void 0!==i?i:Object(M.e)("None")}):Object(M.e)("")),this.wave_hidden=t.map(e=>!(e instanceof N)),this.position=t.flat_map(e=>{var t;return null!==(t=null==e?void 0:e.position)&&void 0!==t?t:Object(M.e)(Ta)}),this.rotation=t.flat_map(e=>{var t;return null!==(t=null==e?void 0:e.rotation)&&void 0!==t?t:Object(M.e)(Ca)})}set_pos_x(e){const t=this.store.selected_entity.val;if(t){const i=t.position.val;this.store.undo.push(new me(this.store,t,t.section.val,t.section.val,i,new y.Vector3(e,i.y,i.z),!1)).redo()}}set_pos_y(e){const t=this.store.selected_entity.val;if(t){const i=t.position.val;this.store.undo.push(new me(this.store,t,t.section.val,t.section.val,i,new y.Vector3(i.x,e,i.z),!1)).redo()}}set_pos_z(e){const t=this.store.selected_entity.val;if(t){const i=t.position.val;this.store.undo.push(new me(this.store,t,t.section.val,t.section.val,i,new y.Vector3(i.x,i.y,e),!1)).redo()}}set_rot_x(e){const t=this.store.selected_entity.val;if(t){const i=t.rotation.val;this.store.undo.push(new be(this.store,t,i,F(Object(W.b)(e),i.y,i.z),!1)).redo()}}set_rot_y(e){const t=this.store.selected_entity.val;if(t){const i=t.rotation.val;this.store.undo.push(new be(this.store,t,i,F(i.x,Object(W.b)(e),i.z),!1)).redo()}}set_rot_z(e){const t=this.store.selected_entity.val;if(t){const i=t.rotation.val;this.store.undo.push(new be(this.store,t,i,F(i.x,i.y,Object(W.b)(e)),!1)).redo()}}}class Oa extends Yn.a{constructor(e){super(),this.unavailable=e.current_quest.map(e=>null==e),this.npc_counts=e.current_quest.flat_map(e=>e?e.npcs:Object(M.e)([])).map(this.update_view)}update_view(e){const t=new Map;for(const i of e)if(i.type!==I.c.VolOptPart2){const e=t.get(i.type)||0;t.set(i.type,e+1)}const i=8*(t.get(I.c.Canane)||0);return[...t].sort((e,t)=>e[0]-t[0]).map(([e,t])=>{const o=e===I.c.Canadine?i:0;return{name:Object(I.d)(e).name,count:t+o}})}}class La{constructor(e,t,i){this.event=e,this.old_delay=t,this.new_delay=i,this.description=`Edit delay of event ${e.id}`}undo(){this.event.set_delay(this.old_delay)}redo(){this.event.set_delay(this.new_delay)}}class Da{constructor(e,t,i,o){this.store=e,this.quest=t,this.event_dag=i,this.event=o,this.new_edges=[],this.description=`Delete event ${o.id}`,this.parents=i.get_parents(o).slice(),this.children=i.get_children(o).slice();for(const e of this.parents){const t=i.get_children(e);for(const i of this.children)t.includes(i)||this.new_edges.push({parent:e,child:i})}this.npcs=t.npcs.val.filter(e=>e.wave.val===o.wave),this.event_index=i.get_index(o)}undo(){this.quest.insert_event(this.event_index,this.event,this.parents,this.children);for(const{parent:e,child:t}of this.new_edges)this.event_dag.remove_edge(e,t);for(const e of this.npcs)e.set_wave(this.event.wave)}redo(){this.store.selected_wave.val===this.event.wave&&this.store.set_selected_wave(void 0);for(const{parent:e,child:t}of this.new_edges)this.event_dag.add_edge(e,t);this.quest.remove_event(this.event_dag,this.event)}}class Ba{constructor(e,t,i,o){this.quest=e,this.event_dag=t,this.event=i,this.parent_event=o,this.description=`Add event ${i.id}`}undo(){this.quest.remove_event(this.event_dag,this.event)}redo(){this.quest.add_event(this.event,this.parent_event?[this.parent_event]:[],[])}}class Pa extends Yn.a{constructor(e){super(),this.store=e,this.focused=()=>{this.store.undo.make_current()},this.add_event=()=>{var e,t,i,o;const s=this.store.current_quest.val,n=this.store.current_area.val;if(s&&n){const r=s.get_event_dag_or_create(n.id),a=r.events.find(e=>e.wave===this.store.selected_wave.val),d=null!==(o=null!==(e=null==a?void 0:a.section_id)&&void 0!==e?e:null===(i=null===(t=this.store.selected_entity.val)||void 0===t?void 0:t.section_id)||void 0===i?void 0:i.val)&&void 0!==o?o:1,c=[],l=[];for(const e of r.events)c.push(e.id),e.wave.section_id.val===d&&l.push(e.wave.id.val);c.sort((e,t)=>e-t),l.sort((e,t)=>e-t);let _,u=0;for(const e of l)if(++u!==e)break;if(u===l.length&&u++,a){let e=a;for(;;){const[t]=r.get_parents(e);if(!t)break;e=t}const t=r.get_sub_graph(e).length.val;_=`${e.id}${t}`}else _=`${d}${u}`;let h=parseInt(_,10),v=0;for(;v=c.indexOf(h,v),-1!==v;)h++;this.store.undo.push(new Ba(s,r,new _a(h,d,new ua(u,n.id,d),30,0),a)).redo()}},this.remove_event=e=>{const t=this.store.current_quest.val,i=this.event_dag.val;t&&i&&this.store.undo.push(new Da(this.store,t,i,e)).redo()},this.set_selected_wave=e=>{this.store.set_selected_wave(e)},this.set_delay=(e,t)=>{this.store.undo.push(new La(e,e.delay.val,t)).redo()},this.enabled=e.quest_runner.running.map(e=>!e),this.unavailable=e.current_quest.map(e=>null==e),this.event_dag=Object(M.d)((e,t)=>e&&t?e.event_dags.get(t.id):void 0,e.current_quest,e.current_area),this.event_sub_graphs=Object(M.b)(e=>{var t;return null!==(t=null==e?void 0:e.connected_sub_graphs)&&void 0!==t?t:Object(M.c)()},this.event_dag)}is_selected(e){return this.store.selected_wave.map(t=>e.wave===t)}add_action(e,t){let i;switch(t){case Ze.SpawnNpcs:i=new it(0,0);break;case Ze.Unlock:i=new ot(0);break;case Ze.Lock:i=new st(0)}e.add_action(i)}remove_action(e,t){e.remove_action(t)}}function Ea(e,t,i){const o=new a.a,s=o.add(new mn(e)),n=o.add(new qn(e)),r=o.add(new an(s)),d=o.add(new Es(t,r)),c=o.add(new Zs(d)),l=new An,_=o.add(new Sn(n,i));return{view:o.add(new ys(t,d,l,o.add(new Qn(o.add(new wa(t,r,d)))),()=>new f(o.add(new ja(d))),()=>new m(o.add(new Oa(d))),()=>new Ee(d,s,n,i()),()=>new Ae(t,d.quest_runner,c),()=>new Ne(o.add(new Sa(d))),()=>new Qe(d,_),()=>new Ye(d,_),()=>new ht(o.add(new Pa(d))),()=>new gs(d,s,n,i()),()=>new cs(d.quest_runner))),dispose(){o.dispose()}}}}}]);