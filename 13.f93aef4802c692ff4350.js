(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{456:function(t,e,i){"use strict";var s;i.d(e,"a",(function(){return s})),function(t){t[t.Little=0]="Little",t[t.Big=1]="Big"}(s||(s={}))},467:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var s=i(456),n=i(550);class o extends n.a{constructor(t,e){super(e),this.endianness=t}get endianness(){return this.little_endian?s.a.Little:s.a.Big}set endianness(t){this.little_endian=t===s.a.Little}u8(){this.check_size(1);const t=this.dv.getUint8(this.absolute_position);return this._position++,t}u16(){this.check_size(2);const t=this.dv.getUint16(this.absolute_position,this.little_endian);return this._position+=2,t}u32(){this.check_size(4);const t=this.dv.getUint32(this.absolute_position,this.little_endian);return this._position+=4,t}i8(){this.check_size(1);const t=this.dv.getInt8(this.absolute_position);return this._position++,t}i16(){this.check_size(2);const t=this.dv.getInt16(this.absolute_position,this.little_endian);return this._position+=2,t}i32(){this.check_size(4);const t=this.dv.getInt32(this.absolute_position,this.little_endian);return this._position+=4,t}f32(){this.check_size(4);const t=this.dv.getFloat32(this.absolute_position,this.little_endian);return this._position+=4,t}u8_array(t){this.check_size(t);const e=[];for(let i=0;i<t;++i)e.push(this.dv.getUint8(this.absolute_position)),this._position++;return e}u16_array(t){this.check_size(2*t);const e=[];for(let i=0;i<t;++i)e.push(this.dv.getUint16(this.absolute_position,this.little_endian)),this._position+=2;return e}u32_array(t){this.check_size(4*t);const e=[];for(let i=0;i<t;++i)e.push(this.dv.getUint32(this.absolute_position,this.little_endian)),this._position+=4;return e}i32_array(t){this.check_size(4*t);const e=[];for(let i=0;i<t;++i)e.push(this.dv.getInt32(this.absolute_position,this.little_endian)),this._position+=4;return e}array_buffer(t=this.size-this.position){this.check_size(t);const e=this.backing_buffer.slice(this.absolute_position,this.absolute_position+t);return this._position+=t,e}copy_to_uint8_array(t,e=this.size-this.position){return this.check_size(e),t.set(new Uint8Array(this.backing_buffer,this.absolute_position,e)),this._position+=e,this}write_u8(t){return this.check_size(1),this.dv.setUint8(this.absolute_position,t),this._position++,this}write_u16(t){return this.check_size(2),this.dv.setUint16(this.absolute_position,t,this.little_endian),this._position+=2,this}write_u32(t){return this.check_size(4),this.dv.setUint32(this.absolute_position,t,this.little_endian),this._position+=4,this}write_i8(t){return this.check_size(1),this.dv.setInt8(this.absolute_position,t),this._position++,this}write_i16(t){return this.check_size(2),this.dv.setInt16(this.absolute_position,t,this.little_endian),this._position+=2,this}write_i32(t){return this.check_size(4),this.dv.setInt32(this.absolute_position,t,this.little_endian),this._position+=4,this}write_f32(t){return this.check_size(4),this.dv.setFloat32(this.absolute_position,t,this.little_endian),this._position+=4,this}write_u8_array(t){return this.check_size(t.length),new Uint8Array(this.backing_buffer,this.absolute_position,t.length).set(new Uint8Array(t)),this._position+=t.length,this}write_cursor(t){const e=t.size-t.position;return this.check_size(e),t.copy_to_uint8_array(new Uint8Array(this.backing_buffer,this.absolute_position,e),e),this._position+=e,this}}class r extends o{constructor(t,e,i=0,s=t.byteLength-i){super(e,i),this._size=s,this.backing_buffer=t,this.dv=new DataView(t,0,t.byteLength)}get size(){return this._size}set size(t){if(t>this.backing_buffer.byteLength-this.offset)throw new Error(`Size ${t} is out of bounds.`);this._size=t}take(t){const e=this.offset+this.position,i=new r(this.backing_buffer,this.endianness,e,t);return this._position+=t,i}}},539:function(t,e,i){"use strict";i.d(e,"a",(function(){return _})),i.d(e,"b",(function(){return u}));var s=i(521),n=i(23),o=i(463),r=i(27);const a=n.a.get("core/data_formats/parsing/ninja/texture"),h=1213027928,c=1414682200;function _(t){const e=Object(s.b)(t,!0);return t.seek_start(0),e.success&&null!=e.value.find(t=>t.type===h||t.type===c)}function u(t){const e=Object(s.a)(t);if(!e.success)return e;const i=Object(o.b)(a);i.add_result(e);const n=e.value,_=n.find(t=>t.type===h),u=_&&function(t){return{texture_count:t.u16()}}(_.data),l=n.filter(t=>t.type===c).map(t=>(function(t){const e=t.u32(),i=t.u32(),s=t.u32(),n=t.u16(),o=t.u16(),r=t.u32();return t.seek(36),{id:s,format:[e,i],width:n,height:o,size:r,data:t.array_buffer(r)}})(t.data));return u||0!==l.length?(u&&u.texture_count!==l.length&&i.add_problem(r.b.Warning,"Corrupted XVM file.",`Found ${l.length} textures instead of ${u.texture_count} as defined in the header.`),i.success({textures:l})):(i.add_problem(r.b.Error,"Corrupted XVM file.","No header and no XVRT chunks found."),i.failure())}},545:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var s=i(23),n=i(463),o=i(27);const r=s.a.get("core/data_formats/parsing/afs"),a=5457473;function h(t){const e=Object(n.b)(r);if(t.bytes_left<8)return e.add_problem(o.b.Error,"AFS archive is corrupted.","Too small to be an AFS archive.").failure();if(t.u32()!==a)return e.add_problem(o.b.Error,"AFS archive is corrupted.","Magic bytes not present.").failure();const i=t.u16();t.seek(2);const s=[];for(let n=1;n<=i;n++){if(t.bytes_left<8){e.add_problem(o.b.Warning,`AFS file entry ${n} is invalid.`,`Couldn't read file entry ${n}, only ${t.bytes_left} bytes left.`);break}const i=t.u32(),r=t.u32();if(i>t.size)e.add_problem(o.b.Warning,`AFS file entry ${n} is invalid.`,`Invalid file offset ${i} for entry ${n}.`);else if(i+r>t.size)e.add_problem(o.b.Warning,`AFS file entry ${n} is invalid.`,`File size ${r} (offset: ${i}) of entry ${n} too large.`);else{const e=t.position;t.seek_start(i),s.push(t.array_buffer(r)),t.seek_start(e)}}return e.success(s)}},550:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));class s{constructor(t){this._position=0,this.offset=t}get position(){return this._position}get bytes_left(){return this.size-this._position}get absolute_position(){return this.offset+this._position}seek(t){return this.seek_start(this.position+t)}seek_start(t){if(t<0||t>this.size)throw new Error(`Offset ${t} is out of bounds.`);return this._position=t,this}seek_end(t){if(t<0||t>this.size)throw new Error(`Offset ${t} is out of bounds.`);return this._position=this.size-t,this}vec2_f32(){return{x:this.f32(),y:this.f32()}}vec3_f32(){return{x:this.f32(),y:this.f32(),z:this.f32()}}string_ascii(t,e,i){const s=[];for(let n=0;n<t;n++){const o=this.u8();if(e&&0===o){i&&this.seek(t-n-1);break}s.push(o)}return String.fromCodePoint(...s)}string_utf16(t,e,i){const s=[],n=Math.floor(t/2);for(let t=0;t<n;t++){const o=this.u16();if(e&&0===o){i&&this.seek(2*(n-t-1));break}s.push(o)}return String.fromCodePoint(...s)}write_u8_array(t){const e=t.length;this.check_size(e);for(let i=0;i<e;i++)this.write_u8(t[i]);return this}write_u16_array(t){const e=t.length;this.check_size(2*e);for(let i=0;i<e;i++)this.write_u16(t[i]);return this}write_u32_array(t){const e=t.length;this.check_size(4*e);for(let i=0;i<e;i++)this.write_u32(t[i]);return this}write_i32_array(t){const e=t.length;this.check_size(4*e);for(let i=0;i<e;i++)this.write_i32(t[i]);return this}write_vec2_f32(t){return this.check_size(8),this.write_f32(t.x),this.write_f32(t.y),this}write_vec3_f32(t){return this.check_size(12),this.write_f32(t.x),this.write_f32(t.y),this.write_f32(t.z),this}write_string_ascii(t,e){this.check_size(e);const i=Math.min(e,t.length);for(let e=0;e<i;e++)this.write_u8(t.codePointAt(e));const s=e-i;for(let t=0;t<s;t++)this.write_u8(0);return this}write_string_utf16(t,e){this.check_size(e);const i=Math.floor(e/2),s=Math.min(i,t.length);for(let e=0;e<s;e++)this.write_u16(t.codePointAt(e));const n=i-s;for(let t=0;t<n;t++)this.write_u16(0);return this}check_size(t){const e=this.size-this._position;if(t>e)throw new Error(`${t} Bytes required but only ${e} available.`)}}},632:function(t,e,i){"use strict";i.d(e,"g",(function(){return n})),i.d(e,"h",(function(){return o})),i.d(e,"f",(function(){return r})),i.d(e,"e",(function(){return a})),i.d(e,"k",(function(){return h})),i.d(e,"l",(function(){return c})),i.d(e,"j",(function(){return _})),i.d(e,"i",(function(){return u})),i.d(e,"a",(function(){return l})),i.d(e,"b",(function(){return d})),i.d(e,"d",(function(){return f})),i.d(e,"c",(function(){return y}));class s{constructor(t){var e,i,s,n,o;this.name=t.name,this.body_style_count=null!==(e=t.body_style_count)&&void 0!==e?e:1,this.head_style_count=t.head_style_count,this.hair_style_count=t.hair_style_count,this.hair_styles_with_accessory=t.hair_styles_with_accessory,this.body_tex_ids=null!==(i=t.body_tex_ids)&&void 0!==i?i:[],this.head_tex_ids=null!==(s=t.head_tex_ids)&&void 0!==s?s:[],this.hair_tex_ids=null!==(n=t.hair_tex_ids)&&void 0!==n?n:[],this.accessory_tex_ids=null!==(o=t.accessory_tex_ids)&&void 0!==o?o:[]}}const n=new s({name:"HUmar",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([6])}),o=new s({name:"HUnewearl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set}),r=new s({name:"HUcast",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),a=new s({name:"HUcaseal",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),h=new s({name:"RAmar",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),c=new s({name:"RAmarl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),_=new s({name:"RAcast",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),u=new s({name:"RAcaseal",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),l=new s({name:"FOmar",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),d=new s({name:"FOmarl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),f=new s({name:"FOnewm",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),y=new s({name:"FOnewearl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])})},826:function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterClassAssetLoader",(function(){return d}));var s=i(499),n=i(467),o=i(456),r=i(544),a=i(632),h=i(539),c=i(545),_=i(31),u=i(463),l=function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))};class d{constructor(t){this.http_client=t,this.nj_object_cache=new Map,this.xvr_texture_cache=new Map,this.nj_motion_cache=new Map}dispose(){for(const t of this.nj_object_cache.values())t.dispose();for(const t of this.nj_motion_cache.values())t.dispose();this.nj_object_cache.clear(),this.nj_motion_cache.clear()}load_geometry(t){let e=this.nj_object_cache.get(t.name);return e||(e=this.load_all_nj_objects(t),this.nj_object_cache.set(t.name,e)),e}load_all_nj_objects(t){const e=f(t,_.e.Viridia,0);return this.load_body_part_geometry(t.name,"Body").then(i=>{if(!i)throw new Error(`Couldn't load body for player class ${t.name}.`);return this.load_body_part_geometry(t.name,"Head",0).then(s=>{if(!s)return i;let n=1+e.body.length;return this.shift_texture_ids(s,n),this.add_to_bone(i,s,59),0===t.hair_style_count?i:this.load_body_part_geometry(t.name,"Hair",0).then(o=>o?(n+=e.head.length,this.shift_texture_ids(o,n),this.add_to_bone(s,o,0),t.hair_styles_with_accessory.has(0)?this.load_body_part_geometry(t.name,"Accessory",0).then(t=>(t&&(n+=e.hair.length,this.shift_texture_ids(t,n),this.add_to_bone(o,t,0)),i)):i):i)})})}load_body_part_geometry(t,e,i){return this.http_client.get(function(t,e,i){return`/player/${t}${e}${null==i?"":i}.nj`}(t,e,i)).array_buffer().then(t=>Object(u.d)(Object(s.c)(new n.a(t,o.a.Little)))[0])}shift_texture_ids(t,e){if(t.model)for(const i of t.model.meshes)null!=i.texture_id&&(i.texture_id+=e);for(const i of t.children)this.shift_texture_ids(i,e)}add_to_bone(t,e,i){const s=t.get_bone(i);s&&(s.evaluation_flags.hidden=!1,s.evaluation_flags.break_child_trace=!1,s.add_child(e))}load_textures(t,e,i){return l(this,void 0,void 0,(function*(){let s=this.xvr_texture_cache.get(t.name);s||(s=this.http_client.get(`/player/${t.name}Tex.afs`).array_buffer().then(t=>{const e=Object(c.a)(new n.a(t,o.a.Little)),i=[];if(e.success)for(const t of e.value){const e=Object(h.b)(new n.a(t,o.a.Little));e.success&&i.push(...e.value.textures)}return i}));const r=yield s,a=f(t,e,i);return[a.section_id,...a.body,...a.head,...a.hair,...a.accessories].map(t=>null==t?void 0:r[t])}))}load_animation(t,e){let i=this.nj_motion_cache.get(t);return i||(i=this.http_client.get(`/player/animation/animation_${t.toString().padStart(3,"0")}.njm`).array_buffer().then(t=>Object(r.c)(new n.a(t,o.a.Little),e))),i}}function f(t,e,i){switch(t){case a.g:{const t=3*i;return{section_id:e+126,body:[t,t+1,t+2,i+108],head:[54,55],hair:[94,95],accessories:[]}}case a.h:{const t=13*i;return{section_id:e+299,body:[t+13,t,t+1,t+2,t+3,277,i+281],head:[235,239],hair:[260,259],accessories:[]}}case a.f:{const t=5*i;return{section_id:e+275,body:[t,t+1,t+2,i+250],head:[t+3,t+4],hair:[],accessories:[]}}case a.e:{const t=5*i;return{section_id:e+375,body:[t,t+1,t+2],head:[t+3,t+4],hair:[],accessories:[]}}case a.k:{const t=7*i;return{section_id:e+197,body:[t+4,t+5,t+6,i+179],head:[126,127],hair:[166,167],accessories:[void 0,void 0,t+2]}}case a.l:{const t=16*i;return{section_id:e+322,body:[t+15,t+1,t],head:[288],hair:[308,309],accessories:[void 0,void 0,t+8]}}case a.j:{const t=5*i;return{section_id:e+300,body:[t,t+1,t+2,t+3,i+275],head:[t+4],hair:[],accessories:[]}}case a.i:{const t=5*i;return{section_id:e+375,body:[i+350,t,t+1,t+2],head:[t+3],hair:[t+4],accessories:[]}}case a.a:{const t=0===i?0:15*i+2;return{section_id:e+310,body:[t+12,t+13,t+14,t],head:[276,272],hair:[void 0,296,297],accessories:[t+4]}}case a.b:{const t=16*i;return{section_id:e+326,body:[t,t+2,t+1,322],head:[288],hair:[void 0,void 0,308],accessories:[t+3,t+4]}}case a.d:{const t=17*i;return{section_id:e+344,body:[t+4,340,t,t+5],head:[306,310],hair:[void 0,void 0,330],accessories:[t+6,t+16,330]}}case a.c:{const t=26*i;return{section_id:e+505,body:[t+1,t,t+2,501],head:[472,468],hair:[void 0,void 0,492],accessories:[t+12,t+13]}}default:throw new Error(`No textures for character class ${t.name}.`)}}}}]);