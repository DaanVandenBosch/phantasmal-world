(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{545:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var i=s(23),r=s(463),n=s(27);const o=i.a.get("core/data_formats/parsing/afs"),a=5457473;function l(e){const t=Object(r.b)(o);if(e.bytes_left<8)return t.add_problem(n.b.Error,"AFS archive is corrupted.","Too small to be an AFS archive.").failure();if(e.u32()!==a)return t.add_problem(n.b.Error,"AFS archive is corrupted.","Magic bytes not present.").failure();const s=e.u16();e.seek(2);const i=[];for(let r=1;r<=s;r++){if(e.bytes_left<8){t.add_problem(n.b.Warning,`AFS file entry ${r} is invalid.`,`Couldn't read file entry ${r}, only ${e.bytes_left} bytes left.`);break}const s=e.u32(),o=e.u32();if(s>e.size)t.add_problem(n.b.Warning,`AFS file entry ${r} is invalid.`,`Invalid file offset ${s} for entry ${r}.`);else if(s+o>e.size)t.add_problem(n.b.Warning,`AFS file entry ${r} is invalid.`,`File size ${o} (offset: ${s}) of entry ${r} too large.`);else{const t=e.position;e.seek_start(s),i.push(e.array_buffer(o)),e.seek_start(t)}}return t.success(i)}},828:function(e,t,s){"use strict";s.r(t),s.d(t,"ModelToolBarController",(function(){return p}));var i=s(140),r=s(498),n=s(467),o=s(455),a=s(499),l=s(544),_=s(539),u=s(545),c=s(23),h=s(630),m=s(463),d=s(27),f=s(14),b=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(e){n(e)}}function a(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};const v=c.a.get("viewer/controllers/model/ModelToolBarController");class p extends i.a{constructor(e){super(),this.store=e,this._result_dialog_visible=Object(f.e)(!1),this._result=Object(f.e)(void 0),this._result_problems_message=Object(f.e)(""),this._result_error_message=Object(f.e)(""),this.result_dialog_visible=this._result_dialog_visible,this.result=this._result,this.result_problems_message=this._result_problems_message,this.result_error_message=this._result_error_message,this.set_show_skeleton=e=>{this.store.set_show_skeleton(e)},this.set_animation_playing=e=>{this.store.set_animation_playing(e)},this.set_animation_frame_rate=e=>{this.store.set_animation_frame_rate(e)},this.set_animation_frame=e=>{this.store.set_animation_frame(e)},this.load_file=e=>b(this,void 0,void 0,(function*(){this._result_problems_message.val=`Encountered some problems while opening "${e.name}".`,this._result_error_message.val=`Couldn't open "${e.name}".`;try{const t=yield Object(r.b)(e),s=new n.a(t,o.a.Little);if(e.name.endsWith(".nj")){const e=Object(a.c)(s);this.set_result(e),e.success&&this.store.set_current_nj_object(e.value[0])}else if(e.name.endsWith(".xj")){const e=Object(a.d)(s);this.set_result(e),e.success&&this.store.set_current_nj_object(e.value[0])}else if(e.name.endsWith(".njm")){this.store.set_current_animation(void 0),this.store.set_current_nj_motion(void 0);const e=this.store.current_nj_object.val;e?(this.set_animation_playing(!0),this.store.set_current_nj_motion(Object(l.c)(s,e.bone_count())),this.set_result(Object(m.c)(void 0))):this.set_result(Object(m.a)([{severity:d.b.Error,ui_message:"No model to animate"}]))}else if(e.name.endsWith(".xvm")){const e=Object(_.b)(s);this.set_result(e),e.success?this.store.set_current_textures(e.value.textures):this.store.set_current_textures([])}else if(e.name.endsWith(".afs")){const e=Object(m.b)(v),t=Object(u.a)(s);if(e.add_result(t),t.success){const s=t.value.flatMap(t=>{var s,i,r,a;const l=new n.a(t,o.a.Little);if(Object(_.a)(l)){const t=Object(_.b)(l);return e.add_result(t),null!==(i=null===(s=t.value)||void 0===s?void 0:s.textures)&&void 0!==i?i:[]}{const t=Object(_.b)(Object(h.a)(l.seek_start(0)));return e.add_result(t),null!==(a=null===(r=t.value)||void 0===r?void 0:r.textures)&&void 0!==a?a:[]}});s.length?this.set_result(e.success(s)):this.set_result(e.failure()),this.store.set_current_textures(s)}else this.set_result(e.failure())}else v.debug(`Unsupported file extension in filename "${e.name}".`),this.set_result(Object(m.a)([{severity:d.b.Error,ui_message:"Unsupported file type."}]))}catch(e){v.error("Couldn't read file.",e),this.set_result(Object(m.a)())}})),this.dismiss_result_dialog=()=>{this._result_dialog_visible.val=!1},this.show_skeleton=e.show_skeleton,this.animation_frame_count=e.animation_frame_count,this.animation_frame_count_label=e.animation_frame_count.map(e=>`/ ${e}`),this.animation_controls_enabled=e.current_nj_motion.map(e=>null!=e),this.animation_playing=e.animation_playing,this.animation_frame_rate=e.animation_frame_rate,this.animation_frame=e.animation_frame.map(e=>Math.round(e))}set_result(e){this._result.val=e,e.problems.length&&(this._result_dialog_visible.val=!0)}}}}]);