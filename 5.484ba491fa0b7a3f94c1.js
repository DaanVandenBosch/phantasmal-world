(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"/UnV":function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));const i=n("rwco").c.get("core/data_formats/parsing/afs"),s=5457473;function a(t){if(t.u32()!==s)return i.error("Not an AFS archive."),[];const e=t.u16();t.seek(2);const n=[];for(let i=0;i<e;i++){const e=t.u32(),i=t.u32();n.push({offset:e,size:i})}const a=[];for(const{offset:e,size:i}of n)t.seek_start(e),a.push(t.array_buffer(i));return a}},"9fJw":function(t,e,n){"use strict";n.d(e,"g",(function(){return s})),n.d(e,"h",(function(){return a})),n.d(e,"f",(function(){return r})),n.d(e,"e",(function(){return o})),n.d(e,"k",(function(){return c})),n.d(e,"l",(function(){return _})),n.d(e,"j",(function(){return l})),n.d(e,"i",(function(){return h})),n.d(e,"a",(function(){return u})),n.d(e,"b",(function(){return d})),n.d(e,"d",(function(){return m})),n.d(e,"c",(function(){return b}));class i{constructor(t){var e,n,i,s,a;this.name=t.name,this.body_style_count=null!=(e=t.body_style_count)?e:1,this.head_style_count=t.head_style_count,this.hair_style_count=t.hair_style_count,this.hair_styles_with_accessory=t.hair_styles_with_accessory,this.body_tex_ids=null!=(n=t.body_tex_ids)?n:[],this.head_tex_ids=null!=(i=t.head_tex_ids)?i:[],this.hair_tex_ids=null!=(s=t.hair_tex_ids)?s:[],this.accessory_tex_ids=null!=(a=t.accessory_tex_ids)?a:[]}}const s=new i({name:"HUmar",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([6])}),a=new i({name:"HUnewearl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set}),r=new i({name:"HUcast",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),o=new i({name:"HUcaseal",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),c=new i({name:"RAmar",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),_=new i({name:"RAmarl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),l=new i({name:"RAcast",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),h=new i({name:"RAcaseal",body_style_count:25,head_style_count:5,hair_style_count:0,hair_styles_with_accessory:new Set}),u=new i({name:"FOmar",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),d=new i({name:"FOmarl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),m=new i({name:"FOnewm",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])}),b=new i({name:"FOnewearl",body_style_count:18,head_style_count:1,hair_style_count:10,hair_styles_with_accessory:new Set([0,1,2,3,4,5,6,7,8,9])})},HjM1:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n("39ZU"),s=n("nN8q"),a=(n("4AvX"),n("FXpb"));const r=28;class o extends s.a{constructor(t,e){super(e),this.gui_store=t,this.tabs=[],this.bar_element=Object(a.h)({className:"core_TabContainer_Bar"}),this.panes_element=Object(a.h)({className:"core_TabContainer_Panes"}),this.element=Object(a.h)({className:"core_TabContainer"}),this.bar_mousedown=t=>{if(t.target instanceof HTMLElement){const e=t.target.dataset.key;e&&this.activate_key(e)}},this.bar_element.onmousedown=this.bar_mousedown;for(const t of e.tabs){const e=Object(a.q)({className:"core_TabContainer_Tab",data:{key:t.key}},t.title);this.bar_element.append(e);const n=this.disposable(new i.a(t.create_view)),s=Object.assign(Object.assign({},t),{tab_element:e,lazy_view:n});this.tabs.push(s),this.panes_element.append(n.element)}this.element.append(this.bar_element,this.panes_element),this.finalize_construction()}get children(){return this.tabs.flatMap(t=>t.lazy_view.children)}resize(t,e){super.resize(t,e),this.bar_element.style.width=`${t}px`,this.bar_element.style.height=`${r}px`;const n=e-r;this.panes_element.style.width=`${t}px`,this.panes_element.style.height=`${n}px`;for(const e of this.tabs)e.lazy_view.resize(t,n);return this}activate(){if(this.active_tab)this.activate_tab(this.active_tab);else{let t;for(const e of this.tabs)null!=e.path&&this.gui_store.path.val.startsWith(e.path)&&(t=e);t?this.activate_tab(t):this.tabs.length&&this.activate_tab(this.tabs[0])}}activate_key(t){for(const e of this.tabs)if(e.key===t){this.activate_tab(e);break}}activate_tab(t){this.active_tab!==t&&(this.active_tab&&(this.active_tab.tab_element.classList.remove("active"),this.active_tab.lazy_view.visible.val=!1,this.active_tab.lazy_view.deactivate()),this.active_tab=t,t.tab_element.classList.add("active"),t.lazy_view.visible.val=!0),null!=t.path&&(this.gui_store.set_path_prefix(t.path),t.lazy_view.activate())}}},U6CM:function(t,e,n){"use strict";n.r(e);var i=n("HjM1"),s=n("zsIO");class a extends s.a{constructor(t,e,n){super(),this.tab_container=this.add(new i.a(t,{class:"viewer_ViewerView",tabs:[{title:"Models",key:"model",path:"/models",create_view:e},{title:"Textures",key:"texture",path:"/textures",create_view:n}]})),this.finalize_construction()}get element(){return this.tab_container.element}resize(t,e){this.tab_container.resize(t,e)}}var r=n("Tpfs"),o=n("Womt"),c=n("Ftn7"),_=n("iR5r"),l=n("rwco");const h=l.c.get("viewer/rendering/TextureRenderer");class u extends c.a{constructor(t,e){super(e),this.disposer=new r.a,this.quad_meshes=[],this.camera=new o.OrthographicCamera(-400,400,300,-300,1,10),this.disposer.add_all(t.textures.observe(({value:t})=>{this.scene.remove(...this.quad_meshes),this.render_textures(t),this.reset_camera(new o.Vector3(0,0,5),new o.Vector3),this.schedule_render()})),this.init_camera_controls(),this.controls.dollySpeed=-1,this.controls.azimuthRotateSpeed=0,this.controls.polarRotateSpeed=0}set_size(t,e){this.camera.left=-Math.floor(t/2),this.camera.right=Math.ceil(t/2),this.camera.top=Math.floor(e/2),this.camera.bottom=-Math.ceil(e/2),this.camera.updateProjectionMatrix(),super.set_size(t,e)}dispose(){super.dispose(),this.disposer.dispose()}render_textures(t){let e=10*(t.length-1),n=0;for(const i of t)e+=i.width,n=Math.max(n,i.height);let i=-Math.floor(e/2);const s=-Math.floor(n/2);for(const e of t){let t=void 0;try{t=Object(_.b)(e)}catch(t){h.error("Couldn't convert XVR texture.",t)}const a=new o.Mesh(this.create_quad(i,s+Math.floor((n-e.height)/2),e.width,e.height),t?new o.MeshBasicMaterial({map:t,transparent:!0}):new o.MeshBasicMaterial({color:16711935}));this.quad_meshes.push(a),this.scene.add(a),i+=10+e.width}}create_quad(t,e,n,i){const s=new o.PlaneGeometry(n,i,1,1);return s.faceVertexUvs=[[[new o.Vector2(0,0),new o.Vector2(0,1),new o.Vector2(1,0)],[new o.Vector2(0,1),new o.Vector2(1,1),new o.Vector2(1,0)]]],s.translate(t+n/2,e+i/2,-5),s}}var d=n("Eqai"),m=n("488w"),b=n("VwSi");const v=30;function f(t,e){const n=e.interpolation===b.a.Spline?o.InterpolateSmooth:o.InterpolateLinear,i=[];return e.motion_data.forEach((e,s)=>{const a=t.get_bone(s);a&&e.tracks.forEach(({type:t,keyframes:e})=>{const r=[],c=[];for(const n of e)if(r.push(n.frame/v),t===b.b.Rotation){const t=a.evaluation_flags.zxy_rotation_order?"ZXY":"ZYX",e=(new o.Quaternion).setFromEuler(new o.Euler(n.value.x,n.value.y,n.value.z,t));c.push(e.x,e.y,e.z,e.w)}else c.push(n.value.x,n.value.y,n.value.z);if(t===b.b.Rotation)i.push(new o.QuaternionKeyframeTrack(`.bones[${s}].quaternion`,r,c,n));else{const e=t===b.b.Position?`.bones[${s}].position`:`.bones[${s}].scale`;i.push(new o.VectorKeyframeTrack(e,r,c,n))}})}),new o.AnimationClip("Animation",(e.frame_count-1)/v,i).optimize()}const y=l.c.get("viewer/rendering/ModelRenderer"),p=new o.MeshLambertMaterial({color:16777215,side:o.DoubleSide}),w=new o.MeshLambertMaterial({skinning:!0,color:16777215,side:o.DoubleSide}),j=Object.freeze(new o.Vector3(0,10,20)),x=Object.freeze(new o.Vector3(0,0,0));class g extends c.a{constructor(t,e){super(e),this.store=t,this.disposer=new r.a,this.clock=new o.Clock,this.update_animation_time=!0,this.camera=new o.PerspectiveCamera(75,1,1,200),this.current_character_class_changed=t=>{const e=null!=t.value;this.character_class_active!==e&&this.reset_camera(j,x),this.character_class_active=e},this.nj_object_or_xvm_changed=()=>{var t;this.mesh&&(this.scene.remove(this.mesh),this.mesh=void 0,this.scene.remove(this.skeleton_helper),this.skeleton_helper=void 0);const e=this.store.current_nj_object.val;if(e){let n;if(this.animation){const e=this.animation.mixer;n=null===(t=e.existingAction(this.animation.clip))||void 0===t?void 0:t.time,e.stopAllAction(),e.uncacheAction(this.animation.clip),this.animation=void 0}const i=this.store.current_textures.val.map(t=>{if(t)try{return Object(_.b)(t)}catch(t){y.error("Couldn't convert XVR texture.",t)}}),s=Object(m.a)(e),a=null!=s.getAttribute("skinIndex"),r=i.map(t=>t?new o.MeshBasicMaterial({skinning:a,map:t,side:o.DoubleSide,alphaTest:.1,transparent:!0}):new o.MeshLambertMaterial({skinning:a,side:o.DoubleSide}));this.mesh=a?Object(d.b)(s,r,w):Object(d.a)(s,r,p);const c=s.boundingBox,l=c.max.y-c.min.y;this.mesh.translateY(-l/2-c.min.y),this.scene.add(this.mesh),this.skeleton_helper=new o.SkeletonHelper(this.mesh),this.skeleton_helper.visible=this.store.show_skeleton.val,this.skeleton_helper.material.linewidth=3,this.scene.add(this.skeleton_helper);const h=this.store.current_nj_motion.val;if(h){const t=new o.AnimationMixer(this.mesh);t.timeScale=this.store.animation_frame_rate.val/v;const i=f(e,h);this.animation={mixer:t,clip:i};const s=t.clipAction(i,this.mesh);s.time=null!=n?n:0,s.play()}}this.schedule_render()},this.nj_motion_changed=({value:t})=>{let e;this.animation&&(this.animation.mixer.stopAllAction(),this.animation.mixer.uncacheAction(this.animation.clip),e=this.animation.mixer);const n=this.store.current_nj_object.val;if(!(this.mesh&&this.mesh instanceof o.SkinnedMesh&&t&&n))return;e||(e=new o.AnimationMixer(this.mesh));const i=f(n,t);this.animation={mixer:e,clip:i},this.clock.start(),e.clipAction(i).play(),this.schedule_render()},this.show_skeleton_changed=({value:t})=>{this.skeleton_helper&&(this.skeleton_helper.visible=t,this.schedule_render())},this.animation_playing_changed=({value:t})=>{this.animation&&(this.animation.mixer.clipAction(this.animation.clip).paused=!t,t?(this.clock.start(),this.schedule_render()):this.clock.stop())},this.animation_frame_rate_changed=({value:t})=>{this.animation&&(this.animation.mixer.timeScale=t/v)},this.animation_frame_changed=({value:t})=>{const e=this.store.current_nj_motion.val;if(this.animation&&e){const n=e.frame_count;t>n&&(t=1),t<1&&(t=n),this.update_animation_time&&(this.animation.mixer.clipAction(this.animation.clip).time=(t-1)/v),this.schedule_render()}},this.character_class_active=null!=t.current_character_class.val,this.disposer.add_all(t.current_character_class.observe(this.current_character_class_changed),t.current_nj_object.observe(this.nj_object_or_xvm_changed),t.current_textures.observe(this.nj_object_or_xvm_changed),t.current_nj_motion.observe(this.nj_motion_changed),t.show_skeleton.observe(this.show_skeleton_changed),t.animation_playing.observe(this.animation_playing_changed),t.animation_frame_rate.observe(this.animation_frame_rate_changed),t.animation_frame.observe(this.animation_frame_changed)),this.init_camera_controls(),this.reset_camera(j,x)}set_size(t,e){this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),super.set_size(t,e)}dispose(){super.dispose(),this.disposer.dispose()}render(){this.animation&&this.animation.mixer.update(this.clock.getDelta()),this.light_holder.quaternion.copy(this.camera.quaternion),super.render(),this.animation&&!this.animation.mixer.clipAction(this.animation.clip).paused&&(this.update_animation_frame(),this.schedule_render())}update_animation_frame(){if(this.animation){const t=this.animation.mixer.clipAction(this.animation.clip);t.paused||(this.update_animation_time=!1,this.store.set_animation_frame(t.time*v+1),this.update_animation_time=!0)}}}var k=n("w6HN"),O=n("6cU9"),M=n("oyid"),S=n("PE7g"),z=n("7ZX1"),V=n("FXpb"),A=n("6Fug");class C extends A.a{constructor(t){super();const e=new O.a({icon_left:V.a.File,text:"Open file...",accept:".afs, .nj, .njm, .xj, .xvm"}),n=new M.a(!1,{label:"Show skeleton"}),i=new M.a(!0,{label:"Play animation"}),s=new S.a(v,{label:"Frame rate:",min:1,max:240,step:1}),a=new S.a(1,{label:"Frame:",min:1,max:t.animation_frame_count,step:1}),r=new z.a(t.animation_frame_count_label);this.toolbar=this.add(new k.a(e,n,i,s,a,r)),this.disposables(e.files.observe(({value:e})=>{e.length&&t.load_file(e[0])}),n.checked.observe(({value:e})=>t.set_show_skeleton(e)));const o=t.animation_controls_enabled;this.disposables(i.enabled.bind_to(o),i.checked.bind_to(t.animation_playing),i.checked.observe(({value:e})=>t.set_animation_playing(e)),s.enabled.bind_to(o),s.value.observe(({value:e})=>t.set_animation_frame_rate(e)),a.enabled.bind_to(o),a.value.bind_to(t.animation_frame),a.value.observe(({value:e})=>t.set_animation_frame(e)),r.enabled.bind_to(o)),this.finalize_construction()}get element(){return this.toolbar.element}get height(){return this.toolbar.height}}var R=n("kcKQ"),P=n("9fJw"),T=n("ouMO");class F{constructor(t,e){this.id=t,this.name=e}}var L=n("nsCy"),U=n("4SjJ"),$=n("uiJh"),q=function(t,e,n,i){return new(n||(n=Promise))((function(s,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function o(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,o)}c((i=i.apply(t,e||[])).next())}))};const H=l.c.get("viewer/stores/ModelStore");class N extends R.a{constructor(t,e,n){super(),this.asset_loader=e,this.random=n,this._current_character_class=Object(T.e)(void 0),this._current_section_id=Object(T.e)(void 0),this._current_body=Object(T.e)(void 0),this._current_animation=Object(T.e)(void 0),this._current_nj_object=Object(T.e)(void 0),this._current_textures=Object(T.c)(),this._current_nj_motion=Object(T.e)(void 0),this._show_skeleton=Object(T.e)(!1),this._animation_playing=Object(T.e)(!0),this._animation_frame_rate=Object(T.e)(v),this._animation_frame=Object(T.e)(0),this.character_classes=[P.g,P.h,P.f,P.e,P.k,P.l,P.j,P.i,P.a,P.b,P.d,P.c],this.current_character_class=this._current_character_class,this.current_section_id=this._current_section_id,this.current_body=this._current_body,this.animations=new Array(572).fill(void 0).map((t,e)=>new F(e,`Animation ${e+1}`)),this.current_animation=this._current_animation,this.current_nj_object=this._current_nj_object,this.current_textures=this._current_textures,this.current_nj_motion=this._current_nj_motion,this.animation_frame_count=this.current_nj_motion.map(t=>t?t.frame_count:0),this.show_skeleton=this._show_skeleton,this.animation_playing=this._animation_playing,this.animation_frame_rate=this._animation_frame_rate,this.animation_frame=this._animation_frame,this.set_current_character_class=t=>{var e;if(this._current_character_class.val!==t){if(null==t)this.set_current_body(void 0);else{const n=this.current_body.val;(void 0===n||n>=(null===(e=t)||void 0===e?void 0:e.body_style_count))&&this.set_current_body(t.body_style_count-1)}this._current_character_class.val=t,null==this.current_animation.val&&this.set_current_nj_motion(void 0)}},this.set_current_section_id=t=>{this._current_section_id.val=t},this.set_current_body=t=>{this._current_body.val=t},this.set_current_animation=t=>{this._current_animation.val!==t&&(this._current_animation.val=t)},this.set_current_nj_object=t=>{this.set_current_character_class(void 0),this.set_current_animation(void 0),this.set_current_textures([]),this.set_current_nj_motion(void 0),this._current_nj_object.val=t},this.set_current_textures=t=>{this._current_textures.val=t},this.set_current_nj_motion=t=>{this.set_current_animation(void 0),this._current_nj_motion.val=t},this.set_show_skeleton=t=>{this._show_skeleton.val=t},this.set_animation_playing=t=>{this._animation_playing.val=t},this.set_animation_frame_rate=t=>{this._animation_frame_rate.val=t},this.set_animation_frame=t=>{this._animation_frame.val=t},this.load_character_class_model=()=>q(this,void 0,void 0,(function*(){const t=this.current_character_class.val;if(null==t)return;const e=this.current_section_id.val;if(null==e)return;const n=this.current_body.val;if(null!=n)try{this._current_nj_object.val=void 0;const i=yield this.asset_loader.load_geometry(t);this._current_textures.val=yield this.asset_loader.load_textures(t,e,n),this._current_nj_object.val=i}catch(e){H.error(`Couldn't load model for ${t.name}.`),this._current_nj_object.val=void 0}})),this.load_animation=()=>q(this,void 0,void 0,(function*(){const t=this._current_nj_object.val,e=this.current_animation.val;if(t&&e)try{this._current_nj_motion.val=yield this.asset_loader.load_animation(e.id,64),this.set_animation_playing(!0)}catch(t){H.error(`Couldn't load animation "${e.name}".`,t),this._current_nj_motion.val=void 0}else this._current_nj_motion.val=void 0})),this.disposables(this.current_character_class.observe(this.load_character_class_model),this.current_section_id.observe(this.load_character_class_model),this.current_body.observe(this.load_character_class_model),this.current_animation.observe(this.load_animation)),this.disposables(t.bind_parameter(U.b.Viewer,"/models","model",this.current_character_class.map(t=>void 0===t?void 0:t.name)),t.bind_parameter(U.b.Viewer,"/models","section_id",this.current_section_id.map(t=>void 0===t?void 0:L.e[t])),t.bind_parameter(U.b.Viewer,"/models","body",this.current_body.map(t=>void 0===t?void 0:String(t+1))));const i=t.get_parameter(U.b.Viewer,"/models","model");let s=this.character_classes.find(t=>t.name===i);null==s&&(s=n.sample_array(this.character_classes));const a=t.get_parameter(U.b.Viewer,"/models","body");let r=null==a?void 0:parseInt(a,10);null!=r&&Number.isInteger(r)?r--:r=n.integer(0,s.body_style_count);const o=t.get_parameter(U.b.Viewer,"/models","section_id"),c=void 0===o?void 0:Object($.b)(L.e,o);this._current_section_id.val=null!=c?c:n.sample_array(L.f),this._current_body.val=r,this._current_character_class.val=s}}var B=n("mKaR"),I=n("iPoI"),X=n("NRxM"),D=n("bcBH"),E=n("kwt4"),W=n("yub1"),J=n("/UnV"),Z=function(t,e,n,i){return new(n||(n=Promise))((function(s,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function o(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,o)}c((i=i.apply(t,e||[])).next())}))};const Q=l.c.get("viewer/controllers/model/ModelToolBarController");class K extends B.a{constructor(t){super(),this.store=t,this.set_show_skeleton=t=>{this.store.set_show_skeleton(t)},this.set_animation_playing=t=>{this.store.set_animation_playing(t)},this.set_animation_frame_rate=t=>{this.store.set_animation_frame_rate(t)},this.set_animation_frame=t=>{this.store.set_animation_frame(t)},this.load_file=t=>Z(this,void 0,void 0,(function*(){try{const e=yield Object(I.b)(t),n=new X.a(e,D.a.Little);if(t.name.endsWith(".nj"))this.store.set_current_nj_object(Object(E.c)(n)[0]);else if(t.name.endsWith(".xj"))this.store.set_current_nj_object(Object(E.d)(n)[0]);else if(t.name.endsWith(".njm")){this.store.set_current_animation(void 0),this.store.set_current_nj_motion(void 0);const t=this.store.current_nj_object.val;t&&(this.set_animation_playing(!0),this.store.set_current_nj_motion(Object(b.c)(n,t.bone_count())))}else if(t.name.endsWith(".xvm"))this.store.set_current_textures(Object(W.a)(n).textures);else if(t.name.endsWith(".afs")){const t=Object(J.a)(n).flatMap(t=>Object(W.a)(new X.a(t,D.a.Little)).textures);this.store.set_current_textures(t)}else Q.error(`Unknown file extension in filename "${t.name}".`)}catch(t){Q.error("Couldn't read file.",t)}})),this.show_skeleton=t.show_skeleton,this.animation_frame_count=t.animation_frame_count,this.animation_frame_count_label=t.animation_frame_count.map(t=>`/ ${t}`),this.animation_controls_enabled=t.current_nj_motion.map(t=>null!=t),this.animation_playing=t.animation_playing,this.animation_frame_rate=t.animation_frame_rate,this.animation_frame=t.animation_frame.map(t=>Math.round(t))}}var Y=n("sv1z");n("ePAx");class G extends s.a{constructor(t){var e,n;super();const i=this.add(new Y.a({class:"viewer_model_CharacterClassOptionsView_section_id",label:"Section ID:",items:L.f,selected:t.current_section_id,to_label:t=>null==t?"":L.e[t],enabled:t.enabled})),s=this.add(new Y.a({class:"viewer_model_CharacterClassOptionsView_body",label:"Body:",items:t.current_body_options,selected:t.current_body,enabled:t.enabled}));this.element=Object(V.h)({className:"viewer_model_CharacterClassOptionsView"},Object(V.r)(Object(V.y)(Object(V.t)(null===(e=i.label)||void 0===e?void 0:e.element),Object(V.t)(i.element)),Object(V.y)(Object(V.t)(null===(n=s.label)||void 0===n?void 0:n.element),Object(V.t)(s.element)))),this.disposables(i.selected.observe(({value:e})=>t.set_current_section_id(e)),s.selected.observe(({value:e})=>t.set_current_body(e))),this.finalize_construction()}}var tt=n("LvDl");class et extends B.a{constructor(t){super(),this.store=t,this.set_current_section_id=t=>{null!=t&&this.store.set_current_section_id(t)},this.set_current_body=t=>{this.store.set_current_body(null==t?void 0:t-1)},this.enabled=t.current_character_class.map(t=>null!=t),this.current_section_id=t.current_section_id,this.current_body_options=t.current_character_class.map(t=>t?Object(tt.range)(1,t.body_style_count+1):[]),this.current_body=t.current_body.map(t=>null==t?void 0:t+1)}}n.d(e,"initialize_viewer",(function(){return it}));var nt=function(t,e,n,i){return new(n||(n=Promise))((function(s,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function o(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,o)}c((i=i.apply(t,e||[])).next())}))};function it(t,e,i,s){const o=new r.a;return{view:new a(i,()=>nt(this,void 0,void 0,(function*(){const{ModelController:a}=yield n.e(14).then(n.bind(null,"UwGQ")),{ModelView:r}=yield Promise.all([n.e(1),n.e(11)]).then(n.bind(null,"puLw")),{CharacterClassAssetLoader:c}=yield n.e(15).then(n.bind(null,"ZV42")),_=o.add(new c(t)),l=o.add(new N(i,_,e)),h=new a(l),u=new K(l),d=new et(l);return new r(h,new C(u),new G(d),new g(l,s()))})),()=>nt(this,void 0,void 0,(function*(){const{TextureController:t}=yield n.e(13).then(n.bind(null,"QRTb")),{TextureView:e}=yield n.e(10).then(n.bind(null,"Za3H")),i=o.add(new t);return new e(i,new u(i,s()))}))),dispose(){o.dispose()}}}},VwSi:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return o}));var i=n("kwt4");const s=1296321870;var a,r;function o(t,e){return t.u32()===s?function(t,e){const n=t.u32();return c(t.take(n),e)}(t,e):(t.seek_start(0),function(t,e){t.seek_end(16);const n=t.u32();t.seek_start(n);const i=t.u32();return t.seek_start(i),function(t,e){t.seek(4);const n=t.u32();return t.seek_start(n),c(t,e)}(t,e)}(t,e))}function c(t,e){let n=t.u32();const i=t.u32(),s=t.u16(),a=t.u16(),o=(192&a)>>6,c=15&a,h=[];for(let a=0;a<e;a++){t.seek_start(n),n=n+=8*c;const e={tracks:[]};h.push(e);const a=[],o=[];for(let e=0;e<c;e++)a.push(t.u32());for(let e=0;e<c;e++){const e=t.u32();o.push(e)}if(1&s){t.seek_start(a.shift());const n=o.shift();n&&e.tracks.push({type:r.Position,keyframes:_(t,n)})}if(2&s){t.seek_start(a.shift());const n=o.shift();n&&e.tracks.push({type:r.Rotation,keyframes:l(t,n,i)})}if(4&s){t.seek_start(a.shift());const n=o.shift();n&&e.tracks.push({type:r.Scale,keyframes:_(t,n)})}}return{motion_data:h,frame_count:i,type:s,interpolation:o,element_count:c}}function _(t,e){const n=[];for(let i=0;i<e;++i)n.push({frame:t.u32(),value:t.vec3_f32()});return n}function l(t,e,n){const s=[],a=t.position;for(let n=0;n<e;++n)s.push({frame:t.u16(),value:{x:t.u16()*i.a,y:t.u16()*i.a,z:t.u16()*i.a}});let r=-1;for(const{frame:i}of s){if(i<r||i>=n)return t.seek_start(a),h(t,e);r=i}return s}function h(t,e){const n=[];for(let s=0;s<e;++s)n.push({frame:t.u32(),value:{x:t.i32()*i.a,y:t.i32()*i.a,z:t.i32()*i.a}});return n}!function(t){t[t.Linear=0]="Linear",t[t.Spline=1]="Spline",t[t.UserFunction=2]="UserFunction"}(a||(a={})),function(t){t[t.Position=0]="Position",t[t.Rotation=1]="Rotation",t[t.Scale=2]="Scale"}(r||(r={}))}}]);