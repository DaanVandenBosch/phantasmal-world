(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{544:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var r=s(24),i=s(453),n=s(28);const l=r.a.get("core/data_formats/parsing/afs");function o(e){const t=new i.a(l);if(e.bytes_left<8)return t.add_problem(n.b.Error,"AFS archive is corrupted.","Too small to be an AFS archive.").failure();if(5457473!==e.u32())return t.add_problem(n.b.Error,"AFS archive is corrupted.","Magic bytes not present.").failure();const s=e.u16();e.seek(2);const r=[];for(let i=1;i<=s;i++){if(e.bytes_left<8){t.add_problem(n.b.Warning,`AFS file entry ${i} is invalid.`,`Couldn't read file entry ${i}, only ${e.bytes_left} bytes left.`);break}const s=e.u32(),l=e.u32();if(s>e.size)t.add_problem(n.b.Warning,`AFS file entry ${i} is invalid.`,`Invalid file offset ${s} for entry ${i}.`);else if(s+l>e.size)t.add_problem(n.b.Warning,`AFS file entry ${i} is invalid.`,`File size ${l} (offset: ${s}) of entry ${i} too large.`);else{const t=e.position;e.seek_start(s),r.push(e.array_buffer(l)),e.seek_start(t)}}return t.success(r)}},632:function(e,t,s){"use strict";s.d(t,"b",(function(){return _})),s.d(t,"a",(function(){return d}));var r=s(453),i=s(540),n=s(544),l=s(28),o=s(466),a=s(457),u=s(629);const c=s(24).a.get("viewer/util/texture_parsing");function _(e){const t=Object(i.b)(e);return t.success?Object(r.d)(t.value.textures):t}function d(e){const t=new r.a(c),s=Object(n.a)(e);if(t.add_result(s),!s.success)return t.failure();0===s.value.length&&t.add_problem(l.b.Info,"AFS archive contains no files.");const _=s.value.flatMap(e=>{var s,r,n,l;const c=new o.a(e,a.a.Little);if(Object(i.a)(c)){const e=Object(i.b)(c);return t.add_result(e),null!==(r=null===(s=e.value)||void 0===s?void 0:s.textures)&&void 0!==r?r:[]}{const e=Object(u.a)(c.seek_start(0));if(t.add_result(e),!e.success)return[];const s=Object(i.b)(e.value);return t.add_result(s),null!==(l=null===(n=s.value)||void 0===n?void 0:n.textures)&&void 0!==l?l:[]}});return t.success(_)}},835:function(e,t,s){"use strict";s.r(t),s.d(t,"TextureController",(function(){return v}));var r=s(140),i=s(16),n=s(501),l=s(466),o=s(457),a=s(24),u=s(14),c=s(453),_=s(28),d=s(632),b=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function l(e){try{a(r.next(e))}catch(e){n(e)}}function o(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,o)}a((r=r.apply(e,t||[])).next())}))};const f=a.a.get("viewer/controllers/TextureController");class v extends r.a{constructor(){super(...arguments),this._textures=Object(u.c)(),this._result_dialog_visible=Object(u.e)(!1),this._result=Object(u.e)(void 0),this._result_problems_message=Object(u.e)(""),this._result_error_message=Object(u.e)(""),this.textures=this._textures,this.result_dialog_visible=this._result_dialog_visible,this.result=this._result,this.result_problems_message=this._result_problems_message,this.result_error_message=this._result_error_message,this.load_file=e=>b(this,void 0,void 0,(function*(){this._result_problems_message.val=`Encountered some problems while opening "${e.name}".`,this._result_error_message.val=`Couldn't open "${e.name}".`;try{const t=Object(i.h)(e.name).toLowerCase(),s=yield Object(n.b)(e),r=new l.a(s,o.a.Little);let a;"xvm"===t?a=Object(d.b)(r):"afs"===t?a=Object(d.a)(r):(f.debug(`Unsupported file extension in filename "${e.name}".`),a=Object(c.b)(Object(c.c)(_.b.Error,"Unsupported file type."))),this.set_result(a),a.success&&(this._textures.val=a.value)}catch(e){f.error("Couldn't read file.",e),this.set_result(Object(c.b)())}})),this.dismiss_result_dialog=()=>{this._result_dialog_visible.val=!1}}set_result(e){this._result.val=e,e.problems.length&&(this._result_dialog_visible.val=!0)}}}}]);