(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{659:function(t,e,i){"use strict";
/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var o,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};!function(t){t[t.NONE=0]="NONE",t[t.ROTATE=1]="ROTATE",t[t.TRUCK=2]="TRUCK",t[t.DOLLY=3]="DOLLY",t[t.ZOOM=4]="ZOOM",t[t.TOUCH_ROTATE=5]="TOUCH_ROTATE",t[t.TOUCH_TRUCK=6]="TOUCH_TRUCK",t[t.TOUCH_DOLLY=7]="TOUCH_DOLLY",t[t.TOUCH_ZOOM=8]="TOUCH_ZOOM",t[t.TOUCH_DOLLY_TRUCK=9]="TOUCH_DOLLY_TRUCK",t[t.TOUCH_ZOOM_TRUCK=10]="TOUCH_ZOOM_TRUCK"}(o||(o={}));var a=2*Math.PI,n=Math.PI/2;function s(t){return Math.abs(t)<1e-5}function h(t,e){return Math.round(t/e)*e}function c(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function p(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}function l(t){return"TouchEvent"in window&&t instanceof TouchEvent}function d(t,e){if(e.set(0,0),l(t)){for(var i=t,o=0;o<i.touches.length;o++)e.x+=i.touches[o].clientX,e.y+=i.touches[o].clientY;return e.x/=i.touches.length,e.y/=i.touches.length,e}var r=t;return e.set(r.clientX,r.clientY),e}function m(t,e){return!t.isPerspectiveCamera&&(console.warn(e+" is not supported in OrthographicCamera"),!0)}var u,_,y,v,g,f,E,T,O,C,x,w,A,U,b,z,L,S,D=function(){function t(){this._listeners={}}return t.prototype.addEventListener=function(t,e){var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},t.prototype.removeEventListener=function(t,e){var i=this._listeners[t];if(void 0!==i){var o=i.indexOf(e);-1!==o&&i.splice(o,1)}},t.prototype.removeAllEventListeners=function(t){t?Array.isArray(this._listeners[t])&&(this._listeners[t].length=0):this._listeners={}},t.prototype.dispatchEvent=function(t){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),o=0,r=i.length;o<r;o++)i[o].call(this,t)}},t}(),M="undefined"!=typeof window&&/Mac/.test(navigator.platform),P=Object.freeze(o),R=function(t){function e(e,i){var r=t.call(this)||this;if(r.enabled=!0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.minDistance=0,r.maxDistance=1/0,r.infinityDolly=!1,r.minZoom=.01,r.maxZoom=1/0,r.dampingFactor=.05,r.draggingDampingFactor=.25,r.azimuthRotateSpeed=1,r.polarRotateSpeed=1,r.dollySpeed=1,r.truckSpeed=2,r.dollyToCursor=!1,r.verticalDragToForward=!1,r.boundaryFriction=0,r.colliderMeshes=[],r._state=o.NONE,r._viewport=null,r._dollyControlAmount=0,r._boundaryEnclosesCamera=!1,r._needsUpdate=!0,r._updatedLastTime=!1,r._camera=e,r._yAxisUpSpace=(new u.Quaternion).setFromUnitVectors(r._camera.up,y),r._yAxisUpSpaceInverse=r._yAxisUpSpace.clone().inverse(),r._state=o.NONE,r._domElement=i,r._target=new u.Vector3,r._targetEnd=r._target.clone(),r._spherical=(new u.Spherical).setFromVector3(f.copy(r._camera.position).applyQuaternion(r._yAxisUpSpace)),r._sphericalEnd=r._spherical.clone(),r._zoom=r._camera.zoom,r._zoomEnd=r._zoom,r._nearPlaneCorners=[new u.Vector3,new u.Vector3,new u.Vector3,new u.Vector3],r._updateNearPlaneCorners(),r._boundary=new u.Box3(new u.Vector3(-1/0,-1/0,-1/0),new u.Vector3(1/0,1/0,1/0)),r._target0=r._target.clone(),r._position0=r._camera.position.clone(),r._zoom0=r._zoom,r._dollyControlAmount=0,r._dollyControlCoord=new u.Vector2,r.mouseButtons={left:o.ROTATE,middle:o.DOLLY,right:o.TRUCK,wheel:r._camera.isPerspectiveCamera?o.DOLLY:r._camera.isOrthographicCamera?o.ZOOM:o.NONE},r.touches={one:o.TOUCH_ROTATE,two:r._camera.isPerspectiveCamera?o.TOUCH_DOLLY_TRUCK:r._camera.isOrthographicCamera?o.TOUCH_ZOOM_TRUCK:o.NONE,three:o.TOUCH_TRUCK},r._domElement){var n=new u.Vector2,s=new u.Vector2,h=new u.Vector2,c=new u.Vector4,p=function(t,e){if(r._camera.isPerspectiveCamera){var i=r._camera,o=f.copy(i.position).sub(r._target),a=i.getEffectiveFOV()*u.MathUtils.DEG2RAD,n=o.length()*Math.tan(.5*a),s=r.truckSpeed*t*n/c.w,h=r.truckSpeed*e*n/c.w;r.verticalDragToForward?(r.truck(s,0,!0),r.forward(-h,!0)):r.truck(s,h,!0)}else if(r._camera.isOrthographicCamera){var p=r._camera;s=t*(p.right-p.left)/p.zoom/c.z,h=e*(p.top-p.bottom)/p.zoom/c.w;r.truck(s,h,!0)}},m=function(t,e){var i=a*r.azimuthRotateSpeed*t/c.w,o=a*r.polarRotateSpeed*e/c.w;r.rotate(i,o,!0)},_=function(t,e,i){var o=Math.pow(.95,-t*r.dollySpeed),a=r._sphericalEnd.radius*o,n=r._sphericalEnd.radius;r.dollyTo(a),r.infinityDolly&&a<r.minDistance&&(r._camera.getWorldDirection(f),r._targetEnd.add(f.normalize().multiplyScalar(n)),r._target.add(f.normalize().multiplyScalar(n))),r.dollyToCursor&&(r._dollyControlAmount+=r._sphericalEnd.radius-n,r._dollyControlCoord.set(e,i))},v=function(t){var e=Math.pow(.95,t*r.dollySpeed);r.zoomTo(r._zoom*e)},E=function(t){if(r.enabled){t.preventDefault();var e=r._state;switch(t.button){case u.MOUSE.LEFT:r._state=r.mouseButtons.left;break;case u.MOUSE.MIDDLE:r._state=r.mouseButtons.middle;break;case u.MOUSE.RIGHT:r._state=r.mouseButtons.right}e!==r._state&&w(t)}},T=function(t){if(r.enabled){t.preventDefault();var e=r._state;switch(t.touches.length){case 1:r._state=r.touches.one;break;case 2:r._state=r.touches.two;break;case 3:r._state=r.touches.three}e!==r._state&&w(t)}},O=-1,C=function(t){if(r.enabled&&r.mouseButtons.wheel!==o.NONE){if(t.preventDefault(),r.dollyToCursor||r.mouseButtons.wheel===o.ROTATE||r.mouseButtons.wheel===o.TRUCK){var e=performance.now();O-e<1e3&&r._getClientRect(c),O=e}var i=M?-1:-3,a=1===t.deltaMode?t.deltaY/i:t.deltaY/(10*i),n=r.dollyToCursor?(t.clientX-c.x)/c.z*2-1:0,s=r.dollyToCursor?(t.clientY-c.y)/c.w*-2+1:0;switch(r.mouseButtons.wheel){case o.ROTATE:m(t.deltaX,t.deltaY);break;case o.TRUCK:p(t.deltaX,t.deltaY);break;case o.DOLLY:_(-a,n,s);break;case o.ZOOM:v(-a)}r.dispatchEvent({type:"control",originalEvent:t})}},x=function(t){r.enabled&&t.preventDefault()},w=function(t){if(r.enabled){if(t.preventDefault(),d(t,g),r._getClientRect(c),n.copy(g),s.copy(g),l(t)&&t.touches.length>=2){var e=t,i=g.x-e.touches[1].clientX,o=g.y-e.touches[1].clientY,a=Math.sqrt(i*i+o*o);h.set(0,a);var p=.5*(e.touches[0].clientX+e.touches[1].clientX),m=.5*(e.touches[0].clientY+e.touches[1].clientY);s.set(p,m)}document.addEventListener("mousemove",A),document.addEventListener("touchmove",A,{passive:!1}),document.addEventListener("mouseup",U),document.addEventListener("touchend",U),r.dispatchEvent({type:"controlstart",originalEvent:t})}},A=function(t){if(r.enabled){t.preventDefault(),d(t,g);var e=s.x-g.x,i=s.y-g.y;switch(s.copy(g),r._state){case o.ROTATE:case o.TOUCH_ROTATE:m(e,i);break;case o.DOLLY:case o.ZOOM:var a=r.dollyToCursor?(n.x-c.x)/c.z*2-1:0,l=r.dollyToCursor?(n.y-c.y)/c.w*-2+1:0;r._state===o.DOLLY?_(i*(1/8),a,l):v(i*(1/8));break;case o.TOUCH_DOLLY:case o.TOUCH_ZOOM:case o.TOUCH_DOLLY_TRUCK:case o.TOUCH_ZOOM_TRUCK:var u=t,y=g.x-u.touches[1].clientX,f=g.y-u.touches[1].clientY,E=Math.sqrt(y*y+f*f),T=h.y-E;h.set(0,E);a=r.dollyToCursor?(s.x-c.x)/c.z*2-1:0,l=r.dollyToCursor?(s.y-c.y)/c.w*-2+1:0;r._state===o.TOUCH_DOLLY||r._state===o.TOUCH_DOLLY_TRUCK?_(T*(1/8),a,l):v(T*(1/8)),r._state!==o.TOUCH_DOLLY_TRUCK&&r._state!==o.TOUCH_ZOOM_TRUCK||p(e,i);break;case o.TRUCK:case o.TOUCH_TRUCK:p(e,i)}r.dispatchEvent({type:"control",originalEvent:t})}},U=function(t){r.enabled&&(r._state=o.NONE,document.removeEventListener("mousemove",A),document.removeEventListener("touchmove",A,{passive:!1}),document.removeEventListener("mouseup",U),document.removeEventListener("touchend",U),r.dispatchEvent({type:"controlend",originalEvent:t}))};r._domElement.addEventListener("mousedown",E),r._domElement.addEventListener("touchstart",T),r._domElement.addEventListener("wheel",C),r._domElement.addEventListener("contextmenu",x),r._removeAllEventListeners=function(){r._domElement.removeEventListener("mousedown",E),r._domElement.removeEventListener("touchstart",T),r._domElement.removeEventListener("wheel",C),r._domElement.removeEventListener("contextmenu",x),document.removeEventListener("mousemove",A),document.removeEventListener("touchmove",A,{passive:!1}),document.removeEventListener("mouseup",U),document.removeEventListener("touchend",U)}}return r.update(0),r}return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.install=function(t){u=t.THREE,_=Object.freeze(new u.Vector3(0,0,0)),y=Object.freeze(new u.Vector3(0,1,0)),v=Object.freeze(new u.Vector3(0,0,1)),g=new u.Vector2,f=new u.Vector3,E=new u.Vector3,T=new u.Vector3,O=new u.Vector3,C=new u.Vector3,x=new u.Spherical,w=new u.Spherical,A=new u.Box3,U=new u.Box3,b=new u.Quaternion,z=new u.Quaternion,L=new u.Matrix4,S=new u.Raycaster},Object.defineProperty(e,"ACTION",{get:function(){return P},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentAction",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._spherical.radius},set:function(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"azimuthAngle",{get:function(){return this._spherical.theta},set:function(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polarAngle",{get:function(){return this._spherical.phi},set:function(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"phiSpeed",{set:function(t){console.warn("phiSpeed was renamed. use azimuthRotateSpeed instead"),this.azimuthRotateSpeed=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"thetaSpeed",{set:function(t){console.warn("thetaSpeed was renamed. use polarRotateSpeed instead"),this.polarRotateSpeed=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundaryEnclosesCamera",{get:function(){return this._boundaryEnclosesCamera},set:function(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(e,i){t.prototype.addEventListener.call(this,e,i)},e.prototype.removeEventListener=function(e,i){t.prototype.removeEventListener.call(this,e,i)},e.prototype.rotate=function(t,e,i){void 0===i&&(i=!1),this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},e.prototype.rotateTo=function(t,e,i){void 0===i&&(i=!1);var o=u.MathUtils.clamp(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=u.MathUtils.clamp(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=o,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},e.prototype.dolly=function(t,e){void 0===e&&(e=!1),this.dollyTo(this._sphericalEnd.radius-t,e)},e.prototype.dollyTo=function(t,e){void 0===e&&(e=!1),m(this._camera,"dolly")||(this._sphericalEnd.radius=u.MathUtils.clamp(t,this.minDistance,this.maxDistance),e||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0)},e.prototype.zoom=function(t,e){void 0===e&&(e=!1),this.zoomTo(this._zoomEnd+t,e)},e.prototype.zoomTo=function(t,e){void 0===e&&(e=!1),this._zoomEnd=u.MathUtils.clamp(t,this.minZoom,this.maxZoom),e||(this._zoom=this._zoomEnd),this._needsUpdate=!0},e.prototype.pan=function(t,e,i){void 0===i&&(i=!1),console.log("`pan` has been renamed to `truck`"),this.truck(t,e,i)},e.prototype.truck=function(t,e,i){void 0===i&&(i=!1),this._camera.updateMatrix(),O.setFromMatrixColumn(this._camera.matrix,0),C.setFromMatrixColumn(this._camera.matrix,1),O.multiplyScalar(t),C.multiplyScalar(-e);var o=f.copy(O).add(C);this._encloseToBoundary(this._targetEnd,o,this.boundaryFriction),i||this._target.copy(this._targetEnd),this._needsUpdate=!0},e.prototype.forward=function(t,e){void 0===e&&(e=!1),f.setFromMatrixColumn(this._camera.matrix,0),f.crossVectors(this._camera.up,f),f.multiplyScalar(t),this._encloseToBoundary(this._targetEnd,f,this.boundaryFriction),e||this._target.copy(this._targetEnd),this._needsUpdate=!0},e.prototype.moveTo=function(t,e,i,o){void 0===o&&(o=!1),this._targetEnd.set(t,e,i),o||this._target.copy(this._targetEnd),this._needsUpdate=!0},e.prototype.fitTo=function(t,e,i){var o=void 0===i?{}:i,r=o.paddingLeft,a=void 0===r?0:r,c=o.paddingRight,p=void 0===c?0:c,l=o.paddingBottom,d=void 0===l?0:l,m=o.paddingTop,u=void 0===m?0:m,_=t.isBox3?A.copy(t):A.setFromObject(t),g=h(this._sphericalEnd.theta,n),T=h(this._sphericalEnd.phi,n);this.rotateTo(g,T,e);var O=f.setFromSpherical(this._sphericalEnd).normalize(),C=b.setFromUnitVectors(O,v);s(Math.abs(O.y)-1)&&C.multiply(z.setFromAxisAngle(y,g));var x=U.makeEmpty();E.copy(_.min).applyQuaternion(C),x.expandByPoint(E),E.copy(_.min).setX(_.max.x).applyQuaternion(C),x.expandByPoint(E),E.copy(_.min).setY(_.max.y).applyQuaternion(C),x.expandByPoint(E),E.copy(_.max).setZ(_.min.z).applyQuaternion(C),x.expandByPoint(E),E.copy(_.min).setZ(_.max.z).applyQuaternion(C),x.expandByPoint(E),E.copy(_.max).setY(_.min.y).applyQuaternion(C),x.expandByPoint(E),E.copy(_.max).setX(_.min.x).applyQuaternion(C),x.expandByPoint(E),E.copy(_.max).applyQuaternion(C),x.expandByPoint(E),C.setFromUnitVectors(v,O),x.min.x-=a,x.min.y-=d,x.max.x+=p,x.max.y+=u;var w=x.getSize(f),L=x.getCenter(E).applyQuaternion(C),S=this._camera.isPerspectiveCamera,D=this._camera.isOrthographicCamera;if(S){var M=this.getDistanceToFit(w.x,w.y,w.z);return this.moveTo(L.x,L.y,L.z,e),void this.dollyTo(M,e)}if(D){var P=this._camera,R=P.right-P.left,F=P.top-P.bottom,V=Math.min(R/w.x,F/w.y);return this.moveTo(L.x,L.y,L.z,e),void this.zoomTo(V,e)}},e.prototype.setLookAt=function(t,e,i,o,r,a,n){void 0===n&&(n=!1);var s=f.set(t,e,i),h=E.set(o,r,a);this._targetEnd.copy(h),this._sphericalEnd.setFromVector3(s.sub(h).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),n||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},e.prototype.lerpLookAt=function(t,e,i,o,r,a,n,s,h,c,p,l,d,m){void 0===m&&(m=!1);var u=f.set(t,e,i),_=E.set(o,r,a);x.setFromVector3(u.sub(_).applyQuaternion(this._yAxisUpSpace));var y=f.set(c,p,l);this._targetEnd.copy(_).lerp(y,d);var v=E.set(n,s,h);w.setFromVector3(v.sub(y).applyQuaternion(this._yAxisUpSpace));var g=w.theta-x.theta,T=w.phi-x.phi,O=w.radius-x.radius;this._sphericalEnd.set(x.radius+O*d,x.phi+T*d,x.theta+g*d),this.normalizeRotations(),m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},e.prototype.setPosition=function(t,e,i,o){void 0===o&&(o=!1),this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,o)},e.prototype.setTarget=function(t,e,i,o){void 0===o&&(o=!1);var r=this.getPosition(f);this.setLookAt(r.x,r.y,r.z,t,e,i,o)},e.prototype.setBoundary=function(t){if(!t)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0},e.prototype.setViewport=function(t,e,i,o){null!==t?(this._viewport=this._viewport||new u.Vector4,"number"==typeof t?this._viewport.set(t,e,i,o):this._viewport.copy(t)):this._viewport=null},e.prototype.getDistanceToFit=function(t,e,i){if(m(this._camera,"getDistanceToFit"))return this._spherical.radius;var o=this._camera,r=t/e,a=o.getEffectiveFOV()*u.MathUtils.DEG2RAD,n=o.aspect;return.5*(r<n?e:t/n)/Math.tan(.5*a)+.5*i},e.prototype.getTarget=function(t){return(t&&t.isVector3?t:new u.Vector3).copy(this._targetEnd)},e.prototype.getPosition=function(t){return(t&&t.isVector3?t:new u.Vector3).setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).add(this._targetEnd)},e.prototype.normalizeRotations=function(){this._sphericalEnd.theta=this._sphericalEnd.theta%a,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=a),this._spherical.theta+=a*Math.round((this._sphericalEnd.theta-this._spherical.theta)/a)},e.prototype.reset=function(t){void 0===t&&(t=!1),this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.zoomTo(this._zoom0,t)},e.prototype.saveState=function(){this._target0.copy(this._target),this._position0.copy(this._camera.position),this._zoom0=this._zoom},e.prototype.updateCameraUp=function(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,y),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).inverse()},e.prototype.update=function(t){var e=this._state===o.NONE?this.dampingFactor:this.draggingDampingFactor,i=1-Math.exp(-e*t*62.5),r=this._sphericalEnd.theta-this._spherical.theta,a=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,h=f.subVectors(this._targetEnd,this._target);if(s(r)&&s(a)&&s(n)&&s(h.x)&&s(h.y)&&s(h.z)?(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd)):(this._spherical.set(this._spherical.radius+n*i,this._spherical.phi+a*i,this._spherical.theta+r*i),this._target.add(h.multiplyScalar(i)),this._needsUpdate=!0),0!==this._dollyControlAmount){if(this._camera.isPerspectiveCamera){var c=this._camera,p=f.setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),l=E.copy(p).cross(c.up).normalize();0===l.lengthSq()&&(l.x=1);var d=T.crossVectors(l,p),m=this._sphericalEnd.radius*Math.tan(c.getEffectiveFOV()*u.MathUtils.DEG2RAD*.5),_=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,y=f.copy(this._targetEnd).add(l.multiplyScalar(this._dollyControlCoord.x*m*c.aspect)).add(d.multiplyScalar(this._dollyControlCoord.y*m));this._targetEnd.lerp(y,_),this._target.copy(this._targetEnd)}this._dollyControlAmount=0}var v=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,v),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),f.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);var g=this._zoomEnd-this._zoom;this._zoom+=g*i,this._camera.zoom!==this._zoom&&(s(g)&&(this._zoom=this._zoomEnd),this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0);var O=this._needsUpdate;return O&&!this._updatedLastTime?(this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):O?this.dispatchEvent({type:"update"}):!O&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._updatedLastTime=O,this._needsUpdate=!1,O},e.prototype.toJSON=function(){return JSON.stringify({enabled:this.enabled,minDistance:this.minDistance,maxDistance:c(this.maxDistance),minZoom:this.minZoom,maxZoom:c(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:c(this.maxPolarAngle),minAzimuthAngle:c(this.minAzimuthAngle),maxAzimuthAngle:c(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:f.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0})},e.prototype.fromJSON=function(t,e){void 0===e&&(e=!1);var i=JSON.parse(t),o=f.fromArray(i.position);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=p(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=p(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=p(i.maxPolarAngle),this.minAzimuthAngle=p(i.minAzimuthAngle),this.maxAzimuthAngle=p(i.maxAzimuthAngle),this.dampingFactor=i.dampingFactor,this.draggingDampingFactor=i.draggingDampingFactor,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this.moveTo(i.target[0],i.target[1],i.target[2],e),x.setFromVector3(o.sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(x.theta,x.phi,e),this.zoomTo(i.zoom,e),this._needsUpdate=!0},e.prototype.dispose=function(){this._removeAllEventListeners()},e.prototype._encloseToBoundary=function(t,e,i){var o=e.lengthSq();if(0===o)return t;var r=E.copy(e).add(t),a=this._boundary.clampPoint(r,T).sub(r),n=a.lengthSq();if(0===n)return t.add(e);if(n===o)return t;if(0===i)return t.add(e).add(a);var s=1+i*n/e.dot(a);return t.add(E.copy(e).multiplyScalar(s)).add(a.multiplyScalar(1-i))},e.prototype._updateNearPlaneCorners=function(){if(this._camera.isPerspectiveCamera){var t=(r=this._camera).near,e=r.getEffectiveFOV()*u.MathUtils.DEG2RAD,i=Math.tan(.5*e)*t,o=i*r.aspect;this._nearPlaneCorners[0].set(-o,-i,0),this._nearPlaneCorners[1].set(o,-i,0),this._nearPlaneCorners[2].set(o,i,0),this._nearPlaneCorners[3].set(-o,i,0)}else if(this._camera.isOrthographicCamera){var r,a=1/(r=this._camera).zoom,n=r.left*a,s=r.right*a,h=r.top*a,c=r.bottom*a;this._nearPlaneCorners[0].set(n,h,0),this._nearPlaneCorners[1].set(s,h,0),this._nearPlaneCorners[2].set(s,c,0),this._nearPlaneCorners[3].set(n,c,0)}},e.prototype._collisionTest=function(){var t=1/0;if(!(this.colliderMeshes.length>=1))return t;if(m(this._camera,"_collisionTest"))return t;t=this._spherical.radius;var e=f.setFromSpherical(this._spherical).divideScalar(t);L.lookAt(_,e,this._camera.up);for(var i=0;i<4;i++){var o=E.copy(this._nearPlaneCorners[i]);o.applyMatrix4(L);var r=T.addVectors(this._target,o);S.set(r,e),S.far=t;var a=S.intersectObjects(this.colliderMeshes);0!==a.length&&a[0].distance<t&&(t=a[0].distance)}return t},e.prototype._getClientRect=function(t){var e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.z=this._viewport.z,t.w=this._viewport.w):(t.z=e.width,t.w=e.height),t},e.prototype._removeAllEventListeners=function(){},e}(D);e.a=R}}]);