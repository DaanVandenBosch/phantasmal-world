(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"/QjG":function(t,e,r){"use strict";r.r(e);var n=r("tDPm"),o=r("y3fX");class i{constructor(t,e,r){this.gl=t;const n=t.createProgram();if(null==n)throw new Error("Failed to create program.");this.program=n;let i=null,s=null;try{if(i=a(t,t.VERTEX_SHADER,e),t.attachShader(n,i),s=a(t,t.FRAGMENT_SHADER,r),t.attachShader(n,s),t.bindAttribLocation(n,o.b,"pos"),t.bindAttribLocation(n,o.a,"normal"),t.bindAttribLocation(n,o.c,"tex"),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS)){const e=t.getProgramInfoLog(n);throw new Error("Shader linking failed. Program log:\n"+e)}this.mat_projection_loc=this.get_required_uniform_location(n,"mat_projection"),this.mat_camera_loc=this.get_required_uniform_location(n,"mat_camera"),this.mat_normal_loc=t.getUniformLocation(n,"mat_normal"),this.tex_sampler_loc=t.getUniformLocation(n,"tex_sampler"),t.detachShader(n,i),t.detachShader(n,s)}catch(e){throw t.deleteProgram(n),e}finally{t.deleteShader(i),t.deleteShader(s)}}set_mat_projection_uniform(t){this.gl.uniformMatrix4fv(this.mat_projection_loc,!1,t.data)}set_mat_camera_uniform(t){this.gl.uniformMatrix4fv(this.mat_camera_loc,!1,t.data)}set_mat_normal_uniform(t){this.gl.uniformMatrix3fv(this.mat_normal_loc,!1,t.data)}set_texture_uniform(t){this.gl.uniform1i(this.tex_sampler_loc,t-this.gl.TEXTURE0)}bind(){this.gl.useProgram(this.program)}unbind(){this.gl.useProgram(null)}delete(){this.gl.deleteProgram(this.program)}get_required_uniform_location(t,e){const r=this.gl.getUniformLocation(t,e);if(null==r)throw new Error(`Couldn't get ${e} uniform location.`);return r}}function a(t,e,r){const n=t.createShader(e);if(null==n)throw new Error(`Failed to create shader of type ${e}.`);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error("Vertex shader compilation failed. Shader log:\n"+e)}return n}var s="#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nuniform mat4 mat_projection;\r\nuniform mat4 mat_camera;\r\nuniform mat3 mat_normal;\r\n\r\nin vec4 pos;\r\nin vec3 normal;\r\n\r\nout vec3 frag_normal;\r\n\r\nvoid main() {\r\n    gl_Position = mat_projection * mat_camera * pos;\r\n    frag_normal = normalize(mat_normal * normal);\r\n}\r\n",c="#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nconst vec3 light_pos = normalize(vec3(-1, 1, 1));\r\nconst vec4 sky_color = vec4(1, 1, 1, 1);\r\nconst vec4 ground_color = vec4(0.1, 0.1, 0.1, 1);\r\n\r\nin vec3 frag_normal;\r\n\r\nout vec4 frag_color;\r\n\r\nvoid main() {\r\n    float cos0 = dot(frag_normal, light_pos);\r\n    float a = 0.5 + 0.5 * cos0;\r\n    float a_back = 1.0 - a;\r\n\r\n    if (gl_FrontFacing) {\r\n        frag_color = mix(ground_color, sky_color, a);\r\n    } else {\r\n        frag_color = mix(ground_color, sky_color, a_back);\r\n    }\r\n}\r\n",h="#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nuniform mat4 mat_projection;\r\nuniform mat4 mat_camera;\r\n\r\nin vec4 pos;\r\nin vec2 tex;\r\n\r\nout vec2 f_tex;\r\n\r\nvoid main() {\r\n    gl_Position = mat_projection * mat_camera * pos;\r\n    f_tex = tex;\r\n}\r\n",d="#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nuniform sampler2D tex_sampler;\r\n\r\nin vec2 f_tex;\r\n\r\nout vec4 frag_color;\r\n\r\nvoid main() {\r\n    frag_color = texture(tex_sampler, f_tex);\r\n}\r\n",u=r("FLbM"),l=r("7/+l");class _{constructor(t){this.gl=t}create_gfx_mesh(t,e,r,n){var i;const a=this.gl;let s=null,c=null,h=null;try{if(s=a.createVertexArray(),null==s)throw new Error("Failed to create VAO.");if(c=a.createBuffer(),null==c)throw new Error("Failed to create vertex buffer.");if(h=a.createBuffer(),null==h)throw new Error("Failed to create index buffer.");a.bindVertexArray(s),a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);const d=Object(o.f)(t);a.vertexAttribPointer(o.b,3,a.FLOAT,!0,d,0),a.enableVertexAttribArray(o.b);const u=Object(o.e)(t);-1!==u&&(a.vertexAttribPointer(o.a,3,a.FLOAT,!0,d,u),a.enableVertexAttribArray(o.a));const l=Object(o.g)(t);return-1!==l&&(a.vertexAttribPointer(o.c,2,a.UNSIGNED_SHORT,!0,d,l),a.enableVertexAttribArray(o.c)),a.bindBuffer(a.ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,h),a.bufferData(a.ELEMENT_ARRAY_BUFFER,r,a.STATIC_DRAW),a.bindVertexArray(null),null===(i=n)||void 0===i||i.upload(),{vao:s,vertex_buffer:c,index_buffer:h}}catch(t){throw a.deleteVertexArray(s),a.deleteBuffer(c),a.deleteBuffer(h),t}}destroy_gfx_mesh(t){if(t){const e=this.gl;e.deleteVertexArray(t.vao),e.deleteBuffer(t.vertex_buffer),e.deleteBuffer(t.index_buffer)}}create_texture(t,e,r,n){const o=this.gl,i=o.getExtension("WEBGL_compressed_texture_s3tc");if(!i)throw new Error("Extension WEBGL_compressed_texture_s3tc not supported.");const a=o.createTexture();if(null==a)throw new Error("Failed to create texture.");let s;switch(t){case l.b.RGBA_S3TC_DXT1:s=i.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case l.b.RGBA_S3TC_DXT3:s=i.COMPRESSED_RGBA_S3TC_DXT3_EXT}return o.bindTexture(o.TEXTURE_2D,a),o.compressedTexImage2D(o.TEXTURE_2D,0,s,e,r,0,new Uint8Array(n)),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.bindTexture(o.TEXTURE_2D,null),a}destroy_texture(t){null!=t&&this.gl.deleteTexture(t)}}r.d(e,"WebglRenderer",(function(){return m}));class m extends u.a{constructor(t){super(t);const e=this.canvas_element.getContext("webgl2");if(null==e)throw new Error("Failed to initialize webgl2 context.");this.gl=e,this.gfx=new _(e),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.clearColor(.1,.1,.1,1),this.shader_programs=[new i(e,s,c),new i(e,h,d)],this.set_size(800,600)}dispose(){for(const t of this.shader_programs)t.delete();super.dispose()}set_size(t,e){this.canvas_element.width=t,this.canvas_element.height=e,this.gl.viewport(0,0,t,e),super.set_size(t,e)}render(){const t=this.gl;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.scene.traverse((e,r)=>{var o;const i=Object(n.d)(r,e.transform);if(e.mesh){const r=this.shader_programs[e.mesh.format];r.bind(),r.set_mat_projection_uniform(this.projection_mat),r.set_mat_camera_uniform(i),r.set_mat_normal_uniform(i.normal_mat3()),(null===(o=e.mesh.texture)||void 0===o?void 0:o.gfx_texture)&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.mesh.texture.gfx_texture),r.set_texture_uniform(t.TEXTURE0));const n=e.mesh.gfx_mesh;t.bindVertexArray(n.vao),t.drawElements(t.TRIANGLES,e.mesh.index_count,t.UNSIGNED_SHORT,0),t.bindVertexArray(null),t.bindTexture(t.TEXTURE_2D,null),r.unbind()}return i},this.camera.mat4)}}},"7/+l":function(t,e,r){"use strict";var n;r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return o})),function(t){t[t.RGBA_S3TC_DXT1=0]="RGBA_S3TC_DXT1",t[t.RGBA_S3TC_DXT3=1]="RGBA_S3TC_DXT3"}(n||(n={}));class o{constructor(t,e,r,n,o){this.gfx=t,this.format=e,this.width=r,this.height=n,this.data=o}upload(){null==this.gfx_texture&&(this.gfx_texture=this.gfx.create_texture(this.format,this.width,this.height,this.data))}destroy(){this.gfx.destroy_texture(this.gfx_texture)}}},FLbM:function(t,e,r){"use strict";var n=r("e6d5"),o=r("tDPm");class i{constructor(){this.look_at=new o.c(0,0,0),this.x_rot=0,this.y_rot=0,this.z_rot=0,this._zoom=1,this._mat4=o.a.identity()}get mat4(){return this._mat4}pan(t,e,r){return this.look_at.x+=t,this.look_at.y+=e,this.look_at.z+=r,this.update_matrix(),this}zoom(t){return this._zoom*=t,this.look_at.x*=t,this.look_at.y*=t,this.look_at.z*=t,this.update_matrix(),this}reset(){return this.look_at.x=0,this.look_at.y=0,this.look_at.z=0,this.x_rot=0,this.y_rot=0,this.z_rot=0,this._zoom=1,this.update_matrix(),this}update_matrix(){this._mat4.data[12]=-this.look_at.x,this._mat4.data[13]=-this.look_at.y,this._mat4.data[14]=-this.look_at.z,this._mat4.data[0]=this._zoom,this._mat4.data[5]=this._zoom,this._mat4.data[10]=this._zoom}}var a=r("ViJ0");r.d(e,"a",(function(){return s}));class s{constructor(t){this.perspective_projection=t,this.projection_mat=o.a.identity(),this.scene=new n.a,this.camera=new i,this.canvas_element=document.createElement("canvas"),this.schedule_render=()=>{null==this.animation_frame&&(this.animation_frame=requestAnimationFrame(this.call_render))},this.call_render=()=>{this.animation_frame=void 0,this.render()},this.mousedown=t=>{1===t.buttons&&(this.pointer_pos=new o.b(t.clientX,t.clientY),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup))},this.mousemove=t=>{if(1===t.buttons){const e=new o.b(t.clientX,t.clientY),r=Object(o.e)(e,this.pointer_pos);this.camera.pan(-r.x,r.y,0),this.pointer_pos=e,this.schedule_render()}},this.mouseup=()=>{this.pointer_pos=void 0,window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)},this.wheel=t=>{this.perspective_projection?t.deltaY<0?this.camera.pan(0,0,-5):this.camera.pan(0,0,5):t.deltaY<0?this.camera.zoom(1.1):this.camera.zoom(.9),this.schedule_render()},this.canvas_element.width=800,this.canvas_element.height=600,this.canvas_element.addEventListener("mousedown",this.mousedown),this.canvas_element.addEventListener("wheel",this.wheel,{passive:!0})}dispose(){this.destroy_scene()}set_size(t,e){if(this.perspective_projection){const r=75,n=t/e,i=.1,s=2e3,c=i*Math.tan(Object(a.a)(.5*r)),h=-c,d=n*c,u=-d;this.projection_mat=o.a.of(2*i/(d-u),0,(d+u)/(d-u),0,0,2*i/(c-h),(c+h)/(c-h),0,0,0,-(s+i)/(s-i),-2*s*i/(s-i),0,0,-1,0)}else{const r=t,n=e,i=-1e3,a=1e3;this.projection_mat=o.a.of(2/r,0,0,0,0,2/n,0,0,0,0,2/(i-a),0,0,0,0,1)}this.schedule_render()}start_rendering(){this.schedule_render()}stop_rendering(){null!=this.animation_frame&&cancelAnimationFrame(this.animation_frame),this.animation_frame=void 0}destroy_scene(){this.scene.traverse(t=>{var e,r,n;null===(e=t.mesh)||void 0===e||e.destroy(this.gfx),null===(n=null===(r=t.mesh)||void 0===r?void 0:r.texture)||void 0===n||n.destroy(),t.mesh=void 0},void 0),this.scene.root_node.clear_children(),this.scene.root_node.transform=o.a.identity()}}},ViJ0:function(t,e,r){"use strict";r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return s}));const n=180/Math.PI,o=Math.PI/180;function i(t){return t*n}function a(t){return t*o}function s(t,e){return(t%e+e)%e}},e6d5:function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return i}));var n=r("tDPm");class o{constructor(){this.root_node=new i(void 0,n.a.identity())}traverse(t,e){this.traverse_node(this.root_node,t,e)}traverse_node(t,e,r){const n=e(t,r);for(const r of t.children)this.traverse_node(r,e,n)}}class i{constructor(t,e,...r){this.mesh=t,this.transform=e,this._children=r}get children(){return this._children}add_child(t){this._children.push(t)}clear_children(){this._children.splice(0)}}},tDPm:function(t,e,r){"use strict";r.d(e,"b",(function(){return o})),r.d(e,"e",(function(){return i})),r.d(e,"c",(function(){return a})),r.d(e,"a",(function(){return c})),r.d(e,"d",(function(){return h}));var n=r("wtpc");class o{constructor(t,e){this.x=t,this.y=e}get u(){return this.x}get v(){return this.y}}function i(t,e){return new o(t.x-e.x,t.y-e.y)}class a{constructor(t,e,r){this.x=t,this.y=e,this.z=r}}class s{constructor(t){this.data=t,Object(n.d)(9===t.length,"data should be of length 9.")}static of(t,e,r,n,o,i,a,c,h){return new s(new Float32Array([t,n,a,e,o,c,r,i,h]))}static identity(){return s.of(1,0,0,0,1,0,0,0,1)}get(t,e){return this.data[t+3*e]}set(t,e,r){this.data[t+3*e]=r}clone(){return new s(new Float32Array(this.data))}transpose(){let t;const e=this.data;t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t}inverse(){const t=this.clone();return t.invert(),t}invert(){const t=this.data[0],e=this.data[1],r=this.data[2],n=this.data[3],o=this.data[4],i=this.data[5],a=this.data[6],s=this.data[7],c=this.data[8],h=c*o-i*s,d=i*a-c*n,u=s*n-o*a,l=t*h+e*d+r*u;if(0===l)return this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=1,this.data[5]=0,this.data[6]=0,this.data[7]=0,void(this.data[8]=1);const _=1/l;this.data[0]=h*_,this.data[1]=(r*s-c*e)*_,this.data[2]=(i*e-r*o)*_,this.data[3]=d*_,this.data[4]=(c*t-r*a)*_,this.data[5]=(r*n-i*t)*_,this.data[6]=u*_,this.data[7]=(e*a-s*t)*_,this.data[8]=(o*t-e*n)*_}}class c{constructor(t){this.data=t,Object(n.d)(16===t.length,"data should be of length 16.")}static of(t,e,r,n,o,i,a,s,h,d,u,l,_,m,f,x){return new c(new Float32Array([t,o,h,_,e,i,d,m,r,a,u,f,n,s,l,x]))}static identity(){return c.of(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static translation(t,e,r){return c.of(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1)}static scale(t,e,r){return c.of(t,0,0,1,0,e,0,1,0,0,r,1,0,0,0,1)}static compose(t,e,r){const n=e.w,o=e.x,i=e.y,a=e.z,s=o+o,h=i+i,d=a+a,u=o*s,l=o*h,_=o*d,m=i*h,f=i*d,x=a*d,g=n*s,p=n*h,v=n*d,T=r.x,E=r.y,w=r.z;return c.of((1-(m+x))*T,(l-v)*E,(_+p)*w,t.x,(l+v)*T,(1-(u+x))*E,(f-g)*w,t.y,(_-p)*T,(f+g)*E,(1-(u+m))*w,t.z,0,0,0,1)}get(t,e){return this.data[t+4*e]}set(t,e,r){this.data[t+4*e]=r}clone(){return new c(new Float32Array(this.data))}normal_mat3(){const t=s.of(this.data[0],this.data[4],this.data[8],this.data[1],this.data[5],this.data[9],this.data[2],this.data[6],this.data[10]);return t.invert(),t.transpose(),t}}function h(t,e){const r=new c(new Float32Array(16));return d(r.data,t,e),r}function d(t,e,r){for(let n=0;n<4;n++)for(let o=0;o<4;o++)for(let i=0;i<4;i++)t[n+4*o]+=e.data[n+4*i]*r.data[i+4*o]}},y3fX:function(t,e,r){"use strict";var n;r.d(e,"d",(function(){return n})),r.d(e,"b",(function(){return o})),r.d(e,"a",(function(){return i})),r.d(e,"c",(function(){return a})),r.d(e,"f",(function(){return s})),r.d(e,"e",(function(){return c})),r.d(e,"g",(function(){return h})),function(t){t[t.PosNorm=0]="PosNorm",t[t.PosTex=1]="PosTex",t[t.PosNormTex=2]="PosNormTex"}(n||(n={}));const o=0,i=1,a=2;function s(t){switch(t){case n.PosNorm:return 24;case n.PosTex:return 16;case n.PosNormTex:return 28}}function c(t){switch(t){case n.PosTex:return-1;case n.PosNorm:case n.PosNormTex:return 12}}function h(t){switch(t){case n.PosNorm:return-1;case n.PosTex:return 12;case n.PosNormTex:return 24}}}}]);