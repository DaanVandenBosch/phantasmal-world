(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"7/+l":function(t,e,i){"use strict";var n;i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return s})),function(t){t[t.RGBA_S3TC_DXT1=0]="RGBA_S3TC_DXT1",t[t.RGBA_S3TC_DXT3=1]="RGBA_S3TC_DXT3"}(n||(n={}));class s{constructor(t,e,i,n,s){this.gfx=t,this.format=e,this.width=i,this.height=n,this.data=s}upload(){null==this.gfx_texture&&(this.gfx_texture=this.gfx.create_texture(this.format,this.width,this.height,this.data))}destroy(){this.gfx.destroy_texture(this.gfx_texture)}}},"7CyS":function(t,e,i){"use strict";i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return a}));var n=i("Womt"),s=i("VwSi");const r=30;function a(t,e){const i=e.interpolation===s.a.Spline?n.InterpolateSmooth:n.InterpolateLinear,a=[];return e.motion_data.forEach((e,o)=>{const h=t.get_bone(o);h&&e.tracks.forEach(({type:t,keyframes:e})=>{const c=[],d=[];for(const i of e)if(c.push(i.frame/r),t===s.b.Rotation){const t=h.evaluation_flags.zxy_rotation_order?"ZXY":"ZYX",e=(new n.Quaternion).setFromEuler(new n.Euler(i.value.x,i.value.y,i.value.z,t));d.push(e.x,e.y,e.z,e.w)}else d.push(i.value.x,i.value.y,i.value.z);if(t===s.b.Rotation)a.push(new n.QuaternionKeyframeTrack(`.bones[${o}].quaternion`,c,d,i));else{const e=t===s.b.Position?`.bones[${o}].position`:`.bones[${o}].scale`;a.push(new n.VectorKeyframeTrack(e,c,d,i))}})}),new n.AnimationClip("Animation",(e.frame_count-1)/r,a).optimize()}},BylX:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("pVCM"),s=i("Womt");n.a.install({THREE:Object.assign(Object.assign({},s),{MOUSE:Object.assign(Object.assign({},s.MOUSE),{LEFT:s.MOUSE.RIGHT,RIGHT:s.MOUSE.LEFT})})});class r{constructor(t){this._debug=!1,this.scene=new s.Scene,this.light_holder=new s.Group,this.render_scheduled=!1,this.animation_frame_handle=void 0,this.light=new s.HemisphereLight(16777215,5263440,1),this.controls_clock=new s.Clock,this.size=new s.Vector2(0,0),this.schedule_render=()=>{this.render_scheduled=!0},this.on_mouse_down=t=>{t.currentTarget&&t.currentTarget.focus()},this.call_render=()=>{const t=this.controls.update(this.controls_clock.getDelta()),e=this.render_scheduled||t;this.render_scheduled=!1,e&&this.render(),this.animation_frame_handle=requestAnimationFrame(this.call_render)},this.renderer=t,this.renderer.domElement.tabIndex=0,this.renderer.domElement.addEventListener("mousedown",this.on_mouse_down),this.renderer.domElement.style.outline="none",this.scene.background=new s.Color(1579032),this.light_holder.add(this.light),this.scene.add(this.light_holder)}get debug(){return this._debug}set debug(t){this._debug=t}get canvas_element(){return this.renderer.domElement}set_size(t,e){this.size.set(t,e),this.renderer.setSize(t,e),this.schedule_render()}pointer_pos_to_device_coords(t){t.set(t.x/this.size.width*2-1,t.y/this.size.height*-2+1)}start_rendering(){null==this.animation_frame_handle&&(this.schedule_render(),this.animation_frame_handle=requestAnimationFrame(this.call_render))}stop_rendering(){null!=this.animation_frame_handle&&(cancelAnimationFrame(this.animation_frame_handle),this.animation_frame_handle=void 0)}reset_camera(t,e){this.controls.setLookAt(t.x,t.y,t.z,e.x,e.y,e.z)}dispose(){this.renderer.dispose(),this.controls.dispose()}init_camera_controls(){this.controls=new n.a(this.camera,this.renderer.domElement),this.controls.dampingFactor=1,this.controls.draggingDampingFactor=1}render(){this.renderer.render(this.scene,this.camera)}}},Eqai:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("Womt");const s=new n.MeshLambertMaterial({color:65280,side:n.DoubleSide});function r(t,e,i,r){const{created_by_geometry_builder:a,materials:o,bones:h}=t.userData;let c;if(e.length&&a){c=[s];for(let t=1;t<o.length;t++){const{texture_id:i,alpha:s,additive_blending:a}=o[t],h=null==i?void 0:e[i];if(h){const t={skinning:r,map:h,side:n.DoubleSide};s&&(t.transparent=!0,t.alphaTest=.01),a&&(t.transparent=!0,t.alphaTest=.01,t.blending=n.AdditiveBlending),c.push(new n.MeshBasicMaterial(t))}else c.push(new n.MeshLambertMaterial({skinning:r,side:n.DoubleSide}))}}else c=i;if(a&&h.length&&r){const e=new n.SkinnedMesh(t,c);return e.add(h[0]),e.bind(new n.Skeleton(h)),e}return new n.Mesh(t,c)}},N8H5:function(t,e,i){"use strict";i.d(e,"b",(function(){return u})),i.d(e,"a",(function(){return _}));var n=i("Womt"),s=i("tRdk"),r=i("kwt4"),a=i("vM2b");const o=new n.Vector3(0,1,0),h=new n.Vector2(0,0),c=new n.Vector3(0,0,0),d=new n.Quaternion(0,0,0,1),l=new n.Vector3(1,1,1);function u(t,e){new p(e).to_geometry_builder(t)}function _(t){return new p(new a.a).create_buffer_geometry(t)}class m{constructor(){this.vertices_stack=[]}put(t){this.vertices_stack.push(t)}get(t){const e=[];for(let i=this.vertices_stack.length-1;i>=0;i--){const n=this.vertices_stack[i][t];n&&e.push(n)}return e}}class p{constructor(t){this.vertices=new m,this.bone_id=0,this.builder=t}to_geometry_builder(t){this.object_to_geometry(t,void 0,new n.Matrix4)}create_buffer_geometry(t){return this.to_geometry_builder(t),this.builder.build()}object_to_geometry(t,e,i){const{no_translate:r,no_rotate:a,no_scale:o,hidden:h,break_child_trace:u,zxy_rotation_order:_,skip:m}=t.evaluation_flags,{position:p,rotation:b,scale:g}=t,f=new n.Euler(b.x,b.y,b.z,_?"ZXY":"ZYX"),w=(new n.Matrix4).compose(r?c:Object(s.b)(p),a?d:(new n.Quaternion).setFromEuler(f),o?l:Object(s.b)(g)).premultiply(i);let x;if(m?x=e:(x=new n.Bone,x.name=this.bone_id.toString(),x.position.set(p.x,p.y,p.z),x.setRotationFromEuler(f),x.scale.set(g.x,g.y,g.z),this.builder.add_bone(x),e&&e.add(x)),t.model&&!h&&this.model_to_geometry(t.model,w),this.bone_id++,!u)for(const e of t.children)this.object_to_geometry(e,x,w)}model_to_geometry(t,e){Object(r.b)(t)?this.njcm_model_to_geometry(t,e):this.xj_model_to_geometry(t,e)}njcm_model_to_geometry(t,e){const i=(new n.Matrix3).getNormalMatrix(e),r=t.vertices.map(t=>{const r=Object(s.b)(t.position),a=t.normal?Object(s.b)(t.normal):new n.Vector3(0,1,0);return r.applyMatrix4(e),a.applyMatrix3(i),{bone_id:this.bone_id,position:r,normal:a,bone_weight:t.bone_weight,bone_weight_status:t.bone_weight_status,calc_continue:t.calc_continue}});this.vertices.put(r);for(const e of t.meshes){const t=this.builder.index_count;for(let t=0;t<e.vertices.length;++t){const i=e.vertices[t],n=this.vertices.get(i.index);if(n.length){const s=n[0],r=s.normal||i.normal||o,a=this.builder.vertex_count;this.builder.add_vertex(s.position,r,e.has_tex_coords?i.tex_coords:h),t>=2&&(t%2==(e.clockwise_winding?1:0)?(this.builder.add_index(a-2),this.builder.add_index(a-1),this.builder.add_index(a)):(this.builder.add_index(a-2),this.builder.add_index(a),this.builder.add_index(a-1)));const c=[[0,0],[0,0],[0,0],[0,0]];for(let t=n.length-1;t>=0;t--){const e=n[t];c[e.bone_weight_status]=[e.bone_id,e.bone_weight]}const d=c.reduce((t,[,e])=>t+e,0);for(const[t,e]of c)this.builder.add_bone_weight(t,d>0?e/d:e)}}this.builder.add_group(t,this.builder.index_count-t,e.texture_id,e.use_alpha,4!==e.src_alpha||5!==e.dst_alpha)}}xj_model_to_geometry(t,e){const i=this.builder.vertex_count,r=(new n.Matrix3).getNormalMatrix(e);for(const{position:i,normal:a,uv:o}of t.vertices){const t=Object(s.b)(i).applyMatrix4(e),c=(a?Object(s.b)(a):new n.Vector3(0,1,0)).applyMatrix3(r),d=o||h;this.builder.add_vertex(t,c,d)}let a,o,c;for(const e of t.meshes){const t=this.builder.index_count;let n=!1;for(let t=2;t<e.indices.length;++t){const s=i+e.indices[t-2],r=i+e.indices[t-1],a=i+e.indices[t],o=this.builder.get_position(s),h=this.builder.get_position(r),c=this.builder.get_position(a),d=this.builder.get_normal(s),l=this.builder.get_normal(r),u=this.builder.get_normal(a),_=h.clone().sub(o).cross(c.clone().sub(o));n&&_.negate(),(_.dot(d)<0?1:0)+(_.dot(l)<0?1:0)+(_.dot(u)<0?1:0)>=2&&(n=!n),n?(this.builder.add_index(r),this.builder.add_index(s),this.builder.add_index(a)):(this.builder.add_index(s),this.builder.add_index(r),this.builder.add_index(a)),n=!n}null!=e.material_properties.texture_id&&(a=e.material_properties.texture_id),null!=e.material_properties.src_alpha&&(o=e.material_properties.src_alpha),null!=e.material_properties.dst_alpha&&(c=e.material_properties.dst_alpha),this.builder.add_group(t,this.builder.index_count-t,a,!0,4!==o||5!==c)}}}},iR5r:function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return a})),i.d(e,"c",(function(){return o}));var n=i("Womt"),s=i("7/+l");function r(t,e){let i,n;switch(e.format[1]){case 6:i=s.b.RGBA_S3TC_DXT1,n=e.width*e.height/2;break;case 7:i=s.b.RGBA_S3TC_DXT3,n=e.width*e.height;break;default:throw new Error(`Format ${e.format.join(", ")} not supported.`)}return new s.a(t,i,e.width,e.height,e.data.slice(0,n))}function a(t){return t.textures.map(o)}function o(t){let e,i;switch(t.format[1]){case 6:e=n.RGBA_S3TC_DXT1_Format,i=t.width*t.height/2;break;case 7:e=n.RGBA_S3TC_DXT3_Format,i=t.width*t.height;break;default:throw new Error(`Format ${t.format.join(", ")} not supported.`)}const s=new n.CompressedTexture([{data:new Uint8Array(t.data,0,i),width:t.width,height:t.height}],t.width,t.height,e);return s.minFilter=n.LinearFilter,s.wrapS=n.MirroredRepeatWrapping,s.wrapT=n.MirroredRepeatWrapping,s.needsUpdate=!0,s}},tDPm:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"e",(function(){return r})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return h})),i.d(e,"d",(function(){return c}));var n=i("wtpc");class s{constructor(t,e){this.x=t,this.y=e}get u(){return this.x}get v(){return this.y}}function r(t,e){return new s(t.x-e.x,t.y-e.y)}class a{constructor(t,e,i){this.x=t,this.y=e,this.z=i}}class o{constructor(t){this.data=t,Object(n.d)(9===t.length,"data should be of length 9.")}static of(t,e,i,n,s,r,a,h,c){return new o(new Float32Array([t,n,a,e,s,h,i,r,c]))}static identity(){return o.of(1,0,0,0,1,0,0,0,1)}get(t,e){return this.data[t+3*e]}set(t,e,i){this.data[t+3*e]=i}clone(){return new o(new Float32Array(this.data))}transpose(){let t;const e=this.data;t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t}inverse(){const t=this.clone();return t.invert(),t}invert(){const t=this.data[0],e=this.data[1],i=this.data[2],n=this.data[3],s=this.data[4],r=this.data[5],a=this.data[6],o=this.data[7],h=this.data[8],c=h*s-r*o,d=r*a-h*n,l=o*n-s*a,u=t*c+e*d+i*l;if(0===u)return this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=1,this.data[5]=0,this.data[6]=0,this.data[7]=0,void(this.data[8]=1);const _=1/u;this.data[0]=c*_,this.data[1]=(i*o-h*e)*_,this.data[2]=(r*e-i*s)*_,this.data[3]=d*_,this.data[4]=(h*t-i*a)*_,this.data[5]=(i*n-r*t)*_,this.data[6]=l*_,this.data[7]=(e*a-o*t)*_,this.data[8]=(s*t-e*n)*_}}class h{constructor(t){this.data=t,Object(n.d)(16===t.length,"data should be of length 16.")}static of(t,e,i,n,s,r,a,o,c,d,l,u,_,m,p,b){return new h(new Float32Array([t,s,c,_,e,r,d,m,i,a,l,p,n,o,u,b]))}static identity(){return h.of(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static translation(t,e,i){return h.of(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1)}static scale(t,e,i){return h.of(t,0,0,1,0,e,0,1,0,0,i,1,0,0,0,1)}static compose(t,e,i){const n=e.w,s=e.x,r=e.y,a=e.z,o=s+s,c=r+r,d=a+a,l=s*o,u=s*c,_=s*d,m=r*c,p=r*d,b=a*d,g=n*o,f=n*c,w=n*d,x=i.x,v=i.y,y=i.z;return h.of((1-(m+b))*x,(u-w)*v,(_+f)*y,t.x,(u+w)*x,(1-(l+b))*v,(p-g)*y,t.y,(_-f)*x,(p+g)*v,(1-(l+m))*y,t.z,0,0,0,1)}get(t,e){return this.data[t+4*e]}set(t,e,i){this.data[t+4*e]=i}clone(){return new h(new Float32Array(this.data))}normal_mat3(){const t=o.of(this.data[0],this.data[4],this.data[8],this.data[1],this.data[5],this.data[9],this.data[2],this.data[6],this.data[10]);return t.invert(),t.transpose(),t}}function c(t,e){const i=new h(new Float32Array(16));return d(i.data,t,e),i}function d(t,e,i){for(let n=0;n<4;n++)for(let s=0;s<4;s++)for(let r=0;r<4;r++)t[n+4*s]+=e.data[n+4*r]*i.data[r+4*s]}},tRdk:function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return a}));var n=i("Womt"),s=i("tDPm");function r(t){return new n.Vector3(t.x,t.y,t.z)}function a(t){return new s.c(t.x,t.y,t.z)}},vM2b:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("Womt"),s=i("wtpc");class r{constructor(){this.materials=[{alpha:!1,additive_blending:!1}],this.map=new Map}add_material(t,e=!1,i=!1){if(null==t)return 0;{const n=t<<2|(e?2:0)|(i?1:0);return Object(s.h)(this.map,n,()=>(this.materials.push({texture_id:t,alpha:e,additive_blending:i}),this.materials.length-1))}}get_materials(){return this.materials}}class a{constructor(){this.positions=[],this.normals=[],this.uvs=[],this.indices=[],this.bones=[],this.bone_indices=[],this.bone_weights=[],this.groups=[],this.material_map=new r}get vertex_count(){return this.positions.length/3}get index_count(){return this.indices.length}get_position(t){return new n.Vector3(this.positions[3*t],this.positions[3*t+1],this.positions[3*t+2])}get_normal(t){return new n.Vector3(this.normals[3*t],this.normals[3*t+1],this.normals[3*t+2])}add_vertex(t,e,i){this.positions.push(t.x,t.y,t.z),this.normals.push(e.x,e.y,e.z),this.uvs.push(i.x,i.y)}add_index(t){this.indices.push(t)}add_bone(t){this.bones.push(t)}add_bone_weight(t,e){this.bone_indices.push(t),this.bone_weights.push(e)}add_group(t,e,i,n=!1,s=!1){const r=this.groups[this.groups.length-1],a=this.material_map.add_material(i,n,s);r&&r.material_index===a?r.size+=e:this.groups.push({offset:t,size:e,material_index:a})}build(){const t=new n.BufferGeometry;let e;t.setAttribute("position",new n.Float32BufferAttribute(this.positions,3)),t.setAttribute("normal",new n.Float32BufferAttribute(this.normals,3)),t.setAttribute("uv",new n.Float32BufferAttribute(this.uvs,2)),t.setIndex(new n.Uint16BufferAttribute(this.indices,1)),this.bone_indices.length&&this.bones.length?(t.setAttribute("skinIndex",new n.Uint16BufferAttribute(this.bone_indices,4)),t.setAttribute("skinWeight",new n.Float32BufferAttribute(this.bone_weights,4)),e=this.bones):e=[];for(const e of this.groups)t.addGroup(e.offset,e.size,e.material_index);const i={created_by_geometry_builder:!0,materials:this.material_map.get_materials(),bones:e};return t.userData=i,t.computeBoundingSphere(),t.computeBoundingBox(),t}}},zaf9:function(t,e,i){"use strict";i.r(e),i.d(e,"ModelRenderer",(function(){return p}));var n=i("Womt"),s=i("iR5r"),r=i("Eqai"),a=i("N8H5"),o=i("7CyS"),h=i("BylX"),c=i("Tpfs");const d=i("rwco").a.get("viewer/rendering/ModelRenderer"),l=new n.MeshLambertMaterial({color:16777215,side:n.DoubleSide}),u=new n.MeshLambertMaterial({skinning:!0,color:16777215,side:n.DoubleSide}),_=Object.freeze(new n.Vector3(0,10,20)),m=Object.freeze(new n.Vector3(0,0,0));class p extends h.a{constructor(t,e){super(e),this.store=t,this.disposer=new c.a,this.clock=new n.Clock,this.update_animation_time=!0,this.camera=new n.PerspectiveCamera(75,1,1,200),this.current_character_class_changed=t=>{const e=null!=t.value;this.character_class_active!==e&&this.reset_camera(_,m),this.character_class_active=e},this.nj_object_or_xvm_changed=()=>{var t;this.mesh&&(this.scene.remove(this.mesh),this.mesh=void 0,this.scene.remove(this.skeleton_helper),this.skeleton_helper=void 0);const e=this.store.current_nj_object.val;if(e){let i;if(this.animation){const e=this.animation.mixer;i=null===(t=e.existingAction(this.animation.clip))||void 0===t?void 0:t.time,e.stopAllAction(),e.uncacheAction(this.animation.clip),this.animation=void 0}const h=this.store.current_textures.val.map(t=>{if(t)try{return Object(s.c)(t)}catch(t){d.error("Couldn't convert XVR texture.",t)}}),c=Object(a.a)(e),_=null!=c.getAttribute("skinIndex");this.mesh=Object(r.a)(c,h,_?u:l,_);const m=c.boundingBox,p=m.max.y-m.min.y;this.mesh.translateY(-p/2-m.min.y),this.scene.add(this.mesh),this.skeleton_helper=new n.SkeletonHelper(this.mesh),this.skeleton_helper.visible=this.store.show_skeleton.val,this.skeleton_helper.material.linewidth=3,this.scene.add(this.skeleton_helper);const b=this.store.current_nj_motion.val;if(b){const t=new n.AnimationMixer(this.mesh);t.timeScale=this.store.animation_frame_rate.val/o.a;const s=Object(o.b)(e,b);this.animation={mixer:t,clip:s};const r=t.clipAction(s,this.mesh);r.time=null!=i?i:0,r.play()}}this.schedule_render()},this.nj_motion_changed=({value:t})=>{let e;this.animation&&(this.animation.mixer.stopAllAction(),this.animation.mixer.uncacheAction(this.animation.clip),e=this.animation.mixer);const i=this.store.current_nj_object.val;if(!(this.mesh&&this.mesh instanceof n.SkinnedMesh&&t&&i))return;e||(e=new n.AnimationMixer(this.mesh));const s=Object(o.b)(i,t);this.animation={mixer:e,clip:s},this.clock.start(),e.clipAction(s).play(),this.schedule_render()},this.show_skeleton_changed=({value:t})=>{this.skeleton_helper&&(this.skeleton_helper.visible=t,this.schedule_render())},this.animation_playing_changed=({value:t})=>{this.animation&&(this.animation.mixer.clipAction(this.animation.clip).paused=!t,t?(this.clock.start(),this.schedule_render()):this.clock.stop())},this.animation_frame_rate_changed=({value:t})=>{this.animation&&(this.animation.mixer.timeScale=t/o.a)},this.animation_frame_changed=({value:t})=>{const e=this.store.current_nj_motion.val;if(this.animation&&e){const i=e.frame_count;t>i&&(t=1),t<1&&(t=i),this.update_animation_time&&(this.animation.mixer.clipAction(this.animation.clip).time=(t-1)/o.a),this.schedule_render()}},this.character_class_active=null!=t.current_character_class.val,this.disposer.add_all(t.current_character_class.observe(this.current_character_class_changed),t.current_nj_object.observe(this.nj_object_or_xvm_changed),t.current_textures.observe(this.nj_object_or_xvm_changed),t.current_nj_motion.observe(this.nj_motion_changed),t.show_skeleton.observe(this.show_skeleton_changed),t.animation_playing.observe(this.animation_playing_changed),t.animation_frame_rate.observe(this.animation_frame_rate_changed),t.animation_frame.observe(this.animation_frame_changed)),this.init_camera_controls(),this.reset_camera(_,m)}set_size(t,e){this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),super.set_size(t,e)}dispose(){super.dispose(),this.disposer.dispose()}render(){this.animation&&this.animation.mixer.update(this.clock.getDelta()),this.light_holder.quaternion.copy(this.camera.quaternion),super.render(),this.animation&&!this.animation.mixer.clipAction(this.animation.clip).paused&&(this.update_animation_frame(),this.schedule_render())}update_animation_frame(){if(this.animation){const t=this.animation.mixer.clipAction(this.animation.clip);t.paused||(this.update_animation_time=!1,this.store.set_animation_frame(t.time*o.a+1),this.update_animation_time=!0)}}}}}]);