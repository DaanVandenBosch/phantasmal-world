(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{457:function(t,e,s){"use strict";function n(t,e){return{success:!0,value:t,problems:null!=e?e:[]}}function r(t){return{success:!1,problems:null!=t?t:[]}}function i(t){if(t.success)return t.value;throw new Error(t.problems.join("\n"))}function o(t){return new a(t)}s.d(e,"c",(function(){return n})),s.d(e,"a",(function(){return r})),s.d(e,"d",(function(){return i})),s.d(e,"b",(function(){return o}));class a{constructor(t){this.logger=t,this.problems=[]}add_problem(t,e,s,n){return this.logger.log(t,s,n),this.problems.push({severity:t,ui_message:e}),this}add_result(t){return this.problems.push(...t.problems),this}success(t){return n(t,this.problems)}failure(){return r(this.problems)}}},458:function(t,e,s){"use strict";s.d(e,"b",(function(){return r})),s.d(e,"e",(function(){return i})),s.d(e,"c",(function(){return o})),s.d(e,"a",(function(){return c})),s.d(e,"d",(function(){return u}));var n=s(38);class r{constructor(t,e){this.x=t,this.y=e}get u(){return this.x}get v(){return this.y}}function i(t,e){return new r(t.x-e.x,t.y-e.y)}class o{constructor(t,e,s){this.x=t,this.y=e,this.z=s}}class a{constructor(t){this.data=t,Object(n.d)(9===t.length,"data should be of length 9.")}static of(t,e,s,n,r,i,o,c,u){return new a(new Float32Array([t,n,o,e,r,c,s,i,u]))}static identity(){return a.of(1,0,0,0,1,0,0,0,1)}get(t,e){return this.data[t+3*e]}set(t,e,s){this.data[t+3*e]=s}clone(){return new a(new Float32Array(this.data))}transpose(){let t;const e=this.data;t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t}inverse(){const t=this.clone();return t.invert(),t}invert(){const t=this.data[0],e=this.data[1],s=this.data[2],n=this.data[3],r=this.data[4],i=this.data[5],o=this.data[6],a=this.data[7],c=this.data[8],u=c*r-i*a,h=i*o-c*n,d=a*n-r*o,l=t*u+e*h+s*d;if(0===l)return this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=1,this.data[5]=0,this.data[6]=0,this.data[7]=0,void(this.data[8]=1);const _=1/l;this.data[0]=u*_,this.data[1]=(s*a-c*e)*_,this.data[2]=(i*e-s*r)*_,this.data[3]=h*_,this.data[4]=(c*t-s*o)*_,this.data[5]=(s*n-i*t)*_,this.data[6]=d*_,this.data[7]=(e*o-a*t)*_,this.data[8]=(r*t-e*n)*_}}class c{constructor(t){this.data=t,Object(n.d)(16===t.length,"data should be of length 16.")}static of(t,e,s,n,r,i,o,a,u,h,d,l,_,f,p,b){return new c(new Float32Array([t,r,u,_,e,i,h,f,s,o,d,p,n,a,l,b]))}static identity(){return c.of(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static translation(t,e,s){return c.of(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1)}static scale(t,e,s){return c.of(t,0,0,1,0,e,0,1,0,0,s,1,0,0,0,1)}static compose(t,e,s){const n=e.w,r=e.x,i=e.y,o=e.z,a=r+r,u=i+i,h=o+o,d=r*a,l=r*u,_=r*h,f=i*u,p=i*h,b=o*h,m=n*a,x=n*u,v=n*h,g=s.x,w=s.y,y=s.z;return c.of((1-(f+b))*g,(l-v)*w,(_+x)*y,t.x,(l+v)*g,(1-(d+b))*w,(p-m)*y,t.y,(_-x)*g,(p+m)*w,(1-(d+f))*y,t.z,0,0,0,1)}get(t,e){return this.data[t+4*e]}set(t,e,s){this.data[t+4*e]=s}clone(){return new c(new Float32Array(this.data))}normal_mat3(){const t=a.of(this.data[0],this.data[4],this.data[8],this.data[1],this.data[5],this.data[9],this.data[2],this.data[6],this.data[10]);return t.invert(),t.transpose(),t}}function u(t,e){const s=new c(new Float32Array(16));return h(s.data,t,e),s}function h(t,e,s){for(let n=0;n<4;n++)for(let r=0;r<4;r++)for(let i=0;i<4;i++)t[n+4*r]+=e.data[n+4*i]*s.data[i+4*r]}},477:function(t,e,s){"use strict";var n;s.d(e,"d",(function(){return n})),s.d(e,"b",(function(){return r})),s.d(e,"a",(function(){return i})),s.d(e,"c",(function(){return o})),s.d(e,"f",(function(){return a})),s.d(e,"e",(function(){return c})),s.d(e,"g",(function(){return u})),function(t){t[t.PosNorm=0]="PosNorm",t[t.PosTex=1]="PosTex",t[t.PosNormTex=2]="PosNormTex"}(n||(n={}));const r=0,i=1,o=2;function a(t){switch(t){case n.PosNorm:return 24;case n.PosTex:return 16;case n.PosNormTex:return 28}}function c(t){switch(t){case n.PosTex:return-1;case n.PosNorm:case n.PosNormTex:return 12}}function u(t){switch(t){case n.PosNorm:return-1;case n.PosTex:return 12;case n.PosNormTex:return 24}}},480:function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return c}));var n=s(457),r=s(23),i=s(26);const o=r.a.get("core/data_formats/parsing/iff");function a(t,e=!1){return u(t,e,[],(t,e,s)=>({type:e,data:t.take(s)}))}function c(t,e=!1){return u(t,e,[],(t,e,s)=>({type:e,size:s}))}function u(t,e,s,r){const a=Object(n.b)(o);let c=!1;for(;t.bytes_left>=8;){const n=t.u32(),o=t.position,u=t.u32();if(u>t.bytes_left){c=!0,e||a.add_problem(0===s.length?i.b.Error:i.b.Warning,"Invalid IFF format.",`Size ${u} was too large (only ${t.bytes_left} bytes left) at position ${o}.`);break}s.push(r(t,n,u))}return c&&0===s.length?a.failure():a.success(s)}},485:function(t,e,s){"use strict";var n=s(480),r=s(23);const i=r.a.get("core/data_formats/parsing/ninja/njcm");var o;function a(t,e){const s=t.u32(),n=t.u32(),r=t.vec3_f32(),i=t.f32(),a=[],u=[];if(s){t.seek_start(s);for(const s of c(t,e,!0))if(s.type===o.Vertex)for(const t of s.vertices)a[t.index]={position:t.position,normal:t.normal,bone_weight:t.bone_weight,bone_weight_status:t.bone_weight_status,calc_continue:t.calc_continue}}if(n){t.seek_start(n);let s=void 0,r=void 0,i=void 0;for(const n of c(t,e,!1))switch(n.type){case o.Bits:r=n.src_alpha,i=n.dst_alpha;break;case o.Tiny:s=n.texture_id;break;case o.Material:r=n.src_alpha,i=n.dst_alpha;break;case o.Strip:for(const t of n.triangle_strips)t.texture_id=s,t.src_alpha=r,t.dst_alpha=i;u.push(...n.triangle_strips)}}return{type:"njcm",vertices:a,meshes:u,collision_sphere_center:r,collision_sphere_radius:i}}function c(t,e,s){const n=[];let r=!0;for(;r;){const a=t.u8(),d=t.u8(),l=t.position;let _=0;if(0===a)n.push({type:o.Null,type_id:a});else if(1<=a&&a<=3)n.push({type:o.Bits,type_id:a,src_alpha:d>>>3&7,dst_alpha:7&d});else if(4===a){const s=d,i=t.position;n.push({type:o.CachePolygonList,type_id:a,cache_index:s,offset:i}),e[s]=i,r=!1}else if(5===a){const r=d,i=e[r];null!=i&&(t.seek_start(i),n.push(...c(t,e,s))),n.push({type:o.DrawPolygonList,type_id:a,cache_index:r})}else if(8<=a&&a<=9){_=2;const e=t.u16();n.push({type:o.Tiny,type_id:a,flip_u:0!=(128&a),flip_v:0!=(64&a),clamp_u:0!=(32&a),clamp_v:0!=(16&a),mipmap_d_adjust:15&a,filter_mode:e>>>14,super_sample:0!=(64&e),texture_id:8191&e})}else if(17<=a&&a<=31){let e,s,r;_=2+2*t.u16(),0!=(1&d)&&(e={b:t.u8()/255,g:t.u8()/255,r:t.u8()/255,a:t.u8()/255}),0!=(2&d)&&(s={b:t.u8()/255,g:t.u8()/255,r:t.u8()/255,a:t.u8()/255}),0!=(4&d)&&(r={b:t.u8(),g:t.u8(),r:t.u8(),e:t.u8()}),n.push({type:o.Material,type_id:a,src_alpha:d>>>3&7,dst_alpha:7&d,diffuse:e,ambient:s,specular:r})}else 32<=a&&a<=50?(_=2+4*t.u16(),n.push({type:o.Vertex,type_id:a,vertices:u(t,a,d)})):56<=a&&a<=58?(_=2+2*t.u16(),n.push({type:o.Volume,type_id:a})):64<=a&&a<=75?(_=2+2*t.u16(),n.push({type:o.Strip,type_id:a,triangle_strips:h(t,a,d)})):255===a?(_=s?2:0,n.push({type:o.End,type_id:a}),r=!1):(_=2+2*t.u16(),n.push({type:o.Unknown,type_id:a}),i.warn(`Unknown chunk type ${a} at offset ${l}.`));t.seek_start(l+_)}return n}function u(t,e,s){if(e<32||e>50)return i.warn(`Unknown vertex chunk type ${e}.`),[];const n=3&s,r=0!=(128&s),o=t.u16(),a=t.u16(),c=[];for(let s=0;s<a;++s){const i={index:o+s,position:t.vec3_f32(),bone_weight:1,bone_weight_status:n,calc_continue:r};if(32===e)t.seek(4);else if(33===e)t.seek(4),i.normal=t.vec3_f32(),t.seek(4);else if(35<=e&&e<=40)37===e?(i.index=o+t.u16(),i.bone_weight=t.u16()/255):t.seek(4);else if(41<=e&&e<=47)i.normal=t.vec3_f32(),e>=42&&(44===e?(i.index=o+t.u16(),i.bone_weight=t.u16()/255):t.seek(4));else if(48<=e&&e<=50){const s=t.u32();i.normal={x:(s>>20&1023)/1023,y:(s>>10&1023)/1023,z:(1023&s)/1023},e>=49&&t.seek(4)}c.push(i)}return c}function h(t,e,s){const n={ignore_light:0!=(1&s),ignore_specular:0!=(2&s),ignore_ambient:0!=(4&s),use_alpha:0!=(8&s),double_side:0!=(16&s),flat_shading:0!=(32&s),environment_mapping:0!=(64&s)},r=t.u16(),i=r>>>14,o=16383&r;let a=!1,c=!1,u=!1,h=!1;switch(e){case 64:break;case 65:case 66:a=!0;break;case 67:u=!0;break;case 68:case 69:a=!0,u=!0;break;case 70:c=!0;break;case 71:case 72:a=!0,c=!0;break;case 73:break;case 74:case 75:h=!0;break;default:throw new Error(`Unexpected chunk type ID: ${e}.`)}const d=[];for(let e=0;e<o;++e){const e=t.i16(),s=e<1,r=Math.abs(e),o=[];for(let e=0;e<r;++e){const s={index:t.u16()};o.push(s),a&&(s.tex_coords={x:t.u16()/255,y:t.u16()/255}),c&&t.seek(4),u&&(s.normal={x:t.u16()/255,y:t.u16()/255,z:t.u16()/255}),h&&t.seek(8),e>=2&&t.seek(2*i)}d.push(Object.assign(Object.assign({},n),{clockwise_winding:s,has_tex_coords:a,has_normal:u,vertices:o}))}return d}!function(t){t[t.Unknown=0]="Unknown",t[t.Null=1]="Null",t[t.Bits=2]="Bits",t[t.CachePolygonList=3]="CachePolygonList",t[t.DrawPolygonList=4]="DrawPolygonList",t[t.Tiny=5]="Tiny",t[t.Material=6]="Material",t[t.Vertex=7]="Vertex",t[t.Volume=8]="Volume",t[t.Strip=9]="Strip",t[t.End=10]="End"}(o||(o={}));const d=r.a.get("core/data_formats/parsing/ninja/xj");function l(t){t.seek(4);const e=t.u32(),s=t.u32(),n=t.u32(),r=t.u32(),i=t.u32(),o=t.u32(),a={type:"xj",vertices:[],meshes:[],collision_sphere_position:t.vec3_f32(),collision_sphere_radius:t.f32()};return s>=1&&(s>1&&d.warn(`Vertex info count of ${s} was larger than expected.`),a.vertices.push(...function(t,e){t.seek_start(e);const s=t.u16();t.seek(2);const n=t.u32(),r=t.u32(),i=t.u32(),o=[];for(let e=0;e<i;++e){t.seek_start(n+e*r);const i=t.vec3_f32();let a,c;switch(s){case 3:a=t.vec3_f32(),c=t.vec2_f32();break;case 4:break;case 5:t.seek(4),c=t.vec2_f32();break;case 6:a=t.vec3_f32();break;case 7:a=t.vec3_f32(),c=t.vec2_f32();break;default:d.warn(`Unknown vertex type ${s} with size ${r}.`)}o.push({position:i,normal:a,uv:c})}return o}(t,e))),a.meshes.push(..._(t,n,r)),a.meshes.push(..._(t,i,o)),a}function _(t,e,s){const n=[];for(let r=0;r<s;++r){t.seek_start(e+20*r);const s=t.u32(),i=t.u32(),o=t.u32(),a=t.u32(),c=f(t,s,i);t.seek_start(o);const u=t.u16_array(a);n.push({material_properties:c,indices:u})}return n}function f(t,e,s){const n={};for(let r=0;r<s;++r){switch(t.seek_start(e+16*r),t.u32()){case 2:n.src_alpha=t.u32(),n.dst_alpha=t.u32();break;case 3:n.texture_id=t.u32();break;case 5:n.diffuse_r=t.u8(),n.diffuse_g=t.u8(),n.diffuse_b=t.u8(),n.diffuse_a=t.u8()}}return n}var p=s(457);s.d(e,"a",(function(){return b})),s.d(e,"b",(function(){return x})),s.d(e,"c",(function(){return g})),s.d(e,"d",(function(){return w})),s.d(e,"e",(function(){return y}));const b=2*Math.PI/65535,m=1296255566;function x(t){return"njcm"===t.type}class v{constructor(t,e,s,n,r,i){this.bone_cache=new Map,this._bone_count=-1,this.evaluation_flags=t,this.model=e,this.position=s,this.rotation=n,this.scale=r,this._children=i,this.children=this._children}bone_count(){if(-1===this._bone_count){const t=[0];this.get_bone_internal(this,Number.MAX_SAFE_INTEGER,t),this._bone_count=t[0]}return this._bone_count}get_bone(t){let e=this.bone_cache.get(t);return void 0===e&&(e=this.get_bone_internal(this,t,[0]),this.bone_cache.set(t,e||null)),e||void 0}add_child(t){this._bone_count=-1,this.bone_cache.clear(),this._children.push(t)}get_bone_internal(t,e,s){if(!t.evaluation_flags.skip){const n=s[0]++;if(this.bone_cache.set(n,t),n===e)return t}if(!t.evaluation_flags.break_child_trace)for(const n of t.children){const t=this.get_bone_internal(n,e,s);if(t)return t}}}function g(t){return k(t,a,[])}function w(t){return k(t,l,void 0)}function y(t){return j(t,l,void 0)}function k(t,e,s){const r=Object(n.a)(t);if(!r.success)return r;const i=r.value.filter(t=>t.type===m),o=[];for(const t of i)o.push(...j(t.data,e,s));return Object(p.c)(o,r.problems)}function j(t,e,s){const n=t.u32(),r=0!=(1&n),i=0!=(2&n),o=0!=(4&n),a=0!=(8&n),c=0!=(16&n),u=0!=(32&n),h=0!=(64&n),d=0!=(128&n),l=t.u32(),_=t.vec3_f32(),f={x:t.i32()*b,y:t.i32()*b,z:t.i32()*b},p=t.vec3_f32(),m=t.u32(),x=t.u32();let g,w,y;return l&&(t.seek_start(l),g=e(t,s)),m?(t.seek_start(m),w=j(t,e,s)):w=[],x?(t.seek_start(x),y=j(t,e,s)):y=[],[new v({no_translate:r,no_rotate:i,no_scale:o,hidden:a,break_child_trace:c,zxy_rotation_order:u,skip:h,shape_skip:d},g,_,f,p,w),...y]}},515:function(t,e,s){"use strict";s.d(e,"b",(function(){return i})),s.d(e,"a",(function(){return o}));var n=s(133),r=s(458);function i(t){return new n.Vector3(t.x,t.y,t.z)}function o(t){return new r.c(t.x,t.y,t.z)}},517:function(t,e,s){"use strict";s.d(e,"a",(function(){return r})),s.d(e,"b",(function(){return i}));var n=s(458);class r{constructor(){this.root_node=new i(void 0,n.a.identity())}traverse(t,e){this.traverse_node(this.root_node,t,e)}traverse_node(t,e,s){const n=e(t,s);for(const s of t.children)this.traverse_node(s,e,n)}}class i{constructor(t,e,...s){this.mesh=t,this.transform=e,this._children=s}get children(){return this._children}add_child(t){this._children.push(t)}clear_children(){this._children.splice(0)}}},651:function(t,e,s){"use strict";var n=s(477);class r{constructor(t){this.format=t,this.vertex_data=[],this.index_data=[]}get vertex_count(){return this.vertex_data.length}triangle(t,e,s){return this.index_data.push(t,e,s),this}build(){const t=Object(n.f)(this.format),e=Object(n.e)(this.format),s=Object(n.g)(this.format),r=new ArrayBuffer(this.vertex_data.length*t),i=new DataView(r);let o=0;for(const{pos:n,normal:r,tex:a}of this.vertex_data)i.setFloat32(o,n.x,!0),i.setFloat32(o+4,n.y,!0),i.setFloat32(o+8,n.z,!0),-1!==e&&(i.setFloat32(o+e,r.x,!0),i.setFloat32(o+e+4,r.y,!0),i.setFloat32(o+e+8,r.z,!0)),-1!==s&&(i.setUint16(o+s,65535*a.x,!0),i.setUint16(o+s+2,65535*a.y,!0)),o+=t;const a=new Uint16Array(2*Math.ceil(this.index_data.length/2));return a.set(this.index_data),new c(this.format,r,a,this.index_data.length,this._texture)}}class i extends r{constructor(){super(n.d.PosNorm)}vertex(t,e){return this.vertex_data.push({pos:t,normal:e}),this}}class o extends r{constructor(){super(n.d.PosTex)}vertex(t,e){return this.vertex_data.push({pos:t,tex:e}),this}texture(t){return this._texture=t,this}}class a extends r{constructor(){super(n.d.PosNormTex)}vertex(t,e,s){return this.vertex_data.push({pos:t,normal:e,tex:s}),this}texture(t){return this._texture=t,this}}s.d(e,"a",(function(){return c}));class c{constructor(t,e,s,n,r){this.format=t,this.vertex_data=e,this.index_data=s,this.index_count=n,this.texture=r}static builder(t){switch(t){case n.d.PosNorm:return new i;case n.d.PosTex:return new o;case n.d.PosNormTex:return new a}}upload(t){var e;null===(e=this.texture)||void 0===e||e.upload(),null==this.gfx_mesh&&(this.gfx_mesh=t.create_gfx_mesh(this.format,this.vertex_data,this.index_data,this.texture))}destroy(t){t.destroy_gfx_mesh(this.gfx_mesh)}}},898:function(t,e,s){"use strict";s.r(e);var n,r=s(15),i=s(485),o=s(515),a=s(651),c=s(517),u=s(477);!function(t){t[t.ZXY=0]="ZXY",t[t.ZYX=1]="ZYX"}(n||(n={}));class h{constructor(t,e,s,n){this.w=t,this.x=e,this.y=s,this.z=n}static euler_angles(t,e,s,r){const i=Math.cos(.5*t),o=Math.sin(.5*t),a=Math.cos(.5*e),c=Math.sin(.5*e),u=Math.cos(.5*s),d=Math.sin(.5*s);switch(r){case n.ZXY:return new h(i*a*u-o*c*d,o*a*u-i*c*d,i*c*u+o*a*d,i*a*d+o*c*u);case n.ZYX:return new h(i*a*u+o*c*d,o*a*u-i*c*d,i*c*u+o*a*d,i*a*d-o*c*u)}}}var d=s(458);const l=new d.c(0,1,0),_=(new d.b(0,0),new d.c(0,0,0)),f=new h(1,0,0,0),p=new d.c(1,1,1);class b{constructor(){this.vertices_stack=[]}put(t){this.vertices_stack.push(t)}get(t){const e=[];for(let s=this.vertices_stack.length-1;s>=0;s--){const n=this.vertices_stack[s][t];n&&e.push(n)}return e}}class m{constructor(){this.vertices=new b}to_node(t){const{no_translate:e,no_rotate:s,no_scale:r,hidden:i,break_child_trace:o,zxy_rotation_order:a,skip:u}=t.evaluation_flags,{position:l,rotation:b,scale:m}=t,x=d.a.compose(e?_:l,s?f:h.euler_angles(b.x,b.y,b.z,a?n.ZXY:n.ZYX),r?p:m);let v;t.model&&!i&&(v=this.model_to_mesh(t.model));const g=new c.b(v,x);if(!o)for(const e of t.children)g.add_child(this.to_node(e));return g}model_to_mesh(t){return Object(i.b)(t)?this.njcm_model_to_mesh(t):this.xj_model_to_mesh(t)}njcm_model_to_mesh(t){var e,s;const n=t.vertices.map(t=>{return{position:Object(o.a)(t.position),normal:t.normal?Object(o.a)(t.normal):l,bone_weight:t.bone_weight,bone_weight_status:t.bone_weight_status,calc_continue:t.calc_continue}});this.vertices.put(n);const r=a.a.builder(u.d.PosNorm);for(const n of t.meshes)for(let t=0;t<n.vertices.length;++t){const i=n.vertices[t],o=this.vertices.get(i.index);if(o.length){const a=o[0],c=null!=(s=null!=(e=a.normal)?e:i.normal)?s:l,u=r.vertex_count;r.vertex(a.position,c),u>=2&&(t%2==(n.clockwise_winding?1:0)?r.triangle(u-2,u-1,u):r.triangle(u-2,u,u-1))}}return r.build()}xj_model_to_mesh(t){const e=a.a.builder(u.d.PosNorm);for(const{position:s,normal:n}of t.vertices)e.vertex(Object(o.a)(s),n?Object(o.a)(n):l);for(const s of t.meshes){let t=!1;for(let n=2;n<s.indices.length;++n){const r=s.indices[n-2],i=s.indices[n-1],o=s.indices[n];t?e.triangle(i,r,o):e.triangle(r,i,o),t=!t}}return e.build()}}s.d(e,"ModelGfxRenderer",(function(){return x}));class x{constructor(t,e){this.store=t,this.renderer=e,this.disposer=new r.a,this.nj_object_or_xvm_changed=()=>{this.renderer.destroy_scene();const t=this.store.current_nj_object.val;if(t){const e=function(t){return(new m).to_node(t)}(t);this.renderer.scene.root_node.add_child(e),this.renderer.scene.traverse(t=>{var e;null===(e=t.mesh)||void 0===e||e.upload(this.renderer.gfx)},void 0)}this.renderer.schedule_render()},this.canvas_element=e.canvas_element,e.camera.pan(0,0,50),this.disposer.add_all(t.current_nj_object.observe(this.nj_object_or_xvm_changed))}dispose(){this.disposer.dispose()}start_rendering(){this.renderer.start_rendering()}stop_rendering(){this.renderer.stop_rendering()}set_size(t,e){this.renderer.set_size(t,e)}}}}]);